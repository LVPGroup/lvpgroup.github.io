<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory LocalRG_HoareDef (Isabelle2020: April 2020)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory LocalRG_HoareDef</h1>

<span class="command">theory</span> <span class="name">LocalRG_HoareDef</span><br/>
<span class="keyword">imports</span> <a href="SmallStepCon.html"><span class="name">SmallStepCon</span></a> <a href="../../AFP/EmbSimpl/HoarePartialProps.html"><span class="name">HoarePartialProps</span></a> <a href="Countable.html"><span class="name">Countable</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
    Author:      David Sanan
    Maintainer:  David Sanan, sanan at ntu edu sg
    License:     LGPL
*)</span></span></span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*  Title:      LocalRG_HoareDef.thy
    Author:     David Sanan, NTU

Copyright (C) 2015-2016 David Sanan 
Some rights reserved, NTU
This library is free software; you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as
published by the Free Software Foundation; either version 2.1 of the
License, or (at your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>LocalRG_HoareDef</span><span>           
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;SmallStepCon&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EmbSimpl.HoarePartialProps&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;HOL-Library.Countable&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Validity  of Correctness Formulas&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Aux&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span class="delimiter">(</span><span>input</span><span class="delimiter">)</span><span>
</span><span>  </span><span>set_fun</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a set &#8658; &#39;a &#8658; bool&quot;</span></span></span><span>  </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_<span class="hidden">&#8681;</span><sub>f</sub>&quot;</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;set_fun s &#8801; &#955;v. v&#8712;s&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span class="delimiter">(</span><span>input</span><span class="delimiter">)</span><span>
</span><span>  </span><span>fun_set</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;a &#8658; bool) &#8658; &#39;a set&quot;</span></span></span><span>  </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_<span class="hidden">&#8681;</span><sub>s</sub>&quot;</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;fun_set f &#8801; {&#963;. f &#963;}&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tl_pair</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc j) &lt; length l &#10233;     
       l1 = tl l &#10233;
       P (l!(Suc j)) (l!(Suc (Suc j)))=
       P  (l1!j) (l1!(Suc j))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>tl_zero_eq</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>for_all_k_sublist</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc j)&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k &lt; j. P ((tl l)!k) ((tl l)!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;P (l!0) (l!(Suc 0))&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k &lt; Suc j.  P (l!k) (l!(Suc k)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>aa0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; Suc j&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P (l!k) (l!(Suc k))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>k1</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>aa0</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>Suc_less_SucD</span><span> </span><span>dual_order.strict_trans</span><span> </span><span>length_greater_0_conv</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Validity for Component Programs.&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;f</span><span class="delimiter">)</span><span> </span><span>tran</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;f) xstate &#215; (&#39;s,&#39;f) xstate&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;p</span><span class="delimiter">,</span><span class="tfree">&#39;f</span><span class="delimiter">,</span><span class="tfree">&#39;e</span><span class="delimiter">)</span><span> </span><span>rgformula</span><span> </span><span class="delimiter">=</span><span>  
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;((&#39;s,&#39;p,&#39;f,&#39;e) com &#215;      
    (&#39;s set) &#215;         
    ((&#39;s,&#39;f) tran) set &#215;
    ((&#39;s,&#39;f) tran) set &#215;
    (&#39;s set) &#215; 
    (&#39;s set))&quot;</span></span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* A *)</span></span></span></span></span><span>
</span><span>    
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;p</span><span class="delimiter">,</span><span class="tfree">&#39;f</span><span class="delimiter">,</span><span class="tfree">&#39;e</span><span class="delimiter">)</span><span> </span><span>sextuple</span><span> </span><span class="delimiter">=</span><span>  
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;p &#215;     
    (&#39;s set) &#215;         
    ((&#39;s,&#39;f) tran) set &#215; 
    ((&#39;s,&#39;f) tran) set &#215; 
    (&#39;s set) &#215;
    (&#39;s set))&quot;</span></span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* A *)</span></span></span></span></span><span>    
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Sta</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s set &#8658; ((&#39;s,&#39;f) tran) set &#8658; bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Sta &#8801; &#955;f g. (&#8704;x y x&#39;. x&#39; &#8712; f &#8743; x=Normal x&#39; &#10230;  (x,y)&#8712; g &#10230; (&#8707;y&#39;. y=Normal y&#39; &#8743; y&#39; &#8712; f))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Sta_intro</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R &#10233; Sta b R &#10233; Sta (a &#8745; b) R&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Sta_assoc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta (a &#8745; (b &#8745; c)) R = Sta ((a&#8745;b)&#8745;c) R&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Sta_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta (a &#8745; b) R = Sta (b &#8745; a) R&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Sta_add</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta (a &#8745; b) R &#10233; Sta (a &#8745; c) R &#10233;
       Sta (a &#8745; b &#8745; c) R&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Sta_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R &#10233; a = b &#10233; Sta b R&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Norm</span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#39;s,&#39;f) tran) set &#8658; bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Norm &#8801; &#955;g. (&#8704;x y. (x, y) &#8712; g &#10230; (&#8707;x&#39; y&#39;. x=Normal x&#39; &#8743; y=Normal y&#39;))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>env_tran</span><span class="delimiter">::</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;p &#8658; (&#39;s, &#39;p, &#39;f,&#39;e) LanguageCon.com option)
     &#8658; (&#39;s set)
        &#8658; ((&#39;s, &#39;p, &#39;f,&#39;e) LanguageCon.com &#215; (&#39;s, &#39;f) xstate) list
           &#8658; (&#39;s,&#39;f) tran set &#8658; bool&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; q l rely &#8801; snd(l!0) &#8712; Normal ` q &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                  
                   (snd(l!i), snd(l!(Suc i))) &#8712; rely)
&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>env_tran_right</span><span class="delimiter">::</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;p &#8658; (&#39;s, &#39;p, &#39;f,&#39;e) LanguageCon.com option)     
        &#8658; ((&#39;s, &#39;p, &#39;f,&#39;e) LanguageCon.com &#215; (&#39;s, &#39;f) xstate) list
           &#8658; (&#39;s,&#39;f) tran set &#8658; bool&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8801; 
   (&#8704;i. Suc i&lt;length l &#10230; 
        &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                  
        (snd(l!i), snd(l!(Suc i))) &#8712; rely)
&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>env_tran_tail</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; (x#l) R &#10233; env_tran_right &#915; l R&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>env_tran_subr</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; (l1@l2) R&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l1 R&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length l1&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l1 ! Suc i&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (l1@l2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l1@l2) ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1@l2) ! Suc i&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd ((l1@l2)! i), snd ((l1@l2) ! Suc i)) &#8712; R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l1! i), snd (l1 ! Suc i)) &#8712;  R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ps psa n. if n &lt; length ps then (ps @ psa) ! n = (ps ! n::(&#39;b, &#39;a, &#39;c,&#39;d) LanguageCon.com &#215; (&#39;b, &#39;c) xstate) 
                   else (ps @ psa) ! n = psa ! (n - length ps)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc i &lt; length l1&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> 
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length l1 &#10230;
        &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l1 ! Suc i &#10230;
        (snd (l1 ! i), snd (l1 ! Suc i)) &#8712; R&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Satis</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Satis &#8801; True&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>sep_conj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sep_conj &#8801; True&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>env_tran_subl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; (l1@l2) R &#10233; env_tran_right &#915; l2 R&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>a</span><span> </span><span>l1</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>intro</span><span class="delimiter">:</span><span>append_Cons</span><span> </span><span>env_tran_tail</span><span> </span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>env_tran_R_R&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R &#10233;  
                     (R  &#8838; R&#39;) &#10233;
                     env_tran_right &#915; l R&#39;&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>Satis_def</span><span> </span><span>sep_conj_def</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>allE</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>env_tran_normal</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely &#8743;  snd(l!i) = Normal s1 &#8743; s1&#8712;q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l &#8743;  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s1 s2. snd(l!i) = Normal s1 &#8743; snd(l!(Suc i)) = Normal s2 &#8743; s2&#8712;q&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_env_tran_not_normal</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely &#8743;  snd(l!i) = Normal s1 &#8743; s1&#8712;q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l &#8743;  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s1. &#172; (snd(l!i) = Normal s1)) &#8744; (&#8704;s2. &#172; (snd (l!Suc i) = Normal s2))&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span> 
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>assum</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s set &#215; (&#39;s,&#39;f) tran set) &#8658; ((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;assum &#8801; &#955;(pre, rely). 
             {c. snd((snd c)!0) &#8712; Normal ` pre &#8743; 
                 (&#8704;i. Suc i&lt;length (snd c) &#10230; 
                 (fst c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd c)!(Suc i)) &#10230;                  
                   (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712;  rely)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>assum1</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s set &#215; (&#39;s,&#39;f) tran set) &#8658;
   &#39;f set &#8658;
     ((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;assum1 &#8801; &#955;(pre, rely) F. 
             {(&#915;,comp). snd(comp!0) &#8712; Normal ` pre &#8743; 
                 (&#8704;i. Suc i&lt;length comp &#10230; 
                  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(comp!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (comp!(Suc i)) &#10230;                  
                   (snd(comp!i), snd(comp!(Suc i))) &#8712;  rely)}&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assum_R_R&#39;</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; assum(p, R) &#10233;
    snd(l!0) &#8712; Normal `  p&#39; &#10233;
    R &#8838; R&#39;  &#10233; 
   (&#915;, l) &#8712; assum(p&#39;, R&#39;)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; assum(p, R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal `  p&#39;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; R &#8838; R&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_right_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&#39;&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a2</span><span> </span><span>env_tran_R_R&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>same_prog_p</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(P,t)#l)&#8712;cptn &#10233;
   (&#915;,(P,s)#(P,t)#l) &#8712; assum (p,R) &#10233;
   Sta p R  &#10233;
   &#8707;t1. t=Normal t1 &#8743; t1 &#8712; p
  &quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(P,t)#l)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(P,t)#l) &#8712; assum (p,R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc 0 &lt; length ((P,s)#(P,t)#l)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(((P,s)#(P,t)#l)!0)  &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (((P,s)#(P,t)#l)!(Suc 0))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>cptn_stepc_rtran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step_ce</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(((P,s)#(P,t)#l)!0)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (((P,s)#(P,t)#l)!(Suc 0)) &#8744;
             &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(((P,s)#(P,t)#l)!0)  &#8594; (((P,s)#(P,t)#l)!(Suc 0))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s=Normal s1 &#8743; s1 &#8712; p&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t1. t=Normal t1 &#8743; t1 &#8712; p &quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step_e</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((P, s) # (P, t) # l) ! 0 &#8594;<span class="hidden">&#8681;</span><sub>e</sub>
          ((P, s) # (P, t) # l) ! Suc 0&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span>s</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span>assum_def</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc 0 &lt; length ((P, s) # (P, t) # l))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(s, t) &#8712; R&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span>a1</span><span> </span><span>step_e</span><span>
</span><span>         </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t1</span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s_t</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s= Normal s2 &#8743; t = Normal t1&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>s</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>R</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(s,t)&#8712;R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assm</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2=s1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span>s_t</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;t1&#8712;p&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>s</span><span> </span><span>s_t</span><span> </span><span>R</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span>Norm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s_t</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((P, s) # (P, t) # l) ! 0 &#8594;
          ((P, s) # (P, t) # l) ! Suc 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&#8800;P &#8744; s=t&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (P, s) &#8594; (P, t)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>local.step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_change_p_or_eq_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span>  </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tl_of_assum_in_assum</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(P,t)#l)&#8712;cptn &#10233;
   (&#915;,(P,s)#(P,t)#l) &#8712; assum (p,R) &#10233;
   Sta p R  &#10233;
   (&#915;,(P,t)#l) &#8712; assum (p,R)
  &quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(P,t)#l)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(P,t)#l) &#8712; assum (p,R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R &quot;</span></span></span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>t1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;t=Normal t1 &#8743; t1 &#8712;p&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>same_prog_p</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((P,s)#(P,t)#l) R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((P,t)#l) R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>t1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tl_of_assum_in_assum1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(Q,t)#l)&#8712;cptn &#10233;
   (&#915;,(P,s)#(Q,t)#l) &#8712; assum (p,R) &#10233;
   t &#8712; Normal ` q &#10233;
   (&#915;,(Q,t)#l) &#8712; assum (q,R) 
  &quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(Q,t)#l)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s)#(Q,t)#l) &#8712; assum (p,R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;t &#8712; Normal ` q&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((P,s)#(Q,t)#l) R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((Q,t)#l) R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>sub_assum</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(x#l0)@l1) &#8712; assum (p,R)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x#l0) &#8712; assum (p,R)&quot;</span></span></span><span>    
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd x &#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((x#l0)@l1) R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>env_tran_right_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; (x#l0) R&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_subr</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd ((x#l0)!0)  &#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd ((x#l0)!0)  &#8712; Normal ` p &#8743; 
                  (&#8704;i. Suc i&lt;length (x#l0) &#10230; 
                       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((x#l0)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((x#l0)!(Suc i)) &#10230;                  
                       (snd((x#l0)!i), snd((x#l0)!(Suc i))) &#8712; R)&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>sub_assum_r</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l0@x1#l1) &#8712; assum (p,R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd x1) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x1#l1) &#8712; assum (q,R)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right  &#915; (l0@x1#l1) R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>env_tran_right_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; (x1#l1) R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_subl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>comm</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((&#39;s,&#39;f) tran) set &#215; 
   (&#39;s set &#215; &#39;s set) &#8658;
   &#39;f set &#8658; 
     ((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;comm &#8801; &#955;(guar, (q,a)) F. 
            {c. snd (last (snd c)) &#8713; Fault ` F  &#10230; 
                (&#8704;i. 
                 Suc i&lt;length (snd c) &#10230; 
                 (fst c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd c)!i)  &#8594; ((snd c)!(Suc i)) &#10230;                                        
                   (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712; guar) &#8743; 
                 (final (last (snd c))  &#10230;                   
                    ((fst (last (snd c)) = Skip &#8743; 
                      snd (last (snd c)) &#8712; Normal ` q)) &#8744;
                    (fst (last (snd c)) = Throw &#8743; 
                      snd (last (snd c)) &#8712; Normal ` a))}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>comm1</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((&#39;s,&#39;f) tran) set &#215; 
   (&#39;s set &#215; &#39;s set) &#8658;
   &#39;f set &#8658; 
     ((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;comm1 &#8801; &#955;(guar, (q,a)) F. 
            {(&#915;,comp). snd (last comp) &#8713; Fault ` F  &#10230; 
                (&#8704;i. 
                 Suc i&lt;length comp &#10230; 
                 &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(comp!i)  &#8594; (comp!(Suc i)) &#10230;                                        
                   (snd(comp!i), snd(comp!(Suc i))) &#8712; guar) &#8743; 
                 (final (last comp)  &#10230;                   
                    ((fst (last comp) = Skip &#8743; 
                      snd (last comp) &#8712; Normal ` q)) &#8744;
                    (fst (last comp) = Throw &#8743; 
                      snd (last comp) &#8712; Normal ` a))}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_dest</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l)&#8712; comm (G,(q,a)) F &#10233;
 snd (last l) &#8713; Fault ` F &#10233;
 (&#8704;i. Suc i&lt;length l &#10230;
   &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230; 
    (snd(l!i), snd(l!(Suc i))) &#8712;  G)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>mp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>conjE</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>allE</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_dest1</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l)&#8712; comm (G,(q,a)) F &#10233;
 snd (last l) &#8713; Fault ` F &#10233;
 Suc i&lt;length l &#10233;
 &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10233;
(snd(l!i), snd(l!(Suc i))) &#8712; G&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>drule</span><span> </span><span>mp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>conjE</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>allE</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_dest2</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l)&#8712; comm (G,(q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; ((fst (last l) = Skip &#8743; 
            snd (last l) &#8712; Normal ` q)) &#8744;
            (fst (last l) = Throw &#8743; 
            snd (last l) &#8712; Normal ` a)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_des3</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l)&#8712; comm (G,(q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span> </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l) &#10230; ((fst (last l) = Skip &#8743; 
            snd (last l) &#8712; Normal ` q)) &#8744;
            (fst (last l) = Throw &#8743; 
            snd (last l) &#8712; Normal ` a)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>commI</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F &#10233;
             (&#8704;i. 
                 Suc i&lt;length l &#10230; 
                 &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                               
                   (snd(l!i), snd(l!(Suc i))) &#8712; G) &#8743; 
                 (final (last l)  &#10230;                   
                    ((fst (last l) = Skip &#8743; 
                      snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                      snd (last l) &#8712; Normal ` a))&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;comm (G, (q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_conseq</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G&#39;, (q&#39;,a&#39;)) F &#10233;
       G&#39; &#8838; G &#8743;
       q&#39; &#8838; q &#8743;
       a&#39; &#8838; a &#10233;
      (&#915;,l) &#8712; comm (G,(q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G&#39;, (q&#39;,a&#39;)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; G&#39; &#8838; G  &#8743;
        q&#39; &#8838; q &#8743;
        a&#39; &#8838; a&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F &quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. 
           Suc i&lt;length l &#10230; 
           &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                          
             (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>             </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))&quot;</span></span></span><span>             
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!i), snd(l!(Suc i))) &#8712;  G&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!i), snd(l!(Suc i))) &#8712;  G&#39;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_dest1</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a</span><span> </span><span>a00</span><span> </span><span>a11</span><span class="delimiter">]</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span> </span><span>sep_conj_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                   
                    ((fst (last l) = Skip &#8743; 
                      snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                      snd (last l) &#8712; Normal ` a))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a33</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                      snd (last l) &#8712; Normal ` q&#39;)) &#8744;
                    (fst (last l) = Throw &#8743; 
                      snd (last l) &#8712; Normal ` a&#39;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_dest2</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a33</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                      snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                      snd (last l) &#8712; Normal ` a)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res1</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l</span><span> </span><span>this</span><span class="delimiter">]</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span>  </span><span>no_comp_tran_no_final_comm</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. &#172; final (l!i)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. fst (l!i) = C&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l&gt;0&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>n_comp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length l &#10230; &#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!i) &#8594; (l!Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>mod_env_not_component</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length(l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>             </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>n_comp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a2</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>com_validity</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#8658;  &#39;f set &#8658; (&#39;s,&#39;p,&#39;f,&#39;e) com &#8658; 
    &#39;s set &#8658; ((&#39;s,&#39;f) tran) set &#8658;  ((&#39;s,&#39;f) tran) set &#8658;  
    &#39;s set &#8658;  &#39;s set &#8658;  bool&quot;</span></span></span><span> 
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872;<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub>/ _ sat [_,_, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a] &#8801; 
   &#8704;s. cp &#915; Pr s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>com_cvalidity</span><span class="delimiter">::</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#8658;
    (&#39;s,&#39;p,&#39;f,&#39;e) sextuple set &#8658;
    &#39;f set &#8658;
    (&#39;s,&#39;p,&#39;f,&#39;e) com &#8658; 
    &#39;s set &#8658;          
    ((&#39;s,&#39;f) tran) set &#8658; 
    ((&#39;s,&#39;f) tran) set &#8658;  
    &#39;s set &#8658; 
    &#39;s set &#8658;
      bool&quot;</span></span></span><span> 
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_,_ &#8872;<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub>/ _ sat [_,_, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a] &#8801; 
   (&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]) &#10230; 
     &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>com_validityn</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#8658; nat &#8658; &#39;f set  &#8658; (&#39;s,&#39;p,&#39;f,&#39;e) com &#8658; 
    &#39;s set &#8658; ((&#39;s,&#39;f) tran) set &#8658;  ((&#39;s,&#39;f) tran) set &#8658;  
    &#39;s set &#8658;  &#39;s set &#8658;  bool&quot;</span></span></span><span> 
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872;_<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub>/ _ sat [_,_, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a] &#8801; 
   &#8704;s. cpn n &#915; Pr s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>com_cvalidityn</span><span class="delimiter">::</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#8658;
    (&#39;s,&#39;p,&#39;f,&#39;e) sextuple set &#8658; nat &#8658;
    &#39;f set &#8658;
    (&#39;s,&#39;p,&#39;f,&#39;e) com &#8658; 
    &#39;s set &#8658;          
    ((&#39;s,&#39;f) tran) set &#8658; 
    ((&#39;s,&#39;f) tran) set &#8658;  
    &#39;s set &#8658; 
    &#39;s set &#8658;
      bool&quot;</span></span></span><span> 
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_,_ &#8872;_<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub>/ _ sat [_,_, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a] &#8801; 
   (&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]) &#10230; 
     &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>com_valid_iff_nvalid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a]) = (&#8704;n. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a])&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>only</span><span class="delimiter">:</span><span> </span><span>com_validity_def</span><span> </span><span>com_validityn_def</span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_eq_cptn_mod_nest</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>com_cnvalid_to_cvalid</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;n. (&#915;,&#920;&#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a])) &#10233; (&#915;,&#920;&#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a])&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>unfold</span><span> </span><span>com_cvalidityn_def</span><span> </span><span>com_cvalidity_def</span><span> </span><span>com_valid_iff_nvalid</span><span> </span><span class="delimiter">[</span><span>THEN</span><span> </span><span>eq_reflection</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>etran_in_comm</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P, t) # xs) &#8712; comm(G, (q,a)) F  &#10233; 
    &#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((P,s))  &#8594; ((P,t))) &#10233;
    (&#915;,(P, s) # (P, t) # xs) &#8712; cptn &#10233;    
   (&#915;,(P, s) # (P, t) # xs) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P, t) # xs) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((P,s))  &#8594; ((P,t))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P, s) # (P, t) # xs) &#8712; cptn&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_def</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P, t) # xs&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P, s) # ?l1&quot;</span></span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length ?l &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?l!i)  &#8594; (?l!(Suc i)) &#10230;                          
                 (snd(?l!i), snd(?l!(Suc i))) &#8712;  G)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length  ?l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>a12</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (?l ! i) &#8594; ( ?l ! Suc i)&quot;</span></span></span><span>               
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length ?l1 &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?l1!i)  &#8594; (?l1!(Suc i)) &#10230;                             
               (snd(?l1!i), snd(?l1!(Suc i))) &#8712;  G)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (?l ! i), snd (?l ! Suc i)) &#8712;  G&quot;</span></span></span><span>         
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (P, s) &#8594; (P, t)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a12</span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>             
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((P, t) # xs) ! n &#8594; ((P, t) # xs) ! Suc n&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>a12</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n &lt; length ((P, t) # xs)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                       
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ((P, t) # xs)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a00</span><span> </span><span>last.simps</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (((P, t) # xs) ! n), snd (((P, t) # xs) ! Suc n)) &#8712; G&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span>a1</span><span> </span><span>comm_dest1</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>            
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last ?l)  &#10230;                   
                    ((fst (last ?l) = Skip &#8743; 
                      snd (last ?l) &#8712; Normal ` q)) &#8744;
                    (fst (last ?l) = Throw &#8743; 
                      snd (last ?l) &#8712; Normal ` a))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res1</span><span class="delimiter">=</span><span>conjI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">}</span></span><span>   
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ctran_in_comm</span><span class="delimiter">:</span><span>   
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; (Normal s,Normal s) &#8712; G  &#10233;
   (&#915;,(Q, Normal s) # xs) &#8712; comm(G, (q,a)) F  &#10233;        
   (&#915;,(P, Normal s) # (Q, Normal s) # xs) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s,Normal s) &#8712; G&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Q, Normal s) # xs) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>          
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_def</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Q, Normal s) # xs&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P, Normal s) # ?l1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length ?l &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?l!i)  &#8594; (?l!(Suc i)) &#10230;                                              
                 (snd(?l!i), snd(?l!(Suc i))) &#8712;  G)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length  ?l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>a12</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (?l ! i) &#8594; ( ?l ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length ?l1 &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?l1!i)  &#8594; (?l1!(Suc i)) &#10230;                              
               (snd(?l1!i), snd(?l1!(Suc i))) &#8712;  G)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (?l ! i), snd (?l ! Suc i)) &#8712; G&quot;</span></span></span><span>   
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>     
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (((P, Normal s) # (Q, Normal s) # xs) ! i) = Normal s &#8743; 
                     snd (((P, Normal s) # (Q, Normal s) # xs) ! (Suc i)) = Normal s&quot;</span></span></span><span>                
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s, Normal s) &#8712; G&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Satis_def</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span>  </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>Satis_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>            
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>a2</span><span>  </span><span>a11</span><span> </span><span>a12</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((Q, Normal s) # xs) ! n &#8594; ((Q, Normal s) # xs) ! Suc n&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>a12</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n &lt; length ((Q, Normal s) # xs)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>f1</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last ?l)  &#10230; 
                  snd (last ?l) &#8713; Fault ` F  &#10230;
                    ((fst (last ?l) = Skip &#8743; 
                      snd (last ?l) &#8712; Normal ` q)) &#8744;
                    (fst (last ?l) = Throw &#8743; 
                      snd (last ?l) &#8712; Normal ` a))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span class="delimiter">=</span><span>conjI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>not_final_in_comm</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Q, Normal s) # xs) &#8712; comm(G, (q,a)) F &#10233;
  &#172; final (last ((Q, Normal s) # xs)) &#10233;
  (&#915;,(Q, Normal s) # xs) &#8712; comm(G, (q&#39;,a&#39;)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_union</span><span class="delimiter">:</span><span>
</span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>   </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,xs) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,ys) &#8712; comm(G, (q&#39;,a&#39;)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[] &#8743; ys&#8800;[]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;( snd (last xs),snd (ys!0)) &#8712; G&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,xs@ys) &#8712; cptn&quot;</span></span></span><span>
</span><span> </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,xs@ys) &#8712; comm(G, (q&#39;,a&#39;)) F&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;xs@ys&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (xs@ys)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_ys</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last (xs@ys) = last ys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length ?l &#10230; 
             &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?l!i)  &#8594; (?l!(Suc i)) &#10230;                                            
               (snd(?l!i), snd(?l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length  ?l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>             </span><span>a12</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (?l ! i) &#8594; ( ?l ! Suc i)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_ys</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&#8805;length xs. (xs@ys)!i = ys!(i-(length xs))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>   
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs. (xs@ys)!i = xs!i&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(?l!i), snd(?l!(Suc i))) &#8712;  G&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&gt;length xs&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>                                 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i - (length xs)) &lt; length ys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (ys ! (i-(length xs))) &#8594; ( ys ! ((Suc i)-(length xs)))&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a12</span><span> </span><span>all_ys</span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>          
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ys) &#8713; Fault ` F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_ys</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(ys!(i-(length xs))), snd(ys!Suc (i-(length xs)))) &#8712; G&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>comm_dest1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>ys</span><span> </span><span>G</span><span> </span><span>q&#39;</span><span> </span><span>a&#39;</span><span> </span><span>F</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i-length xs&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>True</span><span> </span><span>Suc_diff_le</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>all_ys</span><span> </span><span>Suc_diff_le</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>F1</span><span class="delimiter">=</span><span>this</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length xs&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>              
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd ((xs@ys)!(length xs -1)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a2</span><span> </span><span>a4</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_not_F</span><span> </span><span class="delimiter">)</span><span>         
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last xs) &#8713; Fault ` F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_xs</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_conv_nth</span><span> </span><span class="delimiter">)</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (xs ! i) &#8594; ( xs ! Suc i)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>all_xs</span><span> </span><span>a12</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span class="string"><span class="delete"><span class="delete">&quot;(snd(xs!i), snd(xs!(Suc i))) &#8712; G&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>comm_dest1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>xs</span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>all_xs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = length xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>F1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=length xs -1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a2</span><span> </span><span>all_xs</span><span> </span><span>all_ys</span><span>  </span><span>last_conv_nth</span><span> </span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>          
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last ?l)  &#10230;                 
                  ((fst (last ?l) = Skip &#8743; 
                    snd (last ?l) &#8712; Normal ` q&#39;)) &#8744;
                  (fst (last ?l) = Throw &#8743; 
                    snd (last ?l) &#8712; Normal ` a&#39;))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>last_ys</span><span> </span><span>a00</span><span> </span><span>a2</span><span> </span><span>comm_des3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span class="delimiter">=</span><span>conjI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>   </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpn_rule1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. cpn n &#915; P s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F) &#10233;
      (&#8704;s l. (&#915;,l)&#8712;cpn n &#915; P s &#8743; (&#915;,l)&#8712; assum (p, R) &#10230; (&#915;,l) &#8712; comm(G, (q,a)) F)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. cpn n &#915; P s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>l</span><span>    
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;cpn n &#915; P s &#8743; (&#915;,l)&#8712; assum (p, R)&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; P s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>assum_def</span><span> </span><span>comm_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpn_rule2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s l. (&#915;,l)&#8712;cpn n &#915; P s &#8743; (&#915;,l)&#8712; assum (p, R) &#10230; (&#915;,l) &#8712; comm(G, (q,a)) F) &#10233;
                (&#8704;s. cpn n &#915; P s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s l. (&#915;,l)&#8712;cpn n &#915; P s &#8743; (&#915;,l)&#8712; assum (p, R) &#10230; (&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>l</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712; cpn n &#915; P s &#8743; (&#915;,l)&#8712;assum(p, R)&quot;</span></span></span><span>        
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>assum_def</span><span> </span><span>comm_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpn_rule</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s l. (&#915;,l)&#8712;cpn n &#915; P s &#8743; (&#915;,l)&#8712; assum (p, R) &#10230; (&#915;,l) &#8712; comm(G, (q,a)) F) =
                (&#8704;s. cpn n &#915; P s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_rule1</span><span> </span><span>cpn_rule2</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>split_list_i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l &#10233;
                    &#8707;l1 l2. l = l1@(l!i#l2)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>l</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>a</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>id_take_nth_drop</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>sub_assum1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l0@l1) &#8712; assum (p,R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l0&#8800;[]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l0) &#8712; assum (p,R)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>append_self_conv2</span><span> </span><span>id_take_nth_drop</span><span> </span><span>length_greater_0_conv</span><span> </span><span>sub_assum</span><span> </span><span>take_0</span><span class="delimiter">)</span><span>   
</span><span> 
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* text{* 
@{text rel_safe} specifies that the relation leaves unmodifed any fragment out of the 
state
*}
definition rel_safe:: &quot;((&#39;l::sep_algebra,&#39;g::sep_algebra) transition &#8658; bool) &#8658; bool&quot;
where
&quot;rel_safe R &#8801; &#8704;h h1 h2 t. R (h1,t) &#8743; ((h1 &#8846;<span class="hidden">&#8681;</span><sub>p</sub> h2) h) &#10230; R (h, t &#8846; h2)&quot;

definition mem_safe::
&quot;((&#39;l::sep_algebra,&#39;g::sep_algebra) state,&#39;p,&#39;f) body &#8658; 
 ((&#39;l,&#39;g) state,&#39;p,&#39;f) com &#8658; 
 ((&#39;l,&#39;g) transition &#8658; bool) &#8658; 
   bool&quot;
where
 &quot;mem_safe &#915; f R &#8801; &#8704;h h1 h2 t1. 
      ((&#8704;c&#8712; cp &#915; f (Normal h1). 
        final_valid(last (snd c)) &#8743; (Normal t1 =  snd (last (snd c))) &#8743;
        (&#8704;i. Suc i&lt;length (snd c) &#10230; 
                 (fst c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd c)!(Suc i)) &#10230;                  
                   (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712; 
                     (case_prod (&#955;x y. (Normal x, Normal y))) ` (R))) &#8743;      
        (h1 &#8846;<span class="hidden">&#8681;</span><sub>p</sub> h2) h &#10230;
        (&#8704;c&#8712; cp &#915; f (Normal h). 
          final_valid(last (snd c)) &#8743;
          (&#8704;i. Suc i&lt;length (snd c) &#10230; 
              (fst c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd c)!(Suc i)) &#10230;                  
              (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712; 
                (case_prod (&#955;x y. (Normal x, Normal y))) ` (R)) &#10230;
              (Normal (t1 &#8846; h2) =  snd (last (snd c)))))     
      &quot;                         
 *)</span></span></span></span></span><span>
</span><span>
</span><span>     
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Validity for Parallel Programs.&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>All_End</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) par_config &#8658; bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;All_End xs &#8801; fst xs &#8800;[] &#8743; (&#8704;i&lt;length (fst xs). final ((fst xs)!i,snd xs))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>par_assum</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s set &#215;  
   ((&#39;s,&#39;f) tran) set) &#8658;
   ((&#39;s,&#39;p,&#39;f,&#39;e) par_confs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;par_assum &#8801; 
     &#955;(pre, rely). {c. 
       snd((snd c)!0) &#8712; Normal ` pre &#8743; (&#8704;i. Suc i&lt;length (snd c) &#10230; 
       (fst c)&#8866;<span class="hidden">&#8681;</span><sub>p</sub>((snd c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd c)!(Suc i)) &#10230;        
         (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712; rely)}&quot;</span></span></span><span>
</span><span>           
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>par_comm</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(((&#39;s,&#39;f) tran) set  &#215; 
     (&#39;s set &#215; &#39;s set))  &#8658; 
    &#39;f set &#8658;
   ((&#39;s,&#39;p,&#39;f,&#39;e) par_confs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;par_comm &#8801; 
     &#955;(guar, (q,a)) F. 
     {c. snd (last (snd c)) &#8713; Fault ` F &#10230; 
         (&#8704;i. 
            Suc i&lt;length (snd c) &#10230; 
            (fst c)&#8866;<span class="hidden">&#8681;</span><sub>p</sub>((snd c)!i)  &#8594; ((snd c)!(Suc i)) &#10230;                        
              (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712; guar) &#8743; 
                (All_End (last (snd c)) &#10230; 
                   (&#8707;j&lt;length (fst (last (snd c))). fst (last (snd c))!j=Throw &#8743; 
                        snd (last (snd c)) &#8712; Normal ` a) &#8744;
                   (&#8704;j&lt;length (fst (last (snd c))). fst (last (snd c))!j=Skip &#8743;
                        snd (last (snd c)) &#8712; Normal ` q))}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>par_com_validity</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#8658; 
   &#39;f set &#8658;
   (&#39;s,&#39;p,&#39;f,&#39;e) par_com &#8658;  
   (&#39;s set) &#8658; 
   (((&#39;s,&#39;f) tran) set) &#8658; 
   (((&#39;s,&#39;f) tran) set) &#8658; 
   (&#39;s set) &#8658;
   (&#39;s set) &#8658; 
     bool&quot;</span></span></span><span>  
</span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872;<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub>/ _ SAT [_, _, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Ps SAT [pre, R, G, q,a] &#8801; 
   &#8704;s. par_cp &#915; Ps s &#8745; par_assum(pre, R)  &#8838; par_comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>   
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>par_com_cvalidity</span><span> </span><span class="delimiter">::</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#8658;
    (&#39;s,&#39;p,&#39;f,&#39;e) sextuple set &#8658;
   &#39;f set &#8658;
  (&#39;s,&#39;p,&#39;f,&#39;e) par_com &#8658;   
   (&#39;s set) &#8658; 
   (((&#39;s,&#39;f) tran) set) &#8658; 
   (((&#39;s,&#39;f) tran) set) &#8658; 
   (&#39;s set) &#8658;
   (&#39;s set) &#8658; 
     bool&quot;</span></span></span><span>  
</span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_,_ &#8872;<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub>/ _ SAT [_, _, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Ps SAT [p,  R, G, q,a] &#8801; 
  (&#8704;(c,p,R,G,q,a)&#8712; &#920;. (&#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])) &#10230;
   &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Ps SAT [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>   
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>Un_subset_iff</span><span> </span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span> </span><span>sup.bounded_iff</span><span> </span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span>
</span><span>lrghoare</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[(&#39;s,&#39;p,&#39;f,&#39;e) body,
             (&#39;s,&#39;p,&#39;f,&#39;e) sextuple set,
              &#39;f set,
              (&#39;s,&#39;p,&#39;f,&#39;e) com,  
              (&#39;s set),  
              ((&#39;s,&#39;f) tran) set, ((&#39;s,&#39;f) tran) set,
              &#39;s set,
               &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_,_ &#8866;<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub> _ sat [_, _, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>61</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span> </span><span>Skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; Sta q R; (&#8704;s. (Normal s, Normal s) &#8712; G) &#10215; &#10233;
         &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Skip sat [q, R, G, q,a] &quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span>Spec</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;Sta p R;Sta q R;
        (&#8704;s t. s&#8712;p &#8743; (s,t)&#8712;r &#10230; (Normal s,Normal t) &#8712; G);
         p &#8838; {s. (&#8704;t. (s,t)&#8712;r &#10230; t &#8712; q) &#8743; (&#8707;t. (s,t) &#8712; r)} &#10215; &#10233; 
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Spec r e) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Basic</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; Sta p R;Sta q R;
           (&#8704;s t. s&#8712;p &#8743; (t=f s) &#10230; (Normal s,Normal t) &#8712; G);
            p &#8838; {s. f s &#8712; q} &#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Basic f e) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>If</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;Sta p R;  (&#8704;s. (Normal s, Normal s) &#8712; G); 
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, q,a]; 
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [p &#8745; (-b), R, G, q,a]&#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Cond b c1 c2) sat [p,  R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>While</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; Sta p R; Sta (p &#8745; (-b)) R; Sta a R; (&#8704;s. (Normal s,Normal s) &#8712; G);
            &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b, R, G, p,a]&#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (While b c) sat [p, R, G, p &#8745; (-b),a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Seq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;Sta a R; Sta p R; (&#8704;s. (Normal s,Normal s) &#8712; G); 
         &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,a]; &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [q, R, G, r,a]&#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Seq c1 c2) sat [p, R, G, r,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Await</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; Sta p R; Sta q R; Sta a R;
            &#8704;V. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
                  (p &#8745; b &#8745; {V}) c 
                  ({s. (Normal V, Normal s) &#8712; G} &#8745; q),
                  ({s. (Normal V, Normal s) &#8712; G} &#8745; a)&#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Await b c e) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Guard</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;Sta (p &#8745; g) R; (&#8704;s. (Normal s, Normal s) &#8712; G); 
           &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; g, R, G, q,a]&#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Guard f g c) sat [p &#8745; g, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Guarantee</span><span class="delimiter">:</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; Sta p R; (&#8704;s. (Normal s, Normal s) &#8712; G); f&#8712;F;
                 &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; g, R, G, q,a] &#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Guard f g c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>CallRec</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;(c,p,R,G,q,a) &#8712; Specs; 
             &#8704;(c,p,R,G,q,a)&#8712; Specs. c &#8712; dom &#915; &#8743; 
              Sta p R &#8743; (&#8704;s. (Normal s,Normal s) &#8712; G)&#8743;  
             &#915;,&#920; &#8746; Specs &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (the (&#915; c)) sat [p,  R, G, q,a];
            Sta p R; (&#8704;s. (Normal s, Normal s) &#8712; G)&#10215; &#10233;
            &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Asm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;(c,p,R,G,q,a) &#8712; &#920;&#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Call</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;
         Sta p R; (&#8704;s. (Normal s, Normal s) &#8712; G);c &#8712; dom &#915;; 
         &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (the (&#915; c)) sat [p, R, G, q,a]&#10215;  &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span>
</span><span class="delimiter">|</span><span> </span><span>DynCom</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;(Sta p R) &#8743; (Sta q R) &#8743; (Sta a R) &#8743;
            (&#8704;s. (Normal s,Normal s) &#8712; G);
            (&#8704;s &#8712; p. (&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (c s) sat [p, R, G, q,a]))&#10215; &#10233;
            &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (DynCom c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Throw</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;Sta a R; (&#8704;s. (Normal s, Normal s) &#8712; G) &#10215; &#10233;
         &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Throw sat [a,  R, G, q,a] &quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Catch</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;Sta q R; (&#8704;s. (Normal s, Normal s) &#8712; G); 
           &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,r]; 
           &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [r, R, G, q,a]&#10215; &#10233;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Catch c1 c2) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Conseq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s &#8712; p. 
             (&#8707;p&#39; R&#39; G&#39; q&#39; a&#39; &#920;&#39;.  
             (s&#8712; p&#39;) &#8743;
              R &#8838; R&#39; &#8743;            
             G&#39; &#8838; G &#8743;             
             q&#39; &#8838; q &#8743;
             a&#39; &#8838; a &#8743; &#920;&#39; &#8838; &#920; &#8743;                       
            (&#915;,&#920;&#39;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;]) ) 
            &#10233; &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Conj_post</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a] &#10233;
                &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q&#39;,a&#39;] 
            &#10233; &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q &#8745; q&#39;,a &#8745; a&#39;]&quot;</span></span></span><span>
</span><span>  
</span><span class="delimiter">|</span><span> </span><span>Conj_Inter</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sa&#8800;({}::nat set) &#10233; 
               &#8704;i&#8712;sa. &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q i,a] &#10233;                
               &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G,&#8898;i&#8712;sa. q i,a]&quot;</span></span></span><span> 
</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>hoare_elim_cases</span><span> </span><span class="delimiter">[</span><span>cases</span><span> </span><span>set</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Skip sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">thm</span></span><span> </span><span>hoare_elim_cases</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
lemma &quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Skip sat [p, R, G, q,a] &#10233; 
        &#8704;s &#8712; p. 
          (&#8707;p&#39; R&#39; G&#39; q&#39; a&#39;.  
           (s&#8712; p&#39;) &#8743;
            R &#8838; R&#39; &#8743;            
            G&#39; &#8838; G &#8743;             
            q&#39; &#8838; q &#8743;
            a&#39; &#8838; a &#8743;                        
           (&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;]) &#8743; p&#39;=q&#39; &#8743; Sta q&#39; R&#39; &#8743; Norm R&#39; &#8743; (&#8704;s. (Normal s, Normal s) &#8712; G&#39;))&quot;
proof -
  assume a0:&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Skip sat [p, R, G, q,a]&quot;  
  {
   fix s
   assume a01:&quot;s&#8712;p&quot;
   have &quot;(&#8707;p&#39; R&#39; G&#39; q&#39; a&#39;.  
           (s&#8712; p&#39;) &#8743;
            R &#8838; R&#39; &#8743;            
            G&#39; &#8838; G &#8743;             
            q&#39; &#8838; q &#8743;
            a&#39; &#8838; a &#8743;                        
           (&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;]) &#8743; p&#39;=q&#39; &#8743; Sta q&#39; R&#39; &#8743; Norm R&#39; &#8743; (&#8704;s. (Normal s, Normal s) &#8712; G&#39;))&quot;
   proof (cases &quot;p=q&quot;)
    case True thus ?thesis using hoare_elim_cases   sorry
   next
    case False thus ?thesis sorry
   qed
  } thus ?thesis by fastforce
qed*)</span></span></span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* lemma &quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, R, G, q,r] &#10233;
       c&#8800;Throw &#10233;
       Sta p R&quot;
sorry *)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
| Env:  &quot;&#10214;noawaits c; &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (p ) (sequential c) q,(a)&#10215; &#10233;
         &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, sep_empty, Emp, Emp, q,a]&quot;
        
| Hide: &quot;&#10214;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, (I &#8743;* I&#39;), (R &#8743;* R&#39;), (G &#8743;* G&#39;), q,a]; 
         (I  &#9657; R); 
         (I  &#9657; G)
          &#10215; &#10233; 
         &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, I, R, G, q,a]&quot; 

|Frame: &quot;&#10214;
        &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, I, R, G , q,a]; 
        I&#39;  &#9657; R&#39;; I&#39;  &#9657; G&#39;;
        Sta r (R&#39;&#8743;*tran_Id);
        (&#8704;s t. (r imp (I&#39;&#8743;*sep_true))(s,t));
        (rel_safe R); (rel_safe (G&#8743;*tran_True)) &#10215;  &#10233;
        &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p&#8743;*r, I &#8743;* I&#39;, R &#8743;* R&#39;, G &#8743;* G&#39;, q&#8743;*r,a&#8743;*r]&quot;
*)</span></span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Pre</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; (&#39;s,&#39;p,&#39;f,&#39;e)rgformula &#8658; (&#39;s set)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Pre x &#8801; fst(snd x)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Post</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) rgformula &#8658; (&#39;s set)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Post x &#8801;  fst(snd(snd(snd(snd x))))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Abr</span><span> </span><span class="delimiter">::</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) rgformula &#8658; (&#39;s set)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Abr x &#8801; snd(snd(snd(snd(snd x))))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Rely</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) rgformula &#8658; ((&#39;s,&#39;f) tran) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Rely x &#8801; fst(snd(snd x))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Guar</span><span> </span><span class="delimiter">::</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) rgformula &#8658; ((&#39;s,&#39;f) tran) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Guar x &#8801; fst(snd(snd(snd x)))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Com</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) rgformula &#8658; (&#39;s ,&#39;p,&#39;f,&#39;e) com&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Com x &#8801; fst  x&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span>
</span><span>  </span><span>par_rghoare</span><span> </span><span class="delimiter">::</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;[(&#39;s,&#39;p,&#39;f,&#39;e) body,
              (&#39;s,&#39;p,&#39;f,&#39;e) sextuple set,
              &#39;f set,
              ( (&#39;s,&#39;p,&#39;f,&#39;e) rgformula) list,  
              &#39;s set,              
              ((&#39;s,&#39;f) tran) set, ((&#39;s,&#39;f) tran) set,
              &#39;s set,
               &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_,_ &#8866;<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub> _ SAT [_, _, _, _,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>61</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>Parallel</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; &#8704;i&lt;length xs. R &#8746; (&#8899;j&#8712;{j. j&lt;length xs &#8743; j&#8800;i}. (Guar(xs!j))) &#8838; (Rely(xs!i));
    (&#8899;j&lt;length xs. (Guar(xs!j))) &#8838; G;
     p &#8838; (&#8898;i&lt;length xs. (Pre(xs!i)));
    (&#8898;i&lt;length xs. (Post(xs!i))) &#8838; q;
    (&#8899;i&lt;length xs. (Abr(xs!i))) &#8838; a;                 
    &#8704;i&lt;length xs. &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Com(xs!i) sat [Pre(xs!i),Rely(xs!i),Guar(xs!i),Post(xs!i),Abr(xs!i)] &#10215;
   &#10233;  &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> xs SAT [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span> 
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="verbatim"><span class="delete"><span class="delete"><span class="delete"><span class="delete">{* Soundness *}</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>skip_suc_i</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn &#8743; fst (l!i) = Skip&quot;</span></span></span><span>   
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i+1 &lt; length l&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!(i+1)) = Skip&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l1</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l=l1#ls&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>list.exhaust</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less0</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!i) &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_stepc_rtran</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>step_ce_elim_cases</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>not_eq_not_env</span><span> </span><span>prod.collapse</span><span> </span><span>stepc_elim_cases</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>throw_suc_i</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn &#8743; (fst(l!i) = Throw &#8743; snd(l!i) = Normal s1)&quot;</span></span></span><span>   
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely &#8743; s1 &#8712; q&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!(Suc i)) =  Throw &#8743; (&#8707;s2. snd(l!(Suc i)) = Normal s2 &#8743; s2 &#8712;q)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fin</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (l!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l1</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l=l1#ls&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>list.exhaust</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less0</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!i) &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_stepc_rtran</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!i) &#8594; (l!(Suc i)) &#8744; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!i) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">proof</span></span><span>                                          
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!i) &#8594; (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fin</span><span> </span><span>no_step_final&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!i) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a2</span><span> </span><span>env_tran_normal</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span>  </span><span>env_c_c&#39;</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>i_skip_all_skip</span><span class="delimiter">:</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn &#8743; fst (l!i) = Skip&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; (length l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;n=j-i&quot;</span></span></span><span>
</span><span>      </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* assumes a4:&quot;env_tran_right &#915; l rely&quot; *)</span></span></span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Skip&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0.prems&quot;</span></span></span><span> </span><span>skip_suc_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j-1&lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j  - i = Suc n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! (j)) = LanguageCon.com.Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span>  </span><span>skip_suc_i</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_leI</span><span> </span><span class="alt_string"><span class="delete"><span class="delete">`Suc i &lt; length l`</span></span></span><span> </span><span>diff_Suc_1</span><span class="delimiter">)</span><span>        
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j=j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>i_throw_all_throw</span><span class="delimiter">:</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn &#8743; (fst (l!i) = Throw &#8743; snd (l!i) = Normal s1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; (length l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;n=j-i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely &#8743; s1&#8712;q&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Throw &#8743; (&#8707;s2. snd(l!j) = Normal s2  &#8743; s2&#8712;q)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span> </span><span>j</span><span> </span><span>s1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0.prems&quot;</span></span></span><span> </span><span>skip_suc_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_suc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j-1&lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>less_imp_diff_less</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j - Suc i = n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>Suc_inject</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &lt; j&#8250;</span></span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! (j-1)) = LanguageCon.com.Throw &#8743; snd (l ! (j-1)) = Normal s2 &#8743; s2&#8712;q&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span> </span><span>s1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j-1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>diff_zero</span><span> </span><span>less_imp_Suc_add</span><span> </span><span>not_le</span><span> </span><span>not_less_eq_eq</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (j - 1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! (j)) = LanguageCon.com.Throw &#8743; (&#8707;s2. snd(l!j) = Normal s2 &#8743; s2&#8712;q)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>2</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span>throw_suc_i</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j-1&quot;</span></span></span><span> </span><span>s2</span><span> </span><span>rely</span><span> </span><span>q</span><span class="delimiter">]</span><span> </span><span>a4</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j=j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_j</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Skip  &#8744; fst (l!i) = Throw &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a1&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!i) = Normal x &#8743; x &#8712; q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely&quot;</span></span></span><span>    
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>   
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Skip  &#8744; (fst (l!i) = Throw &#8743; snd(l!i) = Normal x)&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a1&#39;</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>i_skip_all_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>           
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>a2</span><span>  </span><span>a4</span><span> </span><span>i_throw_all_throw</span><span> </span><span>a1&#39;</span><span class="delimiter">)</span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>     
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_j</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Skip  &#8744; (fst (l!i) = Throw &#8743; snd(l!i) = Normal s1)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a1&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!i) = Normal x &#8743; x &#8712; q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. i&#8804;j &#8743; Suc j &lt; length l &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely&quot;</span></span></span><span>              
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a1&#39;</span><span> </span><span>only_one_component_tran_j</span><span> 
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>lessI</span><span> </span><span>less_Suc_eq_le</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>zero_skip_all_skip</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn &#8743; fst (l!0) = Skip &#8743;  i &lt; length l&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Skip&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>i_skip_all_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>all_skip</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>      </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = (Skip,s)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i&lt;length x. fst(x!i) = Skip)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>zero_skip_all_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>zero_throw_all_throw</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn &#8743; fst (l!0) = Throw &#8743; 
                  snd(l!0) = Normal s1 &#8743;  i &lt; length l &#8743; s1&#8712;q&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Throw &#8743; (&#8707;s2. snd (l!i) = Normal s2)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>i_throw_all_throw</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>le0</span><span class="delimiter">)</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_0</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (l!0) = Skip) &#8744; (fst (l!0) = Throw)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>                  
</span><span>         </span><span>a1&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!0) = Normal x &#8743; x &#8712; q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely&quot;</span></span></span><span>         
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>      
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804;j &#8743; Suc j&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>   </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_j</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a1&#39;</span><span> </span><span>a2&#39;</span><span> </span><span>a3</span><span> </span><span>a4</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>not_step_comp_step_env</span><span class="delimiter">:</span><span>
</span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc j&lt;length l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k &lt; j. &#172;((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k &lt; j. ((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>asm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&lt;j&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>cptn_stepc_rtran</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>nn</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;nat &#8658; nat &#8658; nat&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>      </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x0 x1. (&#8707;v2&gt;x1. x0 = Suc v2) = (x1 &lt; nn x0 x1 &#8743; x0 = Suc (nn x0 x1))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>moura</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pp</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;nat &#8658; ((&#39;b, &#39;a, &#39;c,&#39;d) LanguageCon.com &#215; (&#39;b, &#39;c) xstate) list &#8658; 
                 (&#39;b, &#39;a, &#39;c,&#39;d) LanguageCon.com &#215; (&#39;b, &#39;c) xstate&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>           </span><span>pps</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;nat &#8658; ((&#39;b, &#39;a, &#39;c,&#39;d) LanguageCon.com &#215; (&#39;b, &#39;c) xstate) list &#8658; 
                  ((&#39;b, &#39;a, &#39;c,&#39;d) LanguageCon.com &#215; (&#39;b, &#39;c) xstate) list&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x0 x1. (&#8707;v2 v3. x1 = v2 # v3 &#8743; length v3 = x0) = (x1 = pp x0 x1 # pps x0 x1 &#8743; length (pps x0 x1) = x0)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>moura</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = pp (nn (length l) k) l # pps (nn (length l) k) l &#8743; length (pps (nn (length l) k) l) = nn (length l) k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc_lessE</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc k &lt; length l&#8250;</span></span></span><span> </span><span>length_Suc_conv</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length (pp (nn (length l) k) l # pps (nn (length l) k) l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc k &lt; length l&#8250;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, pp (nn (length l) k) l # pps (nn (length l) k) l) &#8712; cptn&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (pp (nn (length l) k) l # pps (nn (length l) k) l) ! k &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (pp (nn (length l) k) l # pps (nn (length l) k) l) ! Suc k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>cptn_stepc_rtran</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>asm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_i_env_same_prog</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a1</span><span class="delimiter">:</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k &lt; j. k&#8805;i &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; length l&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) =  fst (l!i)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j-i&quot;</span></span></span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>l</span><span> </span><span>j</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lenl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l&gt;Suc 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>prev</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j=Suc j1&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not0_implies_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a0#l1@[a1]&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>lenl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>add.commute</span><span> </span><span>add.left_neutral</span><span> </span><span>length_Cons</span><span> </span><span>list.exhaust</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_add_less1</span><span> </span><span>rev_exhaust</span><span class="delimiter">)</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>al1_cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,a0#l1)&#8712; cptn&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>tl_in_cptn</span><span> </span><span>cptn_dest_2</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k &lt; j1. k&#8805;i &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((a0#l1)!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((a0#l1)!(Suc k)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&lt;j1 &#8743; k&#8805;i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((a0#l1)!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((a0#l1)!(Suc k)))&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>l</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>prev</span><span> </span><span>lenl</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>   
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_k_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j1_l_l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j1 &lt; Suc (length l1)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>l</span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; Suc j1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="alt_string"><span class="delete"><span class="delete">`k &lt; j1 &#8743; i &#8804; k`</span></span></span><span> </span><span>less_Suc_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; j&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>ksuc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; Suc (Suc j1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>less_Suc_eq</span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>f4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; Suc (length l1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>prev</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>l</span><span> </span><span>a0</span><span> </span><span>j1_l_l1</span><span> </span><span>less_trans</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>            
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! k &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l ! Suc k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f3</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length l1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f3</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>i_j</span><span> </span><span>l</span><span> </span><span>suc_k_j</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                            
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f6</span><span> </span><span>l</span><span>  </span><span>k_l1</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>  
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>k1</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f6</span><span>  </span><span>f4</span><span> </span><span>l</span><span> </span><span>k_l1</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst ((a0#l1)!i)=fst ((a0#l1)!j1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>of</span><span> </span><span>j1</span><span> </span><span>i</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a0#l1&quot;</span></span></span><span class="delimiter">]</span><span> 
</span><span>            </span><span>Suc</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span>prev</span><span> </span><span>al1_cptn</span><span> </span><span>i_j</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_le</span><span> </span><span>Suc_less_eq</span><span> </span><span>diff_Suc_1</span><span> </span><span>l</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l = Suc (length (a0#l1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length (a0#l1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>i_j</span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j1&lt;length (a0#l1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>len_l</span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = fst ((a0#l1)!i)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>prev</span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span>fst</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>append_Cons</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j1_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j1) = fst ((a0#l1)!j1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>prev</span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span>fst</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>append_Cons</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = fst (l!j1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>
</span><span>      </span><span>i_l</span><span> </span><span>j1_l</span><span> </span><span>fst</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>      
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>prev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>env_c_c&#39;</span><span> </span><span>i_j</span><span> </span><span>lessI</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>          
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>  
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_tran_ce_i</span><span class="delimiter">:</span><span> 
</span><span>   </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn  &#8743;  i + 1 &lt; length l&quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span>  </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cptn_stepc_rtran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>zero_final_always_env_0</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Skip &#8744; fst (l!0) = Throw&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a2&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) = Normal s1 &#8743; s1&#8712;q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a2&#39;</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>           
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>step_ce.simps</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>final_always_env_i</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Skip &#8744; fst (l!0) = Throw&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a2&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) = Normal s1 &#8743; s1&#8712;q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&#8805;i &#8743; Suc j&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>              </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta q rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ce_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)) &#8744; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a01</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>   
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a2&#39;</span><span> </span><span>only_one_component_tran_j</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>a1</span><span class="delimiter">]</span><span>  
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span>ce_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>step_ce.simps</span><span class="delimiter">)</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="verbatim"><span class="delete"><span class="delete"><span class="delete"><span class="delete">{*Skip Sound*}</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_q_r_q</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>       
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!i) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!i), snd(l!(Suc i))) &#8712; R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!(Suc i)) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>a1</span><span>  </span><span>a2</span><span> 
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stability</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>   </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>                 
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!j) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743; k &lt; (length l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n=k-j&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. j&#8804;i &#8743; i &lt; k &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R &quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!k) &#8712; Normal ` q &#8743; fst (l!j) = fst (l!k)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>j</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; j + 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k-1&lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(k - 1) - j = n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k-1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. j &#8804; i &#8743; i &lt; k-1 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l ! i) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l ! Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>induct</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l! (k-1)) &#8712; Normal ` q &#8743; fst (l!j) = fst (l!(k-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k-1+1=k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. j&#8804;i &#8743; i &lt; k &#10230; (snd((snd (&#915;,l))!i), snd((snd (&#915;,l))!(Suc i))) &#8712;  R&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>k1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k - 1 &lt; k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>j_1</span><span> </span><span>lessI</span><span class="delimiter">)</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd (&#915;,l))!(k-1)), snd((snd (&#915;,l))!(Suc (k-1)))) &#8712;  R&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="alt_string"><span class="delete"><span class="delete">`j &#8804; k - 1`</span></span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                           
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!k) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stable_q_r_q</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>  </span><span>Suc</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = fst (l!k)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l ! (k-1)) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l ! k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span>k1</span><span> </span><span class="alt_string"><span class="delete"><span class="delete">`j&#8804;k-1`</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k1</span><span> </span><span>prod.collapse</span><span> </span><span>env_c_c&#39;</span><span> </span><span>induct</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_only_env_i_j</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>                 
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!i) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;j &#8743; j &lt; (length l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n=j-i-1&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k&#8805;i. k &lt; j &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>less_imp_le_nat</span><span>  </span><span>stability</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_only_env_1</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>                 
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!i) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;j &#8743; j &lt; (length l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n=j-i-1&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length l &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> 
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>stable_only_env_i_j</span><span> </span><span>less_trans_Suc</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_only_env_q</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>                 
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length l &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; q l R&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length l &#10230; snd (l!i) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length l&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>aa1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length l&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>post_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! 0) &#8712; Normal ` q &quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! i) &#8712; Normal ` q&quot;</span></span></span><span>     
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>i</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>post_0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> 
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&lt;i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>post_0</span><span> </span><span>stable_only_env_1</span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>aa1</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Skip_sound1</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; Skip s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(q, R)&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm (G, (q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(Skip,s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` q &#8743; (&#8704;i. Suc i&lt;length l &#10230;
             (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
               (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
           &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                             
             (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>asuc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l&quot;</span></span></span><span>        
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>cp</span><span> </span><span>prod.collapse</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>stepc_elim_cases</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>zero_skip_all_skip</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
               ((fst (last l) = Skip &#8743; 
                snd (last l) &#8712; Normal ` q)) &#8744;
                (fst (last l) = Throw &#8743; 
                snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_last_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip&quot;</span></span></span><span>             
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="alt_string"><span class="delete"><span class="delete">`0 &lt; length l`</span></span></span><span> </span><span>cp</span><span> </span><span>diff_less</span><span> </span><span>fst_conv</span><span> </span><span>zero_less_one</span><span> </span><span>zero_skip_all_skip</span><span class="delimiter">)</span><span>                           
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8712; Normal ` q&quot;</span></span></span><span>    
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; q l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>assum</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_right</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>env_tran_right_def</span><span> </span><span>assum</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) = Normal s1 &#8743; s1&#8712;q&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_tran_env</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length l &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_always_env_i</span><span> </span><span>cp</span><span> </span><span>zero_final_always_env_0</span><span> </span><span>a0</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length l &#10230; snd (l!i) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stable_only_env_q</span><span>  </span><span>a0</span><span>  </span><span>env</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>fst_last_skip</span><span> </span><span>last_q</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>               
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Skip_sound</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R &#10233;       
   (&#8704;s. (Normal s, Normal s) &#8712; G)  &#10233;
   &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Skip sat [q,R, G, q,a]&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ass</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; Skip s &#8745; assum(q, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; Skip s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(q, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cp &#915; Skip s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Skip_sound1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a10</span><span> </span><span>a11</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Throw_sound1</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; Throw s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(a, R)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm (G, (q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>     
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(Throw,s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (a) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
             (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
               (snd(l!i), snd(l!(Suc i))) &#8712; (R))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) = Normal a1 &#8743; a1 &#8712; a&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length l &#10230; 
           &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                           
             (snd(l!i), snd(l!(Suc i))) &#8712;  (G))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>asuc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>asuci</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! 0) = LanguageCon.com.Throw&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! 0) = Normal s1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! i) = Throw &#8743; (&#8707;s2. snd (l ! i) = Normal s2)&quot;</span></span></span><span>      
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>a1</span><span> </span><span>assum</span><span> </span><span>a_normal</span><span> </span><span>env_tran</span><span> </span><span>asuci</span><span> </span><span>zero_throw_all_throw</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span class="delimiter">)</span><span>           
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
               ((fst (last l) = Skip &#8743; 
                snd (last l) &#8712; Normal ` q)) &#8744;
                (fst (last l) = Throw &#8743; 
                snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a1</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_last_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Throw&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a1</span><span> </span><span>a_normal</span><span> </span><span>cp</span><span> </span><span>diff_less</span><span> </span><span>env_tran</span><span> </span><span>fst_conv</span><span> </span><span>len_l</span><span> </span><span>zero_less_one</span><span> </span><span>zero_throw_all_throw</span><span class="delimiter">)</span><span>                        
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_q</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8712; Normal ` (a)&quot;</span></span></span><span>    
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; a l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>assum</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_right</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>assum</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_tran_env</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length l &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_always_env_i</span><span> </span><span>a1</span><span> </span><span>assum</span><span> </span><span>cp</span><span> </span><span>zero_final_always_env_0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>            
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length l &#10230; snd (l!i) &#8712; Normal ` (a)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stable_only_env_q</span><span>  </span><span>a1</span><span>  </span><span>env</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>                
</span><span>      </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>fst_last_skip</span><span> </span><span>last_q</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>               
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span>              
</span><span>   </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>          
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Throw_sound</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R  &#10233;
   (&#8704;s. (Normal s, Normal s) &#8712; G) &#10233;
   &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Throw sat [a, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span>   
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; (&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ass</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; Throw s &#8745; assum(a, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; Throw s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(a, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cp &#915; Throw s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Throw_sound1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a10</span><span> </span><span>a11</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_comp_tran_before_i_0_g</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = c &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c, s1)  &#8594; ((c1,s2)) &#10230; 
                        (c1=Skip) &#8744; (c1=Throw &#8743; (&#8707;s21. s2 = Normal s21))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>        
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = c&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>cptn_env_same_prog</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span>s1</span><span> </span><span>c1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l_0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!j = (c, s) &#8743; l!(Suc j) = (c1,s1)&quot;</span></span></span><span>  
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>    
</span><span>   </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) &#8712; Normal ` p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>rely</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span>a6</span><span> </span><span>a3</span><span> </span><span>a2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;B r ps n na nb f. &#172; Sta B r &#8744; snd (ps ! n) &#8713; Normal ` B &#8744; &#172; n &#8804; na &#8744; &#172; na &lt; length ps &#8744; na - n &#8800; nb &#8744; (&#8707;nb&#8805;n. nb &lt; na &#8743; &#172; f&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ps ! nb &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ps ! Suc nb) &#8744; &#172; env_tran_right f ps r &#8744; snd (ps ! na) &#8712; Normal ` B &#8743; (fst (ps ! n)::(&#39;b, &#39;a, &#39;c,&#39;d) LanguageCon.com) = fst (ps ! na)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stability</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc j &lt; length l&#8250;</span></span></span><span> </span><span>a4</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_0_skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (l!Suc j) = Skip &#8744; fst (l!Suc j) = Throw) &#8743; 
                           (&#8707;s2. snd(l!Suc j) = Normal s2 ) &quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>a3</span><span> </span><span>SmallStepCon.step_Stuck_prop</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_conv</span><span> </span><span>imageE</span><span> </span><span>l_0</span><span> </span><span>snd_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>   </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_j</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n na. &#172; n &lt; na &#8744; Suc n &#8804; na&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>satx</span><span>  
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_j</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span class="delimiter">]</span><span> </span><span>suc_0_skip</span><span> </span><span>a6</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a3</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>imageE</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>          
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_comp_tran_before_i</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>        
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &lt; i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c, s1)  &#8594; ((c1,s2)) &#10230; 
                        (c1=Skip) &#8744; (c1=Throw &#8743; (&#8707;s21. s2 = Normal s21))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>        
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>a6</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_comp_tran_before_i_0_g</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>less_nat_zero_code</span><span> </span><span>list.exhaust</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1notempty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i=Suc i&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>less_imp_Suc_add</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j=Suc j&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_D</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tl_in_cptn</span><span> </span><span>l1notempty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l1 ! n) = c&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span> </span><span>l1notempty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&#39; &lt; length l1 &#8743; n &#8804; i&#39; &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i&#39; &#8594; (l1 ! Suc i&#39;)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span> </span><span>l1notempty</span><span> </span><span>i&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8804; j&#39; &#8743; j&#39; &lt; i&#39; &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! j&#39; &#8594; (l1 ! Suc j&#39;)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span> </span><span>l1notempty</span><span> </span><span>i&#39;</span><span> </span><span>j&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k&lt;j&#39;. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! k &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1 ! Suc k)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span> </span><span>l1notempty</span><span> </span><span>j&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>     
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l1 rely &#8743; Sta q rely &#8743; Sta p rely &#8743; snd (l1!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l1!Suc j&#39;) &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc 0 &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!0)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc 0))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!Suc 0) &#8712; Normal ` p)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>suc0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>env_tran_tail</span><span> </span><span>j&#39;</span><span> </span><span>nth_Cons_Suc</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>of</span><span> </span><span>l1</span><span> </span><span>i&#39;</span><span> </span><span>j&#39;</span><span> </span><span class="delimiter">]</span><span>  </span><span>Suc</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>  </span><span>Suc</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>j&#39;</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>exists_first_occ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P (n::nat) &#10233; &#8707;m. P m &#8743; (&#8704;i&lt;m. &#172; P i)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>ex_least_nat_le</span><span> </span><span>not_less0</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>exist_first_comp_tran&#39;</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>      
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;j. (Suc j&lt;length l &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))) &#8743; (&#8704;k &lt; j. &#172;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?P</span><span> </span><span class="delimiter">=</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#955;n. Suc n&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!n)  &#8594; (l!(Suc n))))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?P</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>exist_first_comp_tran</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>      
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;j. j&#8804;i &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>  </span><span>pj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc j&lt;length l &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))) &#8743; 
                     (&#8704;k &lt; j. &#172;(Suc k&lt;length l &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>exist_first_comp_tran&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>pj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;i&quot;</span></span></span><span class="delimiter">,</span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>kj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&lt;j&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &#8805; length l &#8744;  &#172; ( (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))) &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length l &#8804; Suc k&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>kj</span><span> </span><span>pj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k + 1 &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>kj</span><span> </span><span>pj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>skip_com_all_skip</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Skip&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j&#8805;i &#8743; j &lt;length l &#10230; fst (l!j) = Skip&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length l - (i + 1)&quot;</span></span></span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_leI</span><span> </span><span>diff_is_0_eq</span><span> </span><span>nat_less_le</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>n</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;n = (length l) - (Suc i + 1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>Suc</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Suc.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>a0</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594; l ! Suc i &#8744; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>or</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc i) = Skip&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>env_c_c&#39;</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594; l ! Suc i&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!i) = Skip&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!i) = Throw&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span> </span><span>stepc_elim_cases</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. l ! Suc i = (LanguageCon.com.Skip, x)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;fst (l ! i) = LanguageCon.com.Throw&#8250;</span></span></span><span> </span><span>local.step</span><span> </span><span>stepc_elim_cases</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>n</span><span> </span><span>a0</span><span> </span><span>or</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>le_less_Suc_eq</span><span> </span><span>not_le</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>terminal_com_all_term</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Skip &#8744; fst (l!i) = Throw&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j&#8805;i &#8743; j &lt;length l &#10230; fst (l!j) = Skip &#8744; fst (l!j) = Throw&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length l - (i + 1)&quot;</span></span></span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_leI</span><span> </span><span>diff_is_0_eq</span><span> </span><span>nat_less_le</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>n</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;n = (length l) - (Suc i + 1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>Suc</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Suc.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>a0</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594; l ! Suc i &#8744; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>or</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc i) = Skip &#8744; fst(l!Suc i) = Throw&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>env_c_c&#39;</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594; l ! Suc i&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!i) = Skip&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!i) = Throw&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span> </span><span>stepc_elim_cases</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. l ! Suc i = (LanguageCon.com.Skip, x)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;fst (l ! i) = LanguageCon.com.Throw&#8250;</span></span></span><span> </span><span>local.step</span><span> </span><span>stepc_elim_cases</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>n</span><span> </span><span>a0</span><span> </span><span>or</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>le_less_Suc_eq</span><span> </span><span>not_le</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_c_comp_tran</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; j &#8743; Suc j &lt; length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; fst (l!j) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c, s1)  &#8594; ((c1,s2)) &#10230; 
                        ((c1=Skip) &#8744; (c1=Throw)) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k &lt; i. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a5</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a2</span><span> </span><span>cptn_env_same_prog</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suci</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!Suc i) = Skip &#8744; fst (l!Suc i) = Throw&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a2</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Skip &#8744; fst (l!j) = Throw&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; j&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leI</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span>  </span><span>terminal_com_all_term</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>suci</span><span class="delimiter">]</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! j) = Skip&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>asm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! j) = Throw&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!i)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Normal</span><span> 
</span><span>         </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>a2</span><span> </span><span>fst</span><span> </span><span>asm</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Abrupt</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>a2</span><span> </span><span>fst</span><span> </span><span>asm</span><span> </span><span>skip_com_all_skip</span><span>
</span><span>             </span><span>suci</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>mod_env_not_component</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>           
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Fault</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>a2</span><span> </span><span>fst</span><span> </span><span>asm</span><span> </span><span>skip_com_all_skip</span><span> 
</span><span>           </span><span>suci</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>mod_env_not_component</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Stuck</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>a2</span><span> </span><span>fst</span><span> </span><span>asm</span><span> </span><span>skip_com_all_skip</span><span> 
</span><span>             </span><span>suci</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>mod_env_not_component</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8800; i &#8743; Suc j &lt; length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; fst (l!j) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c, s1)  &#8594; ((c1,s2)) &#10230; 
                        ((c1=Skip) &#8744; (c1=Throw)) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q &quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j=i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>j_neq_i</span><span class="delimiter">=</span><span>this</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>bb</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;b set &#8658; (&#39;b &#8658; (&#39;b, &#39;c) xstate) &#8658; (&#39;b, &#39;c) xstate &#8658; &#39;b&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x0 x1 x2. (&#8707;v3. x2 = x1 v3 &#8743; v3 &#8712; x0) = (x2 = x1 (bb x0 x1 x2) &#8743; bb x0 x1 x2 &#8712; x0)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>moura</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x f B. x &#8713; f ` B &#8744; x = f (bb B f x) &#8743; bb B f x &#8712; B&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>imageE</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (c, snd (l ! j)) &#8594; (fst (l ! Suc j), Normal (bb q Normal (snd (l ! Suc j))))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a3</span><span> </span><span>a5</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc_leI</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>True</span><span> </span><span>only_one_component_tran_j</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j1</span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>all_ev</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j1&#8804;i &#8743;  
                 (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j1)  &#8594; (l!(Suc j1))) &#8743; 
                 (&#8704;k &lt; j1. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>exist_first_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j1) = c&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>cptn_env_same_prog</span><span> </span><span>le_imp_less_Suc</span><span> </span><span>less_trans_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j1 &lt; length l &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! j1 &#8594; l ! Suc j1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_ev</span><span> </span><span>a2</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>le_eq_less_or_eq</span><span> </span><span>less_trans_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>evs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k &lt; j1. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_ev</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j1 &lt; j &#8743; Suc j &lt; length l &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! j &#8594; l ! Suc j &#8743; fst (l ! j) = c&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>all_ev</span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_c_comp_tran</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>suc</span><span> </span><span>j</span><span> </span><span>a4</span><span> </span><span>evs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_i</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &#8800; i &#8743; Suc j &lt; length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; fst (l!j) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c, s1)  &#8594; ((c1,s2)) &#10230; 
                        ((c1=Skip) &#8744; (c1=Throw)) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q &quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span>j</span><span> </span><span>p</span><span> </span><span>q</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>0</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>0</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="delimiter">]</span><span>  </span><span>0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>less_nat_zero_code</span><span> </span><span>list.exhaust</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1notempty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i=Suc i&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>less_imp_Suc_add</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_D</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j=Suc j&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_D</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tl_in_cptn</span><span> </span><span>l1notempty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l1 ! n) = c&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span> </span><span>l1notempty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&#39; &lt; length l1 &#8743; n &#8804; i&#39; &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i&#39; &#8594; (l1 ! Suc i&#39;)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span> </span><span>l1notempty</span><span> </span><span>i&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;n &#8804; j&#39; &#8743; j&#39; &#8800; i&#39; &#8743; Suc j&#39; &lt; length l1 &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! j&#39; &#8594; (l1 ! Suc j&#39;) &#8743; fst (l1!j&#39;) = c&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>l</span><span> </span><span>l1notempty</span><span> </span><span>i&#39;</span><span> </span><span>j&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l1 rely &#8743;
                  Sta p rely &#8743; snd (l1!n) &#8712; Normal ` p &#8743; 
                  Sta q rely &#8743; snd (l1 ! Suc j&#39;) &#8712; Normal ` q &quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>l</span><span> </span><span>j&#39;</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span>a4</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;i &#8743;  i &#8800; j &#8743; Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))) &#8743;   fst (l!i) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c,s1)  &#8594; ((c1,s2)) &#10230; 
                        ((c1=Skip) &#8744; (c1=Throw))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q &quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>only_one_component_tran_i</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8744; (&#172; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! j &#8594; (l ! Suc j)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt;length l &#8743; k&#8804;j &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_i</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>j</span><span> </span><span>a2</span><span> </span><span>a4</span><span> </span><span>a5</span><span class="delimiter">]</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! j &#8594; (l ! Suc j)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>a0</span><span> </span><span>a3</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_env</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))) &#8743; fst (l!i) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c,s1)  &#8594; ((c1,s2)) &#10230; 
                        ((c1=Skip) &#8744; (c1=Throw))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q &quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ass</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; i &#8743; i &#8800; j &#8743; Suc i &lt; length l &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594; l ! Suc i &#8743; fst (l ! i) = c&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="delimiter">]</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>ass</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_not_comp</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))) &#8743; fst (l!i) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(c, s1)  &#8594; ((c1,s2)) &#10230; 
                        ((c1=Skip) &#8744; (c1=Throw))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q &quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ass</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>    
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>only_one_component_tran_i</span><span> </span><span>ass</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>final_exist_component_tran1</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>               
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; q l R &#8743; Sta q R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; length l &#8743; final (l!j)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>          
</span><span>          </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8800;Skip &#8743; c&#8800;Throw&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;i &#8743; k&lt;j &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k&#8805;i &#8743;  k&lt;j &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k&#8805;i &#8743;  k&lt;j &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>a0</span><span> </span><span>a3</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>less_trans_Suc</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) =  fst (l!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_i_env_same_prog</span><span> </span><span>a0</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>a1</span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>final_exist_component_tran</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = c&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>                         
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; length l &#8743; final (l!j)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>          
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8800;Skip &#8743; c&#8800;Throw&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;i &#8743; k&lt;j &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k&#8805;i &#8743;  k&lt;j &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k&#8805;i &#8743;  k&lt;j &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>less_trans_Suc</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) =  fst (l!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_i_env_same_prog</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>suc_not_final_final_c_tran</span><span class="delimiter">:</span><span>
</span><span> </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt; length l &#8743; &#172;final (l!j) &#8743; final (l!Suc j)&quot;</span></span></span><span>
</span><span> </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>x</span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l = x#xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1</span><span> </span><span>s1</span><span> </span><span>c2</span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!j = (c1,s1) &#8743; l!(Suc j) = (c2,s2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_fst</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = fst (l!Suc j)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>env_c_c&#39;</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!Suc j) = Skip&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>eq_fst</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>p1</span><span class="delimiter">=</span><span>this</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!Suc j) = Throw &#8743; (&#8707;s. snd (l!Suc j) = Normal s)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>eq_fst</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a</span><span> </span><span>eenv_normal_s&#39;_normal_s</span><span> </span><span>local.l1</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>cptn_stepc_rtran</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_not_step_e_step_c</span><span> </span><span>local.l1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>final_exist_component_tran_final</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>                                  
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; length l &#8743; final (l!j)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>                             
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;final(l!i)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;i &#8743; k&lt;j &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final(l!(Suc k))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?P</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;j. i&#8804;j &#8743; j &lt; length l &#8743; final (l!j)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;?P k &#8743; (&#8704;i&lt;k. &#172; ?P i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?P</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_k_not_final</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&#39;&lt;k. i&#39;&#8805;i &#10230; &#172;final (l!i&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_eq_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>le_imp_less_or_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pre_k</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pre_k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc pre_k = k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>k</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a3</span><span> </span><span>eq_iff</span><span> </span><span>le0</span><span> </span><span>lessE</span><span> </span><span>neq0_conv</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!pre_k)  &#8594; (l!k)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_k &#8805;i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pre_k</span><span> </span><span>i_eq_j</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>k</span><span> </span><span>le_Suc_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(final (l!pre_k))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_k_not_final</span><span> </span><span>pre_k</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>suc_not_final_final_c_tran</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>pre_k</span><span> </span><span>k</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pre_k</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>i_k_not_final</span><span> </span><span>k</span><span> </span><span>le_Suc_eq</span><span> </span><span>not_less_eq</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="verbatim"><span class="delete"><span class="delete"><span class="delete"><span class="delete">{* Basic Sound *}</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>basic_skip</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e, s1)  &#8594; ((c1,s2)) &#10230; c1=Skip&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s1</span><span> </span><span>s2</span><span> </span><span>c1</span><span>
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e,s1)  &#8594; ((c1,s2))&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1=Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stepc_elim_cases</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_comp_tran_before_i_basic</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &lt; i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>  
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span>        
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>basic_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>no_comp_tran_before_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_i_basic</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &#8800; i &#8743; Suc j &lt; length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; fst (l!j) =  Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>basic_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>only_one_component_tran_i</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_basic</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; k&#8804;i &#8743; i &#8800; j &#8743;  Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))) &#8743; fst (l!i) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j  &#8743; Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                       Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>       
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>basic_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>only_one_component_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_env_basic</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;i &#8743; Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))) &#8743; fst (l!i) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>        
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                       Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>basic_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>only_one_component_tran_basic</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_not_comp_basic</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))  &#8743; fst (l!i) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                       Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>basic_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>only_one_component_tran_all_not_comp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>one_component_tran_basic</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. f s &#8712; q}&quot;</span></span></span><span>
</span><span>           
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Basic f e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>basic_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>first</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc j&lt;length l &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))) &#8743; 
                 (&#8704;k &lt; j. &#172;((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a2</span><span> </span><span>exist_first_comp_tran&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>prg_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Basic f e&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a0</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cptn_env_same_prog</span><span> </span><span>not_step_comp_step_env</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sta_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) &#8712; Normal ` p&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804;j &#8743; j&lt;(length l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. 0&#8804;k &#8743; k &lt; j &#10230; ((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span>not_step_comp_step_env</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stability</span><span> </span><span>first</span><span> </span><span>a3</span><span> </span><span>a1&#39;</span><span>  </span><span>a0&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>first</span><span> </span><span>prg_j</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) = Normal s &#8743; s&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sta_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc j) = Skip &#8743; snd(l!Suc j) = Normal (f s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>prg_j</span><span> </span><span>snd_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. 0&#8804;i &#8743; i&#8800;j &#8743; Suc i &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_all_not_comp_basic</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span class="delimiter">]</span><span> </span><span>first</span><span> </span><span>a3</span><span> 
</span><span>          </span><span>a0</span><span> </span><span>a1</span><span> </span><span>calculation</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>only_one_component_tran1</span><span> </span><span>prg_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>one_component_tran_basic_env</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. f s &#8712; q}&quot;</span></span></span><span>           
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one_component_tran_basic</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>final_exist_component_tran_basic</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Basic f e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>               
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; q l R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; length l &#8743; final (l!j)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;i &#8743; k&lt;j &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>final_exist_component_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*lemma assumes a0:&quot;&#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  c sat [p, R, G, q,a]&quot;
      shows &quot;&#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  c sat [p, R, G, q,a]&quot;
proof-
  {     
    assume a01:&quot;&#8704;(b,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call b) sat [p, R, G, q,a]&quot;
    have &quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, R, G, q,a]&quot;
    proof-
      {fix s l
        assume a02:&quot;(&#915;,l)&#8712;cpn n &#915; c s&quot; and
               a03:&quot;(&#915;,l)&#8712;assum(p, R)&quot;
        have &quot;(&#915;,l)&#8712;comm(G, (q,a)) F&quot;  
        proof-
          have cpn_cp:&quot;(&#915;,l)&#8712;cp &#915; c s&quot; using a02
            using cp_def cpn_def cptn_if_cptn_mod cptn_mod_nest_cptn_mod by fastforce
        qed
      } then show ?thesis unfolding  com_validityn_def cpn_def by auto
    qed
  } then show ?thesis unfolding com_cvalidityn_def by auto
qed *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Basic_sound1</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. f s &#8712; q}&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s t. s&#8712;p &#8743; (t=f s) &#10230; (Normal s,Normal t) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Basic f e) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>   
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(Basic f e,s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
             (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
               (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length l &#10230; 
           &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                             
           (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>            </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_event</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &#8800; k &#8743; Suc j &lt; length l &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one_component_tran_basic_env</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>f</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>R</span><span class="delimiter">]</span><span> </span><span>a0</span><span> </span><span>a00</span><span> </span><span>a11</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>assum</span><span> </span><span>cp</span><span> 
</span><span>             </span><span>env_tran_right</span><span> </span><span>fst_conv</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>before_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &lt; k  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!k) = Basic f e &#8743; snd (l!k) &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>a11</span><span>  </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>k</span><span> </span><span>k</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_k_skip_q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc k) = Skip &#8743; snd (l!(Suc k)) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>suc_skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc k) = Skip&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a00</span><span> </span><span>a11</span><span>  </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>basic_skip</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!k)=Normal s&#39; &#8743; s&#39; &#8712; (p)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span>  </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(Suc k)) = Normal (f s&#39;)&quot;</span></span></span><span>          
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span>  </span><span>k_basic</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.inject</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>          
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(Suc k)) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>k_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span>s&#39;&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>        </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!k) = Normal s&#39; &#8743; s&#39; &#8712; (p) &#8743;  
           snd (l!(Suc k)) = Normal s&#39;&#39; &#8743; s&#39;&#39; &#8712; q&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>suc_k_skip_q</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712;  G&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Pair_inject</span><span> </span><span>a11</span><span> </span><span>k_basic</span><span> </span><span>prod.exhaust_sel</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230; 
               snd (last l) &#8713; Fault ` F  &#10230;
               ((fst (last l) = Skip &#8743; 
                snd (last l) &#8712; Normal ` q)) &#8744;
                (fst (last l) = Throw &#8743; 
                snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Basic f e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>final_exist_component_tran_basic</span><span> </span><span>env_tran</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_comp_tran</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_event</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &#8800; k &#8743; Suc j &lt; length l &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one_component_tran_basic_env</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>f</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>R</span><span class="delimiter">]</span><span> </span><span>a0</span><span>  </span><span>a11</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>assum</span><span> </span><span>cp</span><span> 
</span><span>             </span><span>env_tran_right</span><span> </span><span>fst_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>           
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>before_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &lt; k  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!k) = Basic f e &#8743; snd (l!k) &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>k_comp_tran</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>k</span><span> </span><span>k</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_k_skip_q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc k) = Skip &#8743; snd (l!(Suc k)) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>suc_skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc k) = Skip&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>k_comp_tran</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>basic_skip</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!k)=Normal s&#39; &#8743; s&#39; &#8712; (p)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_comp_tran</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(Suc k)) = Normal (f s&#39;)&quot;</span></span></span><span>          
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_comp_tran</span><span> </span><span>k_basic</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.inject</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>          
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(Suc k)) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>after_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. (Suc k)&#8804;j &#8743; Suc j &lt; (length l)  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_event</span><span> </span><span>k_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                            
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_last_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip &#8743; 
                         snd ((last l)) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a2</span><span> </span><span>last_l</span><span> </span><span>len_l</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a3</span><span> </span><span>suc_k_skip_q</span><span> </span><span>assum</span><span> </span><span>k_comp_tran</span><span> 
</span><span>            </span><span>stability</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>q</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((length l) - 1)&quot;</span></span></span><span> </span><span>_</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                 
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>                               
</span><span>   </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Basic_sound</span><span class="delimiter">:</span><span> 
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. f s &#8712; q} &#10233;
      (&#8704;s t. s&#8712;p &#8743; (t=f s) &#10230; (Normal s,Normal t) &#8712; G) &#10233;       
       Sta p R &#10233;
       Sta q R &#10233;       
       &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  (Basic f e) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. f s &#8712; q}&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s t. s&#8712;p &#8743; (t=f s) &#10230; (Normal s,Normal t) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Basic f e) s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Basic f e) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cp &#915; (Basic f e) s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Basic_sound1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a10</span><span> </span><span>a11</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="verbatim"><span class="delete"><span class="delete"><span class="delete"><span class="delete">{* Spec Sound *}</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>spec_skip</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; c1=Skip&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s1</span><span> </span><span>s2</span><span> </span><span>c1</span><span>
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2))&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1=Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stepc_elim_cases</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_comp_tran_before_i_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &lt; i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>no_comp_tran_before_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_i_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &#8800; i &#8743; Suc j &lt; length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; fst (l!j) =  Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>only_one_component_tran_i</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;i  &#8743; i &#8800; j &#8743; Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))) &#8743; fst (l!i) =  Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j  &#8743; Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>       
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>only_one_component_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_env_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;i &#8743; Suc i&lt;length l &#8743;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))  &#8743; fst (l!i) =  Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>       
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>only_one_component_tran_spec</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_not_comp_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;i &#8743; Suc i&lt;length l &#8743;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))  &#8743; fst (l!i) =  Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>       
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>only_one_component_tran_all_not_comp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>one_component_tran_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. (&#8704;t. (s,t)&#8712;r &#10230; t &#8712; q) &#8743; (&#8707;t. (s,t) &#8712; r)}&quot;</span></span></span><span>
</span><span>           
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>first</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc j&lt;length l &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!Suc j))) &#8743; 
                 (&#8704;k &lt; j. &#172;((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a2</span><span> </span><span>exist_first_comp_tran&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>prg_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Spec r e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a0</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cptn_env_same_prog</span><span> </span><span>not_step_comp_step_env</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sta_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) &#8712; Normal ` p&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804;j &#8743; j&lt;(length l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. 0&#8804;k &#8743; k &lt; j &#10230; ((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span>not_step_comp_step_env</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stability</span><span> </span><span>first</span><span> </span><span>a3</span><span> </span><span>a1&#39;</span><span>  </span><span>a0&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>first</span><span> </span><span>prg_j</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) = Normal s &#8743; s&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sta_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>       
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!Suc j) = Skip&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>spec_skip</span><span> </span><span>first</span><span> </span><span>prg_j</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc j) = Normal s&#39; &#8743; (s,s&#39;)&#8712;r&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(fst(l!j),snd(l!j))  &#8594; (fst(l!Suc j),snd(l!Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc j) = Normal t&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_spec_skip_normal_normal</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!j)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!j)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc j)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!Suc j)&quot;</span></span></span><span> </span><span>r</span><span class="delimiter">]</span><span> 
</span><span>         </span><span>suc_skip</span><span> </span><span>prg_j</span><span> </span><span>s</span><span> </span><span>a4</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(s,t)&#8712;r&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>s</span><span> </span><span>prg_j</span><span> </span><span>f1</span><span> </span><span>suc_skip</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span>  </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>prod.inject</span><span> </span><span>xstate.distinct</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. snd (l!Suc j)= Normal t  &#8743; (s,t)&#8712;r&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8896;s&#39;. snd (l ! Suc j) = Normal s&#39; &#8743; (s, s&#39;) &#8712; r &#10233; thesis) &#10233; thesis&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>             
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>sta_j</span><span> </span><span>s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. 0&#8804;i &#8743; i&#8800;j &#8743; Suc i &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_all_not_comp_spec</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span class="delimiter">]</span><span> </span><span>first</span><span> </span><span>a3</span><span> 
</span><span>          </span><span>a0</span><span> </span><span>a1</span><span> </span><span>calculation</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>only_one_component_tran1</span><span> </span><span>prg_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>one_component_tran_spec_env</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. (&#8704;t. (s,t)&#8712;r &#10230; t &#8712; q) &#8743; (&#8707;t. (s,t) &#8712; r)}&quot;</span></span></span><span>           
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one_component_tran_spec</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>final_exist_component_tran_spec</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Spec r e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>               
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; q l R &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; length l &#8743; final (l!j)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;i &#8743; k&lt;j &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Spec r e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>final_exist_component_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Spec_sound1</span><span class="delimiter">:</span><span> 
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. (&#8704;t. (s,t)&#8712;r &#10230; t &#8712; q) &#8743; (&#8707;t. (s,t) &#8712; r)} &#10233;
       (&#8704;s t. s&#8712;p  &#8743; (s,t)&#8712;r &#10230; (Normal s, Normal t) &#8712; G) &#10233;       
       Sta p R &#10233;
       Sta q R &#10233; 
       c &#8712; cp &#915; (Spec r e) s &#10233;
       c &#8712; assum(p, R) &#10233;
       c &#8712; comm (G, (q,a)) F&quot;</span></span></span><span>   
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. (&#8704;t. (s,t)&#8712;r &#10230; t &#8712; q) &#8743; (&#8707;t. (s,t) &#8712; r)}&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s t. s&#8712;p  &#8743; (s,t)&#8712;r &#10230; (Normal s,Normal t) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>  </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Spec r e) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(Spec r e,s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
             (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
               (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length l &#10230; 
           &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                       
             (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>            </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                
</span><span>     </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ck</span><span> </span><span>sk</span><span> </span><span>csk</span><span> </span><span>ssk</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>tran_pair</span><span class="delimiter">:</span><span>
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (ck,sk)  &#8594; (csk, ssk) &#8743; (ck = fst (l!k)) &#8743; (sk = snd (l!k)) &#8743; (csk = fst (l!(Suc k))) &#8743; (ssk = snd (l!(Suc k)))&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_event</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &#8800; k &#8743; Suc j &lt; length l &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span>   </span><span>one_component_tran_spec_env</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>r</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>R</span><span class="delimiter">]</span><span> 
</span><span>             </span><span>env_tran_right</span><span> </span><span>fst_conv</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>cp</span><span> </span><span>len_l</span><span> </span><span>assum</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>before_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &lt; k  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ck = Spec r e &#8743; sk &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span>  </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>a11</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>k</span><span> </span><span>k</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>tran_pair</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;csk = Skip&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a00</span><span> </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sk = Normal s&#39; &#8743; s&#39; &#8712; (p)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>suc_k_skip_q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssk = Normal s&#39;&#39; &#8743; (s&#39;,s&#39;&#39;)&#8712;r &quot;</span></span></span><span>           
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>                    
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ss</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk = Normal t&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_spec_skip_normal_normal</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;1</span><span> </span><span>ck</span><span> </span><span>sk</span><span> </span><span>csk</span><span> </span><span>ssk</span><span> </span><span>r</span><span> </span><span>e</span><span> </span><span>s&#39;</span><span class="delimiter">]</span><span> 
</span><span>               </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>a0</span><span> </span><span>suc_skip</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                      
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(s&#39;,t)&#8712;r&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>k_basic</span><span> </span><span>ss</span><span> </span><span>a11</span><span> </span><span>suc_skip</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span>  </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>tran_pair</span><span> </span><span>prod.inject</span><span> </span><span>xstate.distinct</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>            
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. ssk= Normal t  &#8743; (s&#39;,t)&#8712;r&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8896;s&#39;&#39;. ssk = Normal s&#39;&#39;  &#8743; (s&#39;,s&#39;&#39;)&#8712;r&#10233; thesis) &#10233; thesis&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">..</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>                                                                        
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>a1</span><span> </span><span>tran_pair</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230; ((fst (last l) = Skip &#8743; 
                                              snd (last l) &#8712; Normal ` q)) &#8744;
                                              (fst (last l) = Throw &#8743; 
                                              snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Spec r e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>final_exist_component_tran_spec</span><span> </span><span>env_tran</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_comp_tran</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ck</span><span> </span><span>sk</span><span> </span><span>csk</span><span> </span><span>ssk</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>tran_pair</span><span class="delimiter">:</span><span>
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (ck,sk)  &#8594; (csk, ssk) &#8743; (ck = fst (l!k)) &#8743; (sk = snd (l!k)) &#8743; (csk = fst (l!(Suc k))) &#8743; (ssk = snd (l!(Suc k)))&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_event</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &#8800; k &#8743; Suc j &lt; length l &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one_component_tran_spec_env</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>r</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>R</span><span class="delimiter">]</span><span> </span><span>a0</span><span>  </span><span>a11</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>assum</span><span> </span><span>cp</span><span> 
</span><span>             </span><span>env_tran_right</span><span> </span><span>fst_conv</span><span>            
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>before_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &lt; k  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ck = Spec r e &#8743; sk &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>tran_pair</span><span> </span><span>k_comp_tran</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>k</span><span> </span><span>k</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>tran_pair</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;csk = Skip&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>spec_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_k_skip_q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Normal ` q&quot;</span></span></span><span>           
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>         
</span><span>       </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sk =Normal s&#39; &#8743; s&#39; &#8712; (p)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk = Normal t&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_spec_skip_normal_normal</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;1</span><span> </span><span>ck</span><span> </span><span>sk</span><span> </span><span>csk</span><span> </span><span>ssk</span><span> </span><span>r</span><span class="delimiter">]</span><span> </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>a0</span><span> </span><span>suc_skip</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>           
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk= Normal t&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(s&#39;,t)&#8712;r&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>k_basic</span><span> </span><span>k_s</span><span> </span><span>a11</span><span> </span><span>suc_skip</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span>  </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>tran_pair</span><span> </span><span>prod.inject</span><span> </span><span>xstate.distinct</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Normal ` q&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>k_s</span><span> </span><span class="alt_string"><span class="delete"><span class="delete">`ssk = Normal t`</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>after_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. (Suc k)&#8804;j &#8743; Suc j &lt; (length l)  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_event</span><span> </span><span>k_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                            
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_last_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip &#8743; 
                         snd ((last l)) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>tran_pair</span><span> </span><span>suc_skip</span><span> </span><span>last_l</span><span> </span><span>len_l</span><span> </span><span>cp</span><span> 
</span><span>           </span><span>env_tran_right</span><span> </span><span>a3</span><span> </span><span>suc_k_skip_q</span><span> 
</span><span>           </span><span>assum</span><span> </span><span>k_comp_tran</span><span> </span><span>stability</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>q</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((length l) - 1)&quot;</span></span></span><span> </span><span>_</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_mono</span><span> </span><span>diff_Suc_1</span><span> </span><span>lessI</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                  
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>                           
</span><span>   </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Spec_sound</span><span class="delimiter">:</span><span> 
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. (&#8704;t. (s,t)&#8712;r &#10230; t &#8712; q) &#8743; (&#8707;t. (s,t) &#8712; r)} &#10233;
       (&#8704;s t. s&#8712;p  &#8743; (s,t)&#8712;r &#10230; (Normal s, Normal t) &#8712; G) &#10233;       
       Sta p R &#10233;
       Sta q R &#10233;    
       &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  (Spec r e) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; {s. (&#8704;t. (s,t)&#8712;r &#10230; t &#8712; q) &#8743; (&#8707;t. (s,t) &#8712; r)}&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s t. s&#8712;p  &#8743; (s,t)&#8712;r &#10230; (Normal s,Normal t) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Spec r e) s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Spec r e) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cp &#915; (Spec r e) s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Spec_sound1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a10</span><span> </span><span>a11</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="verbatim"><span class="delete"><span class="delete"><span class="delete"><span class="delete">{* Await Sound *}</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>await_skip</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230; c1=Skip &#8744; (c1 = Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s1</span><span> </span><span>s2</span><span> </span><span>c1</span><span>
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2))&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1=Skip &#8744;  (c1 = Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stepc_elim_cases</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_comp_tran_before_i_await</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &lt; i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely  &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                         Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230;  c1=Skip &#8744; (c1 = Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>no_comp_tran_before_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_i_await</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j &#8743; j &#8800; i &#8743; Suc j &lt; length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; fst (l!j) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743; snd (l!Suc j) &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&#8744;(c1 = Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>only_one_component_tran_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_await</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; k&#8804;i &#8743; i &#8800; j &#8743;  Suc i&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))) &#8743; fst (l!i) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;j  &#8743; Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                       Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&#8744;(c1 = Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>only_one_component_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_env_await</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))  &#8743; fst (l!i) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                       Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span>       
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&#8744;(c1 = Throw)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>only_one_component_tran_await</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_one_component_tran_all_not_comp_await</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!k) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#8743; k&#8804;i &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))  &#8743; fst (l!i) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!k) &#8712; Normal ` p &#8743; 
                                       Sta q rely &#8743; snd (l!Suc i) &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. k&#8804;j &#8743; j&#8800;i &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&#8744;(c1 = Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>only_one_component_tran_all_not_comp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>one_component_tran_await</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743;
                                        Sta a rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;V. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
             (p &#8745; b &#8745; {V}) c
             ({s. (Normal V, Normal s) &#8712; G} &#8745; q),
             ({s. (Normal V, Normal s) &#8712; G} &#8745; a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>           
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))) &#8743;
         (&#8707;s s&#39;. fst (l!k) = Await b c e &#8743; snd (l!k) &#8712; Normal ` (p) &#8743; snd (l!k) = Normal s &#8743; snd (l!Suc k) = Normal s&#39; &#8743; 
            (snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q) &#8744; 
             snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>suc_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&#8744; (c1=Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>first</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc j&lt;length l &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))) &#8743; 
                 (&#8704;k &lt; j. &#172;((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>a2</span><span> </span><span>exist_first_comp_tran&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>prg_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Await b c e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a0</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cptn_env_same_prog</span><span> </span><span>not_step_comp_step_env</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sta_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) &#8712; Normal ` p&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804;j &#8743; j&lt;(length l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. 0&#8804;k &#8743; k &lt; j &#10230; ((&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k)))))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span>not_step_comp_step_env</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stability</span><span> </span><span>first</span><span> </span><span>a3</span><span> </span><span>a1&#39;</span><span>  </span><span>a0&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>sta_j</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>      </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = Await b c e &#8743; snd (l!j) = Normal s &#8743;  s &#8712; p &#8743; snd(l!j) &#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sta_j</span><span> </span><span>prg_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>conc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc j) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q) &#8744; 
             snd (l!Suc j) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
                     (p &#8745; b &#8745; {s}) c 
                     ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q),
                     ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a4</span><span> </span><span>hoare_sound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e_auto</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (p &#8745; b &#8745; {s}) c 
                     ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q),
                     ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cvalid_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(fst (l!j), snd(l!j))  &#8594; (fst(l!(Suc j)), snd(l!(Suc j)))&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>first</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step_await</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt;length l &#8743; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (Await b c e,snd(l!j))  &#8594; (fst(l!(Suc j)), snd(l!(Suc j)))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f&#39;</span><span> </span><span>k_basic</span><span> </span><span>first</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>           
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s&#39;_in_bp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#8712; b &#8743; s &#8712; p&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s &#8712; (p &#8745; b)&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>test</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866; &#10216;c,Normal s&#10217; &#8658; t &#8743; 
       ((&#8707;t&#39;. t =Abrupt t&#39; &#8743; snd(l!Suc j) = Normal t&#39;) &#8744;
       (&#8704;t&#39;. t &#8800; Abrupt t&#39; &#8743; snd(l!Suc j)=t))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>t</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc j) = Skip&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (Await b c e,Normal s)  &#8594; (Skip, snd(l!Suc j))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_await</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s&#39;_b</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#8712;b&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s&#39;_in_bp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>step</span><span> </span><span class="delimiter">=</span><span> </span><span>stepc_elim_cases_Await_skip</span><span class="delimiter">[</span><span>OF</span><span> </span><span>step</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>h</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(s &#8712; b &#10233; &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866; &#10216;c,Normal s&#10217; &#8658; snd(l!Suc j) &#10233; &#8704;t&#39;. snd(l!Suc j) &#8800; Abrupt t&#39; &#10233;
              &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866; &#10216;c,Normal s&#10217; &#8658; snd(l!Suc j) &#8743; (&#8704;t&#39;. snd(l!Suc j) &#8800; Abrupt t&#39;))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span class="delimiter">[</span><span>OF</span><span> </span><span>h</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc j)= Throw &#8743; (&#8707;s1. snd(l!Suc j) = Normal s1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!Suc j)= Throw &#8743; snd(l!Suc j) = Normal s1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (Await b c e,Normal s)  &#8594; (Throw, snd(l!Suc j))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_await</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s&#39;_b</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#8712;b&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s&#39;_in_bp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>step</span><span> </span><span class="delimiter">=</span><span> </span><span>stepc_elim_cases_Await_throw</span><span class="delimiter">[</span><span>OF</span><span> </span><span>step</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>h</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8896;t&#39;. snd(l!Suc j) = Normal t&#39; &#10233; s &#8712; b &#10233; &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866; &#10216;c,Normal s&#10217; &#8658; Abrupt t&#39; &#10233; 
                &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866; &#10216;c,Normal s&#10217; &#8658; Abrupt t&#39; &#8743;  snd(l!Suc j) = Normal t&#39;)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span class="delimiter">[</span><span>OF</span><span> </span><span>h</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>suc_skip</span><span>  </span><span>left</span><span>  </span><span>step_await</span><span> </span><span>suc_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866; &#10216;c,Normal s&#10217; &#8658; t &#8743; 
             ((&#8707;t&#39;. t =Abrupt t&#39; &#8743; snd(l!Suc j) = Normal t&#39;) &#8744;
             (&#8704;t&#39;. t &#8800; Abrupt t&#39; &#8743; snd(l!Suc j)=t)) &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;t &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>           
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;t &#8712; Fault ` F&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>tf</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;t=Fault tf &#8743; tf&#8712;F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!Suc j) = Fault tf &#8743; tf&#8712;F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!Suc j) &#8713; Fault  ` F&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_not_F</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>F</span><span class="delimiter">]</span><span> </span><span>a5</span><span> </span><span>a1</span><span> </span><span>step_await</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>t_q_a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;t &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745;q) &#8746; 
                              Abrupt ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_auto</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>valid_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_step</span><span> </span><span>t_q_a</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                                                                       
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>       
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. 0&#8804;i &#8743; i&#8800;j &#8743; Suc i &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_one_component_tran_all_not_comp_await</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span class="delimiter">]</span><span> </span><span>first</span><span> </span><span>a3</span><span> 
</span><span>          </span><span>a0</span><span> </span><span>a1</span><span> </span><span>calculation</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>only_one_component_tran1</span><span> </span><span>prg_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>conc</span><span> </span><span>k</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>     </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;s s&#39;. fst (l!k) = Await b c e &#8743; snd (l!k) &#8712; Normal ` (p) &#8743; snd (l!k) = Normal s &#8743; snd (l!Suc k) = Normal s&#39; &#8743; 
            (snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q) &#8744; 
             snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>one_component_tran_await_env</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l rely &#8743; Sta p rely &#8743; snd (l!0) &#8712; Normal ` p &#8743; 
                                        Sta q rely &#8743;
                                        Sta a rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;V. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
             (p &#8745; b &#8745; {V}) c
             ({s. (Normal V, Normal s) &#8712; G} &#8745; q),
             ({s. (Normal V, Normal s) &#8712; G} &#8745; a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>           
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))) &#8743; 
           (&#8707;s s&#39;. fst (l!k) = Await b c e &#8743; snd (l!k) &#8712; Normal ` (p) &#8743; 
                 snd (l!k) = Normal s &#8743; snd (l!Suc k) = Normal s&#39; &#8743; 
                  (snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q) &#8744; 
                   snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)))&quot;</span></span></span><span>  
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; &#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j)))) &#8743; 
        (&#8707;s s&#39;. fst (l!k) = Await b c e &#8743; snd (l!k) &#8712; Normal ` (p) &#8743; 
                snd (l!k) = Normal s &#8743; snd (l!Suc k) = Normal s&#39; &#8743; 
                  (snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q) &#8744; 
                   snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one_component_tran_await</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>    
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>final_exist_component_tran_await</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = Await b c e&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>               
</span><span>          </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; q l R &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;j &#8743; j &lt; length l &#8743; final (l!j)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;i &#8743; k&lt;j &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s1 s2 c1. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Await b c e,s1)  &#8594; ((c1,s2)) &#10230; (c1=Skip)&#8744;(c1 = Throw &#8743; (&#8707;s21. s2 =Normal s21 ))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>final_exist_component_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>stepc_elim_cases_Await_Fault</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (Await b c e, Normal s) &#8594; (u,Fault f)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Await_sound1</span><span class="delimiter">:</span><span> 
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;V. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
    (p &#8745; b &#8745; {V}) e 
    ({s. (Normal V, Normal s) &#8712; G} &#8745; q),
    ({s. (Normal V, Normal s) &#8712; G} &#8745; a) &#10233;     
 Sta p R &#10233; Sta q R &#10233; Sta a R &#10233;   
 c &#8712; cp &#915; (Await b e e1) s &#10233;
 c &#8712; assum(p, R) &#10233;
 c &#8712; comm (G, (q,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;V. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
        (p &#8745; b &#8745; {V}) e 
        ({s. (Normal V, Normal s) &#8712; G} &#8745; q),
        ({s. (Normal V, Normal s) &#8712; G} &#8745; a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>  </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Await b e e1) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>last_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(Await b e e1,s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
             (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
               (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length l &#10230; 
           &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                              
             (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>            </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_event</span><span class="delimiter">:</span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;s s&#39;. fst (l!k) = Await b e e1 &#8743; snd (l!k) &#8712; Normal ` (p) &#8743; snd (l!k) = 
                   Normal s &#8743; snd (l!Suc k) = Normal s&#39; &#8743; 
                  (snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q) &#8744; 
                   snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span>  </span><span>one_component_tran_await_env</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>b</span><span> </span><span>e</span><span> </span><span>e1</span><span> </span><span>k</span><span> </span><span>R</span><span> </span><span>p</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>G</span><span class="delimiter">]</span><span> </span><span>env_tran_right</span><span> </span><span>cp</span><span> </span><span>len_l</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>assum</span><span> </span><span>fst_conv</span><span> </span><span>last_fault</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                                                                          
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span>s&#39;&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span>
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!k) = Normal s&#39; &#8743; s&#39; &#8712; (p) &#8743;  snd (l!Suc k) = Normal s&#39;&#39; 
        &#8743; (s&#39;&#39; &#8712; (({s. (Normal s&#39;, Normal s) &#8712; G} &#8745; q)) &#8744; 
           s&#39;&#39;&#8712; (({s. (Normal s&#39;, Normal s) &#8712; G} &#8745; a)))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
               ((fst (last l) = Skip &#8743; 
                snd (last l) &#8712; Normal ` q)) &#8744;
                (fst (last l) = Throw &#8743; 
                snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>         
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a1</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Await b e e1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span> </span><span>final_exist_component_tran_await</span><span> </span><span>env_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_comp_tran</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; Suc k &lt; length l &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ck</span><span> </span><span>sk</span><span> </span><span>csk</span><span> </span><span>ssk</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>tran_pair</span><span class="delimiter">:</span><span>
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (ck,sk)  &#8594; (csk, ssk) &#8743; (ck = fst (l!k)) &#8743; (sk = snd (l!k)) &#8743; (csk = fst (l!(Suc k))) &#8743; (ssk = snd (l!(Suc k)))&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_event</span><span class="delimiter">:</span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. 0&#8804;j &#8743; j&#8800;k &#8743; Suc j &lt; (length l) &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))) &#8743;
           (&#8707;s s&#39;. fst (l!k) = Await b e e1 &#8743; snd (l!k) &#8712; Normal ` (p) &#8743; snd (l!k) = 
                   Normal s &#8743; snd (l!Suc k) = Normal s&#39; &#8743; 
                  (snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; q) &#8744; 
                   snd (l!Suc k) &#8712; Normal ` ({s&#39;. (Normal s, Normal s&#39;) &#8712; G} &#8745; a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>one_component_tran_await_env</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>b</span><span> </span><span>e</span><span> </span><span>e1</span><span> </span><span>k</span><span> </span><span>R</span><span> </span><span>p</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>G</span><span class="delimiter">]</span><span> </span><span>a0</span><span> </span><span>a11</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>assum</span><span> </span><span>cp</span><span> 
</span><span>              </span><span>env_tran_right</span><span>  </span><span>len_l</span><span>  </span><span>fst_conv</span><span> </span><span>last_fault</span><span> </span><span>k_comp_tran</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>before_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. 0&#8804;j &#8743; j &lt; k  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ck = Await b e e1 &#8743; sk &#8712; Normal ` (p) &#8743; sk = Normal s&#39;&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>tran_pair</span><span> </span><span>k_comp_tran</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>k</span><span> </span><span>k</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>tran_pair</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>        
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
                 (p &#8745; b &#8745; {s&#39;}) e 
                 ({s. (Normal s&#39;, Normal s) &#8712; G} &#8745; q),
                 ({s. (Normal s&#39;, Normal s) &#8712; G} &#8745; a)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>hoare_sound</span><span> </span><span>k_basic</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e_auto</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (p &#8745; b &#8745; {s&#39;}) e 
                 ({s. (Normal s&#39;, Normal s) &#8712; G} &#8745; q),
                 ({s. (Normal s&#39;, Normal s) &#8712; G} &#8745; a)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cvalid_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>after_k_all_evn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. (Suc k)&#8804;j &#8743; Suc j &lt; (length l)  &#10230; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_event</span><span> </span><span>k_comp_tran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>          
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_skip</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;csk = Skip  &#8744; (csk = Throw &#8743; (&#8707;s1. ssk = Normal s1))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>await_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>at</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csk = Skip&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>atom_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866;&#10216;e,sk&#10217; &#8658; ssk&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>k_basic</span><span> </span><span>cp</span><span> </span><span>stepc_elim_cases_Await_skip</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sk_in_normal_pb</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sk &#8712; Normal ` (p &#8745; b)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>at</span><span> </span><span>cp</span><span> </span><span>stepc_elim_cases_Await_skip</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>IntI</span><span> </span><span>image_iff</span><span class="delimiter">)</span><span>                                  
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip &#8743; 
                   snd ((last l)) &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ssk</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Normal</span><span> </span><span>t</span><span class="delimiter">)</span><span>                                                  
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sk_in_normal_pb</span><span> </span><span>k_basic</span><span> </span><span>e_auto</span><span> </span><span>Normal</span><span> </span><span>atom_tran</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>valid_def</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>at</span><span> </span><span>l</span><span> </span><span>tran_pair</span><span> </span><span>last_l</span><span> </span><span>len_l</span><span> </span><span>cp</span><span> 
</span><span>             </span><span>env_tran_right</span><span> </span><span>a3</span><span>  </span><span>after_k_all_evn</span><span> 
</span><span>             </span><span>assum</span><span> </span><span>k_comp_tran</span><span> </span><span>stability</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>q</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((length l) - 1)&quot;</span></span></span><span> </span><span>_</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>diff_less</span><span> </span><span>less_one</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>         
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Abrupt</span><span> </span><span>t</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>at</span><span> </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>k_basic</span><span> </span><span>cp</span><span> </span><span>stepc_elim_cases_Await_skip</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>                
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Fault</span><span> </span><span>f1</span><span class="delimiter">)</span><span>              
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Normal ` q &#8744; ssk &#8712; Fault ` F&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>sk_in_normal_pb</span><span> </span><span>e_auto</span><span> </span><span>Fault</span><span> </span><span>atom_tran</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>valid_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                          
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Fault</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>suck_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Fault ` F&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. snd (l ! i) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_not_F</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>F</span><span class="delimiter">]</span><span> </span><span>last_fault</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>tran_pair</span><span> </span><span>a11</span><span> </span><span>k_comp_tran</span><span> </span><span>suck_fault</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>diff_less</span><span> </span><span>len_l</span><span> </span><span>less_imp_Suc_add</span><span> </span><span>less_one</span><span> </span><span>less_trans_Suc</span><span class="delimiter">)</span><span>                  
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Stuck</span><span class="delimiter">)</span><span>             
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>sk_in_normal_pb</span><span> </span><span>e_auto</span><span> </span><span>Stuck</span><span> </span><span>atom_tran</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>valid_def</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Stuck</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                             
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>            
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>at</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(csk = Throw &#8743; (&#8707;t. ssk = Normal t))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ssk_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssk=Normal t&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>atom_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>&#8866;&#10216;e,sk&#10217; &#8658; Abrupt t&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>at</span><span> </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>k_basic</span><span> </span><span>ssk_normal</span><span> </span><span>cp</span><span> </span><span>stepc_elim_cases_Await_throw</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>                        
</span><span>       </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sk &#8712; Normal ` (p &#8745; b)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>tran_pair</span><span> </span><span>k_basic</span><span> </span><span>ssk_normal</span><span> </span><span>at</span><span> </span><span>cp</span><span> </span><span>stepc_elim_cases_Await_throw</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>IntI</span><span> </span><span>imageE</span><span> </span><span>image_eqI</span><span> </span><span>stepc_elim_cases_Await_throw</span><span class="delimiter">)</span><span>               
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ssk &#8712; Normal ` a&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_auto</span><span> </span><span>k_basic</span><span> </span><span>ssk_normal</span><span> </span><span>atom_tran</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>valid_def</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (last l) = Throw &#8743; snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>at</span><span> </span><span>l</span><span> </span><span>tran_pair</span><span> </span><span>last_l</span><span> </span><span>len_l</span><span> </span><span>cp</span><span> 
</span><span>           </span><span>env_tran_right</span><span> </span><span>a4</span><span>  </span><span>after_k_all_evn</span><span>
</span><span>           </span><span>assum</span><span> </span><span>k_comp_tran</span><span> </span><span>stability</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((length l) - 1)&quot;</span></span></span><span> </span><span>_</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>        
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>diff_less</span><span> </span><span>less_one</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>                    
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip &#8743; 
                         snd ((last l)) &#8712; Normal ` q &#8744;
                        (fst (last l) = Throw &#8743; snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                     
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>               
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>              
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="verbatim"><span class="delete"><span class="delete"><span class="delete"><span class="delete">{* If sound *}</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_assum_induct</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; (cp &#915; c s) &#8743; ((&#915;,l) &#8712; assum(p, R))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length l &#8743; l!k=(c1,Normal s&#39;) &#8743; s&#39; &#8712; p1&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,drop k l)&#8712; ((cp &#915; c1 (Normal s&#39;)) &#8745; assum(p1, R) )&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(drop k l)!0 = (c1,Normal s&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; p1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, drop k l) &#8712; cp &#915; c1 (Normal s&#39;)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>dropcptn_is_cptn</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>drop_k_s</span><span> </span><span>cp_def</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c</span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,drop k l)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd((snd ?c!0)) &#8712; Normal ` p1&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>drop_k_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length (snd ?c)&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(fst ?c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd ?c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd ?c)!(Suc i))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd ?c)!i), snd((snd ?c)!(Suc i))) &#8712; R &quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, drop k l) &#8712; assum (p1, R)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Await_sound</span><span class="delimiter">:</span><span> 
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;V. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
    (p &#8745; b &#8745; {V}) e 
    ({s. (Normal V, Normal s) &#8712; G} &#8745; q),
    ({s. (Normal V, Normal s) &#8712; G} &#8745; a) &#10233;     
 Sta p R &#10233; Sta q R &#10233; Sta a R &#10233;   
 &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  (Await b e e1) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;V. &#915;<span class="hidden">&#8681;</span><sub>&#172;</sub><span class="hidden">&#8681;</span><sub>a</sub>,{}&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> 
        (p &#8745; b &#8745; {V}) e 
        ({s. (Normal V, Normal s) &#8712; G} &#8745; q),
        ({s. (Normal V, Normal s) &#8712; G} &#8745; a)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span>  
</span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Await b e e1) s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Await b e e1) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cp &#915; (Await b e e1) s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Await_sound1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a10</span><span> </span><span>a11</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_comm_induct</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; (cp &#915; c s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1 = drop j l &#8743; (&#915;, l1)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8805; j &#8743; j &lt; length l&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l)) &#8713; Fault ` F  &#10230; ((Suc k &lt; length l &#10230;
       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)) &#10230;        
       (snd(l!k), snd(l!(Suc k))) &#8712; G) 
      &#8743; (final (last (l))  &#10230;           
            ((fst (last (l)) = Skip &#8743; 
              snd (last (l)) &#8712; Normal ` q)) &#8744;
            (fst (last (l)) = Throw &#8743; 
              snd (last (l)) &#8712; Normal ` (a))))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l1)) &#8713; Fault ` F  &#10230;(&#8704;i.                 
               Suc i&lt;length (snd (&#915;, l1)) &#10230; 
               fst (&#915;, l1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (&#915;, l1))!i)  &#8594; ((snd (&#915;, l1))!(Suc i)) &#10230;                                             
                 (snd((snd (&#915;, l1))!i), snd((snd (&#915;, l1))!(Suc i))) &#8712; G) &#8743; 
               (final (last (snd (&#915;, l1)))  &#10230; 
                snd (last (snd (&#915;, l1))) &#8713; Fault ` F  &#10230;
                  ((fst (last (snd (&#915;, l1))) = Skip &#8743; 
                    snd (last (snd (&#915;, l1))) &#8712; Normal ` q)) &#8744;
                  (fst (last (snd (&#915;, l1))) = Throw &#8743; 
                    snd (last (snd (&#915;, l1))) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l1 = last l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; snd (last l) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a03</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8805; j &#8743; Suc k &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(l!k = l1! (k - j) ) &#8743; (l!Suc k = l1!Suc (k - j))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (k - j) &lt; length l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!(k-j))  &#8594; (l1!(Suc (k-j))) &#10230;         
        (snd((snd (&#915;, l1))!(k-j)), snd((snd (&#915;, l1))!(Suc (k-j)))) &#8712; G&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_&#915;l</span><span> </span><span>a00</span><span> </span><span>l1_f</span><span> </span><span>a03</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)) &#10230; 
        (snd (l ! k), snd (l ! Suc k)) &#8712; G &quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l1_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_side</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l &#10230;
    &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! k &#8594; l ! Suc k &#10230;   
    (snd (l ! k), snd (l ! Suc k)) &#8712; G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last (l))&quot;</span></span></span><span>              
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last (l1))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l1)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_l</span><span> </span><span>l1_f</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last (snd (&#915;, l1))) = Skip &#8743; 
                        snd (last (snd (&#915;, l1))) &#8712; Normal ` q)) &#8744;
                      (fst (last (snd (&#915;, l1))) = Throw &#8743; 
                        snd (last (snd (&#915;, l1))) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_&#915;l</span><span> </span><span>a03</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last (snd (&#915;, l))) = Skip &#8743; 
              snd (last (snd (&#915;, l))) &#8712; Normal ` q)) &#8744;
              (fst (last (snd (&#915;, l))) = Throw &#8743; 
             snd (last (snd (&#915;, l))) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_eq</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>      </span><span>r_side</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;SmallStepCon.final (last l) &#10230;     
      fst (last l) = LanguageCon.com.Skip &#8743; snd (last l) &#8712; Normal ` q &#8744;
       fst (last l) = LanguageCon.com.Throw &#8743; snd (last l) &#8712; Normal ` a&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span class="delimiter">=</span><span>conjI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l_side</span><span> </span><span>r_side</span><span class="delimiter">]</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpn_assum_induct</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; (cpn n &#915; c s) &#8743; ((&#915;,l) &#8712; assum(p, R))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length l &#8743; l!k=(c1,Normal s&#39;) &#8743; s&#39; &#8712; p1&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,drop k l)&#8712; ((cpn n &#915; c1 (Normal s&#39;)) &#8745; assum(p1, R) )&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(drop k l)!0 = (c1,Normal s&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; p1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, drop k l) &#8712; cpn n &#915; c1 (Normal s&#39;)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>dropcptn_is_cptn1</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c</span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,drop k l)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd((snd ?c!0)) &#8712; Normal ` p1&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>drop_k_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length (snd ?c)&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(fst ?c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd ?c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd ?c)!(Suc i))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd ?c)!i), snd((snd ?c)!(Suc i))) &#8712; R &quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, drop k l) &#8712; assum (p1, R)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpn_comm_induct</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1 = drop j l &#8743; (&#915;, l1)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8805; j &#8743; j &lt; length l&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l)) &#8713; Fault ` F  &#10230; ((Suc k &lt; length l &#10230;
       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)) &#10230;        
       (snd(l!k), snd(l!(Suc k))) &#8712; G) 
      &#8743; (final (last (l))  &#10230;           
            ((fst (last (l)) = Skip &#8743; 
              snd (last (l)) &#8712; Normal ` q)) &#8744;
            (fst (last (l)) = Throw &#8743; 
              snd (last (l)) &#8712; Normal ` (a))))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l1)) &#8713; Fault ` F  &#10230;(&#8704;i.                 
               Suc i&lt;length (snd (&#915;, l1)) &#10230; 
               fst (&#915;, l1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (&#915;, l1))!i)  &#8594; ((snd (&#915;, l1))!(Suc i)) &#10230;                                             
                 (snd((snd (&#915;, l1))!i), snd((snd (&#915;, l1))!(Suc i))) &#8712; G) &#8743; 
               (final (last (snd (&#915;, l1)))  &#10230; 
                snd (last (snd (&#915;, l1))) &#8713; Fault ` F  &#10230;
                  ((fst (last (snd (&#915;, l1))) = Skip &#8743; 
                    snd (last (snd (&#915;, l1))) &#8712; Normal ` q)) &#8744;
                  (fst (last (snd (&#915;, l1))) = Throw &#8743; 
                    snd (last (snd (&#915;, l1))) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l1 = last l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; snd (last l) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a03</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8805; j &#8743; Suc k &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(l!k = l1! (k - j) ) &#8743; (l!Suc k = l1!Suc (k - j))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (k - j) &lt; length l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!(k-j))  &#8594; (l1!(Suc (k-j))) &#10230;         
        (snd((snd (&#915;, l1))!(k-j)), snd((snd (&#915;, l1))!(Suc (k-j)))) &#8712; G&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_&#915;l</span><span> </span><span>a00</span><span> </span><span>l1_f</span><span> </span><span>a03</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)) &#10230; 
        (snd (l ! k), snd (l ! Suc k)) &#8712; G &quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l1_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_side</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l &#10230;
    &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! k &#8594; l ! Suc k &#10230;   
    (snd (l ! k), snd (l ! Suc k)) &#8712; G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last (l))&quot;</span></span></span><span>              
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last (l1))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l1)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_l</span><span> </span><span>l1_f</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last (snd (&#915;, l1))) = Skip &#8743; 
                        snd (last (snd (&#915;, l1))) &#8712; Normal ` q)) &#8744;
                      (fst (last (snd (&#915;, l1))) = Throw &#8743; 
                        snd (last (snd (&#915;, l1))) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_&#915;l</span><span> </span><span>a03</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last (snd (&#915;, l))) = Skip &#8743; 
              snd (last (snd (&#915;, l))) &#8712; Normal ` q)) &#8744;
              (fst (last (snd (&#915;, l))) = Throw &#8743; 
             snd (last (snd (&#915;, l))) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_eq</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>      </span><span>r_side</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;SmallStepCon.final (last l) &#10230;     
      fst (last l) = LanguageCon.com.Skip &#8743; snd (last l) &#8712; Normal ` q &#8744;
       fst (last l) = LanguageCon.com.Throw &#8743; snd (last l) &#8712; Normal ` a&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span class="delimiter">=</span><span>conjI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l_side</span><span> </span><span>r_side</span><span class="delimiter">]</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>If_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b,  R, G, q,a] &#10233;
       (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b,  R, G, q,a]) &#10233;
       &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [p &#8745; (-b),  R, G, q,a] &#10233;
       (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [p &#8745; (-b),  R, G, q,a]) &#10233;      
       Sta p R &#10233; (&#8704;s. (Normal s, Normal s) &#8712; G)  &#10233; 
       &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Cond b c1 c2) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b,  R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [p &#8745; (-b), R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [p &#8745; (-b), R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [p &#8745; (-b), R, G, q,a]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>com_cvalidityn_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, q,a]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>all_call</span><span> </span><span>com_cvalidityn_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Cond b c1 c2)  s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Cond b c1 c2) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Cond b c1 c2) s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>  
</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Cond b c1 c2),s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10&#39;</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
                   (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
               &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;               
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                                                                           
</span><span>         </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                   
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj = (Cond b c1 c2) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a4</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span> </span><span>snd_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span class="delimiter">)</span><span>          
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span class="delimiter">)</span><span>   
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>          
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s&#39;, Normal s&#39;) &#8712; G&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712; G&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span> </span><span>k_basic</span><span> </span><span>True</span><span> </span><span>ss</span><span> </span><span>ssj_normal_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>         </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_suc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span>  </span><span>ssj_normal_s</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>before_k_all_evnt</span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;b &#8744; s&#39;&#8713;b&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                         
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;b&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; (p &#8745; b)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a000</span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>              
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum((p &#8745; b), R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>calculation</span><span> </span><span>a2</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>             
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_suc</span><span> </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>
</span><span>                     </span><span>cpn_assum_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>n</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Cond b c1 c2)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>p</span><span> </span><span>R</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>c1</span><span> </span><span>s&#39;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(p &#8745; b)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                         
</span><span>             </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_k</span><span> </span><span>drop_comm</span><span> </span><span>a00</span><span> </span><span>a21</span><span>  </span><span>a10</span><span> </span><span>&#915;1</span><span> </span><span>l_f</span><span>  
</span><span>               </span><span>cpn_comm_induct</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                       
</span><span>           </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8713;b&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; (p &#8745; (-b))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a000</span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum((p &#8745; (-b)), R)  &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>             
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_suc</span><span> </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>
</span><span>                     </span><span>cpn_assum_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>n</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Cond b c1 c2)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>p</span><span> </span><span>R</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>c2</span><span> </span><span>s&#39;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(p &#8745; (-b))&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>             
</span><span>             </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_k</span><span> </span><span>drop_comm</span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>a10</span><span> </span><span>&#915;1</span><span> </span><span>l_f</span><span>
</span><span>             </span><span>cpn_comm_induct</span><span>
</span><span>             </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c_prod</span><span> </span><span>cp</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>not_fault</span><span class="delimiter">:</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>                 
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a1</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172;final(l!0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = LanguageCon.com.Cond b c1 c2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>final_exist_component_tran_final</span><span> </span><span>env_tran_right</span><span> </span><span>final_0</span><span>  
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                 
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj = (Cond b c1 c2) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a4</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span> </span><span>snd_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span class="delimiter">)</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_suc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span>  </span><span>ssj_normal_s</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;b &#8744; s&#39;&#8713;b&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;b&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; (p &#8745; b)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a000</span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum((p &#8745; b), R)  &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_suc</span><span> </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>
</span><span>                 </span><span>cpn_assum_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>n</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Cond b c1 c2)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>p</span><span> </span><span>R</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>c1</span><span> </span><span>s&#39;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(p &#8745; b)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                   
</span><span>         </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>       
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_length</span><span> </span><span>drop_comm</span><span>   </span><span>a10</span><span> </span><span>&#915;1</span><span>  </span><span>cpn_comm_induct</span><span> </span><span>valid</span><span> </span><span>not_fault</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8713;b&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;(p &#8745; (-b))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a000</span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum((p &#8745; (-b)), R)  &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_suc</span><span> </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>
</span><span>                 </span><span>cpn_assum_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>n</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Cond b c1 c2)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>p</span><span> </span><span>R</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>c2</span><span> </span><span>s&#39;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(p &#8745; (-b))&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                   
</span><span>         </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>       
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_length</span><span> </span><span>drop_comm</span><span> </span><span>a10</span><span> </span><span>&#915;1</span><span>  </span><span>cpn_comm_induct</span><span> </span><span>valid</span><span> </span><span>not_fault</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_f</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>              
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>             
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Asm_sound</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;(c, p, R, G, q, a) &#8712; &#920; &#10233;    
    &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]
   &quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>   </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(c, p, R, G, q, a) &#8712; &#920;&quot;</span></span></span><span>    
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p,  R, G, q,a]&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>events_p</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,cfg#l)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,cfg#l) &#8712; assum (p,R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length (cfg#l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k&#8804;i. fst ((cfg#l)!k) = fst cfg&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R &quot;</span></span></span><span> 
</span><span> </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t1. snd((cfg#l)!i)=Normal t1 &#8743; t1 &#8712; p&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a3</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t1. snd ((cfg # l) ! n) = Normal t1 &#8743; t1 &#8712; p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((cfg#l)!n) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((cfg#l)!(Suc n))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span> </span><span>a0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Env</span><span> </span><span>calculation</span><span> </span><span>less_Suc_eq_le</span><span> </span><span>less_not_refl</span><span> </span><span>nat_le_linear</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(snd ((cfg#l)!n),snd ((cfg#l)!(Suc n)))&#8712;R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>Suc</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>not_val_zero</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; dom &#915; &#10233; Sta p R &#10233; &#915; &#8872;0<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; c &#8712; dom &#915;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a01</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; cpn 0 &#915; (Call c) s &#8743; (&#915;,l)&#8712; assum(p, R)&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length l &#8805; 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEmpty</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Product_Type.Collect_case_prodD</span><span> </span><span>Suc_leI</span><span> </span><span>length_greater_0_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a02</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l = 1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = [(Call c,s)]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l ! 0 = (LanguageCon.com.Call c, s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a02</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_leI</span><span> </span><span>impossible_Cons</span><span> </span><span>length_greater_0_conv</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>neq_Nil_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>zero_neq_one</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a02</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l =(Call c, s)#a1#ls&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>less_not_refl</span><span> </span><span>list.exhaust</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>not_less_zero</span><span> </span><span>nth_Cons_0</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>   
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>min_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;min_call m &#915; l&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_cptn_mod_nest</span><span> </span><span>minimum_nest_call</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. fst (l!i) = Call c&quot;</span></span></span><span>        
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_comp_tran_no_final_comm</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>a03</span><span class="delimiter">]</span><span> </span><span>a02</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8704;i&lt;length l. fst (l!i) = Call c)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(i&lt;length l &#8743; fst (l!i) &#8800; Call c)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cfg_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) &#8800; Call c &#8743; (&#8704;k&lt;j. fst (l!k) = Call c)&quot;</span></span></span><span>                     
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fast</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;i. fst (l!i) &#8800; Call c&quot;</span></span></span><span> </span><span>i</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&gt;0 &#8743; j&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span>calculation</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>gr0I</span><span> </span><span>fstI</span><span> </span><span>leI</span><span> </span><span>le_less_trans</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!(j-1)) &#8594; (l!j))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>l_cptn</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_pred</span><span> </span><span>cptn_stepc_rtran</span><span> </span><span>diff_less</span><span> </span><span>not_eq_not_env</span><span> </span><span>prod.collapse</span><span> 
</span><span>                   </span><span>step_ce_elim_cases</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j_1_cfg</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(j-1)) = Normal s&#39; &#8743; s&#39; &#8712; p&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cfg_j</span><span> </span><span>l</span><span> </span><span>a01</span><span class="delimiter">[</span><span>simplified</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>j</span><span class="delimiter">[</span><span>simplified</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>i</span><span> </span><span>a1</span><span> </span><span>events_p</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l_cptn</span><span class="delimiter">[</span><span>simplified</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>a1</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j-1&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_cfg</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!j = (the (&#915; c), Normal s&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cfg_j</span><span> </span><span>a0</span><span>
</span><span>           </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>calculation</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>diff_less</span><span> </span><span>domIff</span><span> </span><span>j</span><span> </span><span>option.sel</span><span> </span><span>prod.collapse</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>        
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(0,&#915;, drop (j-1) l) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dropcptn_is_cptn1</span><span> </span><span>j</span><span> </span><span>less_imp_diff_less</span><span class="delimiter">)</span><span>      
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>redex_call_cptn_mod_min_nest_call_gr_zero</span><span>  </span><span>j</span><span> </span><span>j_cfg</span><span> </span><span>j_1_cfg</span><span> </span><span>cfg_j</span><span> </span><span>step</span><span> </span><span>a0</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>SmallStepCon.redex.simps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>Suc_pred</span><span>  
</span><span>                 </span><span>diff_less</span><span> </span><span>domIff</span><span> </span><span>less_imp_diff_less</span><span> </span><span>min_call_def</span><span> </span><span>not_less_zero</span><span> </span><span>prod.collapse</span><span> 
</span><span>                 </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>             
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>          
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Call_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;f &#8712; dom &#915; &#10233;      
       &#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (the (&#915; f)) sat [p, R, G, q,a] &#10233;         
       Sta p R &#10233; (&#8704;s. (Normal s,Normal s) &#8712; G)  &#10233;
       &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call f) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;f &#8712; dom &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (the (&#915; f)) sat [p, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>        
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span>         
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>bdy</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; f = Some bdy&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p,  R, G, q,a]&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> bdy sat [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Call f)  s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Call f) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Call f) s&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>       
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Call f),s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10&#39;</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
                   (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
               &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                              
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                                                      
</span><span>         </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                             
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj = (Call f) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a3</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a0</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>not_None_eq</span><span> </span><span>snd_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                     
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>a2</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span class="delimiter">)</span><span>   
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>                                  
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s&#39;, Normal s&#39;) &#8712; G&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712; G&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span> </span><span>k_basic</span><span> </span><span>True</span><span> </span><span>ss</span><span> </span><span>ssj_normal_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>         </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>   
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>before_k_all_evnt</span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                      
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712;  G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=bdy&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>option.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>                     
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>contra_subsetD</span><span> </span><span>cpn_assum_induct</span><span class="delimiter">)</span><span>                                
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span>  </span><span>&#915;1</span><span>  </span><span>j_k</span><span> </span><span>j_length</span><span> </span><span>l_f</span><span>
</span><span>             </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Call f&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>k</span><span> </span><span class="delimiter">]</span><span>             
</span><span>             </span><span>Suc_leI</span><span> </span><span>a10&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>            
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c_prod</span><span> </span><span>cp</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                   
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>                       
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a1</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172;final(l!0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = Call f&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span> </span><span>final_exist_component_tran_final</span><span> </span><span>env_tran_right</span><span> </span><span>final_0</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj = (Call f) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a3</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a0</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>not_None_eq</span><span> </span><span>snd_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=bdy&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>option.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>contra_subsetD</span><span> </span><span>cpn_assum_induct</span><span class="delimiter">)</span><span>              
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>       
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_length</span><span> </span><span>l_f</span><span> </span><span>drop_comm</span><span> </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span> </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Call f&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>valid</span><span>  
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span class="keyword1"><span class="command">}</span></span><span>               
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>           
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>CallRec_sound</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;(c, p, R, G, q, a) &#8712; Specs &#10233;
     &#8704;(c, p, R, G, q, a)&#8712;Specs.
       c &#8712; dom &#915; &#8743;
       Sta p R &#8743;  (&#8704;s. (Normal s,Normal s) &#8712; G) &#8743;      
       &#915;,&#920; &#8746; Specs &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> the (&#915; c) sat [p, R, G, q,a] &#8743; 
       (&#8704;x. &#915;,&#920; &#8746; Specs &#8872;x <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> the (&#915; c) sat [p,R, G, q,a]) &#10233;
    Sta p R &#10233; (&#8704;s. (Normal s,Normal s) &#8712; G) &#10233;
     &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c, p, R, G, q, a) &#8712; Specs&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>     </span><span>a1</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;Specs.
       c &#8712; dom &#915; &#8743; Sta p R &#8743; (&#8704;s. (Normal s,Normal s) &#8712; G) &#8743;  
       &#915;,&#920; &#8746; Specs &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> the (&#915; c) sat [p, R, G, q,a] &#8743; 
       (&#8704;x. &#915;,&#920; &#8746; Specs &#8872;x <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> the (&#915; c) sat [p,R, G, q,a])&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; dom &#915;&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>       
</span><span>       </span><span>a1&#39;&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8746; Specs &#8872;n <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> the (&#915; c) sat [p,R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>      </span><span>valid_body</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;Specs.
       c &#8712; dom &#915; &#8743;  Sta p R &#8743;   (&#8704;s. (Normal s,Normal s) &#8712; G) &#8743;    
       (&#8704;x. &#915;,&#920; &#8746; Specs &#8872;x <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> the (&#915; c) sat [p,R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s,Normal s) &#8712; G)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>bdy</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>&#915;bdy</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c = Some bdy&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>theta_specs</span><span class="delimiter">:</span><span> 
</span><span>         </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;&#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a] &#10233;
          &#8704;(c, p, R, G, q, a)&#8712;Specs. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>    
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, a, d)&#8712;Specs. &#915; &#8872;0<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> LanguageCon.com.Call c sat [p,R, G, a,d]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>a</span><span> </span><span>d</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(c, p, R, G, a, d) &#8712; Specs&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;dom &#915; &#8743; Sta p R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8872;0<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (LanguageCon.com.Call c) sat [p,R, G, a,d]&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_val_zero</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>       
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>hyp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;&#920;.  &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a] &#10233;
             &#8704;(c, p, R, G, q, a)&#8712;Specs. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>body</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;&#920;.  &#915; &#8872;Suc n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fact</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(c, p, R, G, q, a) &#8712; Specs&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ctxt_m</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;&#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>body</span><span>  </span><span>cptn_mod_nest_mono</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span>cpn_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_rule</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>valid_Proc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;Specs. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hyp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Sta</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a000</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_dom</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; c &#8712; dom &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a000</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>guar</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s,Normal s)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a000</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?&#920;&#39;</span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#920; &#8746; Specs&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>valid_Proc</span><span> </span><span>ctxt_m</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;?&#920;&#39;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>valid_body</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>valid_body_m</span><span class="delimiter">:</span><span> 
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c, p, R, G, q, a)&#8712;Specs. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (the (&#915; c)) sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span>  </span><span>simp</span><span class="delimiter">:</span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span>    
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>valid_body</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (the (&#915; c)) sat [p,R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a000</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;Suc n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Call c sat [p,R, G, q,a]&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span> </span><span>s</span><span> 
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a01</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;cpn (Suc n) &#915; (Call c) s &#8743; (&#915;,l)&#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length l &#8805; 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEmpty</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Product_Type.Collect_case_prodD</span><span> </span><span>Suc_leI</span><span> </span><span>length_greater_0_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a02</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l = 1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = [(Call c,s)]&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l ! 0 = (LanguageCon.com.Call c, s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a02</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_leI</span><span> </span><span>impossible_Cons</span><span> 
</span><span>                     </span><span>length_greater_0_conv</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>neq_Nil_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>zero_neq_one</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a02</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l =(Call c, s)#a1#ls&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>less_not_refl</span><span> </span><span>list.exhaust</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>not_less_zero</span><span> </span><span>nth_Cons_0</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>   
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>min_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;min_call m &#915; l&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_cptn_mod_nest</span><span> </span><span>minimum_nest_call</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. fst (l!i) = Call c&quot;</span></span></span><span>     
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_comp_tran_no_final_comm</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span>a03</span><span class="delimiter">]</span><span> </span><span>a02</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span>                                     
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8704;i&lt;length l. fst (l!i) = Call c)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(i&lt;length l &#8743; fst (l!i) &#8800; Call c)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cfg_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) &#8800; Call c &#8743; (&#8704;k&lt;j. fst (l!k) = Call c)&quot;</span></span></span><span>                     
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fast</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;i. fst (l!i) &#8800; Call c&quot;</span></span></span><span> </span><span>i</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&gt;0 &#8743; j&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span>calculation</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>gr0I</span><span> </span><span>fstI</span><span> </span><span>leI</span><span> </span><span>le_less_trans</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!(j-1)) &#8594; (l!j))&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>l_cptn</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_pred</span><span> </span><span>cptn_stepc_rtran</span><span> </span><span>diff_less</span><span> </span><span>not_eq_not_env</span><span> </span><span>prod.collapse</span><span> 
</span><span>                   </span><span>step_ce_elim_cases</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>j_1_cfg</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(j-1)) = Normal s&#39; &#8743; s&#39; &#8712; p&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cfg_j</span><span> </span><span>l</span><span> </span><span>a01</span><span class="delimiter">[</span><span>simplified</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>j</span><span class="delimiter">[</span><span>simplified</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>i</span><span> </span><span>Sta</span><span> </span><span>events_p</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l_cptn</span><span class="delimiter">[</span><span>simplified</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>Sta</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j-1&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_cfg</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!j = (the (&#915; c), Normal s&#39;)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cfg_j</span><span> </span><span>c_dom</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>step</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>diff_less</span><span> </span><span>domIff</span><span> </span><span>j</span><span> </span><span>option.sel</span><span> </span><span>prod.collapse</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>  
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_n_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc n,&#915;, drop (j-1) l) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dropcptn_is_cptn1</span><span> </span><span>j</span><span> </span><span>less_imp_diff_less</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, drop j l) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l!(j-1)) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>etranE</span><span> </span><span>mod_env_not_component</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc n,&#915;, (Call c, Normal s&#39;)#(the (&#915; c),Normal s&#39;)#(drop (j+1) l)) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span>j</span><span> </span><span>step</span><span> </span><span>cfg_j</span><span> </span><span>j_cfg</span><span> </span><span>j_1_cfg</span><span>  </span><span>suc_n_call</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_eq_plus1</span><span> 
</span><span>                    </span><span>Suc_less_eq</span><span> </span><span>Suc_pred</span><span> </span><span>diff_less</span><span> </span><span>less_SucI</span><span> </span><span>prod.collapse</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>                  
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (the (&#915; c),Normal s&#39;)#(drop (j+1) l)) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cfg_j</span><span> </span><span>j_cfg</span><span>  </span><span>elim_cptn_mod_nest_call_n_dec</span><span class="delimiter">[</span><span>OF</span><span> </span><span>_</span><span> </span><span class="delimiter">]</span><span> </span><span>c_dom</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>j</span><span> </span><span>j_cfg</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, drop j l) &#8712; assum(p,R)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>   
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, take j l @ l ! j # drop (Suc j) l) &#8712; assum (p, R)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjunct2</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a01</span><span class="delimiter">]</span><span> </span><span>id_take_nth_drop</span><span class="delimiter">[</span><span>OF</span><span> </span><span>conjunct2</span><span class="delimiter">[</span><span>OF</span><span> </span><span>j</span><span class="delimiter">]</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                             
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sub_assum_r</span><span class="delimiter">[</span><span>OF</span><span> </span><span class="delimiter">]</span><span>  </span><span>j_1_cfg</span><span> </span><span>l</span><span> </span><span>j_cfg</span><span> </span><span>j</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>image_eqI</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>                  
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>                              
</span><span>              </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_drop</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, drop j l)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid_body</span><span> </span><span>j_cfg</span><span> </span><span>j</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span>cpn_def</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>h</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;length (take j l). fst ((take j l)!j) = (Call c)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j</span><span> </span><span>cfg_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_take</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,take j l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_comp_tran_no_final_comm</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take j l&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Call c&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>j_1_cfg</span><span> </span><span>l</span><span> </span><span>j_cfg</span><span> </span><span>j</span><span> </span><span>cfg_j</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (last (take j l)), snd (drop j l ! 0)) &#8712; G&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (take j l) = j&quot;</span></span></span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>j_1_cfg</span><span> </span><span>j</span><span> </span><span>j_cfg</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(take j l)!(j-1) = l!(j-1)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>j_1_cfg</span><span> </span><span>j</span><span> </span><span>j_cfg</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last (take j l) = l!(j-1)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>last_conv_nth</span><span> </span><span>less_numeral_extra</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>j_1_cfg</span><span> </span><span>j</span><span> </span><span>j_cfg</span><span> </span><span>guar</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>                                 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_1_cfg</span><span> </span><span>j_cfg</span><span> </span><span>j</span><span> </span><span>cfg_j</span><span> </span><span>j</span><span> </span><span>l_cptn</span><span>
</span><span>                  </span><span>comm_union</span><span class="delimiter">[</span><span>OF</span><span> </span><span>comm_take</span><span> </span><span>comm_drop</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>                 
</span><span>             </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">ultimately</span></span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_rule2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>     
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Seq_env_P</span><span class="delimiter">:</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Seq P Q,s) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (Seq P Q,t)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>env_not_normal_s</span><span> </span><span>snormal_enviroment</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>map_eq_state</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l1. snd (l1!i) = snd (l2!i)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>snd_lift</span><span class="delimiter">)</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>map_eq_seq_c</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l1. fst (l1!i) = Seq (fst (l2!i)) c2&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l1&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l1!i) = Seq (fst (l2!i)) c2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_unfold</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>same_env_seq_c</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1!(Suc i))&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712;cptn &#8743; l1!0 = ((Seq c1 c2),s)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712;cptn &#8743; l2!0 = (c1,s)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length l2&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1!(Suc i))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l2 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Seq c2i c2) &#8743; c1si = (Seq c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>map_eq_seq_c</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>fst_conv</span><span> </span><span>length_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span> </span><span>map_eq_state</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>nth_map</span><span> </span><span>snd_conv</span><span> </span><span>snd_lift</span><span class="delimiter">)</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Env_n</span><span> </span><span>env_c_c&#39;</span><span> </span><span>env_not_normal_s</span><span> </span><span>step_e.Env</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l1 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Seq c2i c2) &#8743; c1si = (Seq c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>map_eq_seq_c</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>fst_conv</span><span> </span><span>length_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span> </span><span>map_eq_state</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>nth_map</span><span> </span><span>snd_conv</span><span> </span><span>snd_lift</span><span class="delimiter">)</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span>        
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Env_n</span><span> </span><span>LanguageCon.com.inject</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>env_c_c&#39;</span><span> </span><span>env_not_normal_s</span><span> </span><span>step_e.Env</span><span class="delimiter">)</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>same_comp_seq_c</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712;cptn &#8743; l1!0 = ((Seq c1 c2),s)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712;cptn &#8743; l2!0 = (c1,s)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length l2&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594; l2 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Seq c2i c2) &#8743; c1si = (Seq c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>map_eq_seq_c</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>fst_conv</span><span> </span><span>length_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span> </span><span>map_eq_state</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>nth_map</span><span> </span><span>snd_conv</span><span> </span><span>snd_lift</span><span class="delimiter">)</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594; (l1 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Seqc</span><span class="delimiter">)</span><span>        
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594; l1 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Seq c2i c2) &#8743; c1si = (Seq c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>map_eq_seq_c</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>fst_conv</span><span> </span><span>length_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span> </span><span>map_eq_state</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span>  </span><span>nth_map</span><span> </span><span>snd_conv</span><span> </span><span>snd_lift</span><span class="delimiter">)</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594; (l2 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span> </span><span>stepc_elim_cases_Seq_Seq</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>           
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assum_map</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s) &#8743; ((&#915;,l1) &#8712; assum(p, R))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span>  
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,l2) &#8712; assum(p, R))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1!(Suc i))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>same_env_seq_c</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l2) = &#915; &#8743; snd (&#915;,l2) = l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2!0 = (c1,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1 = length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s = Normal s&#39;&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>   </span><span>assum_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c</span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd((snd ?c!0)) &#8712; Normal ` (p)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>drop_k_s</span><span> </span><span>a1</span><span> </span><span>normal_s</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length (snd ?c)&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(fst ?c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd ?c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd ?c)!(Suc i))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd ?c)!i), snd((snd ?c)!(Suc i))) &#8712; R&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>map_eq_state</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span> </span><span>eq_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l2) &#8712; assum (p, R)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_map&#39;</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &#8743; (&#915;, l2)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F  &#10230;(Suc k &lt; length l1 &#10230;
       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230; 
       (snd(l1!k), snd(l1!(Suc k))) &#8712;  G) &#8743; 
   (fst (last l1) = (Seq c c2) &#8743; final (c, snd (last l1)) &#10230;     
      (fst (last l1) = (Seq Skip c2) &#8743; 
        (snd (last  l1) &#8712; Normal ` q) &#8744;
      (fst (last l1) = (Seq Throw c2) &#8743; 
        snd (last l1) &#8712; Normal ` (a))))
     &quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>same_comp_seq_c</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l2) = &#915; &#8743; snd (&#915;,l2) = l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2!0 = (c1,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1 = length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Collect_case_prodD</span><span> </span><span>drop_k_s</span><span> </span><span>eq_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l2_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>       
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l1 = l1!((length l1) -1)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l2 = l2!((length l2) -1)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F  &#10230;(&#8704;i ns ns&#39;.                 
               Suc i&lt;length (snd (&#915;, l2)) &#10230; 
               fst (&#915;, l2)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (&#915;, l2))!i)  &#8594; ((snd (&#915;, l2))!(Suc i)) &#10230;                               
                 (snd((snd (&#915;, l2))!i), snd((snd (&#915;, l2))!(Suc i))) &#8712; G) &#8743; 
               (final (last (snd (&#915;, l2)))  &#10230;                 
                  ((fst (last (snd (&#915;, l2))) = Skip &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` q)) &#8744;
                  (fst (last (snd (&#915;, l2))) = Throw &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l1&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_length</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l1!((length l1) -1)) = snd (l2!((length l2) -1))&quot;</span></span></span><span>      
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span>a0</span><span>  </span><span>map_eq_state</span><span> </span><span>eq_length</span><span> </span><span>l2_not_empty</span><span> </span><span>last_snd</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(last l2) = snd (last l1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lenl1</span><span> </span><span>last_lenl2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00a</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F &#10230;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230;       
      (snd((snd (&#915;, l1))!k), snd((snd (&#915;, l1))!(Suc k))) &#8712;  G&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_&#915;l1</span><span> </span><span>pair_&#915;l2</span><span> </span><span>a00</span><span>  </span><span>a03</span><span> </span><span>a3</span><span>  </span><span>eq_length</span><span> </span><span>a00a</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>map_eq_state</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span class="delimiter">=</span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l1) = (Seq c c2) &#8743; final (c, snd (last l1))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>           </span><span>a01</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l1)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=Skip &#8744; c = Throw&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_last_l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l2) = c&quot;</span></span></span><span>                               
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_lenl1</span><span> </span><span>a00</span><span> </span><span>l1_not_empty</span><span> </span><span>eq_length</span><span> </span><span>len0</span><span> </span><span>a2</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lift</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_eq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) = snd (last l1)&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l2_not_empty</span><span> </span><span>a2</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lenl1</span><span> </span><span>last_snd</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (fst (last l2),snd (last l2))&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l2)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_eq</span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (last  l2)) = Skip &#8743; 
                    snd (last  l2) &#8712; Normal ` q &#8744;
                  (fst (last l2) = Throw &#8743; 
                    snd (last l2) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a03</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (last l1) = (Seq Skip c2) &#8743; 
                    snd (last  l1) &#8712; Normal ` q) &#8744;
                  (fst (last l1) = (Seq Throw c2) &#8743; 
                    snd (last l1) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_eq</span><span> </span><span>fst_last_l2</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_map&#39;&#39;</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &#8743; (&#915;, l2)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F &#10230; ((Suc k &lt; length l1 &#10230;
       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230;        
       (snd(l1!k), snd(l1!(Suc k))) &#8712; G) &#8743; 
   (final (last l1) &#10230;     
      (fst (last l1) = Skip &#8743; 
        (snd (last  l1) &#8712; Normal ` r) &#8744;
      (fst (last l1) = Throw &#8743; 
        snd (last l1) &#8712; Normal ` (a)))))
     &quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>same_comp_seq_c</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l2) = &#915; &#8743; snd (&#915;,l2) = l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2!0 = (c1,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1 = length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Collect_case_prodD</span><span> </span><span>drop_k_s</span><span> </span><span>eq_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l2_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>       
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l1 = l1!((length l1) -1)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l2 = l2!((length l2) -1)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F &#10230;(&#8704;i ns ns&#39;.                 
               Suc i&lt;length (snd (&#915;, l2)) &#10230; 
               fst (&#915;, l2)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (&#915;, l2))!i)  &#8594; ((snd (&#915;, l2))!(Suc i)) &#10230;                                            
                 (snd((snd (&#915;, l2))!i), snd((snd (&#915;, l2))!(Suc i))) &#8712; G) &#8743; 
               (final (last (snd (&#915;, l2)))  &#10230;                 
                  ((fst (last (snd (&#915;, l2))) = Skip &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` q)) &#8744;
                  (fst (last (snd (&#915;, l2))) = Throw &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l1&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_length</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l1!((length l1) -1)) = snd (l2!((length l2) -1))&quot;</span></span></span><span>      
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span>a0</span><span>  </span><span>map_eq_state</span><span> </span><span>eq_length</span><span> </span><span>l2_not_empty</span><span> </span><span>last_snd</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(last l2) = snd (last l1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lenl1</span><span> </span><span>last_lenl2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00a</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230;         
        (snd((snd (&#915;, l1))!k), snd((snd (&#915;, l1))!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_&#915;l1</span><span> </span><span>pair_&#915;l2</span><span> </span><span>a00</span><span>  </span><span>a03</span><span> </span><span>a3</span><span>  </span><span>eq_length</span><span> </span><span>a00a</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a2</span><span> </span><span>Suc_lessD</span><span> </span><span>nth_map</span><span> </span><span>snd_lift</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l1)&quot;</span></span></span><span>           
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l1)=Skip &#8744; fst (last l1) = Throw&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l1) = Seq (fst (last l2)) c2&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>last_lenl1</span><span> </span><span>eq_length</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last l2 = l2 ! (length l2 - 1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l2_not_empty</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>a2</span><span> </span><span>l2_not_empty</span><span> </span><span>last_lenl1</span><span> </span><span>last_lift</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_map</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Seq c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &#8743; (&#915;, l2)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift c2) l2&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l1)&#8712; comm(G, (r,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F  &#10230;(Suc i &lt; length (l1) &#10230;
        &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l1 ! i) &#8594; (l1 ! (Suc i)) &#10230;       
        (snd (l1 ! i), snd (l1 ! Suc i)) &#8712; G) &#8743;
        (SmallStepCon.final (last l1) &#10230;                  
                   fst (last l1) = LanguageCon.com.Skip &#8743;
                   snd (last l1) &#8712; Normal ` r &#8744;
                   fst (last l1) = LanguageCon.com.Throw &#8743;
                   snd (last l1) &#8712; Normal ` a) &quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_map&#39;&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l1</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>s</span><span> </span><span>l2</span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>i</span><span> </span><span>r</span><span class="delimiter">]</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>       
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* declare[[show_types]]
lemma &quot;(SOME e. e&#8712;{1::nat,2,3}) = 1 &#8744; (SOME e. e&#8712;{1::nat,2,3}) = 2 &#8744; (SOME e. e&#8712;{1::nat,2,3}) = 3&quot;
  apply auto
  by (metis (mono_tags, lifting) someI)*)</span></span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Seq_sound1</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Seq P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172; final (last x)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (x!0)&#8712; Normal ` p &#8743; Sta p rely &#8743; Sta a rely &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>  </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, rely, G, q,a]&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs. (&#915;,xs) &#8712; cpn n &#915; P s &#8743; x = map (lift Q) xs&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>a5</span><span> </span><span>a6</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>p</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestOne</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, [(P,s)]) &#8712; cpn n &#915; P s &#8743; [(C, s1)] = map (lift Q) [(P,s)]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>lift_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_mod_nest_call.CptnModNestOne</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=Seq P Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs. (&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = map (lift Q) xs&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((C, t1) # xsa) ! 0 = (LanguageCon.com.Seq P Q, t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((C, t1) # xsa). fst (((C, t1) # xsa) ! i) &#8800; Q&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; SmallStepCon.final (last ((C, t1) # xsa))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (((C, t1) # xsa) ! 0) &#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span>  </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>hi</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = map (lift Q) xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1=s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;) &#8743; (n, &#915;,((P,t1)#xsa&#39;))&#8712;cptn_mod_nest_call &#8743; (C, t1) # xsa = map (lift Q) ((P,t1)#xsa&#39;)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s1) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span>Seq_env_P</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;,(P,s1)#(P,t1)#xsa&#39;)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>env_tran</span><span> </span><span>cptn_mod_nest_call.CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s1)#(P,t1)#xsa&#39;) &#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_def</span><span> </span><span>s1_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C,s1)#(C, t1) # xsa = map (lift Q) ((P,s1)#(P,t1)#xsa&#39;)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq1</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;LanguageCon.com.Seq P Q = LanguageCon.com.Seq P0 P1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sa = s&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq1.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P = P0 &#8743; Q = P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, sa) # xsa) &#8712; cpn n &#915; P s&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span>CptnModNestSeq1.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift</span><span> </span><span>CptnModNestSeq1.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>P1</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>zs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (zs!i) = Q &#8743; (i&lt; (length zs))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>add_diff_cancel_left&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>length_append</span><span> </span><span>nth_append_length</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length ((Seq P0 P1,sa)#zs)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((Seq P0 P1, sa) # zs)!Suc i) = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>s&#39;</span><span> </span><span>ys</span><span> </span><span>zs</span><span> </span><span>Q1</span><span> </span><span class="delimiter">)</span><span>          
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s&#39;_a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712;  a&quot;</span></span></span><span>   
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>cpP1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; cpn n &#915; P1 (Normal sa)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>cpP1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; cp &#915; P1 (Normal sa)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>  </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>       
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa) = map (lift Q1)  ((P1, Normal sa) # xsa) &quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Cons_lift</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((LanguageCon.com.Seq P1 Q1, Normal sa) # (map (lift Q1) xsa))) &#8712; assum (p,rely)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((LanguageCon.com.Seq P1 Q1, Normal sa) # (map (lift Q1) xsa)) rely&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>map</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Cons_lift_append</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>env_tran_subr</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa)) &#8712; cpn n &#915; (Seq P1 Q1) (Normal sa)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>  </span><span>cptn_mod_nest_call.CptnModNestSeq1</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa)) &#8712; cp &#915; (Seq P1 Q1) (Normal sa)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>  </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod.CptnModSeq1</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; assum (p,rely)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>map</span><span> </span><span>cpP1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; comm (G,(q,a)) F&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpP1</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>13</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>   
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last ((LanguageCon.com.Throw, Normal s&#39;)# ys))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn_mod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (LanguageCon.com.Throw, Normal s&#39;) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_eq_cptn_mod_set</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (LanguageCon.com.Throw, Normal s&#39;) # ys) &#8712; cptn&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>throw_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Throw, Normal s&#39;) # ys)!0 = (Throw, Normal s&#39;) &#8743; 0 &lt; length((LanguageCon.com.Throw, Normal s&#39;) # ys)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>         
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last ((LanguageCon.com.Throw, Normal s&#39;) # ys) = ((LanguageCon.com.Throw, Normal s&#39;) # ys)!((length ((LanguageCon.com.Throw, Normal s&#39;) # ys)) - 1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((LanguageCon.com.Throw, Normal s&#39;) # ys) rely&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>env_tran_subl</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>           
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>st&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((LanguageCon.com.Throw, Normal s&#39;) # ys)) = Throw &#8743;        
                     snd (last ((LanguageCon.com.Throw, Normal s&#39;) # ys)) = Normal st&#39;&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zero_throw_all_throw</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((Throw, Normal s&#39;) # ys)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length ((Throw, Normal s&#39;) # ys))-1&quot;</span></span></span><span> </span><span>a</span><span> </span><span>rely</span><span class="delimiter">]</span><span>
</span><span>          </span><span>s&#39;_a</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Seq_sound2</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x)&#8712;cptn_mod&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Seq P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last x) = Throw &#8743; snd (last x) = Normal s&#39;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs s&#39; ys. (&#915;,xs) &#8712; cp &#915; P s &#8743; x = ((map (lift Q) xs)@((Throw, Normal s&#39;)#ys))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>s&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModOne</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, [(P,s)]) &#8712; cp &#915; P s &#8743; [(C, s1)] = map (lift Q) [(P,s)]@[(Throw, Normal s&#39;)]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>lift_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn.CptnOne</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=Seq P Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs s&#39; ys. (&#915;, xs) &#8712; cp &#915; P t1 &#8743; (C, t1) # xsa = map (lift Q) xs@((Throw, Normal s&#39;)#ys)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((C, t1) # xsa) ! 0 = (LanguageCon.com.Seq P Q, t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((C, t1) # xsa). fst (((C, t1) # xsa) ! i) &#8800; Q&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((C, t1) # xsa)) = Throw &#8743; snd (last ((C, t1) # xsa)) = Normal s&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>     
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span>s&#39;&#39;</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>hi</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, xs) &#8712; cp &#915; P t1 &#8743; (C, t1) # xsa = map (lift Q) xs@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1=s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModEnv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xsa&#39; s&#39;&#39; ys. xs=((P,t1)#xsa&#39;) &#8743; (&#915;,((P,t1)#xsa&#39;))&#8712;cptn &#8743; (C, t1) # xsa = map (lift Q) ((P,t1)#xsa&#39;)@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,xs)&#8712;cptn &#8743; xs!0 = (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#915;, xs) &#8712; cptn &#8743; xs ! 0 = (P, t1)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span>s&#39;&#39;</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;) &#8743; (&#915;,((P,t1)#xsa&#39;))&#8712;cptn &#8743; (C, t1) # xsa = map (lift Q) ((P,t1)#xsa&#39;)@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s1) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModEnv</span><span> </span><span>Seq_env_P</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s1)#(P,t1)#xsa&#39;)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>env_tran</span><span> </span><span>CptnEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s1)#(P,t1)#xsa&#39;) &#8712; cp &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>s1_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C,s1)#(C, t1) # xsa = map (lift Q) ((P,s1)#(P,t1)#xsa&#39;)@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModSkip</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModThrow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModSeq1</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c p. fst (case p of (ca::(&#39;s, &#39;a, &#39;d,&#39;e) LanguageCon.com, x::(&#39;s, &#39;d) xstate) &#8658; 
                (LanguageCon.com.Seq ca c, x)) = LanguageCon.com.Seq (fst p) c&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[] = xsa&quot;</span></span></span><span>     
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[] &#8800; zs&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>LanguageCon.com.distinct</span><span class="delimiter">(</span><span>71</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>CptnModSeq1</span><span class="delimiter">(</span><span>3</span><span class="delimiter">,</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span>last.simps</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lift</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c. Throw = c &#8744; [] = zs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq1</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq1.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModSeq2</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>P1</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>zs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (zs!i) = Q &#8743; (i&lt; (length zs))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>add_diff_cancel_left&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>length_append</span><span> </span><span>nth_append_length</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length ((Seq P0 P1,sa)#zs)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((Seq P0 P1, sa) # zs)!Suc i) = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq2</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModSeq3</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>s&#39;&#39;</span><span> </span><span>ys</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q &#8743; s=Normal sa&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, Normal sa) # xsa)&#8712; cp &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq3</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cp_def</span><span> </span><span>cptn_eq_cptn_mod_set</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last zs=(Throw, Normal s&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span>CptnModSeq3.hyps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prod_eqI</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>      
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Seq_sound2&#39;</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Seq P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last x) = Throw &#8743; snd (last x) = Normal s&#39;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs s&#39; ys. (&#915;,xs) &#8712; cpn n &#915; P s &#8743; x = ((map (lift Q) xs)@((Throw, Normal s&#39;)#ys))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>s&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestOne</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, [(P,s)]) &#8712; cpn n &#915; P s &#8743; [(C, s1)] = map (lift Q) [(P,s)]@[(Throw, Normal s&#39;)]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>lift_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn.CptnOne</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=Seq P Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs s&#39; ys. (&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = map (lift Q) xs@((Throw, Normal s&#39;)#ys)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((C, t1) # xsa) ! 0 = (LanguageCon.com.Seq P Q, t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((C, t1) # xsa). fst (((C, t1) # xsa) ! i) &#8800; Q&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((C, t1) # xsa)) = Throw &#8743; snd (last ((C, t1) # xsa)) = Normal s&#39;&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>     
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span>s&#39;&#39;</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>hi</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = map (lift Q) xs@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1=s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xsa&#39; s&#39;&#39; ys. xs=((P,t1)#xsa&#39;) &#8743; (n, &#915;,((P,t1)#xsa&#39;))&#8712;cptn_mod_nest_call &#8743; (C, t1) # xsa = map (lift Q) ((P,t1)#xsa&#39;)@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;,xs)&#8712;cptn_mod_nest_call &#8743; xs!0 = (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_mod_nest_call.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(n, &#915;, xs) &#8712; cptn_mod_nest_call &#8743; xs ! 0 = (P, t1)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span>s&#39;&#39;</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;) &#8743; (n, &#915;,((P,t1)#xsa&#39;))&#8712;cptn_mod_nest_call &#8743; 
                (C, t1) # xsa = map (lift Q) ((P,t1)#xsa&#39;)@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s1) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span>Seq_env_P</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;,(P,s1)#(P,t1)#xsa&#39;)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>env_tran</span><span> </span><span>cptn_mod_nest_call.CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s1)#(P,t1)#xsa&#39;) &#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_def</span><span> </span><span>s1_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C,s1)#(C, t1) # xsa = map (lift Q) ((P,s1)#(P,t1)#xsa&#39;)@((Throw, Normal s&#39;&#39;)#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq1</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c p. fst (case p of (ca::(&#39;s, &#39;a, &#39;d,&#39;e) LanguageCon.com, x::(&#39;s, &#39;d) xstate) &#8658; 
                (LanguageCon.com.Seq ca c, x)) = LanguageCon.com.Seq (fst p) c&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[] = xsa&quot;</span></span></span><span>     
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[] &#8800; zs&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>LanguageCon.com.distinct</span><span class="delimiter">(</span><span>71</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>CptnModNestSeq1</span><span class="delimiter">(</span><span>3</span><span class="delimiter">,</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span>last.simps</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lift</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c. Throw = c &#8744; [] = zs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq1</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq1.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>P1</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>zs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (zs!i) = Q &#8743; (i&lt; (length zs))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>add_diff_cancel_left&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>length_append</span><span> </span><span>nth_append_length</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length ((Seq P0 P1,sa)#zs)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((Seq P0 P1, sa) # zs)!Suc i) = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>s&#39;&#39;</span><span> </span><span>ys</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q &#8743; s=Normal sa&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, Normal sa) # xsa)&#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last zs=(Throw, Normal s&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prod_eqI</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>      
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Last_Skip_Exist_Final</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Seq P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(last x) = Skip&quot;</span></span></span><span>  
</span><span class="keyword2"><span class="keyword">shows</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c s&#39; i. i&lt;length x &#8743; x!i = (Seq c Q,s&#39;) &#8743; final (c,s&#39;)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnOne</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>s1</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>st</span><span> </span><span>t</span><span> </span><span>xsa</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>         
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;LanguageCon.com.Seq P Q = C&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnEnv.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>CptnEnv.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnComp</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>st</span><span> </span><span>C&#39;</span><span> </span><span>st&#39;</span><span> </span><span>xsa</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C = (Seq P Q) &#8743; st = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>CptnComp</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Seqc</span><span> </span><span>P1</span><span> </span><span>P1&#39;</span><span> </span><span>P2</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c s&#39; i. i &lt; length ((C&#39;, st&#39;) # xsa) &#8743; 
                        ((C&#39;, st&#39;) # xsa) ! i = (LanguageCon.com.Seq c Q, s&#39;) &#8743; 
                        SmallStepCon.final (c, s&#39;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnComp</span><span> </span><span>last.simps</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>SeqThrowc</span><span> </span><span>C2</span><span> </span><span>s&#39;</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;LanguageCon.com.Seq LanguageCon.com.Throw Q = C&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;C = LanguageCon.com.Seq LanguageCon.com.Throw C2&#8250;</span></span></span><span> </span><span>c_seq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;st = Normal s&#39;&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>FaultPropc</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_seq</span><span> </span><span>redex_not_Seq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>StuckPropc</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_seq</span><span> </span><span>redex_not_Seq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>AbruptPropc</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_seq</span><span> </span><span>redex_not_Seq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Seq_sound3</span><span class="delimiter">:</span><span>                                                       
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Seq P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(last x) = Skip&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (x!0)&#8712; Normal ` p &#8743; Sta p rely &#8743; Sta a rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, rely, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>a6</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>p</span><span class="delimiter">)</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* p) *)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestOne</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span>  
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=Seq P Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((C, t1) # xsa) ! 0 = (LanguageCon.com.Seq P Q, t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((C, t1) # xsa). fst (((C, t1) # xsa) ! i) &#8800; Q&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((C, t1) # xsa)) = LanguageCon.com.Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>SmallStepCon.final_def</span><span class="delimiter">)</span><span>        
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (((C, t1) # xsa) ! 0) &#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span>  </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq1</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cl</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((LanguageCon.com.Seq P0 P1, sa) # zs)) = Seq cl P1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq1</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>fst_conv</span><span> </span><span>last.simps</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lift</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq1</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span> </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>P1</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>zs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (zs!i) = Q &#8743; (i&lt; (length zs))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>add_diff_cancel_left&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>length_append</span><span> </span><span>nth_append_length</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>        
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>   </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>s&#39;</span><span> </span><span>ys</span><span> </span><span>zs</span><span> </span><span>Q1</span><span> </span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s&#39;_a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712;  a&quot;</span></span></span><span>   
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>cpnP1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; cpn n &#915; P1 (Normal sa)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span>  </span><span>cpn_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>cpP1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; cp &#915; P1 (Normal sa)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>   </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa) = map (lift Q1)  ((P1, Normal sa) # xsa) &quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Cons_lift</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((LanguageCon.com.Seq P1 Q1, Normal sa) # (map (lift Q1) xsa))) &#8712; assum (p,rely)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((LanguageCon.com.Seq P1 Q1, Normal sa) # (map (lift Q1) xsa)) rely&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>map</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Cons_lift_append</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>env_tran_subr</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa)) &#8712; cpn n &#915; (Seq P1 Q1) (Normal sa)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> 
</span><span>            </span><span>CptnModNestSeq1</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span>  </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa)) &#8712; cp &#915; (Seq P1 Q1) (Normal sa)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>cp_def</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> 
</span><span>            </span><span>cptn_mod.CptnModSeq1</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; assum (p,rely)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>map</span><span> </span><span>cpP1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; comm (G,(q,a)) F&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpnP1</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>13</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>   
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((LanguageCon.com.Throw, Normal s&#39;) # ys)) = Throw&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (LanguageCon.com.Throw, Normal s&#39;) # ys) &#8712; cptn&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>throw_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Throw, Normal s&#39;) # ys)!0 = (Throw, Normal s&#39;) &#8743; 0 &lt; length((LanguageCon.com.Throw, Normal s&#39;) # ys)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>         
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last ((LanguageCon.com.Throw, Normal s&#39;) # ys) = ((LanguageCon.com.Throw, Normal s&#39;) # ys)!((length ((LanguageCon.com.Throw, Normal s&#39;) # ys)) - 1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((LanguageCon.com.Throw, Normal s&#39;) # ys) rely&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>env_tran_subl</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>           
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>st&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((LanguageCon.com.Throw, Normal s&#39;) # ys)) = Throw &#8743;        
                     snd (last ((LanguageCon.com.Throw, Normal s&#39;) # ys)) = Normal st&#39;&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zero_throw_all_throw</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((Throw, Normal s&#39;) # ys)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length ((Throw, Normal s&#39;) # ys))-1&quot;</span></span></span><span> </span><span>a</span><span> </span><span>rely</span><span class="delimiter">]</span><span>
</span><span>          </span><span>s&#39;_a</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>map_xs_ys</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, sa) # xsa) &#8712; cptn_mod&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((P0, sa) # xsa)) = C&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; cptn_mod&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;zs = map (lift P1) xsa @ (P1, snd (last ((P0, sa) # xsa))) # ys&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P0 P1, sa) # zs) ! 0 = (LanguageCon.com.Seq P Q, s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length ((LanguageCon.com.Seq P0 P1, sa) # zs) &#8743; ((LanguageCon.com.Seq P0 P1, sa) # zs) ! i = (Q, sj)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;i. fst (((LanguageCon.com.Seq P0 P1, sa) # zs) ! j) &#8800; Q&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys. (&#915;, xs) &#8712; cp &#915; P s &#8743;
            (&#915;, ys) &#8712; cp &#915; Q (snd (xs ! (i - 1))) &#8743; (LanguageCon.com.Seq P0 P1, sa) # zs = map (lift Q) xs @ ys&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?P0</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P0, sa) # xsa&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P_Q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;P=P0 &#8743; s=sa &#8743; Q = P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=(length ((P0, sa) # xsa))&quot;</span></span></span><span>   
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i=(length ((P0, sa) # xsa))&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;(length ((P0, sa) # xsa)) &#8744; i &gt; (length ((P0, sa) # xsa))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;(length ((P0, sa) # xsa))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P0 P1, sa) # zs) ! i = map (lift P1) ((P0, sa) # xsa) ! i&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>length_map</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ci si. map (lift P1) ((P0, sa) # xsa) ! i = (Seq ci P1,si)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (&#955;(c, y). (LanguageCon.com.Seq c P1, y)) ((P0, sa) # xsa) ! i = (case ((P0, sa) # xsa) ! i of (c, x) &#8658; (LanguageCon.com.Seq c P1, x))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &lt; length ((P0, sa) # xsa)&#8250;</span></span></span><span> </span><span>nth_map</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c x. map (&#955;(c, x). (LanguageCon.com.Seq c P1, x)) ((P0, sa) # xsa) ! i = (LanguageCon.com.Seq c P1, x)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_beta</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P0 P1, sa) # zs) ! i &#8800; (Q, sj)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span>eq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span class="delimiter">=</span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&gt;(length ((P0, sa) # xsa))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((LanguageCon.com.Seq P0 P1, sa) # zs) ! (length ?P0)) = Q&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>P_Q</span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fstI</span><span> </span><span>length_map</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, sa) # xsa) &#8712; cp &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>cptn_eq_cptn_mod</span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; cp &#915; Q (snd (?P0 ! ((length ?P0) -1)))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>cptn_eq_cptn_mod</span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Q, snd (last ((P0, sa) # xsa))) # ys) &#8712; cptn_mod&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Q, snd (last ((P0, sa) # xsa))) # ys) &#8712; {(f, ps). ps ! 0 = (Q, snd (((P0, sa) # xsa) ! (Suc (length xsa) - 1))) &#8743; (&#915;, ps) &#8712; cptn &#8743; f = &#915;}&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_eq_cptn_mod</span><span> </span><span>last_length</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; {(f, ps). ps ! 0 = (Q, snd (((P0, sa) # xsa) ! (length ((P0, sa) # xsa) - 1))) &#8743; (&#915;, ps) &#8712; cptn &#8743; f = &#915;}&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>P_Q</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>map_xs_ys&#39;</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (P0, sa) # xsa) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((P0, sa) # xsa)) = C&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;zs = map (lift P1) xsa @ (P1, snd (last ((P0, sa) # xsa))) # ys&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P0 P1, sa) # zs) ! 0 = (LanguageCon.com.Seq P Q, s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length ((LanguageCon.com.Seq P0 P1, sa) # zs) &#8743; ((LanguageCon.com.Seq P0 P1, sa) # zs) ! i = (Q, sj)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;i. fst (((LanguageCon.com.Seq P0 P1, sa) # zs) ! j) &#8800; Q&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys. (&#915;, xs) &#8712; cpn n &#915; P s &#8743;
            (&#915;, ys) &#8712; cpn n &#915; Q (snd (xs ! (i - 1))) &#8743; (LanguageCon.com.Seq P0 P1, sa) # zs = map (lift Q) xs @ ys&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?P0</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P0, sa) # xsa&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P_Q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;P=P0 &#8743; s=sa &#8743; Q = P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=(length ((P0, sa) # xsa))&quot;</span></span></span><span>   
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i=(length ((P0, sa) # xsa))&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;(length ((P0, sa) # xsa)) &#8744; i &gt; (length ((P0, sa) # xsa))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;(length ((P0, sa) # xsa))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P0 P1, sa) # zs) ! i = map (lift P1) ((P0, sa) # xsa) ! i&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>length_map</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ci si. map (lift P1) ((P0, sa) # xsa) ! i = (Seq ci P1,si)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (&#955;(c, y). (LanguageCon.com.Seq c P1, y)) ((P0, sa) # xsa) ! i = (case ((P0, sa) # xsa) ! i of (c, x) &#8658; (LanguageCon.com.Seq c P1, x))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;i &lt; length ((P0, sa) # xsa)&#8250;</span></span></span><span> </span><span>nth_map</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c x. map (&#955;(c, x). (LanguageCon.com.Seq c P1, x)) ((P0, sa) # xsa) ! i = (LanguageCon.com.Seq c P1, x)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_beta</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P0 P1, sa) # zs) ! i &#8800; (Q, sj)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span>eq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span class="delimiter">=</span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&gt;(length ((P0, sa) # xsa))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((LanguageCon.com.Seq P0 P1, sa) # zs) ! (length ?P0)) = Q&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>P_Q</span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fstI</span><span> </span><span>length_map</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, sa) # xsa) &#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; cpn n &#915; Q (snd (?P0 ! ((length ?P0) -1)))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>cptn_eq_cptn_mod</span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (Q, snd (last ((P0, sa) # xsa))) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Q, snd (last ((P0, sa) # xsa))) # ys) &#8712; {(f, ps). ps ! 0 = (Q, snd (((P0, sa) # xsa) ! (Suc (length xsa) - 1))) &#8743; 
              (n, &#915;, ps) &#8712; cptn_mod_nest_call &#8743; f = &#915;}&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_eq_cptn_mod</span><span> </span><span>last_length</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; {(f, ps). ps ! 0 = (Q, snd (((P0, sa) # xsa) ! (length ((P0, sa) # xsa) - 1))) &#8743; (n,&#915;, ps) &#8712; cptn_mod_nest_call &#8743; f = &#915;}&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>P_Q</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Seq_sound4</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Seq P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length x &#8743; x!i=(Q,sj)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;i. fst(x!j)&#8800;Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (x!0)&#8712; Normal ` p &#8743; Sta p rely &#8743; Sta a rely&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, rely, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys. (&#915;,xs) &#8712; (cpn n &#915; P s) &#8743; (&#915;,ys) &#8712; (cpn n &#915; Q (snd (xs!(i-1)))) &#8743; x = (map (lift Q) xs)@ys&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>a6</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span> </span><span>sj</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>p</span><span class="delimiter">)</span><span> 
</span><span>   </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestOne</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span>  
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>st</span><span> </span><span>t</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Seq P Q &#8800; Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=(Seq P Q)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(((C, st) # (C, t) # xsa)!0) &#8800;Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>n_q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(((C, st) # (C, t) # xsa)!1) &#8800;Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(((C, st) # (C, t) # xsa)!i) =Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_suc</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&gt; (Suc 0)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_lessI</span><span> </span><span>add.left_neutral</span><span> </span><span>neq0_conv</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=Suc i&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>lessE</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_minus</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&#39;=i-1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_init</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((C, t) # xsa) ! 0 = ((Seq P Q), t)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#39;&lt; length ((C,t)#xsa) &#8743; ((C,t)#xsa)!i&#39; = (Q,sj)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i&#39;</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;i&#39;. fst (((C, t) # xsa) ! j) &#8800; Q&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i&#39;</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (((C, t) # xsa) ! 0) &#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_right_def</span><span> </span><span>Sta_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>hyp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys.
     (&#915;, xs) &#8712; cpn n &#915; P t &#8743;
     (&#915;, ys) &#8712; cpn n &#915; Q (snd (xs ! (i&#39;-1))) &#8743; (C, t) # xsa = map (lift Q) xs @ ys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span>  </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> 
</span><span>         </span><span>CptnModNestEnv.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, xs) &#8712; cpn n &#915; P t &#8743;
     (&#915;, ys) &#8712; cpn n &#915; Q (snd (xs ! (i&#39;-1))) &#8743; (C, t) # xsa = map (lift Q) xs @ ys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P,s)#xs) &#8712; cpn n &#915; P s&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs!0 = (P,t)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs_cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs_cp</span><span>  </span><span>n_q</span><span> </span><span>c_init</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (P,t)#xs&#39;) &#8712; cptn_mod_nest_call &#8743; xs=(P,t)#xs&#39;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>xs_cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Seq P Q, s) = (C, st)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (P, s) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P, t)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Seq_env_P</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>xs&#39;</span><span> </span><span>cpn_def</span><span> </span><span>cptn_mod_nest_call.CptnModNestEnv</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span>  </span><span class="var">?case</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_suc</span><span> </span><span>Cons_lift_append</span><span> </span><span>CptnModNestEnv.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>i&#39;</span><span> </span><span>i_minus</span><span> </span><span>xs_cp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Seq</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq1</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P1_Q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;P1 = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?x</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Seq P0 P1, sa) # zs&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;length ?x. &#8707;c s. ?x!j = (Seq c P1,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq1</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>xsa</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>zs</span><span> </span><span>P0</span><span> </span><span>P1</span><span> </span><span>sa</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>a</span><span> </span><span>xsa</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ac</span><span> </span><span>as</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a=(ac,as)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>zs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;zs = (Seq ac P1,as)#(map (lift P1)  xsa)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>zs_eq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(map (lift P1)  xsa)=(map (lift P1)  xsa)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>hyp</span><span class="delimiter">=</span><span>Cons</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">[</span><span>OF</span><span> </span><span>zs_eq</span><span class="delimiter">]</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>hyp</span><span class="delimiter">[</span><span>of</span><span> </span><span>ac</span><span> </span><span>as</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zs</span><span> </span><span>Cons</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>diff_Suc_Suc</span><span> </span><span>diff_zero</span><span> </span><span>length_Cons</span><span> </span><span>less_Suc_eq_0_disj</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P1_Q</span><span> </span><span>CptnModNestSeq1</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fstI</span><span> </span><span>seq_not_eq2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>P1</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>map_xs_ys&#39;</span><span class="delimiter">[</span><span>OF</span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>
</span><span>                              </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq2</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSeq3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>s&#39;</span><span> </span><span>ys</span><span> </span><span>zs</span><span> </span><span>Q1</span><span> </span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P_Q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;P=P1 &#8743; Q = Q1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Q1 = Throw&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>map_xs_ys&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Normal sa&quot;</span></span></span><span> </span><span>xsa</span><span> </span><span>Throw</span><span> </span><span>Throw</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">]</span><span> 
</span><span>      </span><span>CptnModNestSeq3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>q_not_throw</span><span class="delimiter">=</span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x. x&lt; length ((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) &#10230;
              ((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) ! x &#8800; (Q, sj)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>x_less</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x&lt; length ((LanguageCon.com.Seq P1 Q1, Normal sa) # zs)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) ! x &#8800; (Q, sj)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x &lt; length ((LanguageCon.com.Seq P1 Q1, Normal sa)#map (lift Q1) xsa)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) ! x = map (lift Q1) ((P1, Normal sa) # xsa) ! x&quot;</span></span></span><span>           
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Cons_lift</span><span> </span><span>Cons_lift_append</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>True</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ci si. map (lift Q1) ((P1, Normal sa) # xsa) ! x = (Seq ci Q1,si)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x &lt; length ((P1, Normal sa) # xsa)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (&#955;(c, y). (LanguageCon.com.Seq c Q1, y)) ((P1, Normal sa) # xsa) ! x = (case ((P1, Normal sa) # xsa) ! x of (c, x) &#8658; (LanguageCon.com.Seq c Q1, x))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nth_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c x1. map (&#955;(c, x1). (LanguageCon.com.Seq c Q1, x1)) ((P1, Normal sa) # xsa) ! x = (LanguageCon.com.Seq c Q1, x1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_beta&#39;</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>            
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) ! x &#8800; (Q, sj)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span>eq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>     
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s&#39;_a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712;  a&quot;</span></span></span><span>   
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>cpP1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; cpn n &#915; P1 (Normal sa)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>cpP1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; cp &#915; P1 (Normal sa)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa) = map (lift Q1)  ((P1, Normal sa) # xsa) &quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModSeq3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Cons_lift</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((LanguageCon.com.Seq P1 Q1, Normal sa) # (map (lift Q1) xsa))) &#8712; assum (p,rely)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((LanguageCon.com.Seq P1 Q1, Normal sa) # (map (lift Q1) xsa)) rely&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>map</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Cons_lift_append</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>env_tran_subr</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa)) &#8712; cpn n &#915; (Seq P1 Q1) (Normal sa)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_call.CptnModNestSeq1</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((Seq P1 Q1), Normal sa)#(map (lift Q1) xsa)) &#8712; cp &#915; (Seq P1 Q1) (Normal sa)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; assum (p,rely)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>map</span><span> </span><span>cpP1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, Normal sa) # xsa) &#8712; comm (G,(q,a)) F&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpP1</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>13</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>   
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_throw</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((LanguageCon.com.Throw, Normal s&#39;)# ys). 
              fst (((LanguageCon.com.Throw, Normal s&#39;)# ys)!i) = Throw&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt; length ((LanguageCon.com.Throw, Normal s&#39;)# ys)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (LanguageCon.com.Throw, Normal s&#39;) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>throw_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Throw, Normal s&#39;) # ys)!0 = (Throw, Normal s&#39;) &#8743; 0 &lt; length((LanguageCon.com.Throw, Normal s&#39;) # ys)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>         
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last ((LanguageCon.com.Throw, Normal s&#39;) # ys) = ((LanguageCon.com.Throw, Normal s&#39;) # ys)!((length ((LanguageCon.com.Throw, Normal s&#39;) # ys)) - 1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((LanguageCon.com.Throw, Normal s&#39;) # ys) rely&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>env_tran_subl</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>           
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>             </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((LanguageCon.com.Throw, Normal s&#39;)# ys)!i) = Throw&quot;</span></span></span><span>          
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zero_throw_all_throw</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((Throw, Normal s&#39;) # ys)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&quot;</span></span></span><span> </span><span>a</span><span> </span><span>rely</span><span class="delimiter">]</span><span>
</span><span>              </span><span>s&#39;_a</span><span>  </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>     
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x&#8805; length ((LanguageCon.com.Seq P1 Q1, Normal sa) # map (lift Q1) xsa). 
           x&lt;length (((LanguageCon.com.Seq P1 Q1, Normal sa) # zs)) &#10230;
              fst (((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) ! x) = Throw&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> 
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x&#8805; length ((LanguageCon.com.Seq P1 Q1, Normal sa) # map (lift Q1) xsa)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x&lt;length (((LanguageCon.com.Seq P1 Q1, Normal sa) # zs))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) ! x = 
                   ((LanguageCon.com.Throw, Normal s&#39;)# ys) !(x - (length ((LanguageCon.com.Seq P1 Q1, Normal sa) # map (lift Q1) xsa)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_lift</span><span> </span><span>Cons_lift_append</span><span> </span><span>not_le</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span class="string"><span class="delete"><span class="delete">&quot;fst (((LanguageCon.com.Seq P1 Q1, Normal sa) # zs) ! x) = Throw&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_throw</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>CptnModNestSeq3.hyps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>       
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>q_not_throw</span><span> </span><span>P_Q</span><span> </span><span>x_less</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>not_le</span><span class="delimiter">)</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestSeq3</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>stepc_elim_cases_Seq_throw</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Seq c1 c2,s) &#8594; (Throw, Normal s1)&quot;</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>stepc_elim_cases_Seq_skip_c2</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Seq c1 c2,s) &#8594; (c2,s)&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>seq_skip_throw</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Seq c1 c2,s) &#8594; (c2,s)  &#10233; c1= Skip &#8744; (c1=Throw &#8743; (&#8707;s2&#39;. s=Normal s2&#39;))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>stepc_elim_cases_Seq_skip_c2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>intro</span><span class="delimiter">:</span><span>redex_not_Seq</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Seq_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,a] &#10233;
       &#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,a] &#10233;
       &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [q, R, G, r,a] &#10233;
       &#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [q, R, G, r,a] &#10233;        
       Sta a R &#8743; Sta p R &#10233;  (&#8704;s. (Normal s,Normal s) &#8712; G) &#10233;
       &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Seq c1 c2) sat [p, R, G, r,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [q, R, G, r,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [q, R, G, r,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>     
</span><span>    </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R &#8743; Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [q, R, G, r,a]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>com_cvalidityn_def</span><span> </span><span>all_call</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Seq c1 c2)  s &#8745; assum(p, R) &#8838; comm(G, (r,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Seq c1 c2) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Seq c1 c2) s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Seq c1 c2),s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10&#39;</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn_nest</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Seq c1 c2),s) &#8743; (n,&#915;,l) &#8712; cptn_mod_nest_call &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cpn_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (r,a)) F&quot;</span></span></span><span>         
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>       
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
                 (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                             
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&#8743;
             (final (last l)  &#10230;                    
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal `  r)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` a))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. fst (l!i)&#8800; c2&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>no_c2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. fst (l!i)&#8800; c2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>assumption</span><span>
</span><span>         </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip &#8744; (fst (last l) = Throw &#8743; snd (last l) = Normal s&#39;)&quot;</span></span></span><span>  
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>           
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = LanguageCon.com.Skip&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>no_c2</span><span> </span><span>env_tran_right</span><span> </span><span>cptn_nest</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>Seq_sound3</span><span> </span><span>a4</span><span> </span><span>a1</span><span> </span><span>assum</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">next</span></span><span>             
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>asm0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = LanguageCon.com.Throw &#8743; snd (last l) = Normal s&#39;&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>lc1</span><span> </span><span>s1&#39;</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cpn_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cpn n &#915; c1 s &#8743; l = ((map (lift c2) lc1)@((Throw, Normal s1&#39;)#ys))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Seq_sound2&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>s</span><span> </span><span>s&#39;</span><span class="delimiter">]</span><span>  </span><span>cptn_nest</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>env_tran_right</span><span> </span><span>no_c2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cp &#915; c1 s&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span>split_conv</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?m_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?lm_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length ?m_lc1)&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?last_m_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?m_lc1!(?lm_lc1-1)&quot;</span></span></span><span>             
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;lc1 &#8800; []&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span>a10</span><span>  </span><span>cpn_lc1</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cpn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cpn n &#915; (Seq c1 c2) s&quot;</span></span></span><span>                  
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lc1 ! 0 = (c1, s) &#8743; (n,&#915;, lc1) &#8712; cptn_mod_nest_call &#8743; &#915; = &#915;&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_lc1</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, ?m_lc1) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Cons_lift</span><span> </span><span>cptn_mod_nest_call.CptnModNestSeq1</span><span> </span><span>f1</span><span> </span><span>lc1_not_empty</span><span> </span><span>list.exhaust</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>                               
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>lift_def</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cp &#915; (Seq c1 c2) s&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>cp_def</span><span> </span><span>cp_lc1</span><span> </span><span>cpn_def</span><span> </span><span>lift_is_cptn</span><span> </span><span>mem_Collect_eq</span><span> </span><span>split_conv</span><span class="delimiter">)</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; assum (p,R)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sub_assum</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span> </span><span>cpn_lc1</span><span> </span><span>lc1_not_empty</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,lc1) &#8712; assum(p, R))&quot;</span></span></span><span>  
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span>assum_map</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                          
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>  
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span>  </span><span>cpn_lc1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>m_lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>map_cp</span><span> </span><span>map_assum</span><span> </span><span>comm_map</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_m_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last (?m_lc1) = (Seq (fst (last lc1)) c2,snd (last lc1))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p c. (LanguageCon.com.Seq (fst p) c, snd p) = lift c p&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_map</span><span> </span><span>a000</span><span> </span><span>lc1_not_empty</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last (?m_lc1) = ?last_m_lc1&quot;</span></span></span><span>  
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc1_not_empty</span><span> </span><span>last_conv_nth</span><span> </span><span>list.map_disc_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(?lm_lc1-1)= ?last_m_lc1&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_lc1</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lc1_not_empty</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lm_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(?lm_lc1) = (Throw, Normal s1&#39;)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(?lm_lc1-1)) &#8594; (l!(?lm_lc1))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(?lm_lc1-1)) &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(?lm_lc1))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n na. &#172; n &lt; na &#8744; Suc (na - Suc n) = na - n&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc_diff_Suc</span><span class="delimiter">)</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1 &#8800; []&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>lc1_not_empty</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length (map (lift c2) lc1)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (map (lift c2) lc1) - 1 + 1 &lt; length (map (lift c2) lc1 @ (LanguageCon.com.Throw, Normal s1&#39;) # ys)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_pred&#39;</span><span> </span><span>cp</span><span> </span><span>cpn_lc1</span><span> </span><span>cptn_tran_ce_i</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(?lm_lc1-1)) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(?lm_lc1))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_m_lc1</span><span> </span><span>last_length</span><span> </span><span>l_map</span><span>
</span><span>               </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Seq (fst (last lc1)) c2, snd (last lc1)) = l ! (length (map (lift c2) lc1) - 1)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_map</span><span> </span><span>last_m_lc1</span><span> </span><span>local.last_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>LanguageCon.com.distinct</span><span class="delimiter">(</span><span>71</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;l ! length (map (lift c2) lc1) = (LanguageCon.com.Throw, Normal s1&#39;)&#8250;</span></span></span><span> </span><span>env_c_c&#39;</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>        
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lc1_suc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(?lm_lc1-1)) = snd (l!?lm_lc1) &#8743; fst (l!(?lm_lc1-1)) = Seq Throw c2&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lm_lc1</span><span> </span><span>stepc_elim_cases_Seq_throw</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>asm0</span><span> </span><span>append_is_Nil_conv</span><span> </span><span>cpn_lc1</span><span> </span><span>diff_Suc_less</span><span> </span><span>fst_conv</span><span> </span><span>l_map</span><span> </span><span>last_conv_nth</span><span> </span><span>last_m_lc1</span><span> </span><span>length_greater_0_conv</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>local.last_length</span><span> </span><span>no_c2</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>                            
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!?lm_lc1) &#8712; Normal ` (a)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Throw &#8743; snd (last lc1) = Normal s1&#39;&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span>l_map</span><span> </span><span>lm_lc1</span><span> </span><span>last_m_lc1</span><span> </span><span>last_lc1_suc</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>LanguageCon.com.inject</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>  
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last lc1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1</span><span> </span><span>final_def</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc1)&#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>               </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (last lc1) = Throw &#8743; 
                      snd (last lc1) &#8712; Normal ` (a))&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc1_comm</span><span> </span><span>last_lc1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>               </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>l_map</span><span> </span><span>last_lc1_suc</span><span> </span><span>last_m_lc1</span><span> </span><span>last_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>                                         
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                           
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>             </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>               </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>   
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_m_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt;?lm_lc1  . l!i = ?m_lc1!i&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1 &#8800; []&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>lc1_not_empty</span><span> </span><span>list.map_disc_iff</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>cpn_lc1</span><span>  </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_not_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?m_lc1) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_map</span><span> </span><span>last_lc1_suc</span><span> </span><span>lm_lc1</span><span> </span><span>last_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt; ?lm_lc1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a11&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?m_lc1!k)  &#8594; (?m_lc1!(Suc k))&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>i_m_l</span><span> </span><span>True</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n na. &#172; 0 &lt; n - Suc na &#8744; na &lt; n &quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>zero_less_diff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span>  </span><span>True</span><span> </span><span>a21</span><span> </span><span>i_m_l</span><span>  </span><span>zero_less_diff</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(?m_lc1!k), snd(?m_lc1!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11&#39;</span><span> </span><span>m_lc1_comm</span><span> </span><span>True</span><span> </span><span>comm_dest1</span><span> </span><span>l_f</span><span> </span><span>last_not_F</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_m_l</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=?lm_lc1) &#8744; (Suc k&gt;?lm_lc1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>suck</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=?lm_lc1)&quot;</span></span></span><span>
</span><span>                     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k=?lm_lc1-1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G_s1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s1&#39;, Normal s1&#39;)&#8712;G&quot;</span></span></span><span> 
</span><span>                       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>               
</span><span>                     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!k), snd (l!Suc k)) &#8712; G&quot;</span></span></span><span>               
</span><span>                     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc k) = Normal s1&#39;&quot;</span></span></span><span> 
</span><span>                         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lm_lc1</span><span> </span><span>suck</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                
</span><span>                       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>suck</span><span> </span><span>k</span><span> </span><span>G_s1&#39;</span><span> </span><span>last_lc1_suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a001</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&gt;?lm_lc1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i&#8805;(length lc1) &#8743; (Suc i &lt; length l) &#10230; 
                            &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lm_lc1</span><span> </span><span>lc1_not_empty</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span>  </span><span>env_tran_right</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a_normal</span><span> </span><span>cp</span><span> </span><span>fst_conv</span><span> </span><span>length_map</span><span> 
</span><span>                             </span><span>lm_lc1</span><span> </span><span>only_one_component_tran_j</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="var">?lm_lc1</span><span> </span><span>s1&#39;</span><span> </span><span>a</span><span> </span><span>k</span><span> </span><span>R</span><span class="delimiter">]</span><span> </span><span>snd_conv</span><span> </span><span>a21</span><span> </span><span>a001</span><span> </span><span>a00</span><span>
</span><span>                             </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a001</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a21</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                    
</span><span>                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` r)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` a))&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_t</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Throw&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lm_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>asm0</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?lm_lc1 &#8804; length l -1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! (length l - 1)) &#8712; Normal ` a&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span> </span><span>a_normal</span><span> </span><span>a4</span><span>  </span><span>fst_conv</span><span>  </span><span>lm_lc1</span><span> </span><span>snd_conv</span><span> 
</span><span>                         </span><span>env_tran_right</span><span> </span><span>i_throw_all_throw</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="var">?lm_lc1</span><span> </span><span>s1&#39;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l -1)&quot;</span></span></span><span> </span><span>_</span><span> </span><span>R</span><span> </span><span>a</span><span> </span><span class="delimiter">]</span><span>
</span><span>                       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>diff_is_0_eq</span><span> </span><span>diff_less</span><span> </span><span>diff_less_Suc</span><span> </span><span>diff_zero</span><span> </span><span>image_iff</span><span> </span><span>length_greater_0_conv</span><span> </span><span>lessI</span><span> </span><span>less_antisym</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                               
</span><span>               </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_t</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>  </span><span>cpn_lc1</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>&#915;1</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span>                  
</span><span>         </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>lc1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cpn_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cpn n &#915; c1 s &#8743; l = map (lift c2) lc1&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Seq_sound1</span><span> </span><span>assum</span><span> </span><span>False</span><span> </span><span>no_c2</span><span> </span><span>env_tran_right</span><span> </span><span>cptn_nest</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>a4</span><span> </span><span>a1</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>          
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cp &#915; c1 s &quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>              
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,lc1) &#8712; assum(p, R))&quot;</span></span></span><span>  
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span>  </span><span>cpn_lc1</span><span> </span><span>a10&#39;</span><span> </span><span>a11</span><span> </span><span>assum_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, lc1)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_lc1</span><span> </span><span>a1</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>com_validityn_def</span><span> </span><span>contra_subsetD</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l)&#8712; comm(G, (r,a)) F&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_map</span><span> </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span> </span><span>cp_lc1</span><span> </span><span>cpn_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_f</span><span>
</span><span>             </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span>         
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&lt;length l &#8743; fst (l ! k) = c2&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. (m &lt; length l &#8743; fst (l ! m) = c2) &#8743;
                   (&#8704;i&lt;m. &#172; (i &lt; length l &#8743; fst (l ! i) = c2))&quot;</span></span></span><span>   
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#955;i. i&lt;length l  &#8743; fst (l ! i) = c2)&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l &#8743; fst (l !i) = c2 &#8743;
                                (&#8704;j&lt;i. (fst (l ! j) &#8800; c2))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>        
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>li</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!i =(c2,s2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>eq_fst_iff</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>lc1</span><span> </span><span>lc2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cp_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; (cpn n &#915; c1 s) &#8743; 
                                 (&#915;,lc2) &#8712; (cpn n &#915; c2 (snd (lc1!(i-1)))) &#8743; 
                                 l = (map (lift c2) lc1)@lc2&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Seq_sound4</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>s</span><span class="delimiter">]</span><span> </span><span>a0</span><span> </span><span>env_tran_right</span><span> </span><span>a4</span><span> </span><span>a1</span><span> </span><span>cptn_nest</span><span> </span><span>assum</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_lc1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; (cp  &#915; c1 s) &#8743; 
                    (&#915;,lc2) &#8712; (cp  &#915; c2 (snd (lc1!(i-1))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; length l. snd (l!i) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>l_f</span><span> </span><span>last_not_F</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>F</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_not_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!i) &#8713; Fault ` F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_c1_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length lc1 = length (map (lift c2) lc1)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=length lc1&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>li</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, lc1) &#8712; cpn n &#915; c1 s &#8743; (&#915;, lc2) &#8712; cpn n &#915; c2 (snd (lc1 ! (i - 1))) &#8743; l = map (&#955;(P, s). (LanguageCon.com.Seq P c2, s)) lc1 @ lc2&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length l &#8743; fst (l ! i) = c2 &#8743; (&#8704;n. &#172; n &lt; i &#8744; fst (l ! n) &#8800; c2)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Seq (fst (lc1 ! i)) c2, snd (lc1 ! i)) = lift c2 (lc1 ! i)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_unfold</span><span> </span><span>lift_def</span><span class="delimiter">)</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! length lc1) = c2&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f3</span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>nth_append</span><span> </span><span>cp_lc1</span><span> 
</span><span>                 </span><span>fst_conv</span><span> </span><span>length_map</span><span> </span><span>lift_nth</span><span> </span><span>linorder_neqE_nat</span><span> </span><span>seq_and_if_not_eq</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>                  
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;length lc2. lc2!j=l!(i+j)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>length_c1_map</span><span> </span><span>i_map</span><span> </span><span>a0</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_append_length_plus</span><span class="delimiter">)</span><span>                                                             
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;lc1 &#8800; []&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;lc2 &#8800; []&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>cp_lc1</span><span> </span><span>i_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                      
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_is</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2= snd (last lc1)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>li</span><span> </span><span>a0</span><span> </span><span>lc1_not_empty</span><span> </span><span>i_map</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_conv_nth</span><span> </span><span>lc2_l</span><span class="delimiter">)</span><span>       
</span><span>         </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?m_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1&quot;</span></span></span><span>
</span><span>         </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* let ?lm_lc1 = &quot;(length ?m_lc1)&quot;
         let ?last_m_lc1 = &quot;?m_lc1!(?lm_lc1-1)&quot; *)</span></span></span></span></span><span>                         
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_m_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(i-1) = (Seq (fst (last lc1)) c2,s2)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p c. (LanguageCon.com.Seq (fst p) c, snd p) = lift c p&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (map (lift c2) lc1) = i&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>l_is</span><span> </span><span>a000</span><span> </span><span>cp_lc1</span><span> </span><span>diff_less</span><span> </span><span>last_conv_nth</span><span> </span><span>last_map</span><span> 
</span><span>            </span><span>lc1_not_empty</span><span> </span><span>length_c1_map</span><span> </span><span>length_greater_0_conv</span><span> </span><span>less_Suc0</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>                       
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_mcl1_not_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?m_lc1) &#8713; Fault ` F&quot;</span></span></span><span>                 
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1 &#8800; []&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>lc1_not_empty</span><span> </span><span>list.map_disc_iff</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>i_not_fault</span><span> </span><span>l_is</span><span> </span><span>last_conv_nth</span><span> </span><span>last_snd</span><span> </span><span>lc1_not_empty</span><span> </span><span>li</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>        
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cpn n &#915; (Seq c1 c2) s&quot;</span></span></span><span>               
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lc1 ! 0 = (c1, s) &#8743; (n,&#915;, lc1) &#8712; cptn_mod_nest_call &#8743; &#915; = &#915;&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, ?m_lc1) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc1_not_empty</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_lift</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>cptn_mod_nest_call.CptnModNestSeq1</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>lift_def</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cp&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cp &#915; (Seq c1 c2) s&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; assum (p,R)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sub_assum</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span> </span><span>cp_lc1</span><span> </span><span>lc1_not_empty</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,lc1) &#8712; assum(p, R))&quot;</span></span></span><span>  
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span>assum_map</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>cp_lc1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                          
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>  
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>com_validityn_def</span><span> </span><span>contra_subsetD</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>m_lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>map_cp&#39;</span><span> </span><span>map_assum</span><span> </span><span>comm_map</span><span> </span><span>cp_lc1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i-1)) &#8594; (l!i)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i-1)) &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(i))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n na. &#172; n &lt; na &#8744; Suc (na - Suc n) = na - n&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc_diff_Suc</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1 &#8800; []&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>lc1_not_empty</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length (map (lift c2) lc1)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>             
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (map (lift c2) lc1) - 1 + 1 &lt; length (map (lift c2) lc1 @ lc2)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>lc2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; i&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>i_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_diff_1</span><span> </span><span>a0</span><span> </span><span>add.right_neutral</span><span> </span><span>add_Suc_right</span><span> </span><span>cp</span><span> </span><span>cptn_tran_ce_i</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i-1)) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!i)&quot;</span></span></span><span>           
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>last_m_lc1</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>env_c_c&#39;</span><span> </span><span>seq_and_if_not_eq</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>         
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Seq (fst (last lc1)) c2,s2) &#8594; (c2, s2)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_m_lc1</span><span>  </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>           </span><span>last_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip &#8744; 
            fst (last lc1) = Throw &#8743; (s2 = Normal s2&#39;)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>seq_skip_throw</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>    
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last lc1)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1</span><span> </span><span>l_is</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* look here for the property *******************************************************************************)</span></span></span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>normal_last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip &#8743; snd (last lc1) &#8712; Normal ` q &#8744;
                        fst (last lc1) = Throw &#8743; snd (last lc1) &#8712; Normal ` (a)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>         
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_not_fault</span><span> </span><span>l_is</span><span> </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final</span><span> </span><span>comm_dest2</span><span> </span><span>lc1_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>lastlc1_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc1) = Normal s2&#39;&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Normals2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 = Normal s2&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>l_is</span><span> </span><span class="delimiter">)</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Gs2&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s2&#39;, Normal s2&#39;)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                     
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span>
</span><span>           </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
           &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                    
             (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> 
</span><span>           </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>            </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_m_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j &lt;i . l!j = ?m_lc1!j&quot;</span></span></span><span>             
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1 &#8800; []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>lc1_not_empty</span><span> </span><span>list.map_disc_iff</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>i_map</span><span> </span><span>length_c1_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span class="delimiter">:</span><span>nth_append</span><span class="delimiter">)</span><span>              
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt; i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a11&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?m_lc1!k)  &#8594; (?m_lc1!(Suc k))&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>i_m_l</span><span> </span><span>True</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n na. &#172; 0 &lt; n - Suc na &#8744; na &lt; n &quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>zero_less_diff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>a21</span><span> </span><span>i_m_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>                  
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>                                                             
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length ?m_lc1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>i_map</span><span> </span><span>length_c1_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(?m_lc1!k), snd(?m_lc1!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11&#39;</span><span> </span><span>last_mcl1_not_F</span><span>  </span><span>m_lc1_comm</span><span> </span><span>True</span><span> </span><span>i_map</span><span> </span><span>length_c1_map</span><span> 
</span><span>                    </span><span>comm_dest1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_m_l</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>                                            
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=i) &#8744; (Suc k&gt;i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>suck</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=i)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k=i-1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                                                            
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!k), snd (l!Suc k)) &#8712; G&quot;</span></span></span><span>               
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!Suc k) = Normal s2&#39;&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Normals2</span><span> </span><span>suck</span><span> </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>     
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! k) = Normal s2&#39;&quot;</span></span></span><span>   
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Normals2</span><span> </span><span>k</span><span> </span><span>last_m_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                 
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;p. p &#8712; G &quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span>  </span><span>case_prod_conv</span><span> </span><span>mem_Collect_eq</span><span> </span><span>Gs2&#39;</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>suck</span><span> </span><span>k</span><span> </span><span>Normals2</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Gs2&#39;</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>                       
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a001</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&gt;i&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k=i+k&#39;&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>add.commute</span><span> </span><span>le_Suc_ex</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>throw</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c2=Throw &#8743; fst (last lc1) = Throw&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_in</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2&#39; &#8712; a&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Normals2</span><span> </span><span>i_map</span><span> </span><span>normal_last</span><span> </span><span>li</span><span> </span><span>lastlc1_normal</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>image_iff</span><span> </span><span>snd_conv</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k&#8805;i &#8743; (Suc k &lt; length l) &#10230; 
                            &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Normals2</span><span> </span><span>li</span><span> </span><span>lastlc1_normal</span><span> </span><span>a21</span><span> </span><span>a001</span><span> </span><span>a00</span><span> </span><span>a4</span><span>
</span><span>                        </span><span>a0</span><span> </span><span>throw</span><span> </span><span>env_tran_right</span><span> </span><span>only_one_component_tran_j</span><span> </span><span>snd_conv</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span>  </span><span>cp</span><span> </span><span>env_tran_right</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a21</span><span> </span><span>a001</span><span> </span><span>k</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                                  
</span><span>                </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span class="delimiter">=</span><span>this</span><span>
</span><span>                </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(c2=Throw &#8743; fst (last lc1) = Throw)&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_m_lc1</span><span> </span><span>last_lc1</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>step</span><span> </span><span>a0</span><span> </span><span>l_is</span><span> </span><span>li</span><span> </span><span>prod.collapse</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>11</span><span class="delimiter">)</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> </span><span>lastlc1_normal</span><span> </span><span>Normals2</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l=i+length lc2&quot;</span></span></span><span> 
</span><span>                       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_map</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  assum (q,R)&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (lc2!0) &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>                     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>lc2_l</span><span> </span><span>s2_normal</span><span> </span><span>lc2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                     </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>                     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>j_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt;length lc2&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                            </span><span>j_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(lc2!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (lc2!(Suc j))&quot;</span></span></span><span>
</span><span>                     
</span><span>                     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i + j)&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_len</span><span> </span><span>length_lc2</span><span>
</span><span>                       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i+j))  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l! (Suc (i+ j)))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>j_step</span><span> </span><span>j_len</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(lc2!j), snd(lc2!(Suc j))) &#8712; R&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>suc_len</span><span> </span><span>lc2_l</span><span> </span><span>j_len</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> 
</span><span>                     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712; cpn n &#915; c2 s2&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>i_map</span><span> </span><span>l_is</span><span> </span><span>last_conv_nth</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  comm (G, (r,a)) F&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_last_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc2)&#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>lc2_not_empty</span><span> </span><span>l_f</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suck&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&#39; &lt; length lc2&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k&#39;</span><span> </span><span>a00</span><span> </span><span>length_lc2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(lc2!k&#39;)  &#8594; (lc2!(Suc k&#39;))&quot;</span></span></span><span>  
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k&#39;</span><span> </span><span>lc2_l</span><span> </span><span>a21</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (lc2! k&#39;), snd (lc2 ! Suc k&#39;)) &#8712; G&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_lc2</span><span> </span><span>lc2_last_f</span><span> </span><span>comm_dest1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>lc2</span><span> </span><span>G</span><span> </span><span>r</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>k&#39;</span><span class="delimiter">]</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>suck&#39;</span><span> </span><span>lc2_l</span><span> </span><span>k&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">}</span></span><span>                    
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                 
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span class="delimiter">=</span><span>this</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>right</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal `  r)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` a))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>final_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_last_lc2_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l=last lc2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cp_lc1</span><span> </span><span>lc2_not_empty</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last lc2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>lst_lc1_throw</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Throw&quot;</span></span></span><span>                        
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2_throw</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c2 = Throw&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lst_lc1_throw</span><span> </span><span>step</span><span> </span><span>lastlc1_normal</span><span> </span><span>stepc_elim_cases_Seq_skip_c2</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                                                  
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 &#8712; Normal ` (a)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lst_lc1_throw</span><span> </span><span>l_is</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_ev</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k&lt;length l - 1. k&#8805;i &#8743; (Suc k &lt; length l) &#10230; 
                            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_in</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2&#39; &#8712; a&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Normals2</span><span> </span><span>i_map</span><span> </span><span>normal_last</span><span> </span><span>li</span><span> </span><span>lastlc1_normal</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>image_iff</span><span> </span><span>snd_conv</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>lst_lc1_throw</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k&#8805;i &#8743; (Suc k &lt; length l) &#10230; 
                            &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Normals2</span><span> </span><span>li</span><span> </span><span>lastlc1_normal</span><span>   </span><span>a4</span><span>
</span><span>                     </span><span>a0</span><span> </span><span>c2_throw</span><span> </span><span>env_tran_right</span><span> </span><span>only_one_component_tran_j</span><span> </span><span>snd_conv</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span>  </span><span>cp</span><span> </span><span>env_tran_right</span><span class="delimiter">)</span><span>  
</span><span>               </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>cp</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>      
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Throw</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!(length l - 1)) = Throw&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>c2_throw</span><span> </span><span>a0</span><span> </span><span>cptn_i_env_same_prog</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((length l)-1)&quot;</span></span></span><span> </span><span>i</span><span class="delimiter">]</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                            
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(length l - 1)) &#8712; Normal ` (a) &#8743; fst (l!(length l - 1)) = Throw&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>all_ev</span><span> </span><span>a0</span><span> </span><span>s2_a</span><span> </span><span>li</span><span> </span><span>a4</span><span> </span><span>env_tran_right</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l) -1&quot;</span></span></span><span> </span><span>_</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>Throw</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_pred</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>                         </span><span>lessI</span><span> </span><span>linorder_not_less</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> 
</span><span>                         </span><span>not_less0</span><span> </span><span>not_less_eq_eq</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>                              
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal `  r)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>last_conv_nth</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less0</span><span class="delimiter">)</span><span>                           
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip&quot;</span></span></span><span>                 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> </span><span>lastlc1_normal</span><span> </span><span>Normals2</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l=i+length lc2&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_map</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  assum (q,R)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (lc2!0) &#8712; Normal ` q&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>lc2_l</span><span> </span><span>s2_normal</span><span> </span><span>lc2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                 </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>                 </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>j_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt;length lc2&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                        </span><span>j_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(lc2!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (lc2!(Suc j))&quot;</span></span></span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i + j)&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_len</span><span> </span><span>length_lc2</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i+j))  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l! (Suc (i+ j)))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>j_step</span><span> </span><span>j_len</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(lc2!j), snd(lc2!(Suc j))) &#8712; R&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>suc_len</span><span> </span><span>lc2_l</span><span> </span><span>j_len</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712; cpn n &#915; c2 s2&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>i_map</span><span> </span><span>l_is</span><span> </span><span>last_conv_nth</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  comm (G, (r,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_last_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc2)&#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>lc2_not_empty</span><span> </span><span>l_f</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>             
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last lc2) = Skip &#8743; 
                    snd (last lc2) &#8712; Normal `  r)) &#8744;
                    (fst (last lc2) = Throw &#8743; 
                    snd (last lc2) &#8712; Normal ` a)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_lc2</span><span> </span><span>comm_lc2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal `  r)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` a)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_last_lc2_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` r)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` a)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>         
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> </span><span>l_f</span><span> </span><span>&#915;1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>             
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span> </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Catch_env_P</span><span class="delimiter">:</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch P Q,s) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (Catch P Q,t)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>env_not_normal_s</span><span> </span><span>snormal_enviroment</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>map_catch_eq_state</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l1. snd (l1!i) = snd (l2!i)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>snd_lift_catch</span><span class="delimiter">)</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>map_eq_catch_c</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l1. fst (l1!i) = Catch (fst (l2!i)) c2&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l1&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l1!i) = Catch (fst (l2!i)) c2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_unfold</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>same_env_catch_c</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1!(Suc i))&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712;cptn &#8743; l1!0 = ((Catch c1 c2),s)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712;cptn &#8743; l2!0 = (c1,s)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length l2&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1!(Suc i))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l2 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Catch c2i c2) &#8743; c1si = (Catch c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>l1prod</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>         
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span>  </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>         
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Env_n</span><span> </span><span>env_c_c&#39;</span><span> </span><span>env_not_normal_s</span><span> </span><span>step_e.Env</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l1 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Catch c2i c2) &#8743; c1si = (Catch c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span>       
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Env_n</span><span> </span><span>LanguageCon.com.inject</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>env_c_c&#39;</span><span> </span><span>env_not_normal_s</span><span> </span><span>step_e.Env</span><span class="delimiter">)</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>same_comp_catch_c</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712;cptn &#8743; l1!0 = ((Catch c1 c2),s)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712;cptn &#8743; l2!0 = (c1,s)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length l2&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594; l2 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Catch c2i c2) &#8743; c1si = (Catch c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>map_eq_catch_c</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span> </span><span>map_eq_state</span><span> </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>          
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594; (l1 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Catchc</span><span class="delimiter">)</span><span>        
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l1 ! i &#8594; l1 ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1i</span><span> </span><span>s1i</span><span> </span><span>c1si</span><span> </span><span>s1si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l1prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1 ! i=(c1i,s1i) &#8743; l1!Suc i = (c1si,s1si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2i</span><span> </span><span>s2i</span><span> </span><span>c2si</span><span> </span><span>s2si</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l2prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 ! i=(c2i,s2i) &#8743; l2!Suc i = (c2si,s2si)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1i = (Catch c2i c2) &#8743; c1si = (Catch c2si c2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>  </span><span>l1prod</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>          
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2i=s1i &#8743; s2si=s1si&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a4</span><span>  </span><span>a2</span><span> </span><span>a3</span><span> </span><span>l2prod</span><span>  </span><span>l1prod</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>          
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l2 ! i &#8594; (l2 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l1prod</span><span> </span><span>l2prod</span><span> </span><span>stepc_elim_cases_Catch_Catch</span><span> </span><span>Catch_not_c</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assum_map_catch</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s) &#8743; ((&#915;,l1) &#8712; assum(p, R))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span>  
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,l2) &#8712; assum(p, R))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l1!(Suc i))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>same_env_catch_c</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l2) = &#915; &#8743; snd (&#915;,l2) = l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2!0 = (c1,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1 = length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s = Normal s&#39;&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a0</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>   </span><span>assum_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c</span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd((snd ?c!0)) &#8712; Normal ` (p)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>drop_k_s</span><span> </span><span>a1</span><span> </span><span>normal_s</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length (snd ?c)&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(fst ?c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd ?c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd ?c)!(Suc i))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd ?c)!i), snd((snd ?c)!(Suc i))) &#8712; R&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>map_catch_eq_state</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a11</span><span> </span><span>eq_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l2) &#8712; assum (p, R)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_map&#39;_catch</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &#8743; (&#915;, l2)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F  &#10230;(Suc k &lt; length l1 &#10230;
       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230;        
       (snd(l1!k), snd(l1!(Suc k))) &#8712; G) &#8743; 
   (fst (last l1) = (Catch c c2) &#8743; final (c, snd (last l1)) &#10230;     
      (fst (last l1) = (Catch Skip c2) &#8743; 
        (snd (last  l1) &#8712; Normal ` q) &#8744;
      (fst (last l1) = (Catch Throw c2) &#8743; 
        snd (last l1) &#8712; Normal ` (a))))
     &quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>same_comp_catch_c</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l2) = &#915; &#8743; snd (&#915;,l2) = l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2!0 = (c1,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1 = length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l2&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l2_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>       
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l1 = l1!((length l1) -1)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l2 = l2!((length l2) -1)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F  &#10230;(&#8704;i ns ns&#39;.                 
               Suc i&lt;length (snd (&#915;, l2)) &#10230; 
               fst (&#915;, l2)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (&#915;, l2))!i)  &#8594; ((snd (&#915;, l2))!(Suc i)) &#10230;                               
                 (snd((snd (&#915;, l2))!i), snd((snd (&#915;, l2))!(Suc i))) &#8712; G) &#8743; 
               (final (last (snd (&#915;, l2)))  &#10230;                 
                  ((fst (last (snd (&#915;, l2))) = Skip &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` q)) &#8744;
                  (fst (last (snd (&#915;, l2))) = Throw &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l1&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_length</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l1!((length l1) -1)) = snd (l2!((length l2) -1))&quot;</span></span></span><span>      
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span>a0</span><span>  </span><span>map_catch_eq_state</span><span> </span><span>eq_length</span><span> </span><span>l2_not_empty</span><span> </span><span>last_snd</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(last l2) = snd (last l1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lenl1</span><span> </span><span>last_lenl2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00a</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F &#10230;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230;       
      (snd((snd (&#915;, l1))!k), snd((snd (&#915;, l1))!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_&#915;l1</span><span> </span><span>pair_&#915;l2</span><span> </span><span>a00</span><span>  </span><span>a03</span><span> </span><span>a3</span><span>  </span><span>eq_length</span><span> </span><span>a00a</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>map_catch_eq_state</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span class="delimiter">=</span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l1) = (Catch c c2) &#8743; final (c, snd (last l1))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>           </span><span>a01</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l1)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=Skip &#8744; c = Throw&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_last_l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l2) = c&quot;</span></span></span><span>                               
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_lenl1</span><span> </span><span>a00</span><span> </span><span>l1_not_empty</span><span> </span><span>eq_length</span><span> </span><span>len0</span><span> </span><span>a2</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lift_catch</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_eq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) = snd (last l1)&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l2_not_empty</span><span> </span><span>a2</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lenl1</span><span> </span><span>last_snd_catch</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (fst (last l2),snd (last l2))&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (l2)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_eq</span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (last  l2)) = Skip &#8743; 
                    snd (last  l2) &#8712; Normal ` q &#8744;
                  (fst (last l2) = Throw &#8743; 
                    snd (last l2) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a03</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst (last l1) = (Catch Skip c2) &#8743; 
                    snd (last  l1) &#8712; Normal ` q) &#8744;
                  (fst (last l1) = (Catch Throw c2) &#8743; 
                    snd (last l1) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_eq</span><span> </span><span>fst_last_l2</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_map&#39;&#39;_catch</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &#8743; (&#915;, l2)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F &#10230; ((Suc k &lt; length l1 &#10230;
       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230;        
       (snd(l1!k), snd(l1!(Suc k))) &#8712;  G) &#8743; 
   (final (last l1) &#10230;     
      (fst (last l1) = Skip &#8743; 
        (snd (last  l1) &#8712; Normal ` r) &#8744;
      (fst (last l1) = Throw &#8743; 
        snd (last l1) &#8712; Normal ` a))))
     &quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l2 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l2!i)  &#8594; (l2!(Suc i)) = 
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!i)  &#8594; (l1!(Suc i))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>same_comp_catch_c</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l1) = &#915; &#8743; snd (&#915;,l1) = l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>pair_&#915;l2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (&#915;,l2) = &#915; &#8743; snd (&#915;,l2) = l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_k_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2!0 = (c1,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1 = length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l2&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l1&gt;0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l2_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l2 &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>       
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l1 = l1!((length l1) -1)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lenl2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l2 = l2!((length l2) -1)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span>l2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a03</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F &#10230;(&#8704;i ns ns&#39;.                 
               Suc i&lt;length (snd (&#915;, l2)) &#10230; 
               fst (&#915;, l2)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (&#915;, l2))!i)  &#8594; ((snd (&#915;, l2))!(Suc i)) &#10230;                                              
                 (snd((snd (&#915;, l2))!i), snd((snd (&#915;, l2))!(Suc i))) &#8712; G) &#8743; 
               (final (last (snd (&#915;, l2)))  &#10230;                 
                  ((fst (last (snd (&#915;, l2))) = Skip &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` q)) &#8744;
                  (fst (last (snd (&#915;, l2))) = Throw &#8743; 
                    snd (last (snd (&#915;, l2))) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l1&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length l2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_length</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l2) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l1!((length l1) -1)) = snd (l2!((length l2) -1))&quot;</span></span></span><span>      
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span>a0</span><span>  </span><span>map_catch_eq_state</span><span> </span><span>eq_length</span><span> </span><span>l2_not_empty</span><span> </span><span>last_snd</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(last l2) = snd (last l1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lenl1</span><span> </span><span>last_lenl2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00a</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l1!k)  &#8594; (l1!(Suc k)) &#10230;          
        (snd((snd (&#915;, l1))!k), snd((snd (&#915;, l1))!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_&#915;l1</span><span> </span><span>pair_&#915;l2</span><span> </span><span>a00</span><span>  </span><span>a03</span><span> </span><span>a3</span><span>  </span><span>eq_length</span><span> </span><span>a00a</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a2</span><span> </span><span>Suc_lessD</span><span> </span><span>nth_map</span><span> </span><span>snd_lift_catch</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l1)&quot;</span></span></span><span>           
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l1)=Skip &#8744; fst (last l1) = Throw&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l1) = Catch (fst (last l2)) c2&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>last_lenl1</span><span> </span><span>eq_length</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last l2 = l2 ! (length l2 - 1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l2_not_empty</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>a2</span><span> </span><span>l2_not_empty</span><span> </span><span>last_lenl1</span><span> </span><span>last_lift_catch</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>comm_map_catch</span><span class="delimiter">:</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l1) &#8712; (cp &#915; (Catch c1 c2) s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l2) &#8712; (cp &#915; c1 s) &#8743; (&#915;, l2)&#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l1=map (lift_catch c2) l2&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l1)&#8712; comm(G, (r,a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l1) &#8713; Fault ` F  &#10230;(Suc i &lt; length (l1) &#10230;
        &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l1 ! i) &#8594; (l1 ! (Suc i)) &#10230;       
        (snd (l1 ! i), snd (l1 ! Suc i)) &#8712; G) &#8743;
        (SmallStepCon.final (last l1) &#10230;                  
                   fst (last l1) = LanguageCon.com.Skip &#8743;
                   snd (last l1) &#8712; Normal ` r &#8744;
                   fst (last l1) = LanguageCon.com.Throw &#8743;
                   snd (last l1) &#8712; Normal ` a) &quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_map&#39;&#39;_catch</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l1</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>s</span><span> </span><span>l2</span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>i</span><span> </span><span>r</span><span class="delimiter">]</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>       
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Catch_sound1</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Catch P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172; final (last x)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs. (&#915;,xs) &#8712; cpn n &#915; P s &#8743; x = map (lift_catch Q) xs&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestOne</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, [(P,s)]) &#8712; cpn n &#915; P s &#8743; [(C, s1)] = map (lift_catch Q) [(P,s)]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>lift_catch_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_mod_nest_call.CptnModNestOne</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=Catch P Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs. (&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = map (lift_catch Q) xs&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((C, t1) # xsa) ! 0 = (Catch P Q, t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((C, t1) # xsa). fst (((C, t1) # xsa) ! i) &#8800; Q&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; SmallStepCon.final (last ((C, t1) # xsa))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>     
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>hi</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = map (lift_catch Q) xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1=s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;) &#8743; (n,&#915;,((P,t1)#xsa&#39;))&#8712;cptn_mod_nest_call &#8743; 
                  (C, t1) # xsa = map (lift_catch Q) ((P,t1)#xsa&#39;)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s1) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span>Catch_env_P</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,(P,s1)#(P,t1)#xsa&#39;)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>env_tran</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_mod_nest_call.CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s1)#(P,t1)#xsa&#39;) &#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_def</span><span> </span><span>s1_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C,s1)#(C, t1) # xsa = map (lift_catch Q) ((P,s1)#(P,t1)#xsa&#39;)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Catch</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Catch</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch1</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;LanguageCon.com.Catch P Q = LanguageCon.com.Catch P0 P1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sa = s&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch1.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P = P0 &#8743; Q = P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (P0, sa) # xsa) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>CptnModNestCatch1.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, sa) # xsa) &#8712; cpn n &#915; P s&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_catch</span><span> </span><span>CptnModNestCatch1.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>   
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span> </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span>sa</span><span> </span><span>xsa</span><span>  </span><span>ys</span><span> </span><span>zs</span><span> </span><span>Q1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last ((Skip, sa)# ys))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (Skip,snd (last ((P1, sa) # xsa))) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch2</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_eq_cptn_mod_set</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Skip,snd (last ((P1, sa) # xsa))) # ys) &#8712; cptn&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>       
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>throw_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((Skip,snd (last ((P1, sa) # xsa))) # ys)!0 = (Skip, snd (last ((P1, sa) # xsa))) &#8743; 0 &lt; length((Skip, snd (last ((P1, sa) # xsa))) # ys)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>         
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last ((Skip,snd (last ((P1, sa) # xsa))) # ys) = 
                      ((Skip,snd (last ((P1, sa) # xsa))) # ys)!((length ((Skip,snd (last ((P1, sa) # xsa))) # ys)) - 1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((Skip,snd (last ((P1, sa) # xsa))) # ys) rely&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch2.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>env_tran_subl</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>          
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>st&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((Skip,snd (last ((P1, sa) # xsa))) # ys)) = Skip &#8743;        
                     snd (last ((Skip,snd (last ((P1, sa) # xsa))) # ys)) = Normal st&#39;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestCatch2</span><span> </span><span>zero_skip_all_skip</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((Skip,snd (last ((P1, sa) # xsa))) # ys)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length ((Skip,snd (last ((P1, sa) # xsa))) # ys))-1&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>append_Cons</span><span> </span><span>diff_less</span><span> </span><span>fst_conv</span><span> 
</span><span>         </span><span>last_appendR</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>      
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>last.simps</span><span class="delimiter">)</span><span>       
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>        </span><span>CptnModNestCatch2.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>append_is_Nil_conv</span><span> </span><span>last.simps</span><span> 
</span><span>        </span><span>last_appendR</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>     
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>sa&#39;</span><span> </span><span>P1</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>zs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (zs!i) = Q &#8743; (i&lt; (length zs))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch3</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>add_diff_cancel_left&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>length_append</span><span> </span><span>nth_append_length</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length ((Catch P0 P1,Normal sa)#zs)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((Catch P0 P1, Normal sa) # zs)!Suc i) = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Catch_sound2</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Catch P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last x) = Skip&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys. (&#915;,xs) &#8712; cpn n &#915; P s &#8743; x = ((map (lift_catch Q) xs)@((Skip,snd(last xs))#ys))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestOne</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=Catch P Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys. (&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = 
                map (lift_catch Q) xs@((Skip, snd(last xs))#ys)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((C, t1) # xsa) ! 0 = (LanguageCon.com.Catch P Q, t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((C, t1) # xsa). fst (((C, t1) # xsa) ! i) &#8800; Q&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((C, t1) # xsa)) = Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>hi</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, xs) &#8712; cpn n &#915; P t1 &#8743; (C, t1) # xsa = map (lift_catch Q) xs@((Skip,snd(last ((P, t1)#xs)))#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1=s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xsa&#39; ys. xs=((P,t1)#xsa&#39;) &#8743; (n,&#915;,((P,t1)#xsa&#39;))&#8712;cptn_mod_nest_call &#8743; (C, t1) # xsa = map (lift_catch Q) ((P,t1)#xsa&#39;)@((Skip, snd(last xs))#ys)&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,xs)&#8712;cptn_mod_nest_call &#8743; xs!0 = (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEmpty</span><span> </span><span>calculation</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>calculation</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>hi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xsa&#39;</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs=((P,t1)#xsa&#39;) &#8743; (n,&#915;,((P,t1)#xsa&#39;))&#8712;cptn_mod_nest_call &#8743; (C, t1) # xsa = 
                                    map (lift_catch Q) ((P,t1)#xsa&#39;)@((Skip,snd(last ((P,s1)#(P,t1)#xsa&#39;)))#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s1) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span>Catch_env_P</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,(P,s1)#(P,t1)#xsa&#39;)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>env_tran</span><span> </span><span>CptnEnv</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_mod_nest_call.CptnModNestEnv</span><span class="delimiter">)</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(P,s1)#(P,t1)#xsa&#39;) &#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_def</span><span> </span><span>s1_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C,s1)#(C, t1) # xsa = map (lift_catch Q) ((P,s1)#(P,t1)#xsa&#39;)@((Skip,snd(last ((P,s1)#(P,t1)#xsa&#39;)))#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs</span><span> </span><span>C</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Catch</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.redex_not_Catch</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch1</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c x. (LanguageCon.com.Catch c P1, x) # zs = map (lift_catch P1) ((c, x) # xsa)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_catch</span><span> </span><span>CptnModNestCatch1.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P0, sa) # xsa = []&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch1.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>LanguageCon.com.distinct</span><span class="delimiter">(</span><span>19</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>last_conv_nth</span><span> </span><span>last_lift_catch</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span>sa</span><span> </span><span>xsa</span><span>  </span><span>ys</span><span> </span><span>zs</span><span> </span><span>Q1</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P1 = P &#8743; Q1 = Q &#8743; sa = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1,sa) # xsa)&#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch2</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>cptn_eq_cptn_mod_set</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last zs=(Skip, s&#39;)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;s&#39;. last zs = (LanguageCon.com.Skip, s&#39;) &#10233; thesis&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x. last zs = (LanguageCon.com.Skip, x)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch2.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>append_is_Nil_conv</span><span> </span><span>last_ConsR</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>prod.exhaust_sel</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>        
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_catch_append</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>sa</span><span> </span><span>xsa</span><span> </span><span>sa&#39;</span><span> </span><span>P1</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P0 = P &#8743; P1 = Q &#8743; s=Normal sa&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>zs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (zs!i) = Q &#8743; (i&lt; (length zs))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch3</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>add_diff_cancel_left&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>length_append</span><span> </span><span>nth_append_length</span><span> </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>si</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt; length ((Catch P0 P1,Normal sa)#zs)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((Seq P0 P1, Normal sa) # zs)!Suc i) = Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>zs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>zs</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>si</span><span> </span><span>nth_Cons_Suc</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Catch_sound3</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x)&#8712;cptn&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Catch P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length x. fst (x!i)&#8800; Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst(last x) = Throw&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely &quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>P</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnOne</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>st</span><span> </span><span>t</span><span> </span><span>xsa</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((C, t) # xsa) rely&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;LanguageCon.com.Catch P Q = C&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span>CptnEnv.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnEnv.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>CptnEnv.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>moura</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>  
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnComp</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>st</span><span> </span><span>C&#39;</span><span> </span><span>st&#39;</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_catch</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C = (Catch P Q) &#8743; st = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>CptnComp</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Catchc</span><span> </span><span>P1</span><span> </span><span>P1&#39;</span><span> </span><span>P2</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; ((C&#39;, st&#39;) # xsa) rely&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnComp.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Q = P2&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_catch</span><span> </span><span>Catchc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span>CptnComp.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnComp.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>CptnComp.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>Catchc</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>moura</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span>  </span><span class="delimiter">(</span><span>CatchSkipc</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((C&#39;, st&#39;) # xsa) ! 0) = LanguageCon.com.Skip&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>local.CatchSkipc</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>CptnComp.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>CptnComp.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>LanguageCon.com.distinct</span><span class="delimiter">(</span><span>17</span><span class="delimiter">)</span><span> 
</span><span>            </span><span>last_ConsR</span><span> </span><span>last_length</span><span> </span><span>length_Cons</span><span> </span><span>lessI</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>zero_skip_all_skip</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>SeqThrowc</span><span> </span><span>C2</span><span> </span><span>s&#39;</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c_catch</span><span class="delimiter">)</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>FaultPropc</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_catch</span><span> </span><span>redex_not_Catch</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>StuckPropc</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_catch</span><span> </span><span>redex_not_Catch</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>AbruptPropc</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_catch</span><span> </span><span>redex_not_Catch</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>catch_map_xs_ys&#39;</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (P0, sa) # xsa) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((P0, sa) # xsa)) = C&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;zs = map (lift_catch P1) xsa @ (P1, snd (last ((P0, sa) # xsa))) # ys&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Catch P0 P1, sa) # zs) ! 0 = (LanguageCon.com.Catch P Q, s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length ((LanguageCon.com.Catch P0 P1, sa) # zs) &#8743; ((LanguageCon.com.Catch P0 P1, sa) # zs) ! i = (Q, sj)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;i. fst (((LanguageCon.com.Catch P0 P1, sa) # zs) ! j) &#8800; Q&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys. (&#915;, xs) &#8712; cpn n &#915; P s &#8743;
            (&#915;, ys) &#8712; cpn n &#915; Q (snd (xs ! (i - 1))) &#8743; (LanguageCon.com.Catch P0 P1, sa) # zs = map (lift_catch Q) xs @ ys&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?P0</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P0, sa) # xsa&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P_Q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;P=P0 &#8743; s=sa &#8743; Q = P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=(length ((P0, sa) # xsa))&quot;</span></span></span><span>   
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i=(length ((P0, sa) # xsa))&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;(length ((P0, sa) # xsa)) &#8744; i &gt; (length ((P0, sa) # xsa))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;(length ((P0, sa) # xsa))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Catch P0 P1, sa) # zs) ! i = map (lift_catch P1) ((P0, sa) # xsa) ! i&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>Cons_lift_catch_append</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>length_map</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ci si. map (lift_catch P1) ((P0, sa) # xsa) ! i = (Catch ci P1,si)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a5</span><span> </span><span>eq_map</span><span> </span><span>fst_conv</span><span> </span><span>length_map</span><span> </span><span>map_lift_catch_all_catch</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Catch P0 P1, sa) # zs) ! i &#8800; (Q, sj)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span>eq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span class="delimiter">=</span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&gt;(length ((P0, sa) # xsa))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (((LanguageCon.com.Catch P0 P1, sa) # zs) ! (length ?P0)) = Q&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>P_Q</span><span> </span><span>Cons_lift_catch_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fstI</span><span> </span><span>length_map</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P0, sa) # xsa) &#8712; cpn n &#915; P s&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; cpn n &#915; Q (snd (?P0 ! ((length ?P0) -1)))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>cptn_eq_cptn_mod</span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (Q, snd (last ((P0, sa) # xsa))) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Q, snd (last ((P0, sa) # xsa))) # ys) &#8712; {(f, ps). ps ! 0 = (Q, snd (((P0, sa) # xsa) ! (Suc (length xsa) - 1))) &#8743; 
              (n, &#915;, ps) &#8712; cptn_mod_nest_call &#8743; f = &#915;}&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn_eq_cptn_mod</span><span> </span><span>last_length</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P1, snd (last ((P0, sa) # xsa))) # ys) &#8712; {(f, ps). ps ! 0 = (Q, snd (((P0, sa) # xsa) ! (length ((P0, sa) # xsa) - 1))) &#8743; (n,&#915;, ps) &#8712; cptn_mod_nest_call &#8743; f = &#915;}&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>P_Q</span><span> </span><span>i</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_catch_append</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Catch_sound4</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x!0 = ((Catch P Q),s)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length x &#8743; x!i=(Q,sj)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;i. fst(x!j)&#8800;Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; x rely &quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys. (&#915;,xs) &#8712; (cpn n &#915; P s) &#8743; (&#915;,ys) &#8712; (cpn n &#915; Q (snd (xs!(i-1)))) &#8743; x = (map (lift_catch Q) xs)@ys&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span> </span><span>sj</span><span> </span><span>P</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>st</span><span> </span><span>t</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Catch P Q &#8800; Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>C_catch</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C=(Catch P Q)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(((C, st) # (C, t) # xsa)!0) &#8800;Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;fst(((C, st) # (C, t) # xsa)!1) &#8800;Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(((C, st) # (C, t) # xsa)!i) =Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_suc</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&gt; (Suc 0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_lessI</span><span> </span><span>add.left_neutral</span><span> </span><span>neq0_conv</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=Suc i&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>lessE</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_minus</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&#39;=i-1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((C, t) # xsa) ! 0 = ((Catch P Q), t)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#39;&lt; length ((C,t)#xsa) &#8743; ((C,t)#xsa)!i&#39; = (Q,sj)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i&#39;</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;i&#39;. fst (((C, t) # xsa) ! j) &#8800; Q&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i&#39;</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>hyp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;xs ys.
     (&#915;, xs) &#8712; cpn n &#915; P t &#8743;
     (&#915;, ys) &#8712; cpn n &#915; Q (snd (xs ! (i&#39;-1))) &#8743; (C, t) # xsa = map (lift_catch Q) xs @ ys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>env_tran_tail</span><span> </span><span>CptnModNestEnv.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, xs) &#8712; cpn n &#915; P t &#8743;
     (&#915;, ys) &#8712; cpn n &#915; Q (snd (xs ! (i&#39;-1))) &#8743; (C, t) # xsa = map (lift_catch Q) xs @ ys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P, s)#xs) &#8712; cpn n &#915; P s&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs!0 = (P,t)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>xs_cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_def</span><span> </span><span>CptnEmpty</span><span> </span><span>xs_cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>xs&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (P,t)#xs&#39;) &#8712; cptn_mod_nest_call &#8743; xs=(P,t)#xs&#39;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>xs_cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_def</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Catch P Q, s) = (C, st)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (P, s) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P, t)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Catch_env_P</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>cptn_mod_nest_call.CptnModNestEnv</span><span> </span><span>xs&#39;</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span>  </span><span class="var">?case</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_suc</span><span> </span><span>Cons_lift_catch_append</span><span> </span><span>CptnModNestEnv.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>i&#39;</span><span> </span><span>i_minus</span><span> </span><span>xs_cp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span> </span><span>&#915;</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>t</span><span> </span><span>n</span><span> </span><span>xs</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>CptnModNestSkip.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>CptnModNestSkip.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> 
</span><span>    </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>redex_not_Catch</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span> </span><span>&#915;</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>t</span><span> </span><span>n</span><span> </span><span>xs</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>CptnModNestThrow.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>CptnModNestThrow.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> 
</span><span>       </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>redex_not_Catch</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch1</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P0</span><span> </span><span>s</span><span> </span><span>xs</span><span> </span><span>zs</span><span> </span><span>P1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Catch_not_c</span><span> </span><span>Cons_lift_catch</span><span> </span><span>LanguageCon.com.inject</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> 
</span><span>            </span><span>fst_conv</span><span> </span><span>map_lift_catch_all_catch</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span>sa</span><span> </span><span>xsa</span><span>  </span><span>ys</span><span> </span><span>zs</span><span> </span><span>Q1</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P_Q</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;P=P1 &#8743; Q = Q1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Q1 = Skip&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>catch_map_xs_ys&#39;</span><span> 
</span><span>      </span><span>CptnModNestCatch2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>q_not_throw</span><span class="delimiter">=</span><span>this</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x. x&lt; length ((LanguageCon.com.Catch P1 Q1, sa) # zs) &#10230;
              ((LanguageCon.com.Catch P1 Q1,  sa) # zs) ! x &#8800; (Q, sj)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch2</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>x_less</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x&lt; length ((LanguageCon.com.Catch P1 Q1,  sa) # zs)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Catch P1 Q1,  sa) # zs) ! x &#8800; (Q, sj)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x &lt; length ((LanguageCon.com.Catch P1 Q1, sa)#map (lift_catch Q1) xsa)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Catch P1 Q1, sa) # zs) ! x = map (lift_catch Q1) ((P1, sa) # xsa) ! x&quot;</span></span></span><span>           
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Cons_lift_catch</span><span> </span><span>Cons_lift_catch_append</span><span> </span><span>CptnModNestCatch2</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span>True</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ci si. map (lift_catch Q1) ((P1, sa) # xsa) ! x = (Catch ci Q1,si)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_lift_catch</span><span> </span><span>True</span><span> </span><span>eq_map</span><span> </span><span>map_lift_catch_all_catch</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;((LanguageCon.com.Catch P1 Q1, sa) # zs) ! x &#8800; (Q, sj)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P_Q</span><span> </span><span>eq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>     
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch2</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?s&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ((P1, sa) # xsa))&quot;</span></span></span><span>        
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_throw</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((LanguageCon.com.Skip, ?s&#39;)# ys). 
              fst (((Skip, ?s&#39;)# ys)!i) = Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch2</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span>skip_all_skip</span><span class="delimiter">)</span><span>         
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;x&#8805; length ((LanguageCon.com.Catch P1 Q1,  sa) # map (lift_catch Q1) xsa). 
           x&lt;length (((LanguageCon.com.Catch P1 Q1, sa) # zs)) &#10230;
              fst (((LanguageCon.com.Catch P1 Q1, sa) # zs) ! x) = Skip&quot;</span></span></span><span>  
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>Cons_lift_catch</span><span> </span><span>Cons_lift_catch_append</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> 
</span><span>              </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> 
</span><span>              </span><span>cptn_mod_nest_call.CptnModNestCatch2</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span>  </span><span>skip_com_all_skip</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>x</span><span> 
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x&#8805; length ((Catch P1 Q1, sa) # map (lift_catch Q1) xsa)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x&lt;length (((Catch P1 Q1, sa) # zs))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((Catch P1 Q1, sa) # zs) ! x = 
                   ((Skip, ?s&#39;)# ys) !(x - (length ((Catch P1 Q1, sa) # map (lift_catch Q1) xsa)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch2</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_lift_catch</span><span> </span><span>Cons_lift_catch_append</span><span> </span><span>not_le</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span class="string"><span class="delete"><span class="delete">&quot;fst (((Catch P1 Q1, sa) # zs) ! x) = Skip&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_throw</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>CptnModNestCatch2.hyps</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>       
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span>  </span><span>q_not_throw</span><span> </span><span>P_Q</span><span> </span><span>x_less</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>not_le</span><span class="delimiter">)</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestCatch2</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestCatch3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>P1</span><span> </span><span>sa</span><span> </span><span>xsa</span><span>  </span><span>ys</span><span> </span><span>zs</span><span> </span><span>Q1</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>catch_map_xs_ys&#39;</span><span class="delimiter">[</span><span>OF</span><span> </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span>
</span><span>                                            </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>CptnModNestCatch3</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span class="delimiter">]</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>stepc_elim_cases_Catch_throw</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch c1 c2,s) &#8594; (Throw, Normal s1)&quot;</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>stepc_elim_cases_Catch_skip_c2</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch c1 c2,s) &#8594; (c2,s)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>stepc_elim_cases_Catch_skip_2</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch c1 c2,s) &#8594; (Skip, s)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>catch_skip_throw</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch c1 c2,s) &#8594; (c2,s)  &#10233; (c2= Skip &#8743; c1=Skip) &#8744; (c1=Throw &#8743; (&#8707;s2&#39;. s=Normal s2&#39;))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>stepc_elim_cases_Catch_skip_c2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>redex_not_Catch</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>catch_skip_throw1</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch c1 c2,s) &#8594; (Skip,s)  &#10233; (c1=Skip) &#8744; (c1=Throw &#8743; (&#8707;s2&#39;. s=Normal s2&#39;) &#8743; c2 = Skip)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>stepc_elim_cases_Catch_skip_2</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>redex_not_Catch</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>redex_not_Catch</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Catch_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p,  R, G, q,r] &#10233;
       &#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p,  R, G, q,r] &#10233;
       &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [r,  R, G, q,a] &#10233;
       &#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [r,  R, G, q,a] &#10233;        
       Sta q R  &#10233;  (&#8704;s. (Normal s,Normal s) &#8712; G) &#10233;
       &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Catch c1 c2) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,r]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,r]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [r, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [r, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>     
</span><span>    </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta q R &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span>       
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p, R, G, q,r]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c2 sat [r, R, G, q,a]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>com_cvalidityn_def</span><span> </span><span>all_call</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Catch c1 c2)  s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Catch c1 c2) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Catch c1 c2) s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Catch c1 c2),s) &#8743; (n,&#915;,l) &#8712; cptn_mod_nest_call &#8743; &#915;=&#915;1&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cpn_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Catch c1 c2),s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>         
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>         
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>       
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
                 (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i))  &#10230;              
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&#8743;
             (final (last l)  &#10230;                    
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. fst (l!i)&#8800; c2&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>no_c2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length l. fst (l!i)&#8800; c2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>assumption</span><span>
</span><span>         </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip &#8744; (fst (last l) = Throw &#8743; snd (last l) = Normal s&#39;)&quot;</span></span></span><span>  
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>           
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l)= LanguageCon.com.Throw &#8743; snd (last l) = Normal s&#39;&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>no_c2</span><span> </span><span>env_tran_right</span><span> </span><span>cp&#39;</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>Catch_sound3</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">next</span></span><span>             
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>asm0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip&quot;</span></span></span><span>             
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>lc1</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cp_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cpn n &#915; c1 s &#8743; l = ((map (lift_catch c2) lc1)@((Skip,snd(last lc1))#ys))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Catch_sound2</span><span> </span><span>cp</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>env_tran_right</span><span> </span><span>no_c2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_lc1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cp &#915; c1 s&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_if_cptn_mod</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?m_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift_catch c2) lc1&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?lm_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length ?m_lc1)&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?last_m_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?m_lc1!(?lm_lc1-1)&quot;</span></span></span><span>              
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;lc1 &#8800; []&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span>a10&#39;</span><span> </span><span>cpn_def</span><span> </span><span>cp_lc1</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cpn n &#915; (Catch c1 c2) s&quot;</span></span></span><span>               
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lc1 ! 0 = (c1, s) &#8743; (n, &#915;, lc1) &#8712; cptn_mod_nest_call &#8743; &#915; = &#915;&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, ?m_lc1) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc1_not_empty</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_lift_catch</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>cptn_mod_nest_call.CptnModNestCatch1</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cp&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cp &#915; (Catch c1 c2) s&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_def</span><span> </span><span>cp_lc1&#39;</span><span> </span><span>lift_catch_is_cptn</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; assum (p,R)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sub_assum</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span> </span><span>cp_lc1</span><span> </span><span>lc1_not_empty</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,lc1) &#8712; assum(p, R))&quot;</span></span></span><span>  
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span>assum_map_catch</span><span> </span><span>cp_lc1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                          
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; comm(G, (q,r)) F&quot;</span></span></span><span>  
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>com_validityn_def</span><span> </span><span>contra_subsetD</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>m_lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; comm(G, (q,r)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>map_cp</span><span> </span><span>map_assum</span><span> </span><span>comm_map_catch</span><span> </span><span>cp_lc1&#39;</span><span> </span><span>map_cp&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_m_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last (?m_lc1) = (Catch (fst (last lc1)) c2,snd (last lc1))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a000</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p c. (LanguageCon.com.Catch (fst p) c, snd p) = lift_catch c p&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_lift_catch</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_map</span><span> </span><span>a000</span><span> </span><span>lc1_not_empty</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last (?m_lc1) = ?last_m_lc1&quot;</span></span></span><span>  
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc1_not_empty</span><span> </span><span>last_conv_nth</span><span> </span><span>list.map_disc_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(?lm_lc1-1)= ?last_m_lc1&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lc1_not_empty</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lm_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(?lm_lc1) = (Skip, snd (last lc1))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(?lm_lc1-1)) &#8594; (l!(?lm_lc1))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(?lm_lc1-1)) &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(?lm_lc1))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &#8804; length ys&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (length (map (lift_catch c2) lc1) + length ys) = 
                      length (map (lift_catch c2) lc1 @ (LanguageCon.com.Skip, snd (last lc1)) # ys)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>cp&#39;</span><span> </span><span>cp_lc1</span><span> </span><span>cptn_tran_ce_i</span><span> 
</span><span>                              </span><span>lc1_not_empty</span><span> </span><span>le_add_same_cancel1</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>                    </span><span>less_Suc_eq_le</span><span> </span><span>list.map_disc_iff</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">qed</span></span><span>                              
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(?lm_lc1-1)) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(?lm_lc1))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_m_lc1</span><span> </span><span>last_length</span><span> </span><span>l_map</span><span>
</span><span>               </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.Catch (fst (last lc1)) c2, snd (last lc1)) = l ! (length (map (lift_catch c2) lc1) - 1)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_map</span><span> </span><span>last_m_lc1</span><span> </span><span>local.last_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>LanguageCon.com.simps</span><span class="delimiter">(</span><span>30</span><span class="delimiter">)</span><span> </span><span>env_c_c&#39;</span><span> </span><span>lm_lc1</span><span class="delimiter">)</span><span>                   
</span><span>               </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>        
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lc1_suc</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(?lm_lc1-1)) = snd (l!?lm_lc1)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_map</span><span>  </span><span>last_m_lc1</span><span> </span><span>lm_lc1</span><span> </span><span>local.last_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step_catch</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch (fst (last lc1)) c2,snd (last lc1)) &#8594; (Skip, snd (last lc1))&quot;</span></span></span><span>               
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_map</span><span> </span><span>last_m_lc1</span><span> </span><span>lm_lc1</span><span> </span><span>local.last_length</span><span> </span><span>local.step</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>               </span><span>last_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip  &#8744; 
               fst (last lc1) = Throw &#8743; (snd (last lc1) = Normal s2&#39;) &#8743; c2 = Skip&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>catch_skip_throw1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>              
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lc1_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = LanguageCon.com.Throw &#8743;
                        snd (last lc1) = Normal s2&#39; &#8743; c2 = LanguageCon.com.Skip&quot;</span></span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_c2</span><span> </span><span>asm0</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cp_lc1</span><span> </span><span>last_conv_nth</span><span> </span><span class="delimiter">)</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>  
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_not_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?m_lc1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd ?last_m_lc1 = snd (l!(?lm_lc1-1))&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?lm_lc1-1)&lt; length l&quot;</span></span></span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>               </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(?lm_lc1-1))&#8713; Fault ` F&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp&#39;</span><span> </span><span>cp_lc1</span><span>  </span><span>l_f</span><span>  </span><span>last_not_F</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>F</span><span class="delimiter">]</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>               </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_map</span><span> </span><span>last_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>q_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!?lm_lc1) &#8712; Normal ` q &quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last lc1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1</span><span> </span><span>final_def</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>              
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc1_comm</span><span> </span><span>last_lc1</span><span> </span><span>last_not_F</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_lc1_suc</span><span> </span><span>comm_dest2</span><span> </span><span>l_map</span><span> </span><span>lm_lc1</span><span> </span><span>local.last_length</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>                                             
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>normal_lm_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!?lm_lc1) = Normal s1&#39; &#8743; s1&#39; &#8712;q&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length l &#10230; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;              
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>             </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>               </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>   
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_m_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt;?lm_lc1  . l!i = ?m_lc1!i&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1 &#8800; []&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>lc1_not_empty</span><span> </span><span>list.map_disc_iff</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>cp_lc1</span><span>  </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>                                                         
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt; ?lm_lc1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a11&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?m_lc1!k)  &#8594; (?m_lc1!(Suc k))&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>i_m_l</span><span> </span><span>True</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n na. &#172; 0 &lt; n - Suc na &#8744; na &lt; n &quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>zero_less_diff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>True</span><span> </span><span>a21</span><span> </span><span>i_m_l</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>                 
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(?m_lc1!k), snd(?m_lc1!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11&#39;</span><span> </span><span>m_lc1_comm</span><span> </span><span>True</span><span> </span><span>comm_dest1</span><span> </span><span>l_f</span><span> </span><span>last_not_F</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_m_l</span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=?lm_lc1) &#8744; (Suc k&gt;?lm_lc1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>suck</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=?lm_lc1)&quot;</span></span></span><span>
</span><span>                     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k=?lm_lc1-1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s1&#39;_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!?lm_lc1) = Normal s1&#39;&quot;</span></span></span><span>
</span><span>                       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>q_normal</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G_s1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s1&#39;, Normal s1&#39;)&#8712; G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!k), snd (l!Suc k)) &#8712; G&quot;</span></span></span><span>
</span><span>                     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! k) = Normal s1&#39;&quot;</span></span></span><span>
</span><span>                         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k</span><span> </span><span>last_lc1_suc</span><span> </span><span>s1&#39;_normal</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>G_s1&#39;</span><span> </span><span>s1&#39;_normal</span><span> </span><span>suck</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">qed</span></span><span>                                   
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a001</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&gt;?lm_lc1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i&#8805;(length lc1) &#8743; (Suc i &lt; length l) &#10230; 
                            &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lm_lc1</span><span> </span><span>lc1_not_empty</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915;1 l R&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_map</span><span> </span><span>lm_lc1</span><span> </span><span>a001</span><span> </span><span>a21</span><span> </span><span>a00</span><span> </span><span>a4</span><span>
</span><span>                              </span><span>normal_lm_lc1</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>only_one_component_tran_j</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a001</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a21</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                    
</span><span>                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_t</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lm_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>asm0</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?lm_lc1 &#8804; length l -1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>               
</span><span>               </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. ?lm_lc1 &#8804;i &#8743; i&lt;(length l -1) &#10230;  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i))&quot;</span></span></span><span>        
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp&#39;</span><span> </span><span>fst_conv</span><span> </span><span>length_map</span><span> </span><span>lm_lc1</span><span> </span><span>a4</span><span>
</span><span>                      </span><span>normal_lm_lc1</span><span> </span><span>only_one_component_tran_j</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="var">?lm_lc1</span><span> </span><span>s1&#39;</span><span> </span><span>q</span><span> </span><span class="delimiter">]</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>env_tran_right</span><span> </span><span>less_diff_conv</span><span>  </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>                                                                       
</span><span>               </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! (length l - 1)) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>q_normal</span><span> </span><span>a4</span><span> </span><span>env_tran_right</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>q</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span class="var">?lm_lc1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l) -1&quot;</span></span></span><span> </span><span>_</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>               
</span><span>               </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_t</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>  </span><span>cp_lc1</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>&#915;1</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span>                  
</span><span>         </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>lc1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cp_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cpn n &#915; c1 s &#8743; l = map (lift_catch c2) lc1&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Catch_sound1</span><span> </span><span>False</span><span> </span><span>no_c2</span><span> </span><span>env_tran_right</span><span> </span><span>cp</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_lc1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; cp &#915; c1 s&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,lc1) &#8712; assum(p, R))&quot;</span></span></span><span>  
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span>  </span><span>a10&#39;</span><span> </span><span>a11</span><span> </span><span>assum_map_catch</span><span> </span><span>cp_lc1</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, lc1)&#8712; comm(G, (q,r)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>a1</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>com_validityn_def</span><span> </span><span>contra_subsetD</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l)&#8712; comm(G, (q,r)) F&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_map_catch</span><span> </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span> </span><span>cp_lc1</span><span> </span><span>cp_lc1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_f</span><span> </span><span>False</span><span>
</span><span>             </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">next</span></span><span>         
</span><span>         </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&lt;length l &#8743; fst (l ! k) = c2&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. (m &lt; length l &#8743; fst (l ! m) = c2) &#8743;
                   (&#8704;i&lt;m. &#172; (i &lt; length l &#8743; fst (l ! i) = c2))&quot;</span></span></span><span>   
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#955;i. i&lt;length l  &#8743; fst (l ! i) = c2)&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length l &#8743; fst (l !i) = c2 &#8743;
                                (&#8704;j&lt;i. (fst (l ! j) &#8800; c2))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>        
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>li</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!i =(c2,s2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>eq_fst_iff</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>lc1</span><span> </span><span>lc2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>cp_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; (cpn n &#915; c1 s) &#8743; 
                                 (&#915;,lc2) &#8712; (cpn n &#915; c2 (snd (lc1!(i-1)))) &#8743; 
                                 l = (map (lift_catch c2) lc1)@lc2&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Catch_sound4</span><span> </span><span>a0</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>       
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_lc1&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; (cp &#915; c1 s) &#8743; 
                            (&#915;,lc2) &#8712; (cp &#915; c2 (snd (lc1!(i-1))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_not_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!i) &#8713; Fault ` F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>cp&#39;</span><span> </span><span>l_f</span><span> </span><span>last_not_F</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>F</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_c1_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length lc1 = length (map (lift_catch c2) lc1)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i=length lc1&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>li</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_catch_def</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, lc1) &#8712; cpn n &#915; c1 s &#8743; (&#915;, lc2) &#8712; cpn n &#915; c2 (snd (lc1 ! (i - 1))) &#8743; l = map (&#955;(P, s). (Catch P c2, s)) lc1 @ lc2&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length l &#8743; fst (l ! i) = c2 &#8743; (&#8704;n. &#172; n &lt; i &#8744; fst (l ! n) &#8800; c2)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Catch (fst (lc1 ! i)) c2, snd (lc1 ! i)) = lift_catch c2 (lc1 ! i)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_unfold</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l ! length lc1) = c2&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f3</span><span> </span><span>f2</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Pair_inject</span><span> </span><span>a0</span><span> </span><span>cp_lc1</span><span> </span><span>f3</span><span> 
</span><span>                   </span><span>length_c1_map</span><span> </span><span>li</span><span> </span><span>linorder_neqE_nat</span><span> </span><span>nth_append</span><span> </span><span>nth_map</span><span> </span><span>seq_and_if_not_eq</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>                  
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;length lc2. lc2!j=l!(i+j)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>length_c1_map</span><span> </span><span>i_map</span><span> </span><span>a0</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_append_length_plus</span><span class="delimiter">)</span><span>                                                             
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;lc1 &#8800; []&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;lc2 &#8800; []&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_lc1</span><span> </span><span>a0</span><span> </span><span>i_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>              
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_is</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2= snd (last lc1)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>li</span><span> </span><span>a0</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>i_map</span><span> </span><span>last_conv_nth</span><span> </span><span>lc2_l</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?m_lc1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift_catch c2) lc1&quot;</span></span></span><span>
</span><span>         </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* let ?lm_lc1 = &quot;(length ?m_lc1)&quot;
         let ?last_m_lc1 = &quot;?m_lc1!(?lm_lc1-1)&quot; *)</span></span></span></span></span><span>                         
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_m_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!(i-1) = (Catch (fst (last lc1)) c2,s2)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_map</span><span>  </span><span>cp_lc1</span><span> </span><span>l_is</span><span> </span><span>last_lift_catch</span><span> </span><span>last_snd_catch</span><span> </span><span>lc1_not_empty</span><span> </span><span>length_c1_map</span><span>           
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>diff_Suc_less</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>nth_append</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_mcl1_not_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?m_lc1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>i_not_fault</span><span> </span><span>l_is</span><span> </span><span>last_conv_nth</span><span> </span><span>last_snd_catch</span><span> </span><span>li</span><span> </span><span>list.map_disc_iff</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>                                  
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cpn n &#915; (Catch c1 c2) s&quot;</span></span></span><span>               
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lc1 ! 0 = (c1, s) &#8743; (n,&#915;, lc1) &#8712; cptn_mod_nest_call &#8743; &#915; = &#915;&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, ?m_lc1) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc1_not_empty</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_lift_catch</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>cptn_mod_nest_call.CptnModNestCatch1</span><span class="delimiter">)</span><span>                           
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpn_def</span><span> </span><span>lift_catch_def</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_cp&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; cp &#915; (Catch c1 c2) s&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>map_assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; assum (p,R)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sub_assum</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span> </span><span>cp_lc1</span><span> </span><span>lc1_not_empty</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>map_is_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;,lc1) &#8712; assum(p, R))&quot;</span></span></span><span>  
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span>assum_map_catch</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>cp_lc1</span><span> </span><span>cp_lc1&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>                          
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc1) &#8712; comm(G, (q,r)) F&quot;</span></span></span><span>  
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>com_validityn_def</span><span> </span><span>contra_subsetD</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>m_lc1_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,?m_lc1) &#8712; comm(G, (q,r)) F&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>map_cp&#39;</span><span> </span><span>map_assum</span><span> </span><span>comm_map_catch</span><span> </span><span>cp_lc1</span><span> </span><span>cp_lc1&#39;</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i-1)) &#8594; (l!i)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i-1)) &#8594;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>e</sub> (l!(i))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_pred&#39;</span><span> </span><span>a0</span><span> </span><span>cp&#39;</span><span> </span><span>cptn_tran_ce_i</span><span> </span><span>i_map</span><span> 
</span><span>                  </span><span>lc1_not_empty</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i-1)) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!i)&quot;</span></span></span><span>           
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>last_m_lc1</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>env_c_c&#39;</span><span> </span><span>seq_and_if_not_eq</span><span class="delimiter">(</span><span>12</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_ce_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>         
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(Catch (fst (last lc1)) c2,s2) &#8594; (c2, s2)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_m_lc1</span><span>  </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>           </span><span>last_lc1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(fst (last lc1) = Skip &#8743; c2 = Skip) &#8744; 
            fst (last lc1) = Throw &#8743; (s2 = Normal s2&#39;)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>catch_skip_throw</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>    
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last lc1)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1</span><span> </span><span>l_is</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>normal_last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip &#8743; snd (last lc1) &#8712; Normal ` q &#8744;
                        fst (last lc1) = Throw &#8743; snd (last lc1) &#8712; Normal ` r&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>         
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc1) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_not_fault</span><span> </span><span>l_is</span><span> </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final</span><span> </span><span>comm_dest2</span><span> </span><span>lc1_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>lastlc1_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc1) = Normal s2&#39;&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Normals2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 = Normal s2&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>l_is</span><span class="delimiter">)</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Gs2&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; (Normal s2&#39;, Normal s2&#39;)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>              
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span>
</span><span>           </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
           &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                              
             (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>           </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>            </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>   
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_m_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j &lt;i . l!j = ?m_lc1!j&quot;</span></span></span><span>             
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;map (lift c2) lc1 &#8800; []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>lc1_not_empty</span><span> </span><span>list.map_disc_iff</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>i_map</span><span> </span><span>length_c1_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>simp</span><span class="delimiter">:</span><span>nth_append</span><span class="delimiter">)</span><span>              
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt; i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a11&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(?m_lc1!k)  &#8594; (?m_lc1!(Suc k))&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>i_m_l</span><span> </span><span>True</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n na. &#172; 0 &lt; n - Suc na &#8744; na &lt; n &quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>zero_less_diff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>a21</span><span> </span><span>i_m_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>                  
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>                                                             
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length ?m_lc1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>i_map</span><span> </span><span>length_c1_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(?m_lc1!k), snd(?m_lc1!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11&#39;</span><span> </span><span>last_mcl1_not_F</span><span> </span><span>m_lc1_comm</span><span> </span><span>True</span><span> </span><span>i_map</span><span> </span><span>length_c1_map</span><span> </span><span>comm_dest1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_m_l</span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>                                            
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=i) &#8744; (Suc k&gt;i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>suck</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Suc k=i)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k=i-1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                                                            
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!k), snd (l!Suc k)) &#8712; G&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Gs2&#39;</span><span> </span><span>Normals2</span><span> </span><span>last_m_lc1</span><span> </span><span>li</span><span> </span><span>suck</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>               
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a001</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&gt;i&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>k&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;k=i+k&#39;&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>add.commute</span><span> </span><span>le_Suc_ex</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c2=Skip&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k&#8805;i &#8743; (Suc k &lt; length l) &#10230; 
                            &#172;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k)))&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Normals2</span><span> </span><span>li</span><span> </span><span>lastlc1_normal</span><span> </span><span>a21</span><span> </span><span>a001</span><span> </span><span>a00</span><span> </span><span>a4</span><span>
</span><span>                        </span><span>a0</span><span> </span><span>skip</span><span> </span><span>env_tran_right</span><span> </span><span>cp&#39;</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span> </span><span>Suc_lessD</span><span> </span><span>skip_com_all_skip</span><span class="delimiter">)</span><span>                                      
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a21</span><span> </span><span>a001</span><span> </span><span>k</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span class="delimiter">=</span><span>this</span><span>
</span><span>                </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c2&#8800;Skip&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Throw&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_m_lc1</span><span> </span><span>last_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>                                     
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 &#8712; Normal ` r&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> </span><span>lastlc1_normal</span><span> </span><span>Normals2</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l=i+length lc2&quot;</span></span></span><span> 
</span><span>                       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_map</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  assum (r,R)&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (lc2!0) &#8712; Normal ` r&quot;</span></span></span><span> 
</span><span>                     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>lc2_l</span><span> </span><span>s2_normal</span><span> </span><span>lc2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                     </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>                     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>j_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt;length lc2&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                            </span><span>j_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(lc2!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (lc2!(Suc j))&quot;</span></span></span><span>                     
</span><span>                     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i + j)&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_len</span><span> </span><span>length_lc2</span><span>
</span><span>                       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i+j))  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l! (Suc (i+ j)))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>j_step</span><span> </span><span>j_len</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(lc2!j), snd(lc2!(Suc j))) &#8712; R&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>suc_len</span><span> </span><span>lc2_l</span><span> </span><span>j_len</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> 
</span><span>                     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712; cpn n &#915; c2 s2&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>i_map</span><span> </span><span>l_is</span><span> </span><span>last_conv_nth</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  comm (G, (q,a)) F&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_last_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc2)&#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>lc2_not_empty</span><span> </span><span>l_f</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suck&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&#39; &lt; length lc2&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k&#39;</span><span> </span><span>a00</span><span> </span><span>length_lc2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>arith</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(lc2!k&#39;)  &#8594; (lc2!(Suc k&#39;))&quot;</span></span></span><span>  
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k&#39;</span><span> </span><span>lc2_l</span><span> </span><span>a21</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (lc2! k&#39;), snd (lc2 ! Suc k&#39;)) &#8712; G&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_lc2</span><span>  </span><span>lc2_last_f</span><span> </span><span>comm_dest1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>lc2</span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>k&#39;</span><span class="delimiter">]</span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>suck&#39;</span><span> </span><span>lc2_l</span><span> </span><span>k&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">}</span></span><span>                    
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                 
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span class="delimiter">=</span><span>this</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>right</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                    
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>final_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_last_lc2_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l=last lc2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cp_lc1</span><span> </span><span>lc2_not_empty</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last lc2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>lst_lc1_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Skip&quot;</span></span></span><span>                        
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c2 = Skip&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>step</span><span> </span><span>lastlc1_normal</span><span> </span><span>LanguageCon.com.distinct</span><span class="delimiter">(</span><span>17</span><span class="delimiter">)</span><span> </span><span>last_lc1</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                            
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>Skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!(length l - 1)) = Skip&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>Normals2</span><span>  </span><span>env_tran_right</span><span> </span><span>cp&#39;</span><span> </span><span>c2_skip</span><span> </span><span>a0</span><span>
</span><span>                     </span><span>i_skip_all_skip</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l) - 1&quot;</span></span></span><span> </span><span>_</span><span class="delimiter">]</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                       
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lst_lc1_skip</span><span> </span><span>l_is</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ia. i &#8804; ia &#8743; ia &lt; length l - 1 &#10230; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! ia &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l ! Suc ia&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c2_skip</span><span> </span><span>li</span><span> </span><span>Normals2</span><span> </span><span>a0</span><span> </span><span>cp&#39;</span><span> </span><span>env_tran_right</span><span>  </span><span>final_def</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span> 
</span><span>                   </span><span>Suc_lessD</span><span> </span><span>add.right_neutral</span><span> </span><span>add_Suc_right</span><span> 
</span><span>                   </span><span>cptn_tran_ce_i</span><span> </span><span>i_skip_all_skip</span><span> </span><span>less_diff_conv</span><span> </span><span>step_ce_elim_cases</span><span class="delimiter">)</span><span>                           
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!(length l - 1)) &#8712; Normal ` q &#8743; fst (l!(length l - 1)) = Skip&quot;</span></span></span><span>               
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>s2_a</span><span> </span><span>li</span><span> </span><span>a4</span><span> </span><span>env_tran_right</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>q</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>i</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l) -1&quot;</span></span></span><span> </span><span>_</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>Skip</span><span>                
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_pred</span><span> </span><span>length_greater_0_conv</span><span> </span><span>lessI</span><span> </span><span>linorder_not_less</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> 
</span><span>                   </span><span>not_less0</span><span> </span><span>not_less_eq_eq</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>last_conv_nth</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less0</span><span class="delimiter">)</span><span>                           
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last lc1) = Throw&quot;</span></span></span><span>                 
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s2_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s2 &#8712; Normal ` r&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>normal_last</span><span> </span><span>lastlc1_normal</span><span> </span><span>Normals2</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l=i+length lc2&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_map</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  assum (r,R)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (lc2!0) &#8712; Normal ` r&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>lc2_l</span><span> </span><span>s2_normal</span><span> </span><span>lc2_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                 </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>                 </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>j_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt;length lc2&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                        </span><span>j_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(lc2!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (lc2!(Suc j))&quot;</span></span></span><span>
</span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i + j)&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_len</span><span> </span><span>length_lc2</span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!(i+j))  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l! (Suc (i+ j)))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>j_step</span><span> </span><span>j_len</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(lc2!j), snd(lc2!(Suc j))) &#8712; R&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum</span><span> </span><span>suc_len</span><span> </span><span>lc2_l</span><span> </span><span>j_len</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712; cpn n &#915; c2 s2&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_lc1</span><span> </span><span>i_map</span><span> </span><span>l_is</span><span> </span><span>last_conv_nth</span><span> </span><span>lc1_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_lc2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,lc2) &#8712;  comm (G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lc2_last_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last lc2)&#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lc2_l</span><span> </span><span>lc2_not_empty</span><span> </span><span>l_f</span><span> </span><span>cp_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>             
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last lc2) = Skip &#8743; 
                    snd (last lc2) &#8712; Normal ` q)) &#8744;
                    (fst (last lc2) = Throw &#8743; 
                    snd (last lc2) &#8712; Normal ` (a))&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_lc2</span><span> </span><span>comm_lc2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_last_lc2_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_lc1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>         
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left</span><span> </span><span>l_f</span><span> </span><span>&#915;1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>             
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span> </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>DynCom_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s &#8712; p. ((&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (c1 s) sat [p, R, G, q,a]) &#8743; 
                 (&#8704;n. (&#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (c1 s) sat [p,R, G, q,a])))) &#10233;
        (&#8704;s. (Normal s, Normal s) &#8712; G) &#10233;
       (Sta p R) &#8743; (Sta q R) &#8743; (Sta a R) &#10233;        
        &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (DynCom c1) sat [p,  R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s &#8712; p. ((&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (c1 s) sat [p, R, G, q,a]) &#8743; 
                 (&#8704;n. (&#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (c1 s) sat [p, R, G, q,a]))))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s, Normal s) &#8712; G&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>  
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Sta p R) &#8743; (Sta q R) &#8743; (Sta a R)&quot;</span></span></span><span>               
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_DynCom</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>     
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s &#8712; p. (&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (c1 s) sat [p, R, G, q,a]))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915;(DynCom c1) s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (DynCom c1) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (DynCom c1) s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>       
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(DynCom c1,s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10&#39;</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
                   (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ns</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s=Normal ns &#8743; ns&#8712; p&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>assum</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>       
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
               &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;             
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                                     
</span><span>         </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                             
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj = (DynCom c1) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>a2</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span>  </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a0</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>snd_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                     
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span class="delimiter">)</span><span>   
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>                                  
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s&#39;, Normal s&#39;)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712;  G&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span> </span><span>k_basic</span><span> </span><span>True</span><span> </span><span>ss</span><span> </span><span>ssj_normal_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>         </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>   
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>before_k_all_evnt</span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                      
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;p &#8743; ssj=Normal s&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>ssj_normal_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1_valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (c1 s&#39;) sat [p, R, G, q,a])&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj= (c1 s&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span> </span><span>s_normal</span><span>
</span><span>             </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (LanguageCon.com.DynCom c1, Normal s&#39;) &#8594; (csj, ssj)&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(csj, ssj) = (c1 s&#39;, Normal s&#39;)&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">qed</span></span><span>                                                       
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span>p1</span><span> </span><span>c1_valid</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>             
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>p1</span><span> </span><span>j_length</span><span>  </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>                     
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cpn_assum_induct</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                        
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span>  </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span>  </span><span>j_k</span><span> </span><span>j_length</span><span> </span><span>l_f</span><span>
</span><span>             </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;DynCom c1&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>k</span><span> </span><span class="delimiter">]</span><span>
</span><span>             </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                         
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>            
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c_prod</span><span> </span><span>cp</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                   
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>                       
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a1</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172;final(l!0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = DynCom c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>cp</span><span> </span><span>final_exist_component_tran_final</span><span> </span><span>env_tran_right</span><span> </span><span>final_0</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj = (DynCom c1) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>assum</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a0</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>snd_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c1 s&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>10</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>contra_subsetD</span><span> </span><span>cpn_assum_induct</span><span class="delimiter">)</span><span>               
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>       
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_length</span><span> </span><span>l_f</span><span> </span><span>drop_comm</span><span> </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span> </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;DynCom c1&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>valid</span><span>  
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span class="keyword1"><span class="command">}</span></span><span>               
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Guard_sound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a] &#10233;
   (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a]) &#10233;   
   Sta (p &#8745; g) R &#10233; (&#8704;s. (Normal s, Normal s) &#8712; G) &#10233;
    &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Guard f g c1) sat [p &#8745; g, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [(p &#8745; g) , R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>        
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta (p &#8745; g) R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s, Normal s) &#8712; G&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Guard f g c1)  s &#8745; assum(p &#8745; g, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Guard f g c1) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p &#8745; g, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Guard f g c1) s&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>       
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Guard f g c1),s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10&#39;</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p &#8745; g) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
                   (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; (p &#8745; g) l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length l &#10230; 
               &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                                            
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                                                        
</span><span>         </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                             
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj =(Guard f g c1) &#8743; sj &#8712; Normal ` (p &#8745; g)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;p &#8745; g&quot;</span></span></span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p &#8745; g)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a0</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span>  </span><span>IntD2</span><span> </span><span>prod.inject</span><span class="delimiter">)</span><span>                                
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span class="delimiter">)</span><span>   
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>                                  
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; (Normal s&#39;, Normal s&#39;)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712;  G&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span> </span><span>k_basic</span><span> </span><span>True</span><span> </span><span>ss</span><span> </span><span>ssj_normal_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>         </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>   
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>before_k_all_evnt</span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                      
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712;  G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>IntD2</span><span> </span><span>fst_conv</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                             
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; (p &#8745; g)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum(p &#8745; g, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span>
</span><span>                     </span><span>cpn_assum_induct</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                         
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span>  </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span>  </span><span>j_k</span><span> </span><span>j_length</span><span> </span><span>l_f</span><span>
</span><span>             </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Guard f g c1)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>k</span><span> </span><span class="delimiter">]</span><span>
</span><span>             </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                         
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>            
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c_prod</span><span> </span><span>cp</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                   
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>                       
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a1</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172;final(l!0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = (Guard f g c1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span> </span><span>final_exist_component_tran_final</span><span> </span><span>env_tran_right</span><span> </span><span>final_0</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj = (Guard f g c1) &#8743; sj &#8712; Normal ` (p &#8745; g)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;p &#8745; g&quot;</span></span></span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p &#8745; g)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a1</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>IntD2</span><span> </span><span>Pair_inject</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>               
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>IntD2</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                              
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; (p &#8745; g)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum((p &#8745; g), R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span> </span><span>cpn_assum_induct</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>       
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_length</span><span> </span><span>l_f</span><span> </span><span>drop_comm</span><span> </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span> </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Guard f g c1)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>valid</span><span>  
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span class="keyword1"><span class="command">}</span></span><span>               
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Guarantee_sound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [(p &#8745; g),  R, G, q,a] &#10233;
   &#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a] &#10233;  
   Sta p R &#10233; 
   f&#8712;F &#10233;
   (&#8704;s. (Normal s, Normal s) &#8712; G) &#10233; 
   &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Guard f g c1) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>      
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s. (Normal s, Normal s) &#8712; G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;f&#8712;F&quot;</span></span></span><span>    
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; g, R, G, q,a]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (Guard f g c1)  s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>   
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (Guard f g c1) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp &#915; (Guard f g c1) s&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (q,a)) F&quot;</span></span></span><span>      
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>       
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((Guard f g c1),s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10&#39;</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd(l!0) &#8712; Normal ` (p) &#8743; (&#8704;i. Suc i&lt;length l &#10230; 
                 (&#915;1)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#10230;                 
                   (snd(l!i), snd(l!(Suc i))) &#8712; R)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;env_tran &#915; p l R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran_def</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>env_tran_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;env_tran_right &#915; l R&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>env_tran</span><span> </span><span>env_tran_right_def</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>env_tran_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>                     
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i ns ns&#39;. Suc i&lt;length l &#10230; 
               &#915;1&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                 
                 (snd(l!i), snd(l!(Suc i))) &#8712; G)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                </span><span>a21</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))&quot;</span></span></span><span>                                         
</span><span>         </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                                               
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj =(Guard f g c1) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>          
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>or</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712; (g &#8746; (-g))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; g&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj =(Guard f g c1) &#8743; sj &#8712; Normal ` (p &#8745; g)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712;  (p &#8745; g)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a0</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>IntD2</span><span> </span><span>prod.inject</span><span class="delimiter">)</span><span>                                
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k=j&quot;</span></span></span><span class="delimiter">)</span><span>   
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>                                  
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s&#39;, Normal s&#39;) &#8712; G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712;  G&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span> </span><span>k_basic</span><span> </span><span>True</span><span> </span><span>ss</span><span> </span><span>ssj_normal_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>         </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>   
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_k</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>before_k_all_evnt</span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                      
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! k), snd (l ! Suc k)) &#8712;  G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>IntD2</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                             
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; (p &#8745; g)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum((p &#8745; g), R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span> </span><span>cpn_assum_induct</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                     
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>a00</span><span> </span><span>a21</span><span>  </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span>  </span><span>j_k</span><span> </span><span>j_length</span><span> </span><span>l_f</span><span>
</span><span>               </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Guard f g c1)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span>k</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Satis_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                         
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>            
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>p1</span><span class="delimiter">=</span><span>this</span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* assume &quot;s&#39; &#8712; (Collect (not (set_fun g)))&quot;
          then have &quot;s&#39;&#8713;g&quot; by fastforce *)</span></span></span></span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8713;g&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>csj_skip</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj= Skip &#8743; ssj=Fault f&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>ss</span><span> </span><span>pair_j</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Pair_inject</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) = Fault f&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = k&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length l&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; SmallStepCon.final (l ! k)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.no_step_final&#39;</span><span> </span><span>a21</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; Suc j &#8804; k&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span>SmallStepCon.final_def</span><span> </span><span>cp</span><span> </span><span>csj_skip</span><span> </span><span>i_skip_all_skip</span><span> </span><span>pair_j</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leI</span><span> </span><span>before_k_all_evnt</span><span> </span><span>le_eq_less_or_eq</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span> </span><span>csj_skip</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a00</span><span> </span><span>a4</span><span> </span><span>cp</span><span> </span><span>image_eqI</span><span> </span><span>l_f</span><span> </span><span>last_not_F</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l_f</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>          
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!k), snd(l!(Suc k))) &#8712; G&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>or</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c_prod</span><span> </span><span>cp</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>concr</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(final (last l)  &#10230;                   
                   ((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>valid</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span>                       
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>             
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length l &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span>l1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l=a1#l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>length_greater_0_conv</span><span class="delimiter">)</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!(length l-1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_length</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>a1</span><span> </span><span>l1</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172;final(l!0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&#8804; (length l-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l-1) &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (l!(length l-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>valid</span><span> </span><span>last_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!0) = (Guard f g c1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cp</span><span> </span><span>final_exist_component_tran_final</span><span> </span><span>env_tran_right</span><span> </span><span>final_0</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8805;0 &#8743; k&lt;((length l) - 1) &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594; (l!(Suc k))) &#8743; final (l!(Suc k))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc k&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>before_k_all_evnt</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&#8804;k &#8743;  (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; (&#8704;k &lt; j. (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(l!k)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc k))))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a21</span><span> </span><span>exist_first_comp_tran</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cj</span><span> </span><span>sj</span><span> </span><span>csj</span><span> </span><span>ssj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>pair_j</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(cj,sj)  &#8594; (csj,ssj)) &#8743; cj = fst (l!j) &#8743; sj = snd (l!j) &#8743; csj = fst (l!(Suc j)) &#8743; ssj = snd(l!(Suc j))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst (last l) = Skip &#8743; 
                    snd (last l) &#8712; Normal ` q)) &#8744;
                    (fst (last l) = Throw &#8743; 
                    snd (last l) &#8712; Normal ` (a))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>before_k_all_evnt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj =(Guard f g c1) &#8743; sj &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>pair_j</span><span> </span><span>before_k_all_evnt</span><span> </span><span>cp</span><span> </span><span>env_tran_right</span><span> </span><span>a2</span><span> </span><span>assum</span><span> </span><span>a00</span><span> </span><span>stability</span><span class="delimiter">[</span><span>of</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>l</span><span> </span><span>0</span><span> </span><span>j</span><span> </span><span>j</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>or</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712; (g &#8746; (-g))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39; &#8712; g&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>k_basic</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cj =(Guard f g c1) &#8743; sj &#8712; Normal ` (p &#8745; g)&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span>k_basic</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ss</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sj = Normal s&#39; &#8743; s&#39;&#8712; (p &#8745; g)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ssj_normal_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ssj = Normal s&#39;&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>a1</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Pair_inject</span><span> </span><span>IntD2</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>               
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;csj=c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>pair_j</span><span> </span><span>ss</span><span> </span><span>a0</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>IntD2</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>                              
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8712;(p &#8745; g)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ss</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; csj ssj &#8745; assum((p &#8745; g), R)  &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_validityn_def</span><span> </span><span>cj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>             </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!(Suc j) = (csj, Normal s&#39;)&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>before_k_all_evnt</span><span> </span><span>pair_j</span><span> </span><span>cj</span><span> </span><span>ssj_normal_s</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>drop_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;((&#915;, drop (Suc j) l))&#8712; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>j_length</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span>  </span><span>ssj_normal_s</span><span> </span><span>cpn_assum_induct</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span>       
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_length</span><span> </span><span>l_f</span><span> </span><span>drop_comm</span><span> </span><span>a10&#39;</span><span> </span><span>&#915;1</span><span> 
</span><span>                     </span><span>cptn_comm_induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Guard f g c1)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>F</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>valid</span><span>  
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>           </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span class="delimiter">=</span><span>this</span><span>        
</span><span>           </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* assume &quot;s&#39; &#8712; (Collect (not (set_fun g)))&quot;
            then have &quot;s&#39;&#8713;g&quot; by fastforce *)</span></span></span></span></span><span>
</span><span>             </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s&#39;&#8713;g&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;csj= Skip &#8743; ssj=Fault f&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>k_basic</span><span> </span><span>ss</span><span> </span><span>pair_j</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Pair_inject</span><span> </span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) = Fault f&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pair_j</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a4</span><span> </span><span>cp</span><span> </span><span>imageI</span><span> </span><span>j_length</span><span> </span><span>l_f</span><span> </span><span>last_not_F</span><span class="delimiter">)</span><span>            
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>l_f</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>           
</span><span>           </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>           </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>or</span><span> </span><span>left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>concl</span><span> </span><span>concr</span><span class="delimiter">]</span><span class="keyword1"><span class="command">}</span></span><span>               
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>WhileNone</span><span class="delimiter">:</span><span>   
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (While b c1, s1) &#8594; (LanguageCon.com.Skip, t1) &#10233;   
    (n,&#915;, (Skip, t1) # xsa) &#8712; cptn_mod_nest_call &#10233;  
    &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b,R, G, p,a] &#10233;
    Sta p R &#10233;
    Sta (p &#8745; (-b)) R &#10233;
    Sta a R &#10233;
    (&#8704;s. (Normal s, Normal s) &#8712; G) &#10233;            
    (&#915;, (While b c1, s1) # (LanguageCon.com.Skip, t1) # xsa) &#8712; assum (p, R) &#10233;    
    (&#915;, (While b c1, s1) # (LanguageCon.com.Skip, t1) # xsa) &#8712; comm (G,(p &#8745; (-b)),a) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (While b c1, s1) &#8594; (LanguageCon.com.Skip, t1)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (Skip, t1) # xsa) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b,R, G, p,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta (p &#8745; (-b)) R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s, Normal s) &#8712; G&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a7</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c1, s1) # (LanguageCon.com.Skip, t1) # xsa) &#8712; assum (p, R)&quot;</span></span></span><span>         
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s1N</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1=Normal s1&#39; &#8743; s1&#39;&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_t1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1&#39;&#8713; b &#8743; t1=s1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>LanguageCon.com.distinct</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span>prod.inject</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>elim</span><span class="delimiter">:</span><span>stepc_Normal_elim_cases</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>t1_Normal_post</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;t1&#8712; Normal ` (p &#8745; (-b))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s1N</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c1, s1) # (LanguageCon.com.Skip, t1) # xsa)&#8712;cptn&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a0</span><span> </span><span>cptn.simps</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum_skip</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(LanguageCon.com.Skip, t1) # xsa) &#8712; assum (( p &#8745; (-b)), R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a7</span><span> </span><span>tl_of_assum_in_assum1</span><span> </span><span>t1_Normal_post</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>skip_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(LanguageCon.com.Skip, t1) # xsa) &#8712; 
               comm (G,(( p &#8745; (-b)),a)) F&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#920;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p , R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Skip sat [( p &#8745; (-b)), R, G, ( p &#8745; (-b)),a]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Skip_sound</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(p &#8745; - b)&quot;</span></span></span><span class="delimiter">]</span><span>  </span><span>a4</span><span> </span><span>a6</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_skip</span><span>  </span><span>a1</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span>com_validityn_def</span><span> </span><span>cpn_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G_ref</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s1&#39;, Normal s1&#39;)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>skip_comm</span><span> </span><span>ctran_in_comm</span><span class="delimiter">[</span><span>of</span><span> </span><span>s1&#39;</span><span class="delimiter">]</span><span> </span><span>s1N</span><span> </span><span>s1_t1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>while1</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, ((c, Normal s1) # xs1)) &#8712; cptn_mod_nest_call &#10233;    
    s1 &#8712; b &#10233;
    xsa = map (lift (While b c)) xs1 &#10233;
    &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b,R, G, p,a] &#10233;    
    (&#915;, (While b c, Normal s1) #
        (Seq c (LanguageCon.com.While b c), Normal s1) # xsa)
       &#8712; assum (p, R)  &#10233;               
    &#8704;s. (Normal s, Normal s) &#8712; G &#10233; 
     (&#915;, (LanguageCon.com.While b c, Normal s1) #
         (LanguageCon.com.Seq c (LanguageCon.com.While b c), Normal s1) # xsa)
    &#8712; comm (G, p&#8745;(-b), a) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword3"><span class="command">assume</span></span><span>   
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, ((c, Normal s1) # xs1)) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1 &#8712; b&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xsa = map (lift (While b c)) xs1&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b,R, G, p,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) #
        (Seq c (While b c), Normal s1) # xsa)
       &#8712; assum (p, R) &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>  
</span><span>  </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s,Normal s) &#8712; G&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>seq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Seq c (While b c), Normal s1) # xsa=
           map (lift (While b c)) ((c,Normal s1)#xs1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(While b c,Normal s1) &#8594; (Seq c (While b c),Normal s1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span>
</span><span>    </span><span>WhileTruec</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1 &#8712; p &#8743; s1 &#8712; b &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G_ref</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s1, Normal s1) &#8712; G&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_collect_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Normal s1&#8712; Normal ` (p &#8745; b)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s1_normal</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, map (lift (While b c)) ((c,Normal s1)#xs1))&#8712;cptn&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span>lift_is_cptn</span><span> </span><span>a0</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Seq c (While b c), Normal s1) # xsa) &#8712;cptn&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) # (Seq c (While b c), Normal s1) # xsa) &#8712; cptn&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn.CptnComp</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Seq c (While b c), Normal s1) # xsa)&#8712;assum (p, R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>tl_of_assum_in_assum1</span><span> </span><span>s1_collect_p</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; (cpn n &#915; c (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_c&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; (cp &#915; c (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Seq c (While b c), Normal s1) # xsa) &#8712; (cp &#915; (Seq c (While b c)) (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_seq</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; assum(p,R)&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>assum_seq</span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; assum((p &#8745; b),R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s1_collect_p</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>cp_c</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Seq c (While b c), Normal s1) # xsa) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_seq</span><span> </span><span>cp_c&#39;</span><span> </span><span>comm_map</span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) # (Seq c (While b c), Normal s1) # xsa) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>G_ref</span><span> </span><span>ctran_in_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; final (last ((While b c, Normal s1) # (Seq c (While b c), Normal s1) # xsa))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span>lift_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_beta&#39;</span><span> </span><span>last_map</span><span class="delimiter">)</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_final_in_comm</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>while2</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot; (n,&#915;, (While b c, Normal s1) #
         (Seq c (While b c), Normal s1) # xsa) &#8712;cptn_mod_nest_call &#10233;
    (n, &#915;, (c, Normal s1) # xs1) &#8712; cptn_mod_nest_call &#10233;
    fst (last ((c, Normal s1) # xs1)) = LanguageCon.com.Skip &#10233;
    s1 &#8712; b &#10233;
    xsa = map (lift (While b c)) xs1 @
    (While b c, snd (last ((c, Normal s1) # xs1))) # ys &#10233;
    (n, &#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys)
      &#8712; cptn_mod_nest_call &#10233;
     (&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b, R, G, p,a] &#10233;    
       (&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys)
         &#8712; assum (p, R) &#10233;
       (&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys)
          &#8712; comm (G, p &#8745; (-b), a) F) &#10233;
    &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [ p &#8745; b, R, G, p,a] &#10233;
    (&#915;, (While b c, Normal s1) #
      (Seq c (While b c), Normal s1) # xsa)
      &#8712; assum (p, R)  &#10233;
     &#8704;s. (Normal s,Normal s) &#8712; G  &#10233;     
    (&#915;, (While b c, Normal s1) #
         (Seq c (While b c), Normal s1) # xsa)
      &#8712; comm (G,( p &#8745; (-b), a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (While b c, Normal s1) #
         (Seq c (While b c), Normal s1) # xsa) &#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (c, Normal s1) # xs1) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot; fst (last ((c, Normal s1) # xs1)) = LanguageCon.com.Skip&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1 &#8712; b&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xsa = map (lift (While b c)) xs1 @
            (While b c, snd (last ((c, Normal s1) # xs1))) # ys&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys)
            &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b, R, G, p,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>       
</span><span>       </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) #
               (Seq c (While b c), Normal s1) # xsa)
             &#8712; assum (p, R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a7</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b, R, G, p,a] &#10233;    
           (&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys)
             &#8712; assum (p, R) &#10233;
           (&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys)
             &#8712; comm (G,p &#8745; (-b), a) F)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a8</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s, Normal s) &#8712; G&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l</span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(While b c, Normal s1) #
           (Seq c (While b c), Normal s1) # xsa&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?sub_l</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;((While b c, Normal s1) # 
                 (Seq c (While b c), Normal s1) # 
                 map (lift (While b c)) xs1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>final_not_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (c, Normal s1) # xs1) &#8712; cptn&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys) &#8712; cptn&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>seq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Seq c (While b c), Normal s1) # map (lift (While b c)) xs1=
           map (lift (While b c)) ((c,Normal s1)#xs1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(While b c,Normal s1) &#8594; (Seq c (While b c),Normal s1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span>
</span><span>    </span><span>WhileTruec</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1&#8712;p &#8743; s1 &#8712; b &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G_ref</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s1, Normal s1)&#8712;G &quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_collect_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Normal s1&#8712; Normal ` (p &#8745; b)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s1_normal</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, map (lift (While b c)) ((c,Normal s1)#xs1))&#8712;cptn&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>cptn_eq_cptn_mod</span><span> </span><span>lift_is_cptn</span><span> </span><span>a0&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712;cptn&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) # 
                 (Seq c (While b c), Normal s1) # 
                  map (lift (While b c)) xs1) &#8712; cptn&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cptn.CptnComp</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) #
                 (Seq c (While b c), Normal s1) #
                  map (lift (While b c)) xs1)
          &#8712; assum (p, R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>a3</span><span> </span><span>sub_assum</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Seq c (While b c), Normal s1)  # 
                       map (lift (While b c)) xs1) &#8712; assum (p, R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>tl_of_assum_in_assum1</span><span> </span><span>s1_collect_p</span><span> 
</span><span>          </span><span>tl_of_assum_in_assum</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cpn_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; (cpn n &#915; c (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; (cp &#915; c (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0&#39;</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712; (cp &#915; (Seq c (While b c)) (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_seq</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; assum(p,R) &quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>assum_seq</span><span> </span><span>seq_map</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; assum((p &#8745; b),R) &quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s1_collect_p</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>cpn_c</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_seq</span><span> </span><span>cp_c</span><span> </span><span>comm_map</span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_while</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) # 
                            (Seq c (While b c), Normal s1) # 
                            map (lift (While b c)) xs1) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>G_ref</span><span> </span><span>ctran_in_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_last_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last ((c,Normal s1)#xs1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_while1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (map (lift (While b c)) ((c,Normal s1)#xs1))) = snd (last ((c, Normal s1) # xs1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_beta&#39;</span><span> </span><span>last_map</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_while2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(last (map (lift (While b c)) ((c,Normal s1)#xs1))) =
           last ((While b c, Normal s1) # (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>not_fault_final_last_c</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ( (c,Normal s1)#xs1)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length ?sub_l) - 1 &lt; length ?l&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (?l!((length ?sub_l) - 1))&#8713; Fault ` F&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_not_fault</span><span> </span><span>a3</span><span> </span><span>a00</span><span> </span><span>last_not_F</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="var">?l</span><span> </span><span>F</span><span class="delimiter">]</span><span>
</span><span>           </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_while2</span><span> </span><span>last_while1</span><span> </span><span>seq_map</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>Cons_lift_append</span><span>  </span><span>a3</span><span> </span><span>diff_Suc_1</span><span> </span><span>last_length</span><span> </span><span>length_Cons</span><span> </span><span>lessI</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_c_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ( (c,Normal s1)#xs1)) &#8712; Normal ` (p)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_comm</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>sl</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>sl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ( (c,Normal s1)#xs1)) = Normal sl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>while_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys) &#8712; comm(G,(p&#8745;(-b),a)) F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum_while</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, snd (last ((c, Normal s1) # xs1))) # ys)
             &#8712; assum (p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_c_normal</span><span> </span><span>a3</span><span> </span><span>a6</span><span> </span><span>sub_assum_r</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="var">?sub_l</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(While b c, snd (last ((c, Normal s1) # xs1)))&quot;</span></span></span><span>  </span><span>ys</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>p</span><span class="delimiter">]</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sl&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_c_normal</span><span> </span><span>sl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G1_ref</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal sl, Normal sl)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ?sub_l) = Normal sl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_while1</span><span> </span><span>last_while2</span><span> </span><span>sl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span>a00</span><span> </span><span>a3</span><span> </span><span>sl</span><span> </span><span>while_comm</span><span> </span><span>comm_union</span><span class="delimiter">[</span><span>OF</span><span> </span><span>comm_while</span><span class="delimiter">]</span><span>  
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>p1</span><span> </span><span class="delimiter">=</span><span>this</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>final_not_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (snd (last ?l) &#8713; Fault ` F)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>while3</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, (c, Normal s1) # xs1) &#8712; cptn_mod_nest_call &#10233;    
    fst (last ((c, Normal s1) # xs1)) = Throw &#10233;
    s1 &#8712; b &#10233;
    snd (last ((c, Normal s1) # xs1)) = Normal sl &#10233;
    (n,&#915;, (Throw, Normal sl) # ys) &#8712; cptn_mod_nest_call   &#10233;
    &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b,R, G, p,a] &#10233;    
    (&#915;, (While b c, Normal s1) #
         (Seq c (While b c), Normal s1) #  
         (map (lift (While b c)) xs1 @
           (Throw, Normal sl) # ys))
       &#8712; assum (p, R)  &#10233;        
     Sta p R &#10233;
     Sta a R &#10233; &#8704;s. (Normal s, Normal s) &#8712; G &#10233; 
    (&#915;, (While b c, Normal s1) #
         (Seq c (While b c), Normal s1) #          
         ((map (lift (While b c)) xs1 @
           (Throw, Normal sl) # ys))) &#8712; comm (G, p&#8745; (-b), a) F
&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (c, Normal s1) # xs1) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last ((c, Normal s1) # xs1)) = Throw&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1 &#8712; b&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ((c, Normal s1) # xs1)) = Normal sl&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (Throw, Normal sl) # ys) &#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p &#8745; b, R, G, p,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) #
           (Seq c (While b c), Normal s1) #  
           (map (lift (While b c)) xs1 @
             (Throw, Normal sl) # ys))
           &#8712; assum (p, R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>      
</span><span>       </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>       
</span><span>       </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s,Normal s) &#8712; G&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>seq_map</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Seq c (While b c), Normal s1) # map (lift (While b c)) xs1=
           map (lift (While b c)) ((c,Normal s1)#xs1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(While b c,Normal s1) &#8594; (Seq c (While b c),Normal s1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span>
</span><span>    </span><span>WhileTruec</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1&#8712;p &#8743; s1 &#8712; b &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G_ref</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal s1, Normal s1)&#8712;G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1_collect_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Normal s1&#8712; Normal ` (p &#8745; b)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s1_normal</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n, &#915;, map (lift (While b c)) ((c,Normal s1)#xs1))&#8712;cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span>  </span><span>lift_is_cptn</span><span> </span><span>a0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cptn_mod_nest_call.CptnModNestSeq1</span><span> </span><span>seq_map</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,(Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712;cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (While b c, Normal s1) # 
                 (Seq c (While b c), Normal s1) # 
                  map (lift (While b c)) xs1) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>cptn_mod_nest_call.CptnModNestWhile1</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (LanguageCon.com.While b c, Normal s1) #
         (LanguageCon.com.Seq c (LanguageCon.com.While b c), Normal s1) #
         map (lift (LanguageCon.com.While b c)) xs1)
          &#8712; assum (p, R) &quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>sub_assum</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Seq c (While b c), Normal s1)  # 
                       map (lift (While b c)) xs1) &#8712; assum (p, R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>tl_of_assum_in_assum1</span><span> </span><span>s1_collect_p</span><span> 
</span><span>          </span><span>tl_of_assum_in_assum</span><span> </span><span>cptn_eq_cptn_mod_nest</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cpn_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; (cpn n &#915; c (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; (cp &#915; c (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_seq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712; (cpn n &#915; (Seq c (While b c)) (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_seq</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp_seq&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712; (cp &#915; (Seq c (While b c)) (Normal s1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; assum(p,R)&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assum_map</span><span> </span><span>assum_seq</span><span> </span><span>seq_map</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; assum((p &#8745; b),R)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s1_collect_p</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((c, Normal s1) # xs1)) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>cpn_c</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp_seq&#39;</span><span> </span><span>cp_c</span><span> </span><span>comm_map</span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm_while</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) # (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1) &#8712; comm(G,(p,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>G_ref</span><span> </span><span>ctran_in_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>final_last_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;final (last ((c,Normal s1)#xs1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>not_fault_final_last_c</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ( (c,Normal s1)#xs1)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sl_a</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Normal sl &#8712; Normal ` (a)&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>final_last_c</span><span> </span><span>a1</span><span> </span><span>c_comm</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a3</span><span> </span><span>comm_dest2</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_while1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (map (lift (While b c)) ((c,Normal s1)#xs1))) = snd (last ((c, Normal s1) # xs1))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>lift_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_beta&#39;</span><span> </span><span>last_map</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_while2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(last (map (lift (While b c)) ((c,Normal s1)#xs1))) =
           last ((While b c, Normal s1) # (Seq c (While b c), Normal s1) # map (lift (While b c)) xs1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>seq_map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>throw_comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Throw, Normal sl) # ys) &#8712; comm(G,(p&#8745;(-b),a)) F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>assum_throw</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (Throw, Normal sl) # ys) &#8712; assum (a,R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sl_a</span><span> </span><span>a6</span><span> </span><span>sub_assum_r</span><span class="delimiter">[</span><span>of</span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.While b c, Normal s1) #
         (LanguageCon.com.Seq c (LanguageCon.com.While b c), Normal s1) #
         map (lift (LanguageCon.com.While b c)) xs1&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Throw, Normal sl)&quot;</span></span></span><span> </span><span class="delimiter">]</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(Throw, Normal sl) # ys) &#8712; cpn n &#915; Throw (Normal sl)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Throw_sound</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>a10</span><span> </span><span>a8</span><span>   
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(LanguageCon.com.While b c, Normal s1) #
    (LanguageCon.com.Seq c (LanguageCon.com.While b c), Normal s1) #
    map (lift (LanguageCon.com.While b c)) xs1 &#8800;
    [] &#8743;
    (LanguageCon.com.Throw, Normal sl) # ys &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sl &#8712; a&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sl_a</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G1_ref</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(Normal sl, Normal sl) &#8712; G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last ((While b c, Normal s1) # 
                  (Seq c (While b c), Normal s1) # 
                  map (lift (While b c)) xs1)) = Normal sl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_while1</span><span> </span><span>last_while2</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (((LanguageCon.com.Throw, Normal sl) # ys) ! 0) = Normal sl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_Cons_0</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>G</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd (last ((While b c, Normal s1) # 
                  (Seq c (While b c), Normal s1) # 
                  map (lift (While b c)) xs1)),
                  snd (((LanguageCon.com.Throw, Normal sl) # ys) ! 0)) &#8712; G&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, ((LanguageCon.com.While b c, Normal s1) #
          (LanguageCon.com.Seq c (LanguageCon.com.While b c), Normal s1) #
          map (lift (LanguageCon.com.While b c)) xs1) @
         (LanguageCon.com.Throw, Normal sl) # ys)
    &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn</span><span> </span><span>a4</span><span>  </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod.CptnModWhile3</span><span> </span><span>s1_normal</span><span> 
</span><span>             </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_Cons</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>  </span><span>comm_union</span><span class="delimiter">[</span><span>OF</span><span> </span><span>comm_while</span><span> </span><span>throw_comm</span><span> </span><span>p1</span><span> </span><span>G</span><span> </span><span>cptn</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>       
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>stepc_elim_cases_while_throw</span><span> </span><span class="delimiter">[</span><span>cases</span><span> </span><span>set</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(While b c, s) &#8594; (Throw, t)&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>WhileSound_aux</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, p,a] &#10233;
  Sta p R &#10233;
  Sta  (p &#8745; (-b)) R &#10233; 
  Sta a R &#10233;    
  (n, &#915;,x)&#8712; cptn_mod_nest_call &#10233; 
  &#8704;s. (Normal s, Normal s) &#8712; G &#10233;
  &#8704;s xs. x = ((While b c1),s)#xs &#10230; 
     (&#915;,x)&#8712;assum(p,R) &#10230; 
     (&#915;,x) &#8712; comm (G,(( p &#8745; (-b)),a)) F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, p,a] &quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta  (p &#8745; (-b)) R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,x)&#8712; cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s, Normal s) &#8712; G&quot;</span></span></span><span> 
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>xs</span><span> </span><span>s</span><span> 
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>while_xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;x=((While b c1),s)#xs&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>x_assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x)&#8712;assum(p,R)&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,x) &#8712; comm (G,(( p &#8745; (-b)),a)) F&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>a0</span><span>  </span><span>while_xs</span><span> </span><span>x_assum</span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>xs</span><span> </span><span>s</span><span> </span><span>c1</span><span> </span><span>rule</span><span class="delimiter">:</span><span>cptn_mod_nest_call.induct</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestOne</span><span>  </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModOne</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestEnv</span><span>  </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_while</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;C = While b c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (C, t1) # xsa) &#8712; assum (p, R) &#10230;
                (&#915;, (C, t1) # xsa) &#8712; comm (G, p &#8745; (-b), a) F&quot;</span></span></span><span>  
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,(C, s1)#(C, t1) # xsa) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>2</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>CptnModNestEnv.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_mod_nest_call.CptnModNestEnv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span>cptn_mod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(C, s1)#(C, t1) # xsa) &#8712; cptn&quot;</span></span></span><span>    
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (C, t1) # xsa) &#8712; assum (p, R)&quot;</span></span></span><span>   
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tl_of_assum_in_assum</span><span> </span><span>CptnModNestEnv</span><span class="delimiter">(</span><span>6</span><span class="delimiter">)</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (C, t1) # xsa) &#8712; comm (G, p &#8745; (-b), a) F&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#172; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((C,s1))  &#8594; ((C,t1)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>mod_env_not_component</span><span class="delimiter">)</span><span>      
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_mod</span><span> </span><span>etran_in_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestSkip</span><span> </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C=While b c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (LanguageCon.com.Skip, t1) # xsa) &#8712; cptn_mod_nest_call&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>CptnModNestSkip</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>WhileNone</span><span> </span><span>CptnModNestSkip</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestThrow</span><span>  </span><span>&#915;</span><span> </span><span>C</span><span> </span><span>s1</span><span> </span><span>t1</span><span> </span><span>n</span><span> </span><span>xsa</span><span class="delimiter">)</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C = While b c1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stepc_elim_cases_while_throw</span><span> </span><span>CptnModNestThrow</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestWhile1</span><span>  </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>s1</span><span> </span><span>xs1</span><span> </span><span>b1</span><span> </span><span>xsa</span><span> </span><span>zs</span><span class="delimiter">)</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;b=b1 &#8743; c=c1 &#8743; s=Normal s1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>      
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>CptnModNestWhile1</span><span> </span><span>while1</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestWhile2</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>s1</span><span> </span><span>xs1</span><span> </span><span>b1</span><span> </span><span>xsa</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;, (While b c, Normal s1) #
         (Seq c (While b c), Normal s1) # xsa)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_mod_nest_call.CptnModNestWhile2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>   
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eqs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;b=b1 &#8743; c=c1 &#8743; s=Normal s1&quot;</span></span></span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnModNestWhile2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>a00</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>CptnModNestWhile2</span><span> </span><span>while2</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>b</span><span> </span><span>c</span><span> </span><span>s1</span><span> </span><span>xsa</span><span> </span><span>xs1</span><span> </span><span>ys</span><span> </span><span>F</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>a</span><span class="delimiter">]</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>        
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptnModNestWhile3</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>s1</span><span> </span><span>xs1</span><span> </span><span>b1</span><span> </span><span>sl</span><span> </span><span>ys</span><span> </span><span>zs</span><span class="delimiter">)</span><span>  
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eqs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;b=b1 &#8743; c=c1 &#8743; s=Normal s1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (While b c, Normal s1) #
         (Seq c (While b c), Normal s1) #          
         ((map (lift (While b c)) xs1 @
           (Throw, Normal sl) # ys))) &#8712; comm (G, p&#8745;(-b), a) F&quot;</span></span></span><span>        
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>CptnModNestWhile3</span><span> </span><span>while3</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>s1</span><span> </span><span>xs1</span><span> </span><span>b</span><span> </span><span>sl</span><span> </span><span>ys</span><span> </span><span>F</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>a</span><span class="delimiter">]</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eqs</span><span> </span><span>CptnModNestWhile3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>While_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, p,a] &#10233;
       (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, p,a]) &#10233;       
       Sta p R &#10233;     
       Sta (p &#8745; (-b)) R &#10233; Sta a R &#10233; &#8704;s. (Normal s, Normal s) &#8712; G  &#10233;
       &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (While b c1) sat [p, R, G, p &#8745; (-b),a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span>
</span><span>    </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, p,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. &#915;,&#920; &#8872;n <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, p,a]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>    
</span><span>    </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta p R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta (p &#8745; (-b)) R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Sta a R&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (Normal s, Normal s) &#8712; G&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>  
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c1 sat [p &#8745; b, R, G, p,a])&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>com_cvalidityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; (While b c1)  s &#8745; assum(p, R) &#8838; comm(G, (p &#8745; (-b),a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>     
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; (While b c1) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cp  &#915; (While b c1) s&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_eq_cptn_mod_set</span><span> </span><span>cptn_mod_nest_cptn_mod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=((While b c1),s) &#8743; (&#915;,l) &#8712; cptn &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10&#39;</span><span> </span><span>cp_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l=((While b c1),s)#xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;xs. l = (LanguageCon.com.While b c1, s) # xs &#10233; thesis&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[] &#8800; l&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>cp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n,&#915;,l)&#8712;cptn_mod_nest_call&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>&#915;1</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (p &#8745; (-b),a)) F&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span>   </span><span>WhileSound_aux</span><span> </span><span>a11</span><span> </span><span>&#915;1</span><span> </span><span>a5</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Conseq_sound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s&#8712; p.
       &#8707;p&#39; R&#39; G&#39; q&#39; a&#39; I&#39; &#920;&#39;.
          s &#8712; p&#39; &#8743;
          R &#8838; R&#39; &#8743;            
          G&#39; &#8838; G &#8743;             
          q&#39; &#8838; q &#8743;
          a&#39; &#8838; a &#8743; &#920;&#39; &#8838; &#920; &#8743;
          &#915;,&#920;&#39; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;,R&#39;, G&#39;, q&#39;,a&#39;] &#8743; 
          (&#8704;n. &#915;,&#920;&#39; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;])) &#10233;
  &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q,a]&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;s&#8712; p.
       &#8707;p&#39; R&#39; G&#39; q&#39; a&#39; I&#39; &#920;&#39;.
          s &#8712; p&#39; &#8743;
          R &#8838; R&#39; &#8743;            
          G&#39; &#8838; G &#8743;             
          q&#39; &#8838; q &#8743;
          a&#39; &#8838; a &#8743; &#920;&#39; &#8838; &#920; &#8743;
          &#915;,&#920;&#39; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;,R&#39;, G&#39;, q&#39;,a&#39;] &#8743; 
          (&#8704;n. &#915;,&#920;&#39; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;]))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; P  s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; P s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cp &#915; P s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span>cpn_def</span><span> </span><span>cptn_eq_cptn_mod_nest</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c=(&#915;1,l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(P,s) &#8743; (n,&#915;,l) &#8712; cptn_mod_nest_call &#8743; &#915;=&#915;1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>cpn_def</span><span> </span><span>c_prod</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, l) = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l=(P,s)#xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;xs. l = (P, s) # xs &#10233; thesis&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[] &#8800; l&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cp</span><span> </span><span>cptn.simps</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEmpty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>SmallStepCon.nth_tl</span><span> </span><span>cp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ns</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(s = Normal ns)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ns &#8712; p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>cpn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ns</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ns&#8712;p&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. s &#8712; p &#10230; (&#8707;p&#39; R&#39; G&#39; q&#39; a&#39; &#920;&#39;. (s&#8712;p&#39;) &#8743;
        R &#8838; R&#39; &#8743;            
        G&#39; &#8838; G &#8743;             
        q&#39; &#8838; q &#8743;
        a&#39; &#8838; a &#8743; &#920;&#39; &#8838; &#920; &#8743;
        (&#915;,&#920;&#39; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;,R&#39;, G&#39;, q&#39;,a&#39;]) &#8743; 
        (&#8704;n. &#915;,&#920;&#39; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;ns &#8712; p &#10230; (&#8707;p&#39; R&#39; G&#39; q&#39; a&#39; &#920;&#39;. (ns &#8712; p&#39; ) &#8743;
        R &#8838; R&#39; &#8743;            
        G&#39; &#8838; G &#8743;             
        q&#39; &#8838; q &#8743;
        a&#39; &#8838; a &#8743; &#920;&#39; &#8838; &#920; &#8743;
        (&#915;,&#920;&#39; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;,R&#39;, G&#39;, q&#39;,a&#39;]) &#8743; 
        (&#8704;n. &#915;,&#920;&#39; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>allE</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>     
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>p&#39;</span><span> </span><span>R&#39;</span><span> </span><span>G&#39;</span><span> </span><span>q&#39;</span><span> </span><span>a&#39;</span><span> </span><span>&#920;&#39;</span><span>   </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>     </span><span>rels</span><span class="delimiter">:</span><span>
</span><span>       </span><span class="string"><span class="delete"><span class="delete">&quot;ns &#8712; p&#39; &#8743;
        R &#8838; R&#39; &#8743;            
        G&#39; &#8838; G &#8743;             
        q&#39; &#8838; q &#8743;
        a&#39; &#8838; a &#8743; &#920;&#39; &#8838; &#920; &#8743;       
        (&#8704;n. &#915;,&#920;&#39; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ns</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s &#8712;  Normal ` p&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; assum(p&#39;, R&#39;)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>rels</span><span> </span><span>cp</span><span> </span><span>a11</span><span> </span><span>c_prod</span><span> </span><span>assum_R_R&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>p&#39;</span><span> </span><span>R&#39;</span><span class="delimiter">]</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G&#39;,(q&#39;,a&#39;)) F&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rels</span><span> </span><span>all_call</span><span> </span><span>a10</span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span>com_validityn_def</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span>comm_conseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>l</span><span> </span><span>G&#39;</span><span> </span><span>q&#39;</span><span> </span><span>a&#39;</span><span> </span><span>F</span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span>rels</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c_prod</span><span> </span><span>cp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>                 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Conj_post_sound</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q,a] &#8743; 
   (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a]) &#10233; 
   &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q&#39;,a&#39;] &#8743; 
   (&#8704;n. &#915;,&#920; &#8872;n <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q&#39;,a&#39;]) &#10233;
  &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q &#8745; q&#39; ,a &#8745; a&#39;]&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q,a] &#8743; 
   (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>       </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q&#39;,a&#39;] &#8743; 
   (&#8704;n. &#915;,&#920; &#8872;n <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q&#39;,a&#39;])&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; P  s &#8745; assum(p, R) &#8838; comm(G, (q,a)) F&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>all_call</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; P  s &#8745; assum(p, R) &#8838; comm(G, (q&#39;,a&#39;)) F&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; P  s &#8745; assum(p, R) &#8838; comm(G, (q&#8745;q&#39;,a&#8745;a&#39;)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; P s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; comm(G,(q,a)) F &#8743; c &#8712; comm(G,(q&#39;,a&#39;)) F&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (q&#8745;q&#39;,a&#8745;a&#39;)) F&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>               
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>x91</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sa&#8800;{} &#10233; c&#8712;comm(G, (&#8898;i&#8712;sa. q i,a)) F  = (&#8704;i&#8712;sa. c&#8712;comm(G, q i,a) F)&quot;</span></span></span><span>    
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Ball_def</span><span class="delimiter">)</span><span> 
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>frule</span><span> </span><span>spec</span><span> </span><span class="delimiter">,</span><span>  </span><span>force</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>frule</span><span> </span><span>spec</span><span class="delimiter">,</span><span>  </span><span>force</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conj_inter_sound</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;sa &#8800; {} &#10233; 
 &#8704;i&#8712;sa. &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q i,a] &#8743; (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q i,a]) &#10233; 
 &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, &#8898;i&#8712;sa. q i,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sa&#8800;{}&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&#8712;sa. &#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q i,a] &#8743; 
              (&#8704;n. &#915;,&#920; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p,R, G, q i,a])&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>all_call</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;n<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&#8712;sa. cpn n &#915; P  s &#8745; assum(p, R) &#8838; comm(G, (q i,a)) F&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidityn_def</span><span> </span><span>com_validityn_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpn n &#915; P  s &#8745; assum(p, R) &#8838; comm(G, (&#8898;i&#8712;sa. q i,a)) F&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpn n &#915; P s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assum(p, R)&quot;</span></span></span><span>        
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i&#8712;sa. c&#8712;comm(G, q i,a) F)&quot;</span></span></span><span>        
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;comm(G, (&#8898;i&#8712;sa. q i,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>x91</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0&#39;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>               
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_validityn_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span>com_cvalidityn_def</span><span class="delimiter">)</span><span>  
</span><span class="keyword1"><span class="command">qed</span></span><span>     
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>localRG_sound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, R, G, q,a] &#10233; (&#8896;n. &#915;,&#920; &#8872;n <span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, R, G, q,a])&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span>lrghoare.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Skip</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Skip_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Spec</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Spec_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Basic</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Basic_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Await</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Await_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Throw</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Throw_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>If</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>If_sound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>If_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Asm</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Asm_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>CallRec</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>CallRec_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Call</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Call_sound</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Call_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Seq</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Seq_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Catch</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Catch_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>DynCom</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>DynCom_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Guard</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Guard_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Guarantee</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Guarantee_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>While</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>While_sound</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Conseq</span><span> </span><span>p</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>&#915;</span><span> </span><span>&#920;</span><span> </span><span>F</span><span> </span><span>P</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Conseq_sound</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Conj_post</span><span> </span><span>&#915;</span><span> </span><span>&#920;</span><span> </span><span>F</span><span> </span><span>P</span><span> </span><span>p&#39;</span><span> </span><span>R&#39;</span><span> </span><span>G&#39;</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>q&#39;</span><span> </span><span>a&#39;</span><span class="delimiter">)</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Conj_post_sound</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>&#920;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Conj_Inter</span><span> </span><span>sa</span><span> </span><span>&#915;</span><span> </span><span>&#920;</span><span> </span><span>F</span><span> </span><span>P</span><span> </span><span>p&#39;</span><span> </span><span>R&#39;</span><span> </span><span>G&#39;</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conj_inter_sound</span><span class="delimiter">[</span><span>of</span><span> </span><span>sa</span><span> </span><span>&#915;</span><span> </span><span>&#920;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>ParallelCom</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) rgformula list &#8658; (&#39;s,&#39;p,&#39;f,&#39;e) par_com&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;ParallelCom Ps &#8801; map fst Ps&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ParallelCom_Com</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length xs &#10233; (ParallelCom xs)!i = Com (xs!i)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>ParallelCom_def</span><span> </span><span>Com_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>etran_ctran_eq_p_normal_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> s1  &#8594; s1&#39; &#10233;
             &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> s1  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> s1&#39; &#10233;
            fst s1 = fst s1&#39; &#8743; snd s1 = snd s1&#39; &#8743; (&#8707;ns1. snd s1 = Normal ns1)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> s1  &#8594; s1&#39;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> s1  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> s1&#39;&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ps1</span><span> </span><span>ss1</span><span> </span><span>ps1&#39;</span><span> </span><span>ss1&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>prod</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;s1 = (ps1,ss1) &#8743; s1&#39; = (ps1&#39;, ss1&#39;)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ps1=ps1&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>etranE</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod</span><span>  </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>mod_env_not_component</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>step_e_step_c_eq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; 
  (&#915;,l) &#8733; clist;
  Suc m &lt; length l;
  i &lt; length clist; 
  (fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!m) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc m);          
  (fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!m) &#8594;  ((snd (clist!i))!Suc m);
  (&#8704;l&lt;length clist. 
     l&#8800;i &#10230;  (fst (clist!l))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc m)))
  &#10215; &#10233; 
  l!m = l!(Suc m) &#8743; (&#8707;ns. snd (l!m) = Normal ns )&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8733; clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!m) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc m)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!m) &#8594;  ((snd (clist!i))!Suc m)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;l&lt;length clist. 
                 l&#8800;i &#10230; (fst (clist!l))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc m)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>fp</span><span> </span><span>fs</span><span> </span><span>sp</span><span> </span><span>ss</span><span> 
</span><span>    </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>prod_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (fp, fs) &#8594; (sp,ss) &#8743; 
              fp = fst (((snd (clist!i))!m)) &#8743; fs = snd (((snd (clist!i))!m)) &#8743; 
              sp = fst ((snd (clist!i))!(Suc m)) &#8743; ss = snd((snd (clist!i))!(Suc m)) &#8743;
              &#915; = fst (clist!i)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a1</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_lj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!m)) = snd ((snd (clist!i))!m)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_clist_&#915;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. fst(clist!i) = &#915;&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_env</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l&lt;length clist. 
                    (fst (clist!l))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc m))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>a5</span><span> </span><span>a2</span><span> </span><span>fst_clist_&#915;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>allP</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l&lt; length clist. fst ((snd (clist!l))!m) = fst ((snd (clist!l))!(Suc m))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>elim</span><span class="delimiter">:</span><span>etranE</span><span class="delimiter">)</span><span>         
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!m) = (fst (l!(Suc m)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>conjoin_same_program_i_j</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_l_normal</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!m) = snd (l!(Suc m)) &#8743; (&#8707;ns. snd (l!m) = Normal ns )&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>                        
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!Suc m)) = snd ((snd (clist!i))!(Suc m))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fs = ss &#8743; 
               (&#8707;ns.  (snd ((snd (clist!i))!m) = Normal ns ))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span>  </span><span>all_env</span><span> </span><span>prod_step</span><span> </span><span>allP</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>step_change_p_or_eq_s</span><span class="delimiter">)</span><span>       
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>snd_lj</span><span> </span><span>prod_step</span><span> </span><span>a1</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_eq_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>      
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>two&#39;</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; &#8704;i&lt;length xs. R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838; (Rely (xs ! i));
   p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i)));
   &#8704;i&lt;length xs.
    &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)];
   length xs=length clist; (&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s; (&#915;,l)&#8712;par_assum (p, R) ;
  &#8704;i&lt;length clist. clist!i&#8712;cp &#915; (Com(xs!i)) s; (&#915;,l) &#8733; clist;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]);
  snd (last l) &#8713; Fault ` F&#10215;
  &#10233; &#8704;j i ns ns&#39;. i&lt;length clist &#8743; Suc j&lt;length l &#10230; 
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc j) &#10230; 
      (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Rely(xs!i)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs. R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838; (Rely (xs ! i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.
    &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length xs=length clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;par_assum (p, R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. clist!i&#8712;cp &#915; (Com(xs!i)) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8733; clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i j ns ns&#39;. 
              i&lt;length clist &#8743; Suc j&lt;length l &#8743; 
              &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc j) &#8743; 
              &#172;(snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Rely(xs!i)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>    </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i ns ns&#39;. 
       i&lt;length clist &#8743; Suc j&lt;length l &#8743; 
       &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc j) &#8743;
       &#172;(snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Rely(xs!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?P</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;j. &#8707;i. i&lt;length clist &#8743; Suc j&lt;length l &#8743;
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc j) &#8743;       
      (&#172; (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Rely(xs!i))&quot;</span></span></span><span>        
</span><span>   </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>fist_occ</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(?P m) &#8743; (&#8704;i&lt;m. &#172; ?P i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?P</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?P m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>      </span><span>fst_occ</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length clist &#8743; Suc m&lt;length l &#8743;
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!m) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc m) &#8743;       
      (&#172; (snd((snd (clist!i))!m), snd((snd (clist!i))!Suc m)) &#8712; Rely(xs!i))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>notP</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i&lt;m. &#172; ?P i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fist_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_clist_&#915;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. fst(clist!i) = &#915;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>compat</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!m)  &#8594; (l!(Suc m))) &#8743; 
            (&#8707;i&lt;length clist. 
               ((fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((snd (clist!i))!m)  &#8594; ((snd (clist!i))!(Suc m))) &#8743; 
            (&#8704;l&lt;length clist. 
               l&#8800;i &#10230;  (fst (clist!l))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc m)))) &#8744; 
         (&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!m)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc m)) &#8743; 
          (&#8704;i&lt;length clist.  (fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!i))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!i))!(Suc m))))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>compat_label_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a20</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!m)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc m)) &#8743; 
          (&#8704;i&lt;length clist.  (fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!i))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!i))!(Suc m))))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!m),snd (l!(Suc m))) &#8712; R&quot;</span></span></span><span>       
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span>a5</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!m), snd(l!(Suc m))) &#8712;  Rely(xs!i)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span>a3</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd ((snd (clist!i))!m), snd ((snd (clist!i))!(Suc m)) ) &#8712;  Rely(xs!i)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>        
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a20</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!m)  &#8594; (l!(Suc m))) &#8743; 
            (&#8707;i&lt;length clist. 
               ((fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((snd (clist!i))!m)  &#8594; ((snd (clist!i))!(Suc m))) &#8743; 
            (&#8704;l&lt;length clist. 
               l&#8800;i &#10230;  (fst (clist!l))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc m))))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i&#39;</span><span>  
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>i&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&#39;&lt;length clist &#8743; 
               ((fst (clist!i&#39;))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((snd (clist!i&#39;))!m)  &#8594; ((snd (clist!i&#39;))!(Suc m))) &#8743; 
               (&#8704;l&lt;length clist. 
                 l&#8800;i&#39; &#10230;  (fst (clist!l))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!m  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc m)))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq_&#915;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; = fst (clist!i&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>fp</span><span> </span><span>fs</span><span> </span><span>sp</span><span> </span><span>ss</span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>prod_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; 
               &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (fp, fs) &#8594; (sp,ss) &#8743; 
              fp = fst (((snd (clist!i&#39;))!m)) &#8743; fs = snd (((snd (clist!i&#39;))!m)) &#8743; 
              sp = fst ((snd (clist!i&#39;))!(Suc m)) &#8743; ss = snd((snd (clist!i&#39;))!(Suc m)) &#8743;
              &#915; = fst (clist!i&#39;) &quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>i&#39;</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>            
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = i&#39;&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>       
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!m = l!(Suc m) &#8743; (&#8707;ns. snd (l!m) = Normal ns )&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_e_step_c_eq</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a7</span><span class="delimiter">]</span><span> </span><span>i&#39;</span><span> </span><span>fst_occ</span><span> </span><span>eq_&#915;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!m)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc m))&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_pe.ParEnv</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>           
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! m), snd (l ! Suc m)) &#8712; R &quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span>  </span><span>a5</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! m), snd (l ! Suc m)) &#8712; Rely (xs ! i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a3</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span>a7</span><span>
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>  </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>not_eq</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>       
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fp = sp&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;fs = ss &#8743; (&#8707;ns. fs=Normal ns)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_step</span><span>  </span><span>prod_step</span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_change_p_or_eq_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (fp, fs) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (sp, ss)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>step_e.Env</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!m = l!(Suc m) &#8743; (&#8707;ns. snd (l!m) = Normal ns )&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_e_step_c_eq</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a7</span><span class="delimiter">]</span><span> </span><span>prod_step</span><span> </span><span>i&#39;</span><span> </span><span>fst_occ</span><span> </span><span>prod.collapse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!m)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc m))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_pe.ParEnv</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>           
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! m), snd (l ! Suc m)) &#8712; R &quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span>  </span><span>a5</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! m), snd (l ! Suc m)) &#8712; Rely (xs ! i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a3</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span>a7</span><span>
</span><span>            </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                   
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>                    
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc (Suc m)) (snd(clist!i&#39;))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clist_cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,snd(clist!i&#39;)) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>i&#39;</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sucm_len</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length (snd (clist!i&#39;))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i&#39;</span><span> </span><span>fst_occ</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>summ_lentake</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length ?l1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (clist!i&#39;)&#8800;[]&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i&#39;</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist ! i&#39;))) = snd (last l)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>i&#39;</span><span> </span><span>conjoin_last_same_state</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_i_notF</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd(clist!i&#39;))) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length (snd(clist!i&#39;)).  snd (snd(clist!i&#39;) ! i) &#8713; Fault ` F &quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>last_not_F</span><span class="delimiter">[</span><span>OF</span><span> </span><span>clist_cptn</span><span> </span><span>last_i_notF</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>suc_m_i&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length (snd (clist !i&#39;))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span>i&#39;</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_take_not_f</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (take (Suc (Suc m)) (snd(clist!i&#39;)))) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>           
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>not_env_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#172; &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> snd (clist ! i&#39;) ! m &#8594;<span class="hidden">&#8681;</span><sub>e</sub> snd (clist ! i&#39;) ! Suc m&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span>etran_ctran_eq_p_normal_s</span><span> </span><span>i&#39;</span><span> </span><span>prod_step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>           
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd ((snd(clist!i&#39;))!0)&#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_l</span><span> </span><span>a7</span><span> </span><span>i&#39;</span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd ((snd(clist!i&#39;))!0)&#8712; Normal ` (Pre (xs ! i&#39;))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>i&#39;</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd ((take (Suc (Suc m)) (snd(clist!i&#39;)))!0)&#8712; Normal `(Pre (xs ! i&#39;))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>       
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; Suc (Suc m) &#10230;
                &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> snd (clist ! i&#39;) ! j &#8594;<span class="hidden">&#8681;</span><sub>e</sub> snd (clist ! i&#39;) ! Suc j &#10230;
                (snd (snd (clist ! i&#39;) ! j), snd (snd (clist ! i&#39;) ! Suc j)) &#8712; Rely (xs ! i&#39;)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_env_step</span><span> </span><span>fst_occ</span><span> </span><span>Suc_less_eq</span><span> </span><span>fist_occ</span><span> </span><span>i&#39;</span><span> </span><span>less_SucE</span><span> </span><span>less_trans_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length (take (Suc (Suc m)) (snd(clist!i&#39;))) &#10230;
                &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> snd (clist ! i&#39;) ! j &#8594;<span class="hidden">&#8681;</span><sub>e</sub> snd (clist ! i&#39;) ! Suc j &#10230;
                (snd (snd (clist ! i&#39;) ! j), snd (snd (clist ! i&#39;) ! Suc j)) &#8712; Rely (xs ! i&#39;)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (take (Suc (Suc m)) (snd(clist!i&#39;)))) &#8712; 
                             assum ((Pre (xs ! i&#39;)),Rely (xs ! i&#39;))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,snd(clist!i&#39;)) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>i&#39;</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,take (Suc (Suc m)) (snd(clist!i&#39;))) &#8712; cptn&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>takecptn_is_cptn</span><span class="delimiter">)</span><span>              
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,take (Suc (Suc m)) (snd(clist!i&#39;))) &#8712; cp &#915; (Com(xs!i&#39;)) s&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i&#39;</span><span> </span><span>a3</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>t</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,take (Suc (Suc m)) (snd(clist!i&#39;))) &#8712; 
                              comm (Guar (xs ! i&#39;), (Post (xs ! i&#39;),Abr (xs ! i&#39;))) F &quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>i&#39;</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidity_def</span><span> </span><span>com_validity_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>               
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(take (Suc (Suc m)) (snd(clist!i&#39;))!m), 
                        snd(take (Suc (Suc m)) (snd(clist!i&#39;))!(Suc m))) &#8712; Guar (xs ! i&#39;)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_&#915;</span><span>  </span><span>i&#39;</span><span> </span><span>comm_dest1</span><span class="delimiter">[</span><span>OF</span><span> </span><span>t</span><span> </span><span>last_take_not_f</span><span> </span><span>summ_lentake</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd( (snd(clist!i&#39;))!m), 
                        snd((snd(clist!i&#39;))!(Suc m))) &#8712; Guar (xs ! i&#39;)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd( (snd(clist!i))!m), 
                      snd((snd(clist!i))!(Suc m))) &#8712; Guar (xs ! i&#39;)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>i&#39;</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd( (snd(clist!i))!m), 
                      snd((snd(clist!i))!(Suc m))) &#8712; Rely (xs ! i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_eq</span><span> </span><span>a0</span><span> </span><span>i&#39;</span><span> </span><span>a3</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>compat</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>two</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; &#8704;i&lt;length xs. R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838; (Rely (xs ! i));
   p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i)));
   &#8704;i&lt;length xs.
    &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)];
   length xs=length clist; (&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s; (&#915;,l)&#8712;par_assum (p, R);
  &#8704;i&lt;length clist. clist!i&#8712;cp &#915; (Com(xs!i)) s; (&#915;,l) &#8733; clist;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]);
  snd (last l) &#8713; Fault ` F&#10215;
  &#10233; &#8704;j i ns ns&#39;. i&lt;length clist &#8743; Suc j&lt;length l &#10230; 
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;  ((snd (clist!i))!Suc j) &#10230;       
        (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Guar(xs!i) &quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs. R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838; (Rely (xs ! i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.
    &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length xs=length clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&#8712;par_assum (p, R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. clist!i&#8712;cp &#915; (Com(xs!i)) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8733; clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;i j. i&lt;length clist &#8743; Suc j&lt;length l &#8743;  
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;  ((snd (clist!i))!Suc j) &#8743; 
       &#172; (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Guar(xs!i)) &quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i&lt;length clist &#8743; Suc j&lt;length l &#8743;
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;  ((snd (clist!i))!Suc j) &#8743;        
      &#172; (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Guar(xs!i)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?P</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;j. &#8707;i. i&lt;length clist &#8743; Suc j&lt;length l &#8743;
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;  ((snd (clist!i))!Suc j) &#8743;       
      &#172; (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; Guar(xs!i)&quot;</span></span></span><span>     
</span><span>     </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>fist_occ</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;?P m &#8743; (&#8704;i&lt;m. &#172; ?P i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>exists_first_occ</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?P</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>P</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;?P m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>notP</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i&lt;m. &#172; ?P i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fist_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>     </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>fst_occ</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length clist &#8743; Suc m&lt;length l &#8743; 
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!m) &#8594;  ((snd (clist!i))!Suc m) &#8743;      
      (&#172; (snd((snd (clist!i))!m), snd((snd (clist!i))!Suc m)) &#8712;  Guar(xs!i))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_clist_i</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (clist!i) = &#915;&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> 
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;clist!i&#8712;cp &#915; (Com(xs!i)) s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clistcp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, snd (clist!i))&#8712;cp &#915; (Com(xs!i)) s&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>fst_occ</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?li</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc (Suc m)) (snd (clist!i))&quot;</span></span></span><span>     
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)]&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidity_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>take_in_ass</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, take (Suc (Suc m)) (snd (clist!i))) &#8712; assum (Pre(xs!i), Rely(xs!i))&quot;</span></span></span><span>     
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_take_length_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length (take (Suc (Suc m)) (snd (clist!i))) &#8804; length l&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd((?li!0)) &#8712; Normal ` Pre(xs!i)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(take (Suc (Suc m)) (snd (clist!i)))!0 = (snd (clist!i))!0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (snd(clist!i)!0) = snd (l!0)&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!0) &#8712; Normal ` p&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>left</span><span class="delimiter">=</span><span>this</span><span>
</span><span>       </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>  
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>two&#39;</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span>a8</span><span> </span><span>a9</span><span class="delimiter">]</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>     
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,take (Suc (Suc m)) (snd (clist!i))) &#8712; cp &#915; (Com(xs!i)) s&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>takecptn_is_cptn</span><span> </span><span>clistcp</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>comm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, take (Suc (Suc m)) (snd (clist!i)))&#8712;comm(Guar(xs!i),(Post (xs ! i),Abr (xs ! i))) F&quot;</span></span></span><span>       
</span><span>        </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validity_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>     </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>not_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (take (Suc (Suc m)) (snd (clist!i))))  &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>      
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>cptn</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, snd (clist!i)) &#8712; cptn&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_clist_i</span><span> </span><span>a6</span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (clist!i))&#8800;[]&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn.simps</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>               
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i))) = snd (last l)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_last_same_state</span><span> </span><span>fst_occ</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i))) &#8713; Fault ` F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>       </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sucm</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length (snd (clist!i))&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>sucm_not_fault</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd ((snd (clist!i))!(Suc m)) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_not_F</span><span> </span><span>cptn</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (take (Suc (Suc m)) (snd (clist!i))) = Suc (Suc m)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sucm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last (take (Suc (Suc m)) (snd (clist!i))) =  (take (Suc (Suc m)) (snd (clist!i)))!(Suc m)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_inject</span><span> </span><span>last_conv_nth</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>old.nat.distinct</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(take (Suc (Suc m)) (snd (clist!i)))!(Suc m) = (snd (clist!i))!(Suc m)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>       </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>sucm_not_fault</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; (Suc m &lt; length (snd (clist ! i)) ) &#10230;
                 (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist ! i)) ! m &#8594; (snd (clist ! i)) ! Suc m) &#10230;                      
                    (snd ((snd (clist ! i)) ! m), snd ((snd (clist ! i)) ! Suc m)) &#8712; Guar(xs!i)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>comm_dest</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>comm</span><span> </span><span>not_fault</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>     
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_occ</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>par_cptn_env_comp</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cptn &#8743; Suc i&lt;length l &#10233; 
   &#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub> l!i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc i)) &#8744; &#915; &#8866;<span class="hidden">&#8681;</span><sub>p</sub> l!i &#8594; (l!(Suc i))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cptn &#8743; Suc i&lt;length l&quot;</span></span></span><span>         
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1</span><span> </span><span>s1</span><span> </span><span>c2</span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>li</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!i=(c1,s1) &#8743; l!(Suc i) = (c2,s2)&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>xs</span><span> </span><span>ys</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l= xs@((l!i)#(l!(Suc i))#ys)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_less_SucD</span><span> </span><span>id_take_nth_drop</span><span> </span><span>less_SucI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(drop (length xs) l) = ((l!i)#(l!(Suc i))#ys)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length xs &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>leI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,((l!i)#(l!(Suc i))#ys))&#8712;par_cptn&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>droppar_cptn_is_par_cptn</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,(l!(Suc i))#ys)&#8712;par_cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>par_cptn_dest</span><span> </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span>par_cptn_elim_cases</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>three</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;xs&#8800;[]; &#8704;i&lt;length xs. R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838; (Rely (xs ! i));
   p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i)));
   &#8704;i&lt;length xs.
     &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)];
   length xs=length clist; (&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s; (&#915;,l) &#8712; par_assum(p, R);
    &#8704;i&lt;length clist. clist!i&#8712;cp &#915; (Com(xs!i)) s; (&#915;,l) &#8733; clist; (&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]);
    snd (last l) &#8713; Fault ` F&#10215;
  &#10233; &#8704;j i. i&lt;length clist &#8743; Suc j&lt;length l &#10230;  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc j) &#10230;
      (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712;            
             (R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j))))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs. R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
             &#8838; (Rely (xs ! i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; (&#8898;i&lt;length xs.  (Pre (xs ! i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.
               &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length xs=length clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_assum(p, R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. clist!i&#8712;cp &#915; (Com(xs!i)) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8733; clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>        </span><span>10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length clist &#8743; Suc j&lt;length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;<span class="hidden">&#8681;</span><sub>e</sub>  ((snd (clist!i))!Suc j)&quot;</span></span></span><span>         
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>two</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j i ns ns&#39;. i&lt;length clist &#8743; Suc j&lt;length l &#10230; 
      &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd (clist!i))!j) &#8594;  ((snd (clist!i))!Suc j) &#10230;      
        (snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; (Guar(xs!i))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>two</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span>a8</span><span> </span><span>a9</span><span> </span><span>10</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_lenl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc j&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_lj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length (fst (l!j)) &#8743; i&lt;length (fst (l!(Suc j)))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_same_length</span><span> </span><span>a00</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fst_clist_&#915;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. fst(clist!i) = &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; 
            (&#8707;i&lt;length clist. 
               ((fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((snd (clist!i))!j)  &#8594; ((snd (clist!i))!(Suc j))) &#8743; 
            (&#8704;l&lt;length clist. 
               l&#8800;i &#10230;  (fst (clist!l))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc j)))) &#8744; 
         (&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)) &#8743; 
          (&#8704;i&lt;length clist.  (fst (clist!i))&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!i))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!i))!(Suc j))))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>compat_label_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>compat_label</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; 
            (&#8707;i&lt;length clist. 
               (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((snd (clist!i))!j)  &#8594; ((snd (clist!i))!(Suc j))) &#8743; 
            (&#8704;l&lt;length clist. 
               l&#8800;i &#10230;  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc j)))) &#8744; 
         (&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)) &#8743; 
          (&#8704;i&lt;length clist.  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!i))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!i))!(Suc j))))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_clist_&#915;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712;            
               (R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. Guar (xs ! j)))&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>        
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!j)  &#8594; (l!(Suc j))) &#8743; 
            (&#8707;i&lt;length clist. 
               (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((snd (clist!i))!j)  &#8594; ((snd (clist!i))!(Suc j))) &#8743; 
            (&#8704;l&lt;length clist. 
               l&#8800;i &#10230;  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc j))))&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>            </span><span>a20</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&#39;&lt;length clist &#8743; 
             (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> ((snd (clist!i&#39;))!j)  &#8594; ((snd (clist!i&#39;))!(Suc j))) &#8743; 
             (&#8704;l&lt;length clist. 
                l&#8800;i&#39; &#10230;  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>    
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#39;=i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>eq_i</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>P</span><span> </span><span>S1</span><span> </span><span>S2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>P</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd (clist!i&#39;))!j=(P,S1) &#8743; ((snd (clist!i&#39;))!(Suc j)) = (P,S2)&quot;</span></span></span><span>   
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>elim</span><span class="delimiter">:</span><span>etranE</span><span class="delimiter">)</span><span>       
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;S1 = S2&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_lj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!j)) = snd ((snd (clist!i&#39;))!j)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>a20</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>     
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>all_e</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;l&lt;length clist. &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!l))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!l))!(Suc j)))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a11</span><span> </span><span>a20</span><span> </span><span>eq_i</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>allP</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l&lt; length clist. fst ((snd (clist!l))!j) = fst ((snd (clist!l))!(Suc j))&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>fastforce</span><span> </span><span>elim</span><span class="delimiter">:</span><span>etranE</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!j) = (fst (l!(Suc j)))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>conjoin_same_program_i_j</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!j) = snd (l!(Suc j))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>              
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!Suc j)) = snd ((snd (clist!i&#39;))!(Suc j))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>a20</span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>snd_lj</span><span> </span><span>P</span><span> </span><span>True</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!j = l!(Suc j)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prod_eq_iff</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ns1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ns1. S1=Normal ns1&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P</span><span> </span><span>a20</span><span> </span><span>step_change_p_or_eq_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                    
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j))&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>P</span><span> </span><span>step_pe.ParEnv</span><span> </span><span>snd_lj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>          
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! j), snd (l ! Suc j)) &#8712; R &quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>a00</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>  
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a20</span><span> </span><span>P</span><span> </span><span>a11</span><span> </span><span>step_change_p_or_eq_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i&#39;_clist</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&#39; &lt; length clist&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a20</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clist_i&#39;_Guardxs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd (clist!i&#39;))!j), snd((snd (clist!i&#39;))!Suc j)) &#8712; Guar(xs!i&#39;)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>two</span><span> </span><span>a00</span><span> </span><span>False</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a20</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd((snd (clist!i))!j) = snd (l!j) &#8743; snd((snd (clist!i))!Suc j) = snd (l!Suc j)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a20</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd((snd (clist!i&#39;))!j) = snd (l!j) &#8743; snd((snd (clist!i&#39;))!Suc j) = snd (l!Suc j)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_lenl</span><span> </span><span>a20</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd((snd (clist!i))!j) = snd((snd (clist!i&#39;))!j) &#8743; 
                    snd((snd (clist!i))!Suc j) = snd((snd (clist!i&#39;))!Suc j)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clist_i_Guardxs</span><span class="delimiter">:</span><span>
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;(snd((snd (clist!i))!j), snd((snd (clist!i))!Suc j)) &#8712; 
            Guar(xs!i&#39;)&quot;</span></span></span><span>  
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>clist_i&#39;_Guardxs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>      
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>  
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span>a20</span><span>  </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>        
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l!(Suc j)) &#8743; 
          (&#8704;i&lt;length clist.  &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (snd (clist!i))!j  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd (clist!i))!(Suc j))))&quot;</span></span></span><span>      
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! j), snd (l ! Suc j)) &#8712; R&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a00</span><span> </span><span>a10</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>a00</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>tran_True</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tran_True &#8801; True&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>after</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;after &#8801; True&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>four</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;xs&#8800;[];  &#8704;i&lt;length xs.  R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838;  (Rely (xs ! i));
   (&#8899;j&lt;length xs.  (Guar (xs ! j))) &#8838; (G);
   p &#8838; (&#8898;i&lt;length xs.  (Pre (xs ! i)));
   &#8704;i&lt;length xs.
     &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i),  Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)];
    (&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s; (&#915;,l) &#8712; par_assum(p, R); Suc i &lt; length l;
   &#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub> (l!i) &#8594; (l!(Suc i));
   (&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]);
   snd (last l) &#8713; Fault ` F&#10215;
  &#10233; (snd (l ! i), snd (l ! Suc i)) &#8712; G&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.  R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
             &#8838;  (Rely (xs ! i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8899;j&lt;length xs.  (Guar (xs ! j))) &#8838; (G)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; (&#8898;i&lt;length xs.  (Pre (xs ! i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.
           &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i),  Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_assum(p, R)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a8</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub> (l!i) &#8594; (l!(Suc i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>         
</span><span>         </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a11</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_par_xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length (ParallelCom xs) = length xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>ParallelCom_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(ParallelCom xs)&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712;{(&#915;1,c). &#8707;clist. (length clist)=(length (ParallelCom xs)) &#8743; 
               (&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915; ((ParallelCom xs)!i) s) &#8743; (&#915;,c) &#8733; clist &#8743; &#915;1=&#915;}&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one</span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>clist</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length clist)=(length xs) &#8743; 
               (&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915; ((ParallelCom xs)!i) s) &#8743; (&#915;,l) &#8733; clist&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>length_par_xs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>conjoin</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(length clist)=(length xs) &#8743; 
               (&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915;  (Com (xs ! i)) s) &#8743; (&#915;,l) &#8733; clist&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParallelCom_Com</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_xs_clist</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length xs = length clist&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clist_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915;  (Com (xs ! i)) s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>conjoin</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8733; clist&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>     
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>par_cptn.simps</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_g0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;0&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!((length l) - 1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>    
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt; length l. fst (l!i) = map (&#955;x. fst ((snd x)!i)) clist&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_program_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>Ps</span><span> </span><span>si</span><span> </span><span>Ps&#39;</span><span> </span><span>ssi</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>li</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!i = (Ps,si) &#8743; l!(Suc i) = (Ps&#39;, ssi)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;j r. j&lt;length Ps &#8743; Ps&#39; = Ps[j:=r] &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((Ps!j),si) &#8594; (r, ssi))&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span>par_ctranE</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>j</span><span> </span><span>r</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>step_c</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;length Ps &#8743; Ps&#39; = Ps[j:=r] &#8743; (&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((Ps!j),si) &#8594; (r, ssi))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_Ps_clist</span><span class="delimiter">:</span><span>
</span><span>     </span><span class="string"><span class="delete"><span class="delete">&quot;length Ps = length clist &#8743; length Ps = length Ps&#39;&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span>a7</span><span> </span><span>conjoin_same_length</span><span> </span><span>li</span><span> </span><span>step_c</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>from_step</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(snd (clist!j))!i = ((Ps!j),si) &#8743; (snd (clist!j))!(Suc i) = (Ps&#39;!j,ssi)&quot;</span></span></span><span>  
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>     
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Ps = fst (snd (&#915;, l) ! i)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>f2&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Ps&#39; = fst (snd (&#915;, l) ! (Suc i))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;si = snd (snd (&#915;, l) ! i) &#8743; ssi = snd (snd (&#915;, l) ! (Suc i))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>li</span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (clist!j))!i = ((Ps!j),si)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>conjoin</span><span> </span><span>a7</span><span> </span><span>step_c</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_program_def</span><span> </span><span>same_state_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>     
</span><span>     </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (clist!j))!(Suc i) = (Ps&#39;!j,ssi)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2&#39;</span><span> </span><span>f3</span><span> </span><span>conjoin</span><span> </span><span>a7</span><span> </span><span>step_c</span><span> </span><span>length_Ps_clist</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_program_def</span><span> </span><span>same_state_def</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>step_clist</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(snd (clist!j))!i &#8594; (snd (clist!j))!(Suc i)&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>from_step</span><span>  </span><span>step_c</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>j_xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;length xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_c</span><span> </span><span>length_Ps_clist</span><span> </span><span>length_xs_clist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;length clist&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>j_xs</span><span> </span><span>length_xs_clist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>     </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i j ns ns&#39;. j &lt; length clist &#8743; Suc i &lt; length l &#10230;
            &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> snd (clist ! j) ! i &#8594; snd (clist ! j) ! Suc i &#10230;             
              (snd (snd (clist ! j) ! i), snd (snd (clist ! j) ! Suc i)) &#8712; Guar (xs ! j)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>two</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>length_xs_clist</span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>clist_cp</span><span> </span><span>conjoin</span><span> </span><span>a10</span><span> </span><span>a11</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (snd (clist ! j) ! i), snd (snd (clist ! j) ! Suc i)) &#8712; Guar (xs ! j)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span>step_c</span><span> </span><span>length_Ps_clist</span><span> </span><span>step_clist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>     
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l!i), snd (l!(Suc i)))&#8712; Guar (xs ! j)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>from_step</span><span> </span><span>a2</span><span> </span><span>length_xs_clist</span><span> </span><span>step_c</span><span> </span><span>li</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>j_xs</span><span>
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>sep_conj_def</span><span> </span><span>tran_True_def</span><span> </span><span>after_def</span><span> </span><span>Satis_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>same_program_last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l&#8800;[] &#10233; (&#915;,l) &#8733; clist  &#10233; i&lt;length clist &#10233;fst (last (snd (clist!i))) = fst (last l) ! i&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l&#8800;[]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>conjoin</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8733; clist&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>i_clist</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length clist&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_clist_eq_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. last (snd (clist!i)) = (snd (clist!i))!((length l) - 1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span>  </span><span>last_conv_nth</span><span> </span><span>l_not_empty</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>length_0_conv</span><span> </span><span>snd_eqD</span><span class="delimiter">)</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!((length l)-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = map (&#955;x. fst (snd x ! ((length l)-1))) clist&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_not_empty</span><span> </span><span>last_l</span><span> </span><span>conjoin</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_program_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(map (&#955;x. fst (snd x ! ((length l)-1))) clist)!i = 
            fst ((snd (clist!i))! ((length l)-1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_clist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;fst ((snd (clist!i))! ((length l)-1)) = 
             fst ((snd (clist!i))! ((length (snd (clist!i)))-1))&quot;</span></span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span>i_clist</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst ((snd (clist!i))! ((length (snd (clist!i)))-1)) = fst (last (snd (clist!i)))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_clist</span><span> </span><span>l_not_empty</span><span> </span><span>conjoin</span><span> </span><span>last_clist_eq_l</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>   </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>five</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;xs&#8800;[];  &#8704;i&lt;length xs.  R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838; (Rely (xs ! i));
   p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i)));
   (&#8898;i&lt;length xs. (Post (xs ! i))) &#8838; q;
   (&#8899;i&lt;length xs. (Abr (xs ! i))) &#8838; a ;
   &#8704;i &lt; length xs.
    &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)];
    (&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s; (&#915;,l) &#8712; par_assum(p, R);
   All_End (last l); snd (last l) &#8713; Fault ` F;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]) &#10215; &#10233; 
                   (&#8707;j&lt;length (fst (last l)). fst (last l)!j=Throw &#8743; 
                        snd (last l) &#8712; Normal ` (a)) &#8744;
                   (&#8704;j&lt;length (fst (last l)). fst (last l)!j=Skip &#8743;
                        snd (last l) &#8712; Normal ` q)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.  R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
                                                                     &#8838;  (Rely (xs ! i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8898;i&lt;length xs. (Post (xs ! i))) &#8838; q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8899;i&lt;length xs. (Abr (xs ! i))) &#8838; a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; length xs.
               &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub>  Com (xs ! i) sat [Pre (xs!i), 
                                             Rely (xs ! i), Guar (xs ! i), 
                                             Post (xs ! i),Abr (xs ! i)]&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a7</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_assum(p, R)&quot;</span></span></span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a8</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;All_End (last l)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a9</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a10</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])&quot;</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_par_xs</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length (ParallelCom xs) = length xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>ParallelCom_def</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>   
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(ParallelCom xs)&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712;{(&#915;1,c). &#8707;clist. (length clist)=(length (ParallelCom xs)) &#8743; 
               (&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915; ((ParallelCom xs)!i) s) &#8743; (&#915;,c) &#8733; clist &#8743; &#915;1=&#915;}&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>one</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>clist</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length clist)=(length xs) &#8743; 
               (&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915; ((ParallelCom xs)!i) s) &#8743; (&#915;,l) &#8733; clist&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>length_par_xs</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>conjoin</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(length clist)=(length xs) &#8743; 
               (&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915;  (Com (xs ! i)) s) &#8743; (&#915;,l) &#8733; clist&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParallelCom_Com</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>length_xs_clist</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;length xs = length clist&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*have length_l_clist: &quot;length l = length clist&quot; 
     using conjoin unfolding conjoin_def same_length_def *)</span></span></span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clist_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. (clist!i) &#8712; cp &#915;  (Com (xs ! i)) s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>conjoin</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8733; clist&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l&#8800;[]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a6</span><span> </span><span>par_cptn.simps</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_g0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;0&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;last l = l!((length l) - 1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clist_assum</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. (clist!i) &#8712; assum (Pre (xs!i),Rely (xs!i))&quot;</span></span></span><span>     
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length clist&quot;</span></span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>&#915;1</span><span> </span><span>li</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>clist</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;clist!i=(&#915;1,li)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>    
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>&#915;eq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;1=&#915;&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span> </span><span>i_length</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_functions_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;1,li) &#8712; assum (Pre (xs!i),Rely (xs!i))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (li!0) &#8712; Normal ` ( (Pre (xs!i)))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (&#915;,l) = l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>       
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!0) &#8712; Normal ` (p)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>         
</span><span>         </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l!0) = snd (li!0)&quot;</span></span></span><span>           
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_length</span><span> </span><span>conjoin</span><span> </span><span>l_g0</span><span> </span><span>clist</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>i_length</span><span> </span><span>length_xs_clist</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>              
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. Suc j &lt; length li &#10230; 
                    &#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(li!j)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (li!(Suc j)) &#10230;                 
                    (snd(li!j), snd(li!(Suc j))) &#8712; Rely (xs!i))&quot;</span></span></span><span>        
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>three</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a5</span><span> </span><span>length_xs_clist</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span>clist_cp</span><span> </span><span>conjoin</span><span> </span><span>a10</span><span> </span><span>a9</span><span class="delimiter">]</span><span>  
</span><span>               </span><span>i_length</span><span> </span><span>conjoin</span><span> </span><span>a1</span><span> </span><span>length_xs_clist</span><span> </span><span>clist</span><span>                     
</span><span>         </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>                                   
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>r</span><span> </span><span>&#915;eq</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>assum_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;clist!i &#8712; assum (Pre (xs!i),Rely (xs!i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>            
</span><span>   </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>clist_com</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. (clist!i) &#8712; comm  (Guar (xs!i),(Post(xs!i),Abr (xs!i))) F&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_cvalidity_def</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>com_validity_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clist_cp</span><span> </span><span>length_xs_clist</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>              
</span><span>   </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_clist_eq_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. last (snd (clist!i)) = (snd (clist!i))!((length l) - 1)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin</span><span>  </span><span>last_conv_nth</span><span> </span><span>l_not_empty</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_length_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>length_0_conv</span><span> </span><span>snd_eqD</span><span class="delimiter">)</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_clist_l</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. snd (last (snd (clist!i))) = snd (last l)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_l</span><span> </span><span>conjoin</span><span> </span><span>l_not_empty</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>conjoin_def</span><span> </span><span>same_state_def</span><span> </span><span>same_length_def</span><span> 
</span><span>     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>   </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length (fst (last l)). fst (last l)!i = Skip&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ac1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length (fst (last l)). fst (last l)!i = Skip&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j&lt;length (fst (last l)). fst (last l) ! j = LanguageCon.com.Skip &#8743; snd (last l) &#8712; Normal ` q)&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>aj</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;j&lt;length (fst (last l))&quot;</span></span></span><span>         
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length clist. snd (last (snd (clist!i))) &#8712; Normal ` Post(xs!i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> 
</span><span>           </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a20</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length clist&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i))) = snd (last l)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_clist_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_clist_not_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i)))&#8713; Fault ` F&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span> </span><span>last_clist_l</span><span> </span><span>a20</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>           </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) ! i = Skip&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a20</span><span> </span><span>ac1</span><span> </span><span>conjoin_same_length</span><span class="delimiter">[</span><span>OF</span><span> </span><span>conjoin</span><span class="delimiter">]</span><span>
</span><span>             </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>l_not_empty</span><span> </span><span>last_l</span><span> </span><span class="delimiter">)</span><span>                       
</span><span>           </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) ! i=fst (last (snd (clist!i)))&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>same_program_last</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l_not_empty</span><span> </span><span>conjoin</span><span> </span><span>a20</span><span class="delimiter">]</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last (snd (clist!i))) = Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">.</span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i))) &#8712; Normal ` Post(xs!i)&quot;</span></span></span><span> 
</span><span>             </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clist_com</span><span> </span><span>last_clist_not_F</span><span> </span><span>a20</span><span>
</span><span>             </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>             
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs. snd (last l) &#8712; Normal ` Post(xs!i)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_clist_l</span><span> </span><span>length_xs_clist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs. &#8707;x&#8712;( Post(xs!i)). snd (last l) = Normal x&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;t. (&#8704;i&lt;length xs. t&#8712; Post (xs ! i))&#10230; t&#8712; q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>        
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;x&#8712; q. snd (last l) = Normal x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>length_greater_0_conv</span><span> </span><span>xstate.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8712; Normal ` q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>          
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) ! j = LanguageCon.com.Skip &#8743; snd (last l) &#8712; Normal ` q&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>aj</span><span> </span><span>ac1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>      
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8704;i&lt;length (fst (last l)). fst (last l)!i = Skip)&quot;</span></span></span><span>    
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a20</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt; length (fst (last l)) &#8743;  fst (last l)!i &#8800; Skip&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_i_throw</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l)!i = Throw &#8743; (&#8707;n. snd (last l) = Normal n)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>All_End_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>     
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (fst (last l)) =  length clist&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_same_length</span><span class="delimiter">[</span><span>OF</span><span> </span><span>conjoin</span><span class="delimiter">]</span><span> </span><span>l_not_empty</span><span> </span><span>last_l</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>i_length</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length clist&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a20</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_last</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i))) = snd (last l)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_clist_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>last_clist_not_F</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i)))&#8713; Fault ` F&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span> </span><span>last_clist_l</span><span> </span><span>i_length</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last (snd (clist!i))) = fst (last l) ! i&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>i_length</span><span> </span><span>same_program_last</span><span> </span><span class="delimiter">[</span><span>OF</span><span> </span><span>l_not_empty</span><span> </span><span>conjoin</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last (snd (clist!i))) = Throw&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_i_throw</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last (snd (clist!i))) &#8712; Normal `  Abr(xs!i)&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>clist_com</span><span> </span><span>last_clist_not_F</span><span> </span><span>i_length</span><span> </span><span>last_i_throw</span><span> </span><span>snd_last</span><span>
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>comm_def</span><span> </span><span>final_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l)&#8712; Normal ` Abr(xs!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_clist_l</span><span> </span><span>i_length</span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l)&#8712; Normal ` (a)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span>a0</span><span> </span><span>i_length</span><span> </span><span>length_xs_clist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;j&lt;length (fst (last l)).
        fst (last l) ! j = LanguageCon.com.Throw &#8743; snd (last l) &#8712; Normal ` a&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>last_i_throw</span><span> </span><span>a20</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ParallelEmpty</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i s. (&#915;,l) &#8712; par_cp &#915; (ParallelCom []) s &#10230;
  Suc i &lt; length l &#10230; &#172; (&#915; &#8866;<span class="hidden">&#8681;</span><sub>p</sub> (l!i) &#8594; (l!Suc i))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct_tac</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>case_tac</span><span> </span><span>list</span><span class="delimiter">,</span><span>simp</span><span class="delimiter">,</span><span>simp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>case_tac</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>par_cp_def</span><span> </span><span>ParallelCom_def</span><span class="delimiter">)</span><span> 
</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>erule</span><span> </span><span>par_ctranE</span><span class="delimiter">,</span><span>simp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>par_cp_def</span><span> </span><span>ParallelCom_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>erule</span><span> </span><span>par_cptn.cases</span><span class="delimiter">,</span><span>simp</span><span class="delimiter">)</span><span>
</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>list.inject</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less0</span><span> </span><span>step_p_pair_elim_cases</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ParallelEmpty2</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom []) s&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>         </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length l&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (l!i) = []&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>paremp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;ParallelCom [] = []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>ParallelCom_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;l!0 =([],s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l0</span><span> </span><span>a1</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>i</span><span> </span><span>s</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ParCptnOne</span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>ParCptnEnv</span><span> </span><span>&#915;</span><span> </span><span>P</span><span> </span><span>s1</span><span> </span><span>t</span><span> </span><span>xs</span><span> </span><span>i</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; Suc (Suc (length xs))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParCptnEnv.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(P, s1) = ([], s)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParCptnEnv.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>ParCptnEnv.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>diff_Suc_1</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>less_Suc_eq_0_disj</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>ParCptnComp</span><span> </span><span>&#915;</span><span> </span><span>P</span><span> </span><span>s1</span><span> </span><span>Q</span><span> </span><span>t</span><span> </span><span>xs</span><span class="delimiter">)</span><span>   
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;, (P,s1)#(Q, t) # xs) &#8712; par_cp &#915; (ParallelCom []) s1&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParCptnComp</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>ParCptnComp</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>step_p_elim_cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; &#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub> (P, s1) &#8594; (Q, t)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParallelEmpty</span><span> </span><span>ParCptnComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParCptnComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parallel_sound</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.
       R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838; (Rely (xs ! i)) &#10233;
    (&#8899;j&lt;length xs. (Guar (xs ! j))) &#8838; G &#10233;
    p &#8838; (&#8898;i&lt;length xs. (Pre (xs ! i))) &#10233;
    (&#8898;i&lt;length xs. (Post (xs ! i))) &#8838; q &#10233;
    (&#8899;i&lt;length xs. (Abr (xs ! i))) &#8838; a &#10233;    
    &#8704;i&lt;length xs.
       &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Com (xs !i) sat [Pre (xs !i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)] &#10233;
  &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> ParallelCom xs SAT [p, R, G, q,a]
  &quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> 
</span><span>  </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.
      R &#8746; (&#8899;j&#8712;{j. j &lt; length xs &#8743; j &#8800; i}. (Guar (xs ! j)))
       &#8838;  (Rely (xs ! i))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8899;j&lt;length xs.  (Guar (xs ! j))) &#8838; G&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;p &#8838; (&#8898;i&lt;length xs.  (Pre (xs ! i)))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8898;i&lt;length xs.  (Post (xs ! i))) &#8838; q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8899;i&lt;length xs.  (Abr (xs ! i))) &#8838; a&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>   </span><span>a5</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs.
            &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Com (xs !i) sat [Pre (xs !i), Rely (xs ! i), Guar (xs ! i), Post (xs ! i),Abr (xs ! i)]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span> 
</span><span>     </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(c,p,R,G,q,a)&#8712; &#920;. &#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>l</span><span>
</span><span>       </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s &#8743; (&#915;,l) &#8712; par_assum(p, R)&quot;</span></span></span><span>       
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_par_cp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_cp &#915; (ParallelCom xs) s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c_par_assum</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_assum(p, R)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> </span><span>ns</span><span> </span><span>ns&#39;</span><span>
</span><span>         </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a20</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) &#8713; Fault ` F&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a30</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l&quot;</span></span></span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                   </span><span>a31</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!i)  &#8594; (l!(Suc i))&quot;</span></span></span><span>                   
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>xs_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs = []&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#915; &#8866;<span class="hidden">&#8681;</span><sub>p</sub> (l!i) &#8594; (l!Suc i))&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a30</span><span> </span><span>a10</span><span> </span><span>ParallelEmpty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a31</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>            
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd(l!i), snd(l!(Suc i))) &#8712;  G&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>four</span><span class="delimiter">[</span><span>OF</span><span> </span><span>xs_not_empty</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a5</span><span> </span><span>c_par_cp</span><span> </span><span>c_par_assum</span><span> </span><span>a30</span><span> </span><span>a31</span><span> </span><span>a00</span><span> </span><span>a20</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length l &#10230; 
                     &#915;&#8866;<span class="hidden">&#8681;</span><sub>p</sub>(l!i)  &#8594; (l!(Suc i)) &#10230;                      
                     (snd(l!i), snd(l!(Suc i))) &#8712; G &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>l</span><span> </span><span class="delimiter">=</span><span> </span><span>this</span><span>
</span><span>         </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a30</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;All_End (last l)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>xs_not_empty</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs&#8800;[]&quot;</span></span></span><span> 
</span><span>           </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">{</span></span><span> </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>xs_emp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;xs=[]&quot;</span></span></span><span>
</span><span>             </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lenl</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;0&lt;length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_cp_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>par_cptn.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(length l) - 1 &lt; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst(l!((length l) - 1)) = []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ParallelEmpty2</span><span> </span><span>a10</span><span> </span><span>xs_emp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>             </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a30</span><span> </span><span>lenl</span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>All_End_def</span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>last_conv_nth</span><span> </span><span class="delimiter">)</span><span>              
</span><span>           </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>           </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;j&lt;length (fst (last l)). fst (last l)!j=Throw &#8743; 
                        snd (last l) &#8712; Normal ` (a)) &#8744;
                      (&#8704;j&lt;length (fst (last l)). fst (last l)!j=Skip &#8743;
                        snd (last l) &#8712; Normal ` q)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>five</span><span class="delimiter">[</span><span>OF</span><span> </span><span>xs_not_empty</span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>c_par_cp</span><span> </span><span>c_par_assum</span><span> </span><span>a30</span><span> </span><span>a20</span><span> </span><span>a00</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>         </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;All_End (last l) &#10230; 
                      (&#8707;j&lt;length (fst (last l)). fst (last l)!j=Throw &#8743; 
                        snd (last l) &#8712; Normal ` (a)) &#8744;
                   (&#8704;j&lt;length (fst (last l)). fst (last l)!j=Skip &#8743;
                        snd (last l) &#8712; Normal ` q)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>           </span><span class="keyword1"><span class="command">note</span></span><span> </span><span>res1</span><span> </span><span class="delimiter">=</span><span> </span><span>conjI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l</span><span> </span><span>this</span><span class="delimiter">]</span><span> 
</span><span>       </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915;,l) &#8712; par_comm(G, (q,a)) F&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_comm_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>       
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (ParallelCom xs) SAT [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>par_com_validity_def</span><span> </span><span>par_cp_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>par_com_cvalidity_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span>  
</span><span> </span><span>par_rgsound</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Ps SAT [p, R, G, q,a] &#10233;
  &#915;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> (ParallelCom Ps) SAT [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>rule</span><span class="delimiter">:</span><span>par_rghoare.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Parallel</span><span> </span><span>xs</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>p</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>&#915;</span><span> </span><span>&#920;</span><span> </span><span>F</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>localRG_sound</span><span> </span><span>com_cnvalid_to_cvalid</span><span> </span><span>parallel_sound</span><span class="delimiter">[</span><span>of</span><span> </span><span>xs</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>p</span><span> </span><span>q</span><span> </span><span>a</span><span> </span><span>&#915;</span><span> </span><span>&#920;</span><span> </span><span>F</span><span class="delimiter">]</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Conseq&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. s&#8712;p &#10230;
              (&#8707;p&#39; q&#39; a&#39; R&#39; G&#39;. 
                (&#8704;Z. &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [(p&#39; Z), (R&#39; Z), (G&#39; Z), (q&#39; Z),(a&#39; Z)]) &#8743;
                   (&#8707; Z. s&#8712;p&#39; Z &#8743; (q&#39; Z &#8838; q) &#8743; (a&#39; Z &#8838; a) &#8743; (G&#39; Z &#8838; G) &#8743; (R &#8838; R&#39; Z)))
              &#10233;
              &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>Conseq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>order_refl</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conseq</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;Z. &#915;,&#920;&#39;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [(p&#39; Z), (R&#39; Z), (G&#39; Z), (q&#39; Z),(a&#39; Z)]; &#920;&#39; &#8838; &#920; ;
              &#8704;s. s &#8712; p &#10230; (&#8707; Z. s&#8712;p&#39; Z &#8743; (q&#39; Z &#8838; q) &#8743; (a&#39; Z &#8838; a) &#8743; (G&#39; Z &#8838; G) &#8743; (R &#8838; R&#39; Z))&#10215;
              &#10233;
               &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>Conseq</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>order_refl</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conseqPrePost</span><span class="delimiter">[</span><span>trans</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#39;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R&#39;, G&#39;, q&#39;,a&#39;] &#10233; &#920;&#39; &#8838; &#920; &#10233;
  p&#8838;p&#39; &#10233; q&#39; &#8838; q &#10233; a&#39; &#8838; a &#10233; G&#39; &#8838; G &#10233; R &#8838; R&#39; &#10233; 
  &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a]&quot;</span></span></span><span>  
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>conseq</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conseqPre</span><span class="delimiter">[</span><span>trans</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p&#39;, R, G, q,a] &#10233;
  p&#8838;p&#39; &#10233;
  &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>conseq</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conseqPost</span><span class="delimiter">[</span><span>trans</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q&#39;,a&#39;] &#10233;
  q&#39;&#8838;q &#10233;  a&#39;&#8838;a &#10233;
  &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>conseq</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span>x</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;(sa&#39;::nat set). (&#8704;x. (x&#8712; sa) = ((to_nat x) &#8712; sa&#39;))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>from_nat_to_nat</span><span> </span><span>imageE</span><span> </span><span>image_eqI</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>not_empty_set_countable</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sa&#8800;({}::(&#39;a::countable) set)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{i. ((&#955;i. i&#8712; sa) o from_nat) i}&#8800;{}&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>Collect_empty_eq_bot</span><span> </span><span>assms</span><span> </span><span>comp_apply</span><span> </span><span>empty_def</span><span> </span><span>equals0I</span><span> </span><span>from_nat_to_nat</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eq_set_countable</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;(&#8898;i&#8712;{i. ((&#955;i. i&#8712; sa) o from_nat) i}. (q o from_nat) i) = ((&#8898;i&#8712;sa. q i))&quot;</span></span></span><span>     
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>from_nat_to_nat</span><span class="delimiter">)</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conj_inter_countable</span><span class="delimiter">[</span><span>trans</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;sa&#8800;({}::(&#39;a::countable) set)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>          </span><span>a1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&#8712;sa. &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G, q i,a]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G,(&#8898;i&#8712;sa. q i),a]&quot;</span></span></span><span>  
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&#8712;{i. ((&#955;i. i&#8712; sa) o from_nat) i}. &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G,(q o from_nat) i,a]&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> P sat [p, R, G,&#8898;i&#8712;{i. ((&#955;i. i&#8712; sa) o from_nat) i}. (q o from_nat) i,a]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Conj_Inter</span><span class="delimiter">[</span><span>OF</span><span> </span><span>not_empty_set_countable</span><span class="delimiter">[</span><span>OF</span><span> </span><span>a0</span><span class="delimiter">]</span><span class="delimiter">]</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>    
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_set_countable</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>    
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>all_Post</span><span class="delimiter">[</span><span>trans</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p_n::(&#39;a::countable). &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [P, R, G, Q p_n, Qa]&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [P, R, G,{s. &#8704;p_n. s&#8712;Q p_n},Qa]&quot;</span></span></span><span>      
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [P, R, G,(&#8898;p_n. Q  p_n),Qa]&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>conj_inter_countable</span><span class="delimiter">[</span><span>of</span><span> </span><span>UNIV</span><span class="delimiter">]</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;P. {s. &#8704;p_n. s&#8712;P p_n} = (&#8898;p_n. P p_n)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>all_Pre</span><span class="delimiter">[</span><span>trans</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p_n. &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [P p_n, R, G, Q, Qa]&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [{s. &#8704;p_n. s&#8712;P p_n}, R, G,Q,Qa]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>p_n</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [{s. &#8704;p_n. s&#8712;P p_n}, R, G,Q,Qa]&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{v. &#8704;n. v &#8712; P n} &#8838; P p_n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>a0</span><span> </span><span>LocalRG_HoareDef.conseqPrePost</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>Pre_Post_all</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p_n::(&#39;a::countable). &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [P p_n, R, G, Q p_n, Qa]&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [{s. &#8704;p_n. s&#8712;P p_n}, R, G,{s. &#8704;p_n. s&#8712;Q p_n},Qa]&quot;</span></span></span><span>    
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>p_n</span><span>
</span><span>     
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [{s. &#8704;p_n. s&#8712;P p_n}, R, G,Q p_n,Qa]&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{v. &#8704;n. v &#8712; P n} &#8838; P p_n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>a0</span><span> </span><span>LocalRG_HoareDef.conseqPrePost</span><span> </span><span>subset_eq</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p_n. &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [{s. &#8704;p_n. s&#8712;P p_n}, R, G,Q p_n,Qa]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;p_n. &#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> C sat [{s. &#8704;p_n. s&#8712;P p_n}, R, G,{s. &#8704;p_n. s&#8712;Q p_n},Qa]&quot;</span></span></span><span>    
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_Post</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;P. {s. &#8704;p_n. s&#8712;P p_n} = (&#8898;p_n. P p_n)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s1</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>  
</span><span>  
</span><span>  
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>hoare_elim_skip_cases</span><span> </span><span class="delimiter">[</span><span>cases</span><span> </span><span>set</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span class="string"><span class="delete"><span class="delete">&quot;&#915;,&#920;&#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Skip sat [p, R, G, q,a]&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* abbreviation 
 &quot;stepc_rtrancl&quot; :: &quot;[(&#39;s,&#39;p,&#39;f,&#39;e) body,(&#39;s,&#39;p,&#39;f) config,(&#39;s,&#39;p,&#39;f) config] &#8658; bool&quot;
                                (&quot;_&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (_ &#8594;<span class="hidden">&#8679;</span><sup>*</sup>/ _)&quot; [81,81,81] 100)
 where                                
  &quot;&#915;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> cf0 &#8594;<span class="hidden">&#8679;</span><sup>*</sup> cf1 &#8801; ((CONST stepc &#915;))<span class="hidden">&#8679;</span><sup>*</sup><span class="hidden">&#8679;</span><sup>*</sup> cf0 cf1&quot; *)</span></span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span></pre>

</div>
</body>
</html>
