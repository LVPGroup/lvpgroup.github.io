<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/a6825305-9cdd-4ac5-b661-569d2fcf8cab/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.theories { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }
</style><title>Theory "L4_Inv_Schedule"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> L4_Inv_Schedule
  <span class="keyword2"><span class="keyword">imports</span></span> L4_Inv_Thread
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetCurrentTime›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTime_Inv_Current_Thread_In_Active SetCurrentTime_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetCurrentTime_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetCurrentTime_rtran SetCurrentTime_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTime_valid SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    SetCurrentTime_direct_eq SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetCurrentTime_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetCurrentTime_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetCurrentTime_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTime_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTime_Inv_Space_HasNot_Loop SetCurrentTime_Inv_Space_Valid_Has_Real
   SetCurrentTime_Inv_Space_Perms_IsNot_Empty SetCurrentTime_Inv_Space_Spaces_In_Config 
   SetCurrentTime_Inv_Space_InitialSpaces_In_Spaces SetCurrentTime_Inv_Space_Perms_Subset
   SetCurrentTime_Inv_Space_Spaces_IsNot_None SetCurrentTime_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Sigma0_Space_def p1 SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_IntThreads_Space_def p1 SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_RootServer_Space_def p1 SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetCurrentTime_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetCurrentTime_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetCurrentTime_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="comment1">(*
Inv_Sigma0_Space
Inv_IntThreads_Space
Inv_RootServer_Space
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    SetCurrentTime_Inv_Idle_NotIn_Threads SetCurrentTime_Inv_Idle_Space_Is_KernelSpace
    SetCurrentTime_Inv_Sigma0_Space SetCurrentTime_Inv_IntThreads_Space
    SetCurrentTime_Inv_RootServer_Space SetCurrentTime_Inv_Sigma0_In_Active 
    SetCurrentTime_Inv_RootServer_In_Active SetCurrentTime_Inv_IntThreads_In_Active 
    SetCurrentTime_Inv_Threads_In_Config SetCurrentTime_Inv_Active_In_Threads 
    SetCurrentTime_Inv_NThreads_Is_None SetCurrentTime_Inv_Threads_IsNot_None 
    SetCurrentTime_Inv_Threads_Space_In_Spaces SetCurrentTime_Inv_Threads_Sche_In_Threads 
    SetCurrentTime_Inv_NActive_Utcb_Is_None SetCurrentTime_Inv_Active_Utcb_IsNot_None
    SetCurrentTime_Inv_IntThreads_Utcb_Is_None 
    SetCurrentTime_Inv_Threads_Partner_In_Threads SetCurrentTime_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def 
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> SetCurrentTime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTime_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>SetCurrentTime <span class="bound">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTime_Inv_Current SetCurrentTime_Inv_Space SetCurrentTime_Inv_Thread SetCurrentTime_Inv_Schedule SetCurrentTime_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetThreadCurrentTimeslice›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_Inv_Current_Thread_In_Active SetThreadCurrentTimeslice_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetThreadCurrentTimeslice_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadCurrentTimeslice_rtran SetThreadCurrentTimeslice_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_valid SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    SetThreadCurrentTimeslice_direct_eq SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadCurrentTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadCurrentTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadCurrentTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_Inv_Space_HasNot_Loop SetThreadCurrentTimeslice_Inv_Space_Valid_Has_Real
   SetThreadCurrentTimeslice_Inv_Space_Perms_IsNot_Empty SetThreadCurrentTimeslice_Inv_Space_Spaces_In_Config 
   SetThreadCurrentTimeslice_Inv_Space_InitialSpaces_In_Spaces SetThreadCurrentTimeslice_Inv_Space_Perms_Subset
   SetThreadCurrentTimeslice_Inv_Space_Spaces_IsNot_None SetThreadCurrentTimeslice_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Sigma0_Space_def p1 SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_IntThreads_Space_def p1 SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_RootServer_Space_def p1 SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
     <span class="keyword2"><span class="keyword">and</span></span>  p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadCurrentTimeslice_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadCurrentTimeslice_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
   SetThreadCurrentTimeslice_Inv_Idle_NotIn_Threads SetThreadCurrentTimeslice_Inv_Idle_Space_Is_KernelSpace
    SetThreadCurrentTimeslice_Inv_Sigma0_Space SetThreadCurrentTimeslice_Inv_IntThreads_Space
    SetThreadCurrentTimeslice_Inv_RootServer_Space SetThreadCurrentTimeslice_Inv_Sigma0_In_Active 
    SetThreadCurrentTimeslice_Inv_RootServer_In_Active SetThreadCurrentTimeslice_Inv_IntThreads_In_Active 
    SetThreadCurrentTimeslice_Inv_Threads_In_Config SetThreadCurrentTimeslice_Inv_Active_In_Threads 
    SetThreadCurrentTimeslice_Inv_NThreads_Is_None SetThreadCurrentTimeslice_Inv_Threads_IsNot_None 
    SetThreadCurrentTimeslice_Inv_Threads_Space_In_Spaces SetThreadCurrentTimeslice_Inv_Threads_Sche_In_Threads 
    SetThreadCurrentTimeslice_Inv_NActive_Utcb_Is_None SetThreadCurrentTimeslice_Inv_Active_Utcb_IsNot_None
    SetThreadCurrentTimeslice_Inv_IntThreads_Utcb_Is_None 
    SetThreadCurrentTimeslice_Inv_Threads_Partner_In_Threads SetThreadCurrentTimeslice_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def 
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> SetThreadCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> SetThreadCurrentTimeslice_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">gno</span> <span class="main">∈</span> threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>SetThreadCurrentTimeslice <span class="bound">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_Inv_Current SetThreadCurrentTimeslice_Inv_Space SetThreadCurrentTimeslice_Inv_Thread SetThreadCurrentTimeslice_Inv_Schedule SetThreadCurrentTimeslice_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetCurrentTimeslice›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTimeslice_Inv_Current_Thread_In_Active SetCurrentTimeslice_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetCurrentTimeslice_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetCurrentTimeslice_rtran SetCurrentTimeslice_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTimeslice_valid SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    SetCurrentTimeslice_direct_eq SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetCurrentTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetCurrentTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetCurrentTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTimeslice_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTimeslice_Inv_Space_HasNot_Loop SetCurrentTimeslice_Inv_Space_Valid_Has_Real
   SetCurrentTimeslice_Inv_Space_Perms_IsNot_Empty SetCurrentTimeslice_Inv_Space_Spaces_In_Config 
   SetCurrentTimeslice_Inv_Space_InitialSpaces_In_Spaces SetCurrentTimeslice_Inv_Space_Perms_Subset
   SetCurrentTimeslice_Inv_Space_Spaces_IsNot_None SetCurrentTimeslice_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Sigma0_Space_def p1 SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_IntThreads_Space_def p1 SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_RootServer_Space_def p1 SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetCurrentTimeslice_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetCurrentTimeslice_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetCurrentTimeslice_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    SetCurrentTimeslice_Inv_Idle_NotIn_Threads SetCurrentTimeslice_Inv_Idle_Space_Is_KernelSpace
    SetCurrentTimeslice_Inv_Sigma0_Space SetCurrentTimeslice_Inv_IntThreads_Space
    SetCurrentTimeslice_Inv_RootServer_Space SetCurrentTimeslice_Inv_Sigma0_In_Active 
    SetCurrentTimeslice_Inv_RootServer_In_Active SetCurrentTimeslice_Inv_IntThreads_In_Active 
    SetCurrentTimeslice_Inv_Threads_In_Config SetCurrentTimeslice_Inv_Active_In_Threads 
    SetCurrentTimeslice_Inv_NThreads_Is_None SetCurrentTimeslice_Inv_Threads_IsNot_None 
    SetCurrentTimeslice_Inv_Threads_Space_In_Spaces SetCurrentTimeslice_Inv_Threads_Sche_In_Threads 
    SetCurrentTimeslice_Inv_NActive_Utcb_Is_None SetCurrentTimeslice_Inv_Active_Utcb_IsNot_None
    SetCurrentTimeslice_Inv_IntThreads_Utcb_Is_None 
    SetCurrentTimeslice_Inv_Threads_Partner_In_Threads SetCurrentTimeslice_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def 
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> SetCurrentTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> SetCurrentTimeslice_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetCurrentTimeslice <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTimeslice_Inv_Current SetCurrentTimeslice_Inv_Space SetCurrentTimeslice_Inv_Thread SetCurrentTimeslice_Inv_Schedule SetCurrentTimeslice_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹enqueue_wait›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_wait_Inv_Current_Thread_In_Active enqueue_wait_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> enqueue_wait_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enqueue_wait_rtran enqueue_wait_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enqueue_wait_valid enqueue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    enqueue_wait_direct_eq enqueue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_wait_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_wait_Inv_Space_HasNot_Loop enqueue_wait_Inv_Space_Valid_Has_Real
   enqueue_wait_Inv_Space_Perms_IsNot_Empty enqueue_wait_Inv_Space_Spaces_In_Config 
   enqueue_wait_Inv_Space_InitialSpaces_In_Spaces enqueue_wait_Inv_Space_Perms_Subset
   enqueue_wait_Inv_Space_Spaces_IsNot_None enqueue_wait_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Sigma0_Space_def p1 enqueue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_IntThreads_Space_def p1 enqueue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_RootServer_Space_def p1 enqueue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def enqueue_wait_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def enqueue_wait_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def enqueue_wait_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    enqueue_wait_Inv_Idle_NotIn_Threads enqueue_wait_Inv_Idle_Space_Is_KernelSpace
    enqueue_wait_Inv_Sigma0_Space enqueue_wait_Inv_IntThreads_Space
    enqueue_wait_Inv_RootServer_Space enqueue_wait_Inv_Sigma0_In_Active 
    enqueue_wait_Inv_RootServer_In_Active enqueue_wait_Inv_IntThreads_In_Active 
    enqueue_wait_Inv_Threads_In_Config enqueue_wait_Inv_Active_In_Threads 
    enqueue_wait_Inv_NThreads_Is_None enqueue_wait_Inv_Threads_IsNot_None 
    enqueue_wait_Inv_Threads_Space_In_Spaces enqueue_wait_Inv_Threads_Sche_In_Threads 
    enqueue_wait_Inv_NActive_Utcb_Is_None enqueue_wait_Inv_Active_Utcb_IsNot_None
    enqueue_wait_Inv_IntThreads_Utcb_Is_None 
    enqueue_wait_Inv_Threads_Partner_In_Threads enqueue_wait_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> enqueue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>enqueue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_wait_def Inv_Schedule_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_wait_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">gno</span> <span class="main">∈</span> active_threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>enqueue_wait <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_wait_Inv_Current enqueue_wait_Inv_Space enqueue_wait_Inv_Thread enqueue_wait_Inv_Schedule enqueue_wait_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹dequeue_wait›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> dequeue_wait_Inv_Current_Thread_In_Active dequeue_wait_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> dequeue_wait_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dequeue_wait_rtran dequeue_wait_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dequeue_wait_valid dequeue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    dequeue_wait_direct_eq dequeue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_wait_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_wait_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_wait_Inv_Space_HasNot_Loop dequeue_wait_Inv_Space_Valid_Has_Real
   dequeue_wait_Inv_Space_Perms_IsNot_Empty dequeue_wait_Inv_Space_Spaces_In_Config 
   dequeue_wait_Inv_Space_InitialSpaces_In_Spaces dequeue_wait_Inv_Space_Perms_Subset
   dequeue_wait_Inv_Space_Spaces_IsNot_None dequeue_wait_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Sigma0_Space_def p1 dequeue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_IntThreads_Space_def p1 dequeue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_RootServer_Space_def p1 dequeue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_wait_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def dequeue_wait_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def dequeue_wait_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def dequeue_wait_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    dequeue_wait_Inv_Idle_NotIn_Threads dequeue_wait_Inv_Idle_Space_Is_KernelSpace
    dequeue_wait_Inv_Sigma0_Space dequeue_wait_Inv_IntThreads_Space
    dequeue_wait_Inv_RootServer_Space dequeue_wait_Inv_Sigma0_In_Active 
    dequeue_wait_Inv_RootServer_In_Active dequeue_wait_Inv_IntThreads_In_Active 
    dequeue_wait_Inv_Threads_In_Config dequeue_wait_Inv_Active_In_Threads 
    dequeue_wait_Inv_NThreads_Is_None dequeue_wait_Inv_Threads_IsNot_None 
    dequeue_wait_Inv_Threads_Space_In_Spaces dequeue_wait_Inv_Threads_Sche_In_Threads 
    dequeue_wait_Inv_NActive_Utcb_Is_None dequeue_wait_Inv_Active_Utcb_IsNot_None
    dequeue_wait_Inv_IntThreads_Utcb_Is_None 
    dequeue_wait_Inv_Threads_Partner_In_Threads dequeue_wait_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> dequeue_wait_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>dequeue_wait <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def dequeue_wait_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> set_remove1_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">force</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> dequeue_wait_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>dequeue_wait <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_wait_Inv_Current dequeue_wait_Inv_Space dequeue_wait_Inv_Thread dequeue_wait_Inv_Schedule dequeue_wait_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹enqueue_ready›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_ready_Inv_Current_Thread_In_Active enqueue_ready_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> enqueue_ready_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enqueue_ready_rtran enqueue_ready_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enqueue_ready_valid enqueue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    enqueue_ready_direct_eq enqueue_ready_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_ready_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_ready_Inv_Space_HasNot_Loop enqueue_ready_Inv_Space_Valid_Has_Real
   enqueue_ready_Inv_Space_Perms_IsNot_Empty enqueue_ready_Inv_Space_Spaces_In_Config 
   enqueue_ready_Inv_Space_InitialSpaces_In_Spaces enqueue_ready_Inv_Space_Perms_Subset
   enqueue_ready_Inv_Space_Spaces_IsNot_None enqueue_ready_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> enqueue_ready_def Let_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def enqueue_ready_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def enqueue_ready_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def enqueue_ready_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    enqueue_ready_Inv_Idle_NotIn_Threads enqueue_ready_Inv_Idle_Space_Is_KernelSpace
    enqueue_ready_Inv_Sigma0_Space enqueue_ready_Inv_IntThreads_Space
    enqueue_ready_Inv_RootServer_Space enqueue_ready_Inv_Sigma0_In_Active 
    enqueue_ready_Inv_RootServer_In_Active enqueue_ready_Inv_IntThreads_In_Active 
    enqueue_ready_Inv_Threads_In_Config enqueue_ready_Inv_Active_In_Threads 
    enqueue_ready_Inv_NThreads_Is_None enqueue_ready_Inv_Threads_IsNot_None 
    enqueue_ready_Inv_Threads_Space_In_Spaces enqueue_ready_Inv_Threads_Sche_In_Threads 
    enqueue_ready_Inv_NActive_Utcb_Is_None enqueue_ready_Inv_Active_Utcb_IsNot_None
    enqueue_ready_Inv_IntThreads_Utcb_Is_None 
    enqueue_ready_Inv_Threads_Partner_In_Threads enqueue_ready_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> enqueue_ready_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def enqueue_ready_def Let_def enqueue_ready_queuing_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_ready_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">gno</span> <span class="main">∈</span> active_threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>enqueue_ready <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_ready_Inv_Current enqueue_ready_Inv_Space enqueue_ready_Inv_Thread enqueue_ready_Inv_Schedule enqueue_ready_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹dequeue_ready›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_Inv_Current_Thread_In_Active dequeue_ready_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> dequeue_ready_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dequeue_ready_rtran dequeue_ready_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dequeue_ready_valid dequeue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    dequeue_ready_direct_eq dequeue_ready_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_ready_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_Inv_Space_HasNot_Loop dequeue_ready_Inv_Space_Valid_Has_Real
   dequeue_ready_Inv_Space_Perms_IsNot_Empty dequeue_ready_Inv_Space_Spaces_In_Config 
   dequeue_ready_Inv_Space_InitialSpaces_In_Spaces dequeue_ready_Inv_Space_Perms_Subset
   dequeue_ready_Inv_Space_Spaces_IsNot_None dequeue_ready_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Let_def Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Let_def Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Let_def Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dequeue_ready_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def dequeue_ready_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def dequeue_ready_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def dequeue_ready_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    dequeue_ready_Inv_Idle_NotIn_Threads dequeue_ready_Inv_Idle_Space_Is_KernelSpace
    dequeue_ready_Inv_Sigma0_Space dequeue_ready_Inv_IntThreads_Space
    dequeue_ready_Inv_RootServer_Space dequeue_ready_Inv_Sigma0_In_Active 
    dequeue_ready_Inv_RootServer_In_Active dequeue_ready_Inv_IntThreads_In_Active 
    dequeue_ready_Inv_Threads_In_Config dequeue_ready_Inv_Active_In_Threads 
    dequeue_ready_Inv_NThreads_Is_None dequeue_ready_Inv_Threads_IsNot_None 
    dequeue_ready_Inv_Threads_Space_In_Spaces dequeue_ready_Inv_Threads_Sche_In_Threads 
    dequeue_ready_Inv_NActive_Utcb_Is_None dequeue_ready_Inv_Active_Utcb_IsNot_None
    dequeue_ready_Inv_IntThreads_Utcb_Is_None 
    dequeue_ready_Inv_Threads_Partner_In_Threads dequeue_ready_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> dequeue_ready_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>dequeue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def dequeue_ready_def dequeue_ready_queuing_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> set_remove1_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">force</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> dequeue_ready_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>dequeue_ready <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_Inv_Current dequeue_ready_Inv_Space dequeue_ready_Inv_Thread dequeue_ready_Inv_Schedule dequeue_ready_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹enqueue_readys›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_Inv_Current_Thread_In_Active enqueue_readys_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> enqueue_readys_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enqueue_readys_rtran enqueue_readys_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enqueue_readys_valid enqueue_readys_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_readys_direct_eq enqueue_readys_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_readys_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_readys_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>enqueue_readys_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_Inv_Space_HasNot_Loop enqueue_readys_Inv_Space_Valid_Has_Real
   enqueue_readys_Inv_Space_Perms_IsNot_Empty enqueue_readys_Inv_Space_Spaces_In_Config 
   enqueue_readys_Inv_Space_InitialSpaces_In_Spaces enqueue_readys_Inv_Space_Perms_Subset
   enqueue_readys_Inv_Space_Spaces_IsNot_None enqueue_readys_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def spaces_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    enqueue_readys_Inv_Idle_NotIn_Threads enqueue_readys_Inv_Idle_Space_Is_KernelSpace
    enqueue_readys_Inv_Sigma0_Space enqueue_readys_Inv_IntThreads_Space
    enqueue_readys_Inv_RootServer_Space enqueue_readys_Inv_Sigma0_In_Active 
    enqueue_readys_Inv_RootServer_In_Active enqueue_readys_Inv_IntThreads_In_Active 
    enqueue_readys_Inv_Threads_In_Config enqueue_readys_Inv_Active_In_Threads 
    enqueue_readys_Inv_NThreads_Is_None enqueue_readys_Inv_Threads_IsNot_None 
    enqueue_readys_Inv_Threads_Space_In_Spaces enqueue_readys_Inv_Threads_Sche_In_Threads 
    enqueue_readys_Inv_NActive_Utcb_Is_None enqueue_readys_Inv_Active_Utcb_IsNot_None
    enqueue_readys_Inv_IntThreads_Utcb_Is_None 
    enqueue_readys_Inv_Threads_Partner_In_Threads enqueue_readys_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def<span class="main">)</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> ready_queue_enqueue_readys_prop<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> set<span class="main">(</span>ready_queuing <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span>  set <span class="main">(</span>ready_queuing <span class="free">s</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">t</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>enqueue_ready_def Let_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_insertI2<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>enqueue_ready_queuing_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"set<span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_NC_Thread enqueue_readys_NC_Scheduling p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> p0<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> ready_queue_enqueue_readys_prop enqueue_readys_NC_Thread p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> set<span class="main">(</span><span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> active_threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>enqueue_readys <span class="bound">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_Inv_Current enqueue_readys_Inv_Space enqueue_readys_Inv_Thread enqueue_readys_Inv_Schedule enqueue_readys_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹dequeue_waits›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> dequeue_waits_Inv_Current_Thread_In_Active dequeue_waits_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> dequeue_waits_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dequeue_waits_rtran dequeue_waits_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dequeue_waits_valid dequeue_waits_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_waits_direct_eq dequeue_waits_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_waits_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_waits_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dequeue_waits_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_waits_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_waits_Inv_Space_HasNot_Loop dequeue_waits_Inv_Space_Valid_Has_Real
   dequeue_waits_Inv_Space_Perms_IsNot_Empty dequeue_waits_Inv_Space_Spaces_In_Config 
   dequeue_waits_Inv_Space_InitialSpaces_In_Spaces dequeue_waits_Inv_Space_Perms_Subset
   dequeue_waits_Inv_Space_Spaces_IsNot_None dequeue_waits_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    dequeue_waits_Inv_Idle_NotIn_Threads dequeue_waits_Inv_Idle_Space_Is_KernelSpace
    dequeue_waits_Inv_Sigma0_Space dequeue_waits_Inv_IntThreads_Space
    dequeue_waits_Inv_RootServer_Space dequeue_waits_Inv_Sigma0_In_Active 
    dequeue_waits_Inv_RootServer_In_Active dequeue_waits_Inv_IntThreads_In_Active 
    dequeue_waits_Inv_Threads_In_Config dequeue_waits_Inv_Active_In_Threads 
    dequeue_waits_Inv_NThreads_Is_None dequeue_waits_Inv_Threads_IsNot_None 
    dequeue_waits_Inv_Threads_Space_In_Spaces dequeue_waits_Inv_Threads_Sche_In_Threads 
    dequeue_waits_Inv_NActive_Utcb_Is_None dequeue_waits_Inv_Active_Utcb_IsNot_None
    dequeue_waits_Inv_IntThreads_Utcb_Is_None 
    dequeue_waits_Inv_Threads_Partner_In_Threads dequeue_waits_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dequeue_wait_def<span class="main">)</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="main"><span class="main">(</span></span><span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> dequeue_wait_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> set_remove1_subset subset_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> dequeue_waits_NC_Scheduling dequeue_waits_NC_Thread p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>dequeue_waits <span class="bound">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_waits_Inv_Current dequeue_waits_Inv_Space dequeue_waits_Inv_Thread dequeue_waits_Inv_Schedule dequeue_waits_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹switch_to›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">=</span> idle <span class="main">∨</span> <span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">=</span> idle <span class="main">∨</span> <span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span> <span class="main">∧</span> Inv_Active_In_Threads <span class="free">s</span> <span class="main">∧</span> Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def Inv_Active_In_Threads_def Inv_Threads_IsNot_None_def</span><span class="main">]</span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">=</span> idle <span class="main">∨</span> <span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span> <span class="main">∧</span> Inv_Active_In_Threads <span class="free">s</span> <span class="main">∧</span> Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_to_Inv_Current_Thread_In_Active switch_to_Inv_Current_Space_IsNot_None
    Inv_Current_def p0 p1 p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> switch_to_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> switch_to_rtran switch_to_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> switch_to_valid switch_to_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    switch_to_direct_eq switch_to_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>switch_to_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>switch_to_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>switch_to_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> switch_to_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> switch_to_Inv_Space_HasNot_Loop switch_to_Inv_Space_Valid_Has_Real
   switch_to_Inv_Space_Perms_IsNot_Empty switch_to_Inv_Space_Spaces_In_Config 
   switch_to_Inv_Space_InitialSpaces_In_Spaces switch_to_Inv_Space_Perms_Subset
   switch_to_Inv_Space_Spaces_IsNot_None switch_to_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> switch_to_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def switch_to_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def switch_to_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def switch_to_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    switch_to_Inv_Idle_NotIn_Threads switch_to_Inv_Idle_Space_Is_KernelSpace
    switch_to_Inv_Sigma0_Space switch_to_Inv_IntThreads_Space
    switch_to_Inv_RootServer_Space switch_to_Inv_Sigma0_In_Active 
    switch_to_Inv_RootServer_In_Active switch_to_Inv_IntThreads_In_Active 
    switch_to_Inv_Threads_In_Config switch_to_Inv_Active_In_Threads 
    switch_to_Inv_NThreads_Is_None switch_to_Inv_Threads_IsNot_None 
    switch_to_Inv_Threads_Space_In_Spaces switch_to_Inv_Threads_Sche_In_Threads 
    switch_to_Inv_NActive_Utcb_Is_None switch_to_Inv_Active_Utcb_IsNot_None
    switch_to_Inv_IntThreads_Utcb_Is_None 
    switch_to_Inv_Threads_Partner_In_Threads switch_to_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> switch_to_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>switch_to <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def switch_to_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> set_remove1_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">force</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> switch_to_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">gno</span> <span class="main">=</span> idle <span class="main">∨</span> <span class="free">gno</span> <span class="main">∈</span> active_threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>switch_to <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Thread_def switch_to_Inv_Current <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> switch_to_Inv_Space switch_to_Inv_Thread switch_to_Inv_Schedule switch_to_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Scheduling›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> find_next_thread_result_p<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span> <span class="main">⟶</span>
 <span class="main">(</span>find_max_queuing_thread <span class="main">(</span>ready_queuing <span class="free">s</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> idle <span class="main">∨</span> find_max_queuing_thread <span class="main">(</span>ready_queuing <span class="free">s</span><span class="main">)</span> <span class="free">n</span> <span class="main">∈</span> active_threads <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> last_in_set <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> last_in_set <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> find_next_thread_result<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">=</span> find_next_thread <span class="free">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">r</span> <span class="main">=</span> idle <span class="main">∨</span> <span class="free">r</span> <span class="main">∈</span> active_threads <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> find_next_thread_def 
  <span class="keyword1"><span class="command">using</span></span> find_next_thread_result_p <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduling_def enqueue_ready_def Let_def switch_to_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> p2 find_next_thread_result
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span> <span class="main">∧</span> Inv_Active_In_Threads <span class="free">s</span> <span class="main">∧</span> Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>current_thread <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> idle <span class="main">∨</span> <span class="main">(</span>current_thread <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> active_threads <span class="free">s</span> <span class="main">∨</span> <span class="main">(</span>current_thread <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command">using</span></span> p0 find_next_thread_result Scheduling_def enqueue_ready_def Let_def switch_to_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def Inv_Active_In_Threads_def Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> Scheduling_NC_Thread 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span> <span class="main">∧</span> Inv_Idle_Space_Is_KernelSpace <span class="free">s</span> <span class="main">∧</span> Inv_Active_In_Threads <span class="free">s</span> <span class="main">∧</span> Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Scheduling_Inv_Current_Thread_In_Active Scheduling_Inv_Current_Space_IsNot_None
    Inv_Current_def p0 p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Scheduling_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Scheduling_rtran Scheduling_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Scheduling_valid Scheduling_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
    Scheduling_direct_eq Scheduling_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Scheduling_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Scheduling_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Scheduling_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> Scheduling_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> Scheduling_Inv_Space_HasNot_Loop Scheduling_Inv_Space_Valid_Has_Real
   Scheduling_Inv_Space_Perms_IsNot_Empty Scheduling_Inv_Space_Spaces_In_Config 
   Scheduling_Inv_Space_InitialSpaces_In_Spaces Scheduling_Inv_Space_Perms_Subset
   Scheduling_Inv_Space_Spaces_IsNot_None Scheduling_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_IPC Scheduling_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> Scheduling_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> Scheduling_NC_Thread Scheduling_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    Scheduling_Inv_Idle_NotIn_Threads Scheduling_Inv_Idle_Space_Is_KernelSpace
    Scheduling_Inv_Sigma0_Space Scheduling_Inv_IntThreads_Space
    Scheduling_Inv_RootServer_Space Scheduling_Inv_Sigma0_In_Active 
    Scheduling_Inv_RootServer_In_Active Scheduling_Inv_IntThreads_In_Active 
    Scheduling_Inv_Threads_In_Config Scheduling_Inv_Active_In_Threads 
    Scheduling_Inv_NThreads_Is_None Scheduling_Inv_Threads_IsNot_None 
    Scheduling_Inv_Threads_Space_In_Spaces Scheduling_Inv_Threads_Sche_In_Threads 
    Scheduling_Inv_NActive_Utcb_Is_None Scheduling_Inv_Active_Utcb_IsNot_None
    Scheduling_Inv_IntThreads_Utcb_Is_None 
    Scheduling_Inv_Threads_Partner_In_Threads Scheduling_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def 
    Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def 
Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> Scheduling_def switch_to_def enqueue_ready_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Let_def<span class="main">)</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">cur</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>Scheduling <span class="free">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def Scheduling_def switch_to_def enqueue_ready_def Let_def enqueue_ready_queuing_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> Scheduling_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">cur</span> <span class="main">∈</span> active_threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>Scheduling <span class="bound">s</span> <span class="free">cur</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">using</span></span> Scheduling_Inv_Current Inv_Thread_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">using</span></span> Scheduling_Inv_Space Scheduling_Inv_Thread Scheduling_Inv_Schedule Scheduling_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹modify_expired_threads_state›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_Inv_Current_Thread_In_Active modify_expired_threads_state_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> modify_expired_threads_state_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> modify_expired_threads_state_rtran modify_expired_threads_state_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> modify_expired_threads_state_valid modify_expired_threads_state_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> modify_expired_threads_state_direct_eq modify_expired_threads_state_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>modify_expired_threads_state_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>modify_expired_threads_state_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>modify_expired_threads_state_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_Inv_Space_HasNot_Loop modify_expired_threads_state_Inv_Space_Valid_Has_Real
   modify_expired_threads_state_Inv_Space_Perms_IsNot_Empty modify_expired_threads_state_Inv_Space_Spaces_In_Config 
   modify_expired_threads_state_Inv_Space_InitialSpaces_In_Spaces modify_expired_threads_state_Inv_Space_Perms_Subset
   modify_expired_threads_state_Inv_Space_Spaces_IsNot_None modify_expired_threads_state_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"set <span class="free">xs</span> <span class="main">⊆</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_NC_Thread
    p1 SetThreadState_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"set <span class="free">xs</span> <span class="main">⊆</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p1
    modify_expired_threads_state_Inv_Idle_NotIn_Threads modify_expired_threads_state_Inv_Idle_Space_Is_KernelSpace
    modify_expired_threads_state_Inv_Sigma0_Space modify_expired_threads_state_Inv_IntThreads_Space
    modify_expired_threads_state_Inv_RootServer_Space modify_expired_threads_state_Inv_Sigma0_In_Active 
    modify_expired_threads_state_Inv_RootServer_In_Active modify_expired_threads_state_Inv_IntThreads_In_Active 
    modify_expired_threads_state_Inv_Threads_In_Config modify_expired_threads_state_Inv_Active_In_Threads 
    modify_expired_threads_state_Inv_NThreads_Is_None modify_expired_threads_state_Inv_Threads_IsNot_None 
    modify_expired_threads_state_Inv_Threads_Space_In_Spaces modify_expired_threads_state_Inv_Threads_Sche_In_Threads 
    modify_expired_threads_state_Inv_NActive_Utcb_Is_None modify_expired_threads_state_Inv_Active_Utcb_IsNot_None
    modify_expired_threads_state_Inv_IntThreads_Utcb_Is_None 
    modify_expired_threads_state_Inv_Threads_Partner_In_Threads modify_expired_threads_state_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"set <span class="free">xs</span> <span class="main">⊆</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>modify_expired_threads_state <span class="free">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p0
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def SetThreadState_def
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_NC_Scheduling
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> modify_expired_threads_state_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> set <span class="free">xs</span> <span class="main">⊆</span> threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>modify_expired_threads_state <span class="bound">s</span> <span class="free">xs</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_Inv_Current modify_expired_threads_state_Inv_Space modify_expired_threads_state_Inv_Thread modify_expired_threads_state_Inv_Schedule modify_expired_threads_state_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹parse_wakeup_queues›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> enqueue_readys_C_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">prio</span><span class="main">.</span> Inv_Schedule <span class="free">s</span> <span class="main">⟹</span> set <span class="free">xs</span> <span class="main">⊆</span> active_threads <span class="free">s</span> <span class="main">⟹</span> set <span class="main">(</span>ready_queuing <span class="main">(</span>enqueue_readys <span class="free">s</span> <span class="free">xs</span><span class="main">)</span> <span class="bound">prio</span><span class="main">)</span> <span class="main">⊆</span> active_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enqueue_ready_def Let_def GetThreadPriority_def enqueue_ready_queuing_def Inv_Schedule_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dequeue_waits_C_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"set <span class="main">(</span>wait_queuing <span class="main">(</span>dequeue_waits <span class="free">s</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>wait_queuing <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">xs</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dequeue_wait_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> in_mono notin_set_remove1<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> find_expired_threads_is_subset<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"set <span class="main">(</span>find_expired_threads <span class="free">s</span> <span class="free">wait_list</span> <span class="free">cur_time</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">wait_list</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">wait_list</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_NC_Thread_Cond<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> active_threads <span class="free">s</span> <span class="main">⟹</span> Inv_Schedule <span class="free">s</span> <span class="main">⟹</span> thread_state <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="bound">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> modify_expired_threads_state_NC_Thread_Cond<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> enqueue_readys_NC_Thread dequeue_waits_NC_Thread
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language"><span class="quoted"><span class="language">"set <span class="main"><span class="main">(</span></span>wait_queuing <span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">using</span></span> find_expired_threads_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">using</span></span> enqueue_readys_NC_Thread dequeue_waits_NC_Thread Inv_Schedule_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_NC_Thread dequeue_waits_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_NC_Config<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> Threads_Gno SysConf <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> threads <span class="free">s</span> <span class="main">⟹</span> Inv_Schedule <span class="free">s</span> <span class="main">⟹</span> Inv_Active_In_Threads <span class="free">s</span>
 <span class="main">⟹</span> thread_state <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="bound">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> modify_expired_threads_state_NC_Thread_Cond<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> enqueue_readys_NC_Thread dequeue_waits_NC_Thread
      Inv_Active_In_Threads_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Inv_Schedule_def enqueue_readys_NC_Thread dequeue_waits_NC_Thread
      find_expired_threads_is_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_NC_Thread dequeue_waits_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_C_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> threads <span class="free">s</span> <span class="main">⟹</span> Inv_Threads_IsNot_None <span class="free">s</span> <span class="main">⟹</span> thread_state <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> None"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> modify_expired_threads_state_C_Thread<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> enqueue_readys_NC_Thread dequeue_waits_NC_Thread
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_readys_Inv_Threads_IsNot_None dequeue_waits_Inv_Threads_IsNot_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Inv_Current_Thread_In_Active_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_NC_Current dequeue_waits_NC_Current enqueue_readys_NC_Current
  modify_expired_threads_state_NC_Thread dequeue_waits_NC_Thread enqueue_readys_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Inv_Current_Space_IsNot_None_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> modify_expired_threads_state_NC_Current dequeue_waits_NC_Current enqueue_readys_NC_Current
    modify_expired_threads_state_NC_Thread dequeue_waits_NC_Thread enqueue_readys_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_Inv_Current_Thread_In_Active parse_wakeup_queues_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> parse_wakeup_queues_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parse_wakeup_queues_rtran parse_wakeup_queues_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parse_wakeup_queues_valid parse_wakeup_queues_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parse_wakeup_queues_direct_eq parse_wakeup_queues_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>parse_wakeup_queues_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>parse_wakeup_queues_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>parse_wakeup_queues_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_Inv_Space_HasNot_Loop parse_wakeup_queues_Inv_Space_Valid_Has_Real
   parse_wakeup_queues_Inv_Space_Perms_IsNot_Empty parse_wakeup_queues_Inv_Space_Spaces_In_Config 
   parse_wakeup_queues_Inv_Space_InitialSpaces_In_Spaces parse_wakeup_queues_Inv_Space_Perms_Subset
   parse_wakeup_queues_Inv_Space_Spaces_IsNot_None parse_wakeup_queues_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadError_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p2 p3
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_User
    parse_wakeup_queues_NC_IPC parse_wakeup_queues_NC_Config
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span>  parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_IPC 
    parse_wakeup_queues_C_Thread<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_NC_Thread parse_wakeup_queues_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> parse_wakeup_queues_Inv_Idle_NotIn_Threads p2
    parse_wakeup_queues_Inv_Idle_NotIn_Threads parse_wakeup_queues_Inv_Idle_Space_Is_KernelSpace
    parse_wakeup_queues_Inv_Sigma0_Space parse_wakeup_queues_Inv_IntThreads_Space
    parse_wakeup_queues_Inv_RootServer_Space parse_wakeup_queues_Inv_Sigma0_In_Active 
    parse_wakeup_queues_Inv_RootServer_In_Active parse_wakeup_queues_Inv_IntThreads_In_Active 
    parse_wakeup_queues_Inv_Threads_In_Config parse_wakeup_queues_Inv_Active_In_Threads 
    parse_wakeup_queues_Inv_NThreads_Is_None parse_wakeup_queues_Inv_Threads_IsNot_None 
    parse_wakeup_queues_Inv_Threads_Space_In_Spaces parse_wakeup_queues_Inv_Threads_Sche_In_Threads 
    parse_wakeup_queues_Inv_NActive_Utcb_Is_None parse_wakeup_queues_Inv_Active_Utcb_IsNot_None
    parse_wakeup_queues_Inv_IntThreads_Utcb_Is_None 
    parse_wakeup_queues_Inv_Threads_Partner_In_Threads parse_wakeup_queues_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> parse_wakeup_queues_NC_IPC parse_wakeup_queues_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">thm</span></span> parse_wakeup_queues_NC_Scheduling
<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> parse_wakeup_queues_NC_Thread<span class="main">)</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Let_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> modify_expired_threads_state_NC_Scheduling<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> enqueue_readys_NC_Scheduling<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"set <span class="main">(</span>wait_queuing
          <span class="main">(</span>dequeue_waits <span class="free">s</span>
            <span class="main">(</span>find_expired_threads <span class="free">s</span> <span class="main">(</span>wait_queuing <span class="free">s</span><span class="main">)</span> <span class="main">(</span>current_time <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>wait_queuing <span class="free">s</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> dequeue_waits_C_Scheduling<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> parse_wakeup_queues_NC_Thread<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> modify_expired_threads_state_NC_Scheduling<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> t <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language"><span class="quoted"><span class="language">"active_threads <span class="free"><span class="free">s</span></span>"</span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language"><span class="quoted"><span class="language">"active_threads <span class="main"><span class="main">(</span></span>dequeue_waits <span class="free"><span class="free">s</span></span>
                  <span class="main"><span class="main">(</span></span>find_expired_threads <span class="free"><span class="free">s</span></span> <span class="main"><span class="main">(</span></span>wait_queuing <span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>current_time <span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dequeue_waits_NC_Thread
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> enqueue_readys_C_Scheduling<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 dequeue_waits_Inv_Schedule
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> dequeue_waits_NC_Thread<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> find_expired_threads_is_subset Inv_Schedule_def p1
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues <span class="bound">s</span> <span class="free">cur</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_Inv_Current parse_wakeup_queues_Inv_Space parse_wakeup_queues_Inv_Thread parse_wakeup_queues_Inv_Schedule parse_wakeup_queues_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹end_of_timeslice›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> end_of_timeslice_NC_Current end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> end_of_timeslice_NC_Current end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> end_of_timeslice_Inv_Current_Thread_In_Active end_of_timeslice_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> end_of_timeslice_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> end_of_timeslice_rtran end_of_timeslice_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> end_of_timeslice_valid end_of_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> end_of_timeslice_direct_eq end_of_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>end_of_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>end_of_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>end_of_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> end_of_timeslice_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> end_of_timeslice_Inv_Space_HasNot_Loop end_of_timeslice_Inv_Space_Valid_Has_Real
   end_of_timeslice_Inv_Space_Perms_IsNot_Empty end_of_timeslice_Inv_Space_Spaces_In_Config 
   end_of_timeslice_Inv_Space_InitialSpaces_In_Spaces end_of_timeslice_Inv_Space_Perms_Subset
   end_of_timeslice_Inv_Space_Spaces_IsNot_None end_of_timeslice_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> p1 
  <span class="keyword1"><span class="command">unfolding</span></span> end_of_timeslice_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_NThreads_Is_None_def enqueue_ready_Inv_NThreads_Is_None SetThreadCurrentTimeslice_Inv_NThreads_Is_None <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_ready_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> p1
  <span class="keyword1"><span class="command">unfolding</span></span> end_of_timeslice_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="main">(</span>enqueue_ready <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Threads_IsNot_None_def
  enqueue_ready_Inv_Threads_IsNot_None SetThreadCurrentTimeslice_Inv_Threads_IsNot_None <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> enqueue_ready_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>


<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> end_of_timeslice_NC_Thread end_of_timeslice_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> end_of_timeslice_NC_Thread end_of_timeslice_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> end_of_timeslice_NC_Thread end_of_timeslice_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> end_of_timeslice_NC_Thread end_of_timeslice_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> end_of_timeslice_NC_Thread end_of_timeslice_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> end_of_timeslice_NC_Thread end_of_timeslice_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    end_of_timeslice_Inv_Idle_NotIn_Threads end_of_timeslice_Inv_Idle_Space_Is_KernelSpace
    end_of_timeslice_Inv_Sigma0_Space end_of_timeslice_Inv_IntThreads_Space
    end_of_timeslice_Inv_RootServer_Space end_of_timeslice_Inv_Sigma0_In_Active 
    end_of_timeslice_Inv_RootServer_In_Active end_of_timeslice_Inv_IntThreads_In_Active 
    end_of_timeslice_Inv_Threads_In_Config end_of_timeslice_Inv_Active_In_Threads 
    end_of_timeslice_Inv_NThreads_Is_None end_of_timeslice_Inv_Threads_IsNot_None 
    end_of_timeslice_Inv_Threads_Space_In_Spaces end_of_timeslice_Inv_Threads_Sche_In_Threads 
    end_of_timeslice_Inv_NActive_Utcb_Is_None end_of_timeslice_Inv_Active_Utcb_IsNot_None
    end_of_timeslice_Inv_IntThreads_Utcb_Is_None 
    end_of_timeslice_Inv_Threads_Partner_In_Threads end_of_timeslice_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> end_of_timeslice_NC_IPC end_of_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>end_of_timeslice <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1
  <span class="keyword1"><span class="command">unfolding</span></span> end_of_timeslice_def Let_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_Inv_Schedule enqueue_ready_Inv_Schedule Inv_Schedule_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> end_of_timeslice_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">gno</span> <span class="main">∈</span> active_threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>end_of_timeslice <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> end_of_timeslice_Inv_Current end_of_timeslice_Inv_Space end_of_timeslice_Inv_Thread end_of_timeslice_Inv_Schedule end_of_timeslice_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹preempt_thread›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> preempt_thread_NC_Current preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> preempt_thread_NC_Current preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> preempt_thread_Inv_Current_Thread_In_Active preempt_thread_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> preempt_thread_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preempt_thread_rtran preempt_thread_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preempt_thread_valid preempt_thread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preempt_thread_direct_eq preempt_thread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>preempt_thread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>preempt_thread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>preempt_thread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> preempt_thread_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> preempt_thread_Inv_Space_HasNot_Loop preempt_thread_Inv_Space_Valid_Has_Real
   preempt_thread_Inv_Space_Perms_IsNot_Empty preempt_thread_Inv_Space_Spaces_In_Config 
   preempt_thread_Inv_Space_InitialSpaces_In_Spaces preempt_thread_Inv_Space_Perms_Subset
   preempt_thread_Inv_Space_Spaces_IsNot_None preempt_thread_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">cur</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> p1 
  <span class="keyword1"><span class="command">unfolding</span></span> preempt_thread_def Let_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_Inv_NThreads_Is_None SetCurrentTimeslice_Inv_NThreads_Is_None enqueue_ready_Inv_NThreads_Is_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">cur</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> p1
  <span class="keyword1"><span class="command">unfolding</span></span> preempt_thread_def Let_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_Inv_Threads_IsNot_None SetCurrentTimeslice_Inv_Threads_IsNot_None
  enqueue_ready_Inv_Threads_IsNot_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>


<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> preempt_thread_NC_Thread preempt_thread_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> preempt_thread_NC_Thread preempt_thread_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> preempt_thread_NC_Thread preempt_thread_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> preempt_thread_NC_Thread preempt_thread_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> preempt_thread_NC_Thread preempt_thread_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> preempt_thread_NC_Thread preempt_thread_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">cur</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    preempt_thread_Inv_Idle_NotIn_Threads preempt_thread_Inv_Idle_Space_Is_KernelSpace
    preempt_thread_Inv_Sigma0_Space preempt_thread_Inv_IntThreads_Space
    preempt_thread_Inv_RootServer_Space preempt_thread_Inv_Sigma0_In_Active 
    preempt_thread_Inv_RootServer_In_Active preempt_thread_Inv_IntThreads_In_Active 
    preempt_thread_Inv_Threads_In_Config preempt_thread_Inv_Active_In_Threads 
    preempt_thread_Inv_NThreads_Is_None preempt_thread_Inv_Threads_IsNot_None 
    preempt_thread_Inv_Threads_Space_In_Spaces preempt_thread_Inv_Threads_Sche_In_Threads 
    preempt_thread_Inv_NActive_Utcb_Is_None preempt_thread_Inv_Active_Utcb_IsNot_None
    preempt_thread_Inv_IntThreads_Utcb_Is_None 
    preempt_thread_Inv_Threads_Partner_In_Threads preempt_thread_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> preempt_thread_NC_IPC preempt_thread_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">cur</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>preempt_thread <span class="free">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1
  <span class="keyword1"><span class="command">unfolding</span></span> preempt_thread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">cur</span> <span class="main">∈</span> active_threads <span class="main">(</span>SetCurrentTimeslice <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">cur</span> <span class="main">(</span>GetCurrentTimeslice <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>GetThreadCurrentTimeslice <span class="main">(</span>SetThreadCurrentTimeslice <span class="free">s</span> <span class="free">cur</span> <span class="main">(</span>GetCurrentTimeslice <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">dest</span><span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadCurrentTimeslice_Inv_Schedule SetCurrentTimeslice_Inv_Schedule enqueue_ready_Inv_Schedule <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTimeslice_def SetThreadCurrentTimeslice_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> preempt_thread_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">cur</span> <span class="main">∈</span> active_threads <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>preempt_thread <span class="bound">s</span> <span class="free">cur</span> <span class="free">dest</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> preempt_thread_Inv_Current preempt_thread_Inv_Space preempt_thread_Inv_Thread preempt_thread_Inv_Schedule preempt_thread_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>        

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹update_timeslice›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> update_timeslice_NC_Current update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> update_timeslice_NC_Current update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> update_timeslice_Inv_Current_Thread_In_Active update_timeslice_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> update_timeslice_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> update_timeslice_rtran update_timeslice_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> update_timeslice_valid update_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> update_timeslice_direct_eq update_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>update_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>update_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>update_timeslice_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> update_timeslice_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> update_timeslice_Inv_Space_HasNot_Loop update_timeslice_Inv_Space_Valid_Has_Real
   update_timeslice_Inv_Space_Perms_IsNot_Empty update_timeslice_Inv_Space_Spaces_In_Config 
   update_timeslice_Inv_Space_InitialSpaces_In_Spaces update_timeslice_Inv_Space_Perms_Subset
   update_timeslice_Inv_Space_Spaces_IsNot_None update_timeslice_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_Space_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Space_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_Space_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
     <span class="keyword2"><span class="keyword">and</span></span>  p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> update_timeslice_def Let_def total_quantum_expired_def SetThreadCurrentTimeslice_def SetThreadQuantum_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> update_timeslice_def Let_def total_quantum_expired_def SetThreadCurrentTimeslice_def SetThreadQuantum_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> update_timeslice_NC_Thread update_timeslice_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> update_timeslice_NC_Thread update_timeslice_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> update_timeslice_NC_Thread update_timeslice_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> update_timeslice_NC_Thread update_timeslice_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> update_timeslice_NC_Thread update_timeslice_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> update_timeslice_NC_Thread update_timeslice_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    update_timeslice_Inv_Idle_NotIn_Threads update_timeslice_Inv_Idle_Space_Is_KernelSpace
    update_timeslice_Inv_Sigma0_Space update_timeslice_Inv_IntThreads_Space
    update_timeslice_Inv_RootServer_Space update_timeslice_Inv_Sigma0_In_Active 
    update_timeslice_Inv_RootServer_In_Active update_timeslice_Inv_IntThreads_In_Active 
    update_timeslice_Inv_Threads_In_Config update_timeslice_Inv_Active_In_Threads 
    update_timeslice_Inv_NThreads_Is_None update_timeslice_Inv_Threads_IsNot_None 
    update_timeslice_Inv_Threads_Space_In_Spaces update_timeslice_Inv_Threads_Sche_In_Threads 
    update_timeslice_Inv_NActive_Utcb_Is_None update_timeslice_Inv_Active_Utcb_IsNot_None
    update_timeslice_Inv_IntThreads_Utcb_Is_None 
    update_timeslice_Inv_Threads_Partner_In_Threads update_timeslice_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_IPC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IPC <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IPC_def GetThreadsTids_def GnosToTids_def Inv_Recvfor_Not_NIL_def Inv_RecvTime_Not_Zero_def Inv_Recv_Is_None_def</span><span class="main">]</span> update_timeslice_NC_IPC update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Schedule›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv_Schedule<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Schedule_def 
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Schedule_def</span><span class="main">]</span> update_timeslice_NC_Scheduling update_timeslice_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> update_timeslice_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>update_timeslice <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> update_timeslice_Inv_Current update_timeslice_Inv_Space update_timeslice_Inv_Thread update_timeslice_Inv_Schedule update_timeslice_Inv_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹handle_time_interrupt›</span></span></span>
<span class="keyword1"><span class="command">thm</span></span> find_highest_thread.simps
<span class="keyword1"><span class="command">lemma</span></span> find_highest_thread_result<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">cur</span> <span class="main">∈</span> active_threads <span class="free">s</span> <span class="main">⟶</span> set <span class="main">(</span><span class="free">list</span><span class="main">)</span> <span class="main">⊆</span> active_threads <span class="free">s</span> <span class="main">⟶</span> 
 <span class="main">(</span>find_highest_thread <span class="free">s</span> <span class="free">list</span> <span class="free">cur</span><span class="main">)</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"find_highest_thread <span class="free">s</span> <span class="free">list</span> <span class="free">cur</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="free">list</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">cur</span><span class="main">}</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">list</span></span></span> <span class="quasi_keyword">arbitrary</span> <span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">cur</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parse_wakeup_queues_result<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="free">s</span> <span class="main">⟶</span> <span class="free">cur</span> <span class="main">∈</span> active_threads <span class="free">s</span> <span class="main">⟶</span> snd <span class="main">(</span>parse_wakeup_queues <span class="free">s</span> <span class="free">cur</span><span class="main">)</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parse_wakeup_queues_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>find_highest_thread <span class="free">s</span> <span class="main">(</span>find_expired_threads <span class="free">s</span> <span class="main">(</span>wait_queuing <span class="free">s</span><span class="main">)</span> <span class="main">(</span>current_time <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="free">cur</span><span class="main">)</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"set <span class="main">(</span>find_expired_threads <span class="free">s</span> <span class="main">(</span>wait_queuing <span class="free">s</span><span class="main">)</span> <span class="main">(</span>current_time <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> active_threads <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command">using</span></span> find_expired_threads_is_subset Inv_Schedule_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> find_highest_thread_result <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span> 

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹handle_time_interrupt›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> handle_time_interrupt_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>handle_time_interrupt <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> handle_time_interrupt_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">=</span> idle"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTime_Inv parse_wakeup_queues_Inv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="main">(</span>current_timeslice
                        <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues
                               <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="main">(</span>current_time <span class="free">s</span> <span class="main">+</span> TIMER_TICK_LENGTH<span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span>current_thread <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                       TIMER_TICK_LENGTH
                       <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span>
                       thread_timeslice_length
                        <span class="main">(</span>fst <span class="main">(</span>parse_wakeup_queues
                               <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="main">(</span>current_time <span class="free">s</span> <span class="main">+</span> TIMER_TICK_LENGTH<span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span>current_thread <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span>current_thread <span class="free">s</span><span class="main">)</span> <span class="main">≠</span>
                       Some <span class="main">0</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"snd <span class="main">(</span>parse_wakeup_queues
                              <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="main">(</span>current_time <span class="free">s</span> <span class="main">+</span> TIMER_TICK_LENGTH<span class="main">)</span><span class="main">)</span>
                              <span class="main">(</span>current_thread <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                        current_thread <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> parse_wakeup_queues_Inv SetCurrentTime_Inv SetCurrentTimeslice_Inv<span class="main">[</span><span class="language"><span class="operator">unfolded</span> SetCurrentTimeslice_def</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> switch_to_Inv<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Schedule <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="main">(</span>current_time <span class="free">s</span> <span class="main">+</span> TIMER_TICK_LENGTH<span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>current_thread <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> active_threads <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="main">(</span>current_time <span class="free">s</span> <span class="main">+</span> TIMER_TICK_LENGTH<span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"snd <span class="main">(</span>parse_wakeup_queues <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="main">(</span>current_time <span class="free">s</span> <span class="main">+</span> TIMER_TICK_LENGTH<span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>current_thread <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>active_threads <span class="main">(</span>SetCurrentTime <span class="free">s</span> <span class="main">(</span>current_time <span class="free">s</span> <span class="main">+</span> TIMER_TICK_LENGTH<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parse_wakeup_queues_result<span class="main">)</span></span> 
  <span class="keyword1"><span class="command">using</span></span> preempt_thread_NC_Thread parse_wakeup_queues_NC_Thread <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> Invariants_def Inv_Current_def Inv_Current_Thread_In_Active_def SetCurrentTime_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> SetCurrentTime_Inv_Schedule Invariants_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> preempt_thread_Inv<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Invariants_def Inv_Current_def Inv_Current_Thread_In_Active_def SetCurrentTime_def parse_wakeup_queues_NC_Thread <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span>  parse_wakeup_queues_Inv SetCurrentTime_Inv SetCurrentTimeslice_Inv<span class="main">[</span><span class="language"><span class="operator">unfolded</span> SetCurrentTimeslice_def</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> Scheduling_Inv<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Invariants_def Inv_Current_def Inv_Current_Thread_In_Active_def SetCurrentTime_def
  update_timeslice_NC_Thread end_of_timeslice_NC_Thread parse_wakeup_queues_NC_Thread <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> update_timeslice_Inv<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> end_of_timeslice_NC_Current parse_wakeup_queues_NC_Current SetCurrentTime_def 
   end_of_timeslice_NC_Thread parse_wakeup_queues_NC_Thread Invariants_def Inv_Current_def Inv_Current_Thread_In_Active_def
   Inv_Thread_def Inv_Active_In_Threads_def apply simp
    apply blast
   apply (subst end_of_timeslice_Inv)
  using Invariants_def Inv_Current_def Inv_Current_Thread_In_Active_def SetCurrentTime_def
  parse_wakeup_queues_NC_Thread apply simp
  using parse_wakeup_queues_Inv SetCurrentTime_Inv SetCurrentTimeslice_Inv[unfolded SetCurrentTimeslice_def] apply simp
  by auto
end</pre></body>