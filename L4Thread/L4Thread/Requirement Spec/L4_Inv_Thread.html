<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.theories { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }
</style><title>Theory "L4_Inv_Thread"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> L4_Inv_Thread
  <span class="keyword2"><span class="keyword">imports</span></span> L4_Inv_Space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetThreadPager›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadPager_Inv_Current_Thread_In_Active SetThreadPager_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetThreadPager_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadPager_rtran SetThreadPager_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadPager_valid SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPager_direct_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPager_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPager_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPager_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPager_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadPager_Inv_Space_HasNot_Loop SetThreadPager_Inv_Space_Valid_Has_Real
   SetThreadPager_Inv_Space_Perms_IsNot_Empty SetThreadPager_Inv_Space_Spaces_In_Config 
   SetThreadPager_Inv_Space_InitialSpaces_In_Spaces SetThreadPager_Inv_Space_Perms_Subset
   SetThreadPager_Inv_Space_Spaces_IsNot_None SetThreadPager_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadPager_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadPager_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadPager_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadPager_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetThreadPager_def p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∉</span> kIntThreads"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetThreadPager_def p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetThreadPager_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∉</span> kIntThreads"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p2 p3 p4
    SetThreadPager_Inv_Idle_NotIn_Threads SetThreadPager_Inv_Idle_Space_Is_KernelSpace
    SetThreadPager_Inv_Sigma0_In_Active SetThreadPager_Inv_RootServer_In_Active 
    SetThreadPager_Inv_IntThreads_In_Active 
    SetThreadPager_Inv_Threads_In_Config SetThreadPager_Inv_Active_In_Threads 
    SetThreadPager_Inv_NThreads_Is_None SetThreadPager_Inv_Threads_IsNot_None 
    SetThreadPager_Inv_Threads_Space_Dom
    SetThreadPager_Inv_Threads_Space_In_Spaces SetThreadPager_Inv_Threads_Eq_Space_Threads
    SetThreadPager_Inv_Threads_Sche_In_Threads 
    SetThreadPager_Inv_NActive_Utcb_Is_None SetThreadPager_Inv_Active_Utcb_IsNot_None
    SetThreadPager_Inv_IntThreads_Utcb_Is_None SetThreadPager_Inv_Sigma0_Space
    SetThreadPager_Inv_RootServer_Space SetThreadPager_Inv_IntThreads_Space
    SetThreadPager_Inv_Threads_Partner_In_Threads SetThreadPager_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPager_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> active_threads <span class="free">s</span>"</span></span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∉</span> kIntThreads"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetThreadPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 p3 p4 Invariants_def SetThreadPager_Inv_Current SetThreadPager_Inv_Space 
    SetThreadPager_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetThreadState›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadState_Inv_Current_Thread_In_Active SetThreadState_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetThreadState_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadState_rtran SetThreadState_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadState_valid SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadState_direct_eq SetThreadState_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadState_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadState_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadState_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadState_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadState_Inv_Space_HasNot_Loop SetThreadState_Inv_Space_Valid_Has_Real
   SetThreadState_Inv_Space_Perms_IsNot_Empty SetThreadState_Inv_Space_Spaces_In_Config 
   SetThreadState_Inv_Space_InitialSpaces_In_Spaces SetThreadState_Inv_Space_Perms_Subset
   SetThreadState_Inv_Space_Spaces_IsNot_None SetThreadState_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadState_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadState_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadState_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetThreadState_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p0
    SetThreadState_Inv_Idle_NotIn_Threads SetThreadState_Inv_Idle_Space_Is_KernelSpace
    SetThreadState_Inv_Sigma0_In_Active SetThreadState_Inv_RootServer_In_Active 
    SetThreadState_Inv_IntThreads_In_Active 
    SetThreadState_Inv_Threads_In_Config SetThreadState_Inv_Active_In_Threads 
    SetThreadState_Inv_NThreads_Is_None SetThreadState_Inv_Threads_IsNot_None 
    SetThreadState_Inv_Threads_Space_Dom
    SetThreadState_Inv_Threads_Space_In_Spaces SetThreadState_Inv_Threads_Eq_Space_Threads
    SetThreadState_Inv_Threads_Sche_In_Threads 
    SetThreadState_Inv_NActive_Utcb_Is_None SetThreadState_Inv_Active_Utcb_IsNot_None
    SetThreadState_Inv_IntThreads_Utcb_Is_None SetThreadState_Inv_Sigma0_Space
    SetThreadState_Inv_RootServer_Space SetThreadState_Inv_IntThreads_Space
    SetThreadState_Inv_Threads_Partner_In_Threads SetThreadState_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadState_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetThreadState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1 Invariants_def SetThreadState_Inv_Current 
    SetThreadState_Inv_Space SetThreadState_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetIpcPartner›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetIpcPartner_Inv_Current_Thread_In_Active SetIpcPartner_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetIpcPartner_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetIpcPartner_rtran SetIpcPartner_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetIpcPartner_valid SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetIpcPartner_direct_eq SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcPartner_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcPartner_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcPartner_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcPartner_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetIpcPartner_Inv_Space_HasNot_Loop SetIpcPartner_Inv_Space_Valid_Has_Real
   SetIpcPartner_Inv_Space_Perms_IsNot_Empty SetIpcPartner_Inv_Space_Spaces_In_Config 
   SetIpcPartner_Inv_Space_InitialSpaces_In_Spaces SetIpcPartner_Inv_Space_Perms_Subset
   SetIpcPartner_Inv_Space_Spaces_IsNot_None SetIpcPartner_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetIpcPartner_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetIpcPartner_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetIpcPartner_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetIpcPartner_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">pa</span> <span class="main">≠</span> NILTHREAD <span class="main">∧</span> <span class="free">pa</span> <span class="main">≠</span> ANYTHREAD <span class="main">⟶</span> 
                              TidToGno <span class="free">pa</span> <span class="main">∈</span> threads <span class="free">s</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> p1 SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">pa</span> <span class="main">≠</span> NILTHREAD <span class="main">∧</span> <span class="free">pa</span> <span class="main">≠</span> ANYTHREAD <span class="main">⟶</span> 
                              TidToGno <span class="free">pa</span> <span class="main">∈</span> threads <span class="free">s</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p0 p2
    SetIpcPartner_Inv_Idle_NotIn_Threads SetIpcPartner_Inv_Idle_Space_Is_KernelSpace
    SetIpcPartner_Inv_Sigma0_In_Active SetIpcPartner_Inv_RootServer_In_Active 
    SetIpcPartner_Inv_IntThreads_In_Active 
    SetIpcPartner_Inv_Threads_In_Config SetIpcPartner_Inv_Active_In_Threads 
    SetIpcPartner_Inv_NThreads_Is_None SetIpcPartner_Inv_Threads_IsNot_None 
    SetIpcPartner_Inv_Threads_Space_Dom
    SetIpcPartner_Inv_Threads_Space_In_Spaces SetIpcPartner_Inv_Threads_Eq_Space_Threads
    SetIpcPartner_Inv_Threads_Sche_In_Threads 
    SetIpcPartner_Inv_NActive_Utcb_Is_None SetIpcPartner_Inv_Active_Utcb_IsNot_None
    SetIpcPartner_Inv_IntThreads_Utcb_Is_None SetIpcPartner_Inv_Sigma0_Space
    SetIpcPartner_Inv_RootServer_Space SetIpcPartner_Inv_IntThreads_Space
    SetIpcPartner_Inv_Threads_Partner_In_Threads SetIpcPartner_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcPartner_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">pa</span> <span class="main">≠</span> NILTHREAD <span class="main">∧</span> <span class="free">pa</span> <span class="main">≠</span> ANYTHREAD <span class="main">⟶</span> 
                              TidToGno <span class="free">pa</span> <span class="main">∈</span> threads <span class="free">s</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetIpcPartner <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Invariants_def SetIpcPartner_Inv_Current SetIpcPartner_Inv_Space SetIpcPartner_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetIpcTimeout›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetIpcTimeout_Inv_Current_Thread_In_Active SetIpcTimeout_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetIpcTimeout_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetIpcTimeout_rtran SetIpcTimeout_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetIpcTimeout_valid SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetIpcTimeout_direct_eq SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcTimeout_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcTimeout_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcTimeout_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetIpcTimeout_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetIpcTimeout_Inv_Space_HasNot_Loop SetIpcTimeout_Inv_Space_Valid_Has_Real
   SetIpcTimeout_Inv_Space_Perms_IsNot_Empty SetIpcTimeout_Inv_Space_Spaces_In_Config 
   SetIpcTimeout_Inv_Space_InitialSpaces_In_Spaces SetIpcTimeout_Inv_Space_Perms_Subset
   SetIpcTimeout_Inv_Space_Spaces_IsNot_None SetIpcTimeout_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetIpcTimeout_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetIpcTimeout_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetIpcTimeout_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetIpcTimeout_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetIpcTimeout_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p0
    SetIpcTimeout_Inv_Idle_NotIn_Threads SetIpcTimeout_Inv_Idle_Space_Is_KernelSpace
    SetIpcTimeout_Inv_Sigma0_In_Active SetIpcTimeout_Inv_RootServer_In_Active 
    SetIpcTimeout_Inv_IntThreads_In_Active 
    SetIpcTimeout_Inv_Threads_In_Config SetIpcTimeout_Inv_Active_In_Threads 
    SetIpcTimeout_Inv_NThreads_Is_None SetIpcTimeout_Inv_Threads_IsNot_None 
    SetIpcTimeout_Inv_Threads_Space_Dom
    SetIpcTimeout_Inv_Threads_Space_In_Spaces SetIpcTimeout_Inv_Threads_Eq_Space_Threads
    SetIpcTimeout_Inv_Threads_Sche_In_Threads 
    SetIpcTimeout_Inv_NActive_Utcb_Is_None SetIpcTimeout_Inv_Active_Utcb_IsNot_None
    SetIpcTimeout_Inv_IntThreads_Utcb_Is_None SetIpcTimeout_Inv_Sigma0_Space
    SetIpcTimeout_Inv_RootServer_Space SetIpcTimeout_Inv_IntThreads_Space
    SetIpcTimeout_Inv_Threads_Partner_In_Threads SetIpcTimeout_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetIpcTimeout_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetIpcTimeout <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1 Invariants_def SetIpcTimeout_Inv_Current SetIpcTimeout_Inv_Space SetIpcTimeout_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetThreadsIncomingDel›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadsIncomingDel_Inv_Current_Thread_In_Active SetThreadsIncomingDel_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetThreadsIncomingDel_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadsIncomingDel_rtran SetThreadsIncomingDel_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadsIncomingDel_valid SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadsIncomingDel_direct_eq SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadsIncomingDel_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadsIncomingDel_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadsIncomingDel_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadsIncomingDel_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadsIncomingDel_Inv_Space_HasNot_Loop SetThreadsIncomingDel_Inv_Space_Valid_Has_Real
   SetThreadsIncomingDel_Inv_Space_Perms_IsNot_Empty SetThreadsIncomingDel_Inv_Space_Spaces_In_Config 
   SetThreadsIncomingDel_Inv_Space_InitialSpaces_In_Spaces SetThreadsIncomingDel_Inv_Space_Perms_Subset
   SetThreadsIncomingDel_Inv_Space_Spaces_IsNot_None SetThreadsIncomingDel_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadsIncomingDel_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadsIncomingDel_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadsIncomingDel_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadsIncomingDel_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetThreadsIncomingDel_def p1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> set_remove1_subset <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p0
    SetThreadsIncomingDel_Inv_Idle_NotIn_Threads SetThreadsIncomingDel_Inv_Idle_Space_Is_KernelSpace
    SetThreadsIncomingDel_Inv_Sigma0_In_Active SetThreadsIncomingDel_Inv_RootServer_In_Active 
    SetThreadsIncomingDel_Inv_IntThreads_In_Active 
    SetThreadsIncomingDel_Inv_Threads_In_Config SetThreadsIncomingDel_Inv_Active_In_Threads 
    SetThreadsIncomingDel_Inv_NThreads_Is_None SetThreadsIncomingDel_Inv_Threads_IsNot_None 
    SetThreadsIncomingDel_Inv_Threads_Space_In_Spaces SetThreadsIncomingDel_Inv_Threads_Space_Dom
    SetThreadsIncomingDel_Inv_Threads_Eq_Space_Threads SetThreadsIncomingDel_Inv_Threads_Sche_In_Threads 
    SetThreadsIncomingDel_Inv_NActive_Utcb_Is_None SetThreadsIncomingDel_Inv_Active_Utcb_IsNot_None
    SetThreadsIncomingDel_Inv_IntThreads_Utcb_Is_None SetThreadsIncomingDel_Inv_Sigma0_Space
    SetThreadsIncomingDel_Inv_RootServer_Space SetThreadsIncomingDel_Inv_IntThreads_Space
    SetThreadsIncomingDel_Inv_Threads_Partner_In_Threads SetThreadsIncomingDel_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadsIncomingDel_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetThreadsIncomingDel <span class="free">s</span> <span class="free">gno</span> <span class="free">t</span><span class="main">)</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1 Invariants_def SetThreadsIncomingDel_Inv_Current SetThreadsIncomingDel_Inv_Space SetThreadsIncomingDel_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetThreadPriority›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadPriority_Inv_Current_Thread_In_Active SetThreadPriority_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetThreadPriority_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadPriority_rtran SetThreadPriority_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadPriority_valid SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadPriority_direct_eq SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPriority_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPriority_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPriority_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadPriority_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadPriority_Inv_Space_HasNot_Loop SetThreadPriority_Inv_Space_Valid_Has_Real
   SetThreadPriority_Inv_Space_Perms_IsNot_Empty SetThreadPriority_Inv_Space_Spaces_In_Config 
   SetThreadPriority_Inv_Space_InitialSpaces_In_Spaces SetThreadPriority_Inv_Space_Perms_Subset
   SetThreadPriority_Inv_Space_Spaces_IsNot_None SetThreadPriority_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadPriority_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadPriority_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadPriority_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadPriority_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetThreadPriority_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetThreadPriority_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p2
    SetThreadPriority_Inv_Idle_NotIn_Threads SetThreadPriority_Inv_Idle_Space_Is_KernelSpace
    SetThreadPriority_Inv_Sigma0_In_Active SetThreadPriority_Inv_RootServer_In_Active 
    SetThreadPriority_Inv_IntThreads_In_Active 
    SetThreadPriority_Inv_Threads_In_Config SetThreadPriority_Inv_Active_In_Threads 
    SetThreadPriority_Inv_NThreads_Is_None SetThreadPriority_Inv_Threads_IsNot_None 
    SetThreadPriority_Inv_Threads_Space_Dom
    SetThreadPriority_Inv_Threads_Space_In_Spaces SetThreadPriority_Inv_Threads_Eq_Space_Threads
    SetThreadPriority_Inv_Threads_Sche_In_Threads 
    SetThreadPriority_Inv_NActive_Utcb_Is_None SetThreadPriority_Inv_Active_Utcb_IsNot_None
    SetThreadPriority_Inv_IntThreads_Utcb_Is_None SetThreadPriority_Inv_Sigma0_Space
    SetThreadPriority_Inv_RootServer_Space SetThreadPriority_Inv_IntThreads_Space
    SetThreadPriority_Inv_Threads_Partner_In_Threads SetThreadPriority_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadPriority_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetThreadPriority <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Invariants_def SetThreadPriority_Inv_Current SetThreadPriority_Inv_Space SetThreadPriority_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetThreadQuantum›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadQuantum_Inv_Current_Thread_In_Active SetThreadQuantum_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetThreadQuantum_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadQuantum_rtran SetThreadQuantum_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadQuantum_valid SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadQuantum_direct_eq SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadQuantum_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadQuantum_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadQuantum_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadQuantum_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadQuantum_Inv_Space_HasNot_Loop SetThreadQuantum_Inv_Space_Valid_Has_Real
   SetThreadQuantum_Inv_Space_Perms_IsNot_Empty SetThreadQuantum_Inv_Space_Spaces_In_Config 
   SetThreadQuantum_Inv_Space_InitialSpaces_In_Spaces SetThreadQuantum_Inv_Space_Perms_Subset
   SetThreadQuantum_Inv_Space_Spaces_IsNot_None SetThreadQuantum_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadQuantum_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadQuantum_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadQuantum_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadQuantum_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetThreadQuantum_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetThreadQuantum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p2
    SetThreadQuantum_Inv_Idle_NotIn_Threads SetThreadQuantum_Inv_Idle_Space_Is_KernelSpace
    SetThreadQuantum_Inv_Sigma0_In_Active SetThreadQuantum_Inv_RootServer_In_Active 
    SetThreadQuantum_Inv_IntThreads_In_Active 
    SetThreadQuantum_Inv_Threads_In_Config SetThreadQuantum_Inv_Active_In_Threads 
    SetThreadQuantum_Inv_NThreads_Is_None SetThreadQuantum_Inv_Threads_IsNot_None
    SetThreadQuantum_Inv_Threads_Space_Dom
    SetThreadQuantum_Inv_Threads_Space_In_Spaces SetThreadQuantum_Inv_Threads_Eq_Space_Threads
    SetThreadQuantum_Inv_Threads_Sche_In_Threads 
    SetThreadQuantum_Inv_NActive_Utcb_Is_None SetThreadQuantum_Inv_Active_Utcb_IsNot_None
    SetThreadQuantum_Inv_IntThreads_Utcb_Is_None SetThreadQuantum_Inv_Sigma0_Space
    SetThreadQuantum_Inv_RootServer_Space SetThreadQuantum_Inv_IntThreads_Space
    SetThreadQuantum_Inv_Threads_Partner_In_Threads SetThreadQuantum_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadQuantum_Inv<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetThreadQuantum <span class="free">s</span> <span class="free">gno</span> <span class="free">quan</span><span class="main">)</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Invariants_def SetThreadQuantum_Inv_Current SetThreadQuantum_Inv_Space SetThreadQuantum_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetThreadTimeslice›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadTimeslice_Inv_Current_Thread_In_Active SetThreadTimeslice_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetThreadTimeslice_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetThreadTimeslice_rtran SetThreadTimeslice_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadTimeslice_valid SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetThreadTimeslice_direct_eq SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadTimeslice_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetThreadTimeslice_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetThreadTimeslice_Inv_Space_HasNot_Loop SetThreadTimeslice_Inv_Space_Valid_Has_Real
   SetThreadTimeslice_Inv_Space_Perms_IsNot_Empty SetThreadTimeslice_Inv_Space_Spaces_In_Config 
   SetThreadTimeslice_Inv_Space_InitialSpaces_In_Spaces SetThreadTimeslice_Inv_Space_Perms_Subset
   SetThreadTimeslice_Inv_Space_Spaces_IsNot_None SetThreadTimeslice_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadTimeslice_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SetThreadTimeslice_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadTimeslice_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetThreadTimeslice_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> SetThreadTimeslice_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">prio</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetThreadTimeslice_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p2
    SetThreadTimeslice_Inv_Idle_NotIn_Threads SetThreadTimeslice_Inv_Idle_Space_Is_KernelSpace
    SetThreadTimeslice_Inv_Sigma0_In_Active SetThreadTimeslice_Inv_RootServer_In_Active 
    SetThreadTimeslice_Inv_IntThreads_In_Active 
    SetThreadTimeslice_Inv_Threads_In_Config SetThreadTimeslice_Inv_Active_In_Threads 
    SetThreadTimeslice_Inv_NThreads_Is_None SetThreadTimeslice_Inv_Threads_IsNot_None
    SetThreadTimeslice_Inv_Threads_Space_Dom
    SetThreadTimeslice_Inv_Threads_Space_In_Spaces SetThreadTimeslice_Inv_Threads_Eq_Space_Threads
    SetThreadTimeslice_Inv_Threads_Sche_In_Threads 
    SetThreadTimeslice_Inv_NActive_Utcb_Is_None SetThreadTimeslice_Inv_Active_Utcb_IsNot_None
    SetThreadTimeslice_Inv_IntThreads_Utcb_Is_None SetThreadTimeslice_Inv_Sigma0_Space
    SetThreadTimeslice_Inv_RootServer_Space SetThreadTimeslice_Inv_IntThreads_Space
    SetThreadTimeslice_Inv_Threads_Partner_In_Threads SetThreadTimeslice_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetThreadTimeslice_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetThreadTimeslice <span class="free">s</span> <span class="free">gno</span> <span class="free">slice</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Invariants_def SetThreadTimeslice_Inv_Current SetThreadTimeslice_Inv_Space SetThreadTimeslice_Inv_Thread 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Unwind›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Current_Isar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Unwind_Inv_Current_Thread_In_Active Unwind_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Current<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> Inv_Current <span class="bound">s</span> <span class="main">⟶</span> Inv_Current <span class="main">(</span>Unwind <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Unwind_Inv_Current_Isar
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Unwind_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Unwind_rtran Unwind_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Unwind_valid Unwind_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> Unwind_direct_eq Unwind_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Unwind_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Unwind_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Unwind_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Unwind_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> Unwind_Inv_Space_HasNot_Loop Unwind_Inv_Space_Valid_Has_Real
   Unwind_Inv_Space_Perms_IsNot_Empty Unwind_Inv_Space_Spaces_In_Config 
   Unwind_Inv_Space_InitialSpaces_In_Spaces Unwind_Inv_Space_Perms_Subset
   Unwind_Inv_Space_Spaces_IsNot_None Unwind_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_NThreads_Is_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
        p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> GetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Threads_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
        p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> GetIpcPartner_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def Unwind_def Let_def dequeue_wait_def SetThreadsIncomingDel_def GetIpcPartner_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
        p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> notin_set_remove1 option.sel<span class="main">)</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def Unwind_def
  Let_def dequeue_wait_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def Unwind_def
  Let_def dequeue_wait_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def Unwind_def
  Let_def dequeue_wait_def SetThreadsIncomingDel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>Unwind <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    Unwind_Inv_Idle_NotIn_Threads Unwind_Inv_Idle_Space_Is_KernelSpace
    Unwind_Inv_Sigma0_In_Active Unwind_Inv_RootServer_In_Active 
    Unwind_Inv_IntThreads_In_Active 
    Unwind_Inv_Threads_In_Config Unwind_Inv_Active_In_Threads 
    Unwind_Inv_NThreads_Is_None Unwind_Inv_Threads_IsNot_None
    Unwind_Inv_Threads_Space_Dom
    Unwind_Inv_Threads_Space_In_Spaces Unwind_Inv_Threads_Eq_Space_Threads
    Unwind_Inv_Threads_Sche_In_Threads 
    Unwind_Inv_NActive_Utcb_Is_None Unwind_Inv_Active_Utcb_IsNot_None
    Unwind_Inv_IntThreads_Utcb_Is_None Unwind_Inv_Sigma0_Space
    Unwind_Inv_RootServer_Space Unwind_Inv_IntThreads_Space
    Unwind_Inv_Threads_Partner_In_Threads Unwind_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unwind_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>Unwind <span class="bound">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> Unwind_Inv_Current Unwind_Inv_Space Unwind_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetError›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Current_Isar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetError_Inv_Current_Thread_In_Active SetError_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Current<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">error</span><span class="main">.</span> Inv_Current <span class="bound">s</span> <span class="main">⟶</span> Inv_Current <span class="main">(</span>SetError <span class="bound">s</span> <span class="free">gno</span> <span class="bound">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetError_Inv_Current_Isar
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetError_rtran SetError_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetError_valid SetError_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetError_direct_eq SetError_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetError_NC_Space spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetError_NC_Space spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetError_NC_Space spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetError_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetError_Inv_Space_HasNot_Loop SetError_Inv_Space_Valid_Has_Real
   SetError_Inv_Space_Perms_IsNot_Empty SetError_Inv_Space_Spaces_In_Config 
   SetError_Inv_Space_InitialSpaces_In_Spaces SetError_Inv_Space_Perms_Subset
   SetError_Inv_Space_Spaces_IsNot_None SetError_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetError_def SetThreadError_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetError <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    SetError_Inv_Idle_NotIn_Threads SetError_Inv_Idle_Space_Is_KernelSpace
    SetError_Inv_Sigma0_In_Active SetError_Inv_RootServer_In_Active 
    SetError_Inv_IntThreads_In_Active 
    SetError_Inv_Threads_In_Config SetError_Inv_Active_In_Threads 
    SetError_Inv_NThreads_Is_None SetError_Inv_Threads_IsNot_None
    SetError_Inv_Threads_Space_Dom
    SetError_Inv_Threads_Space_In_Spaces SetError_Inv_Threads_Eq_Space_Threads
    SetError_Inv_Threads_Sche_In_Threads 
    SetError_Inv_NActive_Utcb_Is_None SetError_Inv_Active_Utcb_IsNot_None
    SetError_Inv_IntThreads_Utcb_Is_None SetError_Inv_Threads_Incoming_In_Threads 
    SetError_Inv_Threads_Partner_In_Threads SetError_Inv_Sigma0_Space
    SetError_Inv_RootServer_Space SetError_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetError_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">error</span><span class="main">.</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>SetError <span class="bound">s</span> <span class="free">gno</span> <span class="bound">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> SetError_Inv_Current SetError_Inv_Space SetError_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹CreateThread›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_def Let_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
    CreateAddressSpace_NC_Current CreateAddressSpace_NC_Thread
    SetError_NC_Current SetError_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_def Let_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
    CreateAddressSpace_NC_Current CreateAddressSpace_NC_Thread
    SetError_NC_Current SetError_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateThread_Inv_Current_Thread_In_Active CreateThread_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateThread_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CreateThread_rtran CreateThread_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateThread_valid<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"CreateThread_Cond SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_def Let_def CreateThread_Cond_def CreateAddressSpace_def
      SetError_def SetThreadError_def get_perms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">sp</span> <span class="main">=</span> <span class="free">space</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inv_Space_Valid_In_Spaces_lemma<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_Cond_def CreateAddressSpace_def
      SetError_def SetThreadError_def get_perms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def 
  CreateTcb_def direct_path_def get_perms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> CreateTcb_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms CreateAddressSpace_Inv_Space_Perms_Subset
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_def Let_def CreateThread_Cond_def CreateAddressSpace_def
    SetError_def SetThreadError_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> CreateThread_C_Space' CreateThread_C_Space
    CreateThread_NC_Space CreateThread_NC_Space_Other
  <span class="keyword1"><span class="command">using</span></span> Un_assoc subset_Un_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∉</span> spaces <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CreateAddressSpace_def CreateThread_Cond_def CreateTcb_def<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def spaces_def
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def spaces_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>CreateThread_valid<span class="main">)</span></span>


<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> CreateThread_Inv_Space_HasNot_Loop CreateThread_Inv_Space_Valid_Has_Real
   CreateThread_Inv_Space_Perms_IsNot_Empty CreateThread_Inv_Space_Spaces_In_Config 
   CreateThread_Inv_Space_InitialSpaces_In_Spaces CreateThread_Inv_Space_Perms_Subset
   CreateThread_Inv_Space_Spaces_IsNot_None CreateThread_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="document"><span class="plain_text">‹CreateTcb›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> idle"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Inv_Idle_NotIn_Threads_def CreateTcb_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> idle"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Inv_Idle_Space_Is_KernelSpace_def CreateTcb_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> Threads_Gno SysConf"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">scheduler</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> Threads_Gno SysConf <span class="main">-</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
    p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> p3
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def CreateTcb_def SetThreadError_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> kSigma0"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def CreateTcb_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> kRootServer"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def CreateTcb_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateTcb_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∉</span> kIntThreads"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>CreateTcb <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def CreateTcb_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="document"><span class="plain_text">‹CreateThread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Idle_NotIn_Threads CreateThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Idle_Space_Is_KernelSpace CreateThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Sigma0_In_Active
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_RootServer_In_Active
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_IntThreads_In_Active
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Threads_In_Config CreateThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Active_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_NThreads_Is_None <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p2 CreateAddressSpace_Inv_Active_In_Threads <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Threads_IsNot_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateTcb_def CreateAddressSpace_def CreateThread_Cond_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>                      
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Threads_Space_In_Spaces CreateThread_Cond_def
    CreateAddressSpace_C_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> Address_Space SysConf"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">spacea</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"CreateThread_Cond SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∉</span> spaces <span class="free">s</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
          a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> Address_Space SysConf"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">spacea</span> <span class="main">∈</span> spaces <span class="main">(</span>CreateTcb <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> h01<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="free">space</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">≠</span> idle"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> CreateThread_Cond_def</span><span class="main">]</span> p5<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h02<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∄</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="free">space</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Thread_Exist p3 p4 a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="main">(</span>CreateTcb <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span> <span class="skolem">spacea</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>CreateTcb <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">spacea</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">spacea</span> <span class="main">=</span> <span class="free">space</span>"</span></span></span><span class="main">)</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def CreateAddressSpace_def
          <span class="keyword1"><span class="command">using</span></span> a2 a3 h02
          <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">spacea</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a4 CreateTcb_def CreateAddressSpace_NC_Space_Other
          <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">spacea</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">spacea</span><span class="main">}</span>"</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Eq_Space_Threads_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> CreateTcb_def CreateAddressSpace_def
          <span class="keyword1"><span class="command">using</span></span> False a2 a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> CreateThread_Cond_def</span><span class="main">]</span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateThread_Cond_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def CreateTcb_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def CreateThread_Cond_def Inv_NThreads_Is_None_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_Threads_Sche_In_Threads p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateThread_Cond_def CreateAddressSpace_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_NActive_Utcb_Is_None
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p2 CreateAddressSpace_Inv_NThreads_Is_None
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateThread_Cond_def CreateAddressSpace_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_Active_Utcb_IsNot_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 CreateAddressSpace_Inv_IntThreads_Utcb_Is_None CreateThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_Threads_Partner_In_Threads p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateThread_Cond_def CreateAddressSpace_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_Threads_Incoming_In_Threads p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateThread_Cond_def CreateAddressSpace_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_Sigma0_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_Sigma0_Space assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_Cond_def
    <span class="keyword1"><span class="command">using</span></span> assms Inv_Active_In_Threads_def Inv_Sigma0_In_Active_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_RootServer_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_RootServer_Space assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_Cond_def
    <span class="keyword1"><span class="command">using</span></span> assms Inv_Active_In_Threads_def Inv_RootServer_In_Active_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>CreateThread' SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateThread'_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateTcb_Inv_IntThreads_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_IntThreads_Space assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateThread_Cond_def
    <span class="keyword1"><span class="command">using</span></span> assms Inv_Active_In_Threads_def Inv_IntThreads_In_Active_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    CreateThread_Inv_Idle_NotIn_Threads CreateThread_Inv_Idle_Space_Is_KernelSpace
    CreateThread_Inv_Sigma0_In_Active CreateThread_Inv_RootServer_In_Active 
    CreateThread_Inv_IntThreads_In_Active 
    CreateThread_Inv_Threads_In_Config CreateThread_Inv_Active_In_Threads 
    CreateThread_Inv_NThreads_Is_None CreateThread_Inv_Threads_IsNot_None
    CreateThread_Inv_Threads_Space_Dom
    CreateThread_Inv_Threads_Space_In_Spaces CreateThread_Inv_Threads_Eq_Space_Threads
    CreateThread_Inv_Threads_Sche_In_Threads 
    CreateThread_Inv_NActive_Utcb_Is_None CreateThread_Inv_Active_Utcb_IsNot_None
    CreateThread_Inv_IntThreads_Utcb_Is_None CreateThread_Inv_Threads_Partner_In_Threads
    CreateThread_Inv_Threads_Incoming_In_Threads CreateThread_eq CreateThread_Inv_Sigma0_Space
    CreateThread_Inv_RootServer_Space CreateThread_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateThread_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>CreateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> CreateThread_Inv_Current CreateThread_Inv_Space CreateThread_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹ActivateThread›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> ActivateThread_Inv_Current_Thread_In_Active ActivateThread_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> ActivateThread_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ActivateThread_rtran ActivateThread_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ActivateThread_valid ActivateThread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> ActivateThread_direct_eq ActivateThread_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateThread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateThread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateThread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateThread_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> ActivateThread_Inv_Space_HasNot_Loop ActivateThread_Inv_Space_Valid_Has_Real
   ActivateThread_Inv_Space_Perms_IsNot_Empty ActivateThread_Inv_Space_Spaces_In_Config 
   ActivateThread_Inv_Space_InitialSpaces_In_Spaces ActivateThread_Inv_Space_Perms_Subset
   ActivateThread_Inv_Space_Spaces_IsNot_None ActivateThread_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_IntThreads_In_Active_def Inv_NThreads_Is_None_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Inv_IntThreads_Utcb_Is_None_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Inv_Sigma0_Space_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Inv_RootServer_Space_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Inv_IntThreads_Space_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    ActivateThread_Inv_Idle_NotIn_Threads ActivateThread_Inv_Idle_Space_Is_KernelSpace
    ActivateThread_Inv_Sigma0_In_Active ActivateThread_Inv_RootServer_In_Active 
    ActivateThread_Inv_IntThreads_In_Active 
    ActivateThread_Inv_Threads_In_Config ActivateThread_Inv_Active_In_Threads 
    ActivateThread_Inv_NThreads_Is_None ActivateThread_Inv_Threads_IsNot_None
    ActivateThread_Inv_Threads_Space_Dom ActivateThread_Inv_Threads_Eq_Space_Threads
    ActivateThread_Inv_Threads_Space_In_Spaces ActivateThread_Inv_Threads_Sche_In_Threads 
    ActivateThread_Inv_NActive_Utcb_Is_None ActivateThread_Inv_Active_Utcb_IsNot_None
    ActivateThread_Inv_IntThreads_Utcb_Is_None ActivateThread_Inv_Threads_Partner_In_Threads
    ActivateThread_Inv_Threads_Incoming_In_Threads ActivateThread_Inv_Sigma0_Space
    ActivateThread_Inv_RootServer_Space ActivateThread_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateThread_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>ActivateThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> ActivateThread_Inv_Current ActivateThread_Inv_Space ActivateThread_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹CreateActiveThread›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateActiveThread_Inv_Current_Thread_In_Active CreateActiveThread_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateActiveThread_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CreateActiveThread_rtran CreateActiveThread_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CreateActiveThread_valid CreateActiveThread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> CreateActiveThread_direct_eq CreateActiveThread_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>CreateActiveThread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>CreateActiveThread_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> initialised_spaces <span class="free">s</span> <span class="main">⟹</span> space_threads <span class="free">s</span> <span class="free">space</span> <span class="main">≠</span> None"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 p2 Inv_Space_InitialSpaces_In_Spaces_def Inv_Space_Spaces_IsNot_None_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"dom<span class="main">(</span>space_threads <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>space_threads <span class="free">s</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateActiveThread_def CreateActiveThread_Cond_def Let_def spaces_def SetError_NC_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Spaces_IsNot_None_def CreateActiveThread_NC_Space 
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>CreateActiveThread_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> CreateActiveThread_Inv_Space_HasNot_Loop CreateActiveThread_Inv_Space_Valid_Has_Real
   CreateActiveThread_Inv_Space_Perms_IsNot_Empty CreateActiveThread_Inv_Space_Spaces_In_Config 
   CreateActiveThread_Inv_Space_InitialSpaces_In_Spaces CreateActiveThread_Inv_Space_Perms_Subset
   CreateActiveThread_Inv_Space_Spaces_IsNot_None CreateActiveThread_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_Space_Is_KernelSpace_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_IntThreads_In_Active_def Inv_NThreads_Is_None_def 
    Inv_Active_In_Threads_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Inv_Threads_Space_In_Spaces_def Inv_Space_InitialSpaces_In_Spaces_def
     CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>  
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def CreateActiveThread_Cond_def
    Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 Inv_Threads_Sche_In_Threads_def Inv_Active_In_Threads_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 p3 Inv_IntThreads_Utcb_Is_None_def Inv_IntThreads_In_Active_def
    Inv_Active_In_Threads_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def CreateActiveThread_Cond_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_Cond_def
    <span class="keyword1"><span class="command">using</span></span> assms Inv_Sigma0_In_Active_def Inv_Active_In_Threads_def Inv_Sigma0_Space_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_Cond_def
    <span class="keyword1"><span class="command">using</span></span> assms Inv_RootServer_In_Active_def Inv_Active_In_Threads_def Inv_RootServer_Space_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_def Let_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> CreateActiveThread_Cond_def
    <span class="keyword1"><span class="command">using</span></span> assms Inv_IntThreads_In_Active_def Inv_Active_In_Threads_def Inv_IntThreads_Space_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p2 
    CreateActiveThread_Inv_Idle_NotIn_Threads CreateActiveThread_Inv_Idle_Space_Is_KernelSpace
    CreateActiveThread_Inv_Sigma0_In_Active CreateActiveThread_Inv_RootServer_In_Active 
    CreateActiveThread_Inv_IntThreads_In_Active 
    CreateActiveThread_Inv_Threads_In_Config CreateActiveThread_Inv_Active_In_Threads 
    CreateActiveThread_Inv_NThreads_Is_None CreateActiveThread_Inv_Threads_IsNot_None
    CreateActiveThread_Inv_Threads_Space_Dom CreateActiveThread_Inv_Threads_Eq_Space_Threads
    CreateActiveThread_Inv_Threads_Space_In_Spaces CreateActiveThread_Inv_Threads_Sche_In_Threads 
    CreateActiveThread_Inv_NActive_Utcb_Is_None CreateActiveThread_Inv_Active_Utcb_IsNot_None
    CreateActiveThread_Inv_IntThreads_Utcb_Is_None CreateActiveThread_Inv_Threads_Partner_In_Threads
    CreateActiveThread_Inv_Threads_Incoming_In_Threads CreateActiveThread_Inv_Sigma0_Space
    CreateActiveThread_Inv_RootServer_Space CreateActiveThread_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateActiveThread_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>CreateActiveThread SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="free">scheduler</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Invariants_def Inv_Space_def
   CreateActiveThread_Inv_Current CreateActiveThread_Inv_Space CreateActiveThread_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹DeleteThread›</span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹delete_temp1›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def Let_def delete_temp1_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> Unwind_NC_Current
    Unwind_NC_Thread dequeue_ready_NC_Current dequeue_ready_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def Let_def delete_temp1_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> Unwind_NC_Current
    Unwind_NC_Thread dequeue_ready_NC_Current dequeue_ready_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_Inv_Current_Thread_In_Active delete_temp1_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp1_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Space Unwind_NC_Space
    direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">smt</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">" <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> one_path.hyps
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> delete_temp1_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> tran_path.intros<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tran_path.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> delete_temp1_direct_eq h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h3 tran_path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_direct_eq tran_path.intros delete_temp1_tran1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_direct_eq valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> delete_temp1_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_temp1_rtran delete_temp1_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def delete_temp1_def Let_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_valid Unwind_valid dequeue_ready_valid 
    Unwind_NC_Space dequeue_ready_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def delete_temp1_def Let_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_valid Unwind_direct_eq dequeue_ready_direct_eq
    Unwind_NC_Space dequeue_ready_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def delete_temp1_def Let_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span> Unwind_NC_Space dequeue_ready_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def delete_temp1_def Let_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span> Unwind_NC_Space dequeue_ready_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def delete_temp1_def Let_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span> Unwind_NC_Space dequeue_ready_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>delete_temp1_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> delete_temp1_Inv_Space_HasNot_Loop delete_temp1_Inv_Space_Valid_Has_Real
   delete_temp1_Inv_Space_Perms_IsNot_Empty delete_temp1_Inv_Space_Spaces_In_Config 
   delete_temp1_Inv_Space_InitialSpaces_In_Spaces delete_temp1_Inv_Space_Perms_Subset
   delete_temp1_Inv_Space_Spaces_IsNot_None delete_temp1_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp1_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Unwind_Inv_NThreads_Is_None<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dequeue_ready_def Inv_Active_In_Threads_def
        Inv_NThreads_Is_None_def Inv_Threads_Partner_In_Threads_def
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Inv_NThreads_Is_None_def dequeue_ready_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp1_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Unwind_Inv_Threads_IsNot_None<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dequeue_ready_def Inv_Active_In_Threads_def
        Inv_Threads_IsNot_None_def Inv_Threads_Partner_In_Threads_def
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Inv_Threads_IsNot_None_def dequeue_ready_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread dequeue_ready_NC_Space Unwind_NC_Thread Unwind_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">thm</span></span> Unwind_Inv_Threads_IsNot_None
<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread dequeue_ready_NC_Space Unwind_NC_Thread Unwind_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread dequeue_ready_NC_User dequeue_ready_NC_IPC
    Unwind_NC_Thread Unwind_NC_User Unwind_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread dequeue_ready_NC_User dequeue_ready_NC_IPC
    Unwind_NC_Thread Unwind_NC_User Unwind_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread dequeue_ready_NC_User dequeue_ready_NC_IPC
    Unwind_NC_Thread Unwind_NC_User Unwind_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread dequeue_ready_NC_User dequeue_ready_NC_IPC
    Unwind_NC_Thread Unwind_NC_User Unwind_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp1_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Unwind_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms dequeue_ready_def Inv_Active_In_Threads_def
        Inv_Threads_Incoming_In_Threads_def Inv_Threads_Partner_In_Threads_def
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Inv_Threads_Incoming_In_Threads_def dequeue_ready_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> dequeue_ready_NC_Thread Unwind_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹delete_temp2›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def Let_def delete_temp2_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Current DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def Let_def delete_temp2_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Current DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_Inv_Current_Thread_In_Active delete_temp2_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_direct_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_direct_eq tran_path.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_direct_eq ValidVpageHasSon <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_branch1_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_branch1_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> one_path.hyps
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> delete_temp2_branch1_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> tran_path.intros<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tran_path.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> delete_temp2_branch1_direct_eq h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h3 tran_path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_branch1_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_branch1_direct_eq tran_path.intros delete_temp2_branch1_tran1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_branch1_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_branch1_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_branch1_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_branch1_direct_eq ValidVpageHasSon <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_branch1_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_branch1_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span><span class="main">⦇</span>space_threads <span class="main">:=</span> space_threads <span class="free">s</span><span class="main">(</span><span class="free">space</span> <span class="main">↦</span>
                         the <span class="main">(</span>space_threads <span class="free">s</span> <span class="free">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_branch1_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_branch1_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> "</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms DeleteAddressSpace_Inv_Space_Valid_Has_Real
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> delete_temp2_branch1_valid<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> delete_temp2_branch1_rtran<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms DeleteAddressSpace_Inv_Space_Perms_IsNot_Empty
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> delete_temp2_branch1_valid<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms DeleteAddressSpace_Inv_Space_Perms_Subset
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> delete_temp2_branch1_direct_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms DeleteAddressSpace_Inv_Space_Spaces_In_Config
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms DeleteAddressSpace_Inv_Space_InitialSpaces_In_Spaces
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms DeleteAddressSpace_Inv_Space_Spaces_IsNot_None
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def spaces_def
    Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> delete_temp2_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_User DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹delete_temp3›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> current_thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Thread_In_Active_def Let_def delete_temp3_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> current_thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Current_Space_IsNot_None_def Let_def delete_temp3_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> current_thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_Inv_Current_Thread_In_Active delete_temp3_Inv_Current_Space_IsNot_None
    Inv_Current_def p1 p2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp3_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">" <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> one_path.hyps
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> delete_temp3_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> tran_path.intros<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tran_path.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> delete_temp3_direct_eq h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h3 tran_path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_direct_eq tran_path.intros delete_temp3_tran1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_direct_eq ValidVpageHasSon <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_rtran delete_temp3_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_temp3_valid<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def delete_temp3_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_temp3_direct_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> space_mapping <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp3_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>delete_temp3_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>delete_temp3_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>delete_temp3_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> delete_temp3_Inv_Space_HasNot_Loop delete_temp3_Inv_Space_Valid_Has_Real
   delete_temp3_Inv_Space_Perms_IsNot_Empty delete_temp3_Inv_Space_Spaces_In_Config 
   delete_temp3_Inv_Space_InitialSpaces_In_Spaces delete_temp3_Inv_Space_Perms_Subset
   delete_temp3_Inv_Space_Spaces_IsNot_None delete_temp3_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_NotIn_Threads_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> idle"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> kSigma0"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_In_Active_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> kRootServer"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_In_Active_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∉</span> kIntThreads"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_In_Active_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_In_Config_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_In_Threads_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_NThreads_Is_None_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_IsNot_None_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def spaces_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> threads <span class="free">s</span> <span class="main">⟶</span> thread_scheduler <span class="free">s</span> <span class="bound">t</span> <span class="main">≠</span> Some <span class="free">gno</span>"</span></span></span>
     <span class="comment1">(*∄t. t ∈ threads s ∧ thread_scheduler s t = Some gno*)</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Sche_In_Threads_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_NActive_Utcb_Is_None_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Active_Utcb_IsNot_None_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> threads <span class="free">s</span> <span class="main">⟶</span> thread_ipc_partner <span class="free">s</span> <span class="bound">t</span> <span class="main">≠</span> Some <span class="main">(</span>GnoToTid <span class="free">gno</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def delete_temp3_def Let_def
    GnoToTid_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> threadid_t.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">force</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> threads <span class="free">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">gno</span> <span class="main">∉</span> set <span class="main">(</span>the <span class="main">(</span>thread_incoming <span class="free">s</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> kSigma0"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> kRootServer"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∉</span> kIntThreads"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">≠</span> kSigma0 <span class="main">∧</span> <span class="free">gno</span> <span class="main">≠</span> kRootServer <span class="main">∧</span> <span class="free">gno</span> <span class="main">∉</span> kIntThreads"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> p1
    delete_temp3_Inv_Idle_NotIn_Threads delete_temp3_Inv_Idle_Space_Is_KernelSpace
    delete_temp3_Inv_Sigma0_In_Active delete_temp3_Inv_RootServer_In_Active 
    delete_temp3_Inv_IntThreads_In_Active 
    delete_temp3_Inv_Threads_In_Config delete_temp3_Inv_Active_In_Threads 
    delete_temp3_Inv_NThreads_Is_None delete_temp3_Inv_Threads_IsNot_None 
    delete_temp3_Inv_Threads_Space_In_Spaces delete_temp3_Inv_Threads_Sche_In_Threads 
    delete_temp3_Inv_NActive_Utcb_Is_None delete_temp3_Inv_Active_Utcb_IsNot_None
    delete_temp3_Inv_IntThreads_Utcb_Is_None delete_temp3_Inv_Sigma0_Space
    delete_temp3_Inv_RootServer_Space delete_temp3_Inv_IntThreads_Space
    delete_temp3_Inv_Threads_Partner_In_Threads delete_temp3_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Current_Thread_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Current_Thread_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Current_Thread_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def delete_temp2_def delete_temp1_def Let_def
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Current Unwind_NC_Current dequeue_ready_NC_Current
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def delete_temp2_def delete_temp1_def Let_def
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Current Unwind_NC_Current dequeue_ready_NC_Current
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteThread_Inv_Current_Thread_In_Active DeleteThread_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> SetError_direct_eq delete_temp1_direct_eq delete_temp2_direct_eq delete_temp3_direct_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteThread_direct_eq tran_path.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteThread_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_valid_vpage<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteThread_direct_eq valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> ValidVpageHasSon<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteThread_valid_vpage DeleteThread_valid_rpage FatherIsVirtual ValidExSon
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> DeleteThread_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> "</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_HasNot_Loop<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Vpage_Range<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> "</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_HasNot_Loop<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Vpage_Range<span class="main">)</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> delete_temp1_def dequeue_ready_def Let_def DeleteThread_Cond_def
    <span class="keyword1"><span class="command">using</span></span> Unwind_NC_Thread
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Vpage_Range<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Space_Vpage_Range<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Space_Vpage_Range<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Space_Vpage_Range<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> DeleteThread_Inv_Space_HasNot_Loop DeleteThread_Inv_Space_Valid_Has_Real
    DeleteThread_Inv_Space_Perms_IsNot_Empty DeleteThread_Inv_Space_Spaces_In_Config
    DeleteThread_Inv_Space_InitialSpaces_In_Spaces DeleteThread_Inv_Space_Perms_Subset
    DeleteThread_Inv_Space_Spaces_IsNot_None DeleteThread_Inv_Space_Vpage_Range
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def DeleteThread_Cond_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Sigma0_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Sigma0_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Sigma0_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def Inv_Sigma0_Space_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_RootServer_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_RootServer_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_RootServer_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def Inv_RootServer_Space_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_IntThreads_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_IntThreads_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_IntThreads_In_Active<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def Inv_IntThreads_Space_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Threads_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Threads_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Threads_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Active_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Active_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Active_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_NThreads_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_NThreads_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_NThreads_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_temp1_Inv_Active_In_Threads delete_temp2_Inv_Active_In_Threads delete_temp3_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Threads_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Threads_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Threads_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> Unwind_NC_Space dequeue_ready_NC_Space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp1_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp1_def Let_def
  <span class="keyword1"><span class="command">using</span></span> Unwind_NC_Thread dequeue_ready_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Space_Pre<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Space
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> domD domIff<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_NC_Space_Pre<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_NC_Space_Pre<span class="main"><span class="main">[</span></span><span class="language"><span class="operator">unfolded</span> spaces_def</span><span class="main"><span class="main">]</span></span> spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_C_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">⟹</span> 
the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">⟹</span> <span class="main">¬</span>dIsPrivilegedSpace<span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
  the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">∉</span> spaces <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def spaces_def DeleteAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_NC_Space_Other<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">⟹</span>
<span class="free">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">⟹</span> <span class="free">space</span> <span class="main">≠</span> the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def DeleteAddressSpace_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Space2
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_NC_Space_Threads_Other<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">≠</span> <span class="free">space</span> <span class="main">⟹</span>
space_threads <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">space</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="free">space</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Space_Other
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">⟹</span>
spaces <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp2_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>delete_temp2 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp3_def Let_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_temp3_NC_Thread_Other<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">≠</span> <span class="free">gno</span> <span class="main">⟹</span> thread_space <span class="main">(</span>delete_temp3 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_temp3_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Threads_Space_Dom<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Threads_Space_Dom<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Threads_Space_Dom<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"DeleteThread_Cond <span class="free">s</span> <span class="free">gno</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">∈</span> threads <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">gno</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> delete_temp3_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">∈</span> threads <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> delete_temp3_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">∈</span> threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> delete_temp2_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h22<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> delete_temp1_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">space</span><span class="main">.</span> <span class="bound">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> thread_space <span class="free">s</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="bound">space</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">space</span></span> <span class="keyword2"><span class="keyword">where</span></span> h31<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> thread_space <span class="free">s</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="skolem">space</span>"</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h32<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">∧</span> thread_space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="skolem">space</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> delete_temp1_NC_Space delete_temp1_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h33<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">⟹</span>
        <span class="skolem">space</span> <span class="main">≠</span> the <span class="main">(</span>thread_space <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_temp1_NC_Space delete_temp1_NC_Thread<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> h1 h31 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h34<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h32 delete_temp2_NC_Space_Other delete_temp2_NC_Space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">have</span></span> h35<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"thread_space <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="skolem">space</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h32 delete_temp2_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h41<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h34 delete_temp3_NC_Space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> h42<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"thread_space <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="skolem">space</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h35 h1
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_temp3_NC_Thread_Other<span class="main">)</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">space</span><span class="main">.</span>
            <span class="bound">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="main">∧</span>
            thread_space <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="bound">space</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h41 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">space</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"DeleteThread_Cond <span class="free">s</span> <span class="free">gno</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> delete_temp3_NC_Space delete_temp2_NC_Space_Pre delete_temp1_NC_Space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> DeleteThread_Cond_def</span><span class="main">]</span>
        p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>dIsPrivilegedSpace <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dIsPrivilegedSpace_def
      is_kSigma0Space_def is_kRootServerSpace_def <span class="keyword1"><span class="command">using</span></span> a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> DeleteThread_Cond_def</span><span class="main">]</span>
      p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">space</span> <span class="main">⟹</span> the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> delete_temp2_C_Space h2 h3 delete_temp1_NC_Space h1 delete_temp1_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">space</span> <span class="main">⟹</span> the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span> 
        the <span class="main">(</span>space_threads <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_temp3_NC_Space<span class="main">)</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> delete_temp2_def Let_def <span class="keyword1"><span class="command">using</span></span> delete_temp1_NC_Space delete_temp1_NC_Thread
      Thread_AtLeast_One_In_Space p1 p2 a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> DeleteThread_Cond_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">from</span></span> h4 <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">space</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span> 
      <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> delete_temp3_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delete_temp2_NC_Thread delete_temp1_NC_Thread<span class="main">)</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">space</span> <span class="main">⟹</span> the <span class="main">(</span>space_threads <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h5 h6 h11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">space</span> <span class="main">⟹</span> the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> 
        the <span class="main">(</span>space_threads <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delete_temp3_NC_Space<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> delete_temp2_NC_Space_Threads_Other<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> delete_temp1_NC_Thread delete_temp1_NC_Space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">space</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">=</span> 
      <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> delete_temp3_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delete_temp2_NC_Thread delete_temp1_NC_Thread<span class="main">)</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">space</span> <span class="main">⟹</span> the <span class="main">(</span>space_threads <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h11 h8 h9 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>delete_temp3 <span class="main">(</span>delete_temp2 <span class="main">(</span>delete_temp1 <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="free">gno</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h7 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>                     
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def delete_temp2_def Let_def
      delete_temp1_def
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
      Unwind_NC_Thread dequeue_ready_NC_Thread
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">sorry</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_IPC
      Unwind_NC_Thread dequeue_ready_NC_Thread Unwind_NC_IPC dequeue_ready_NC_IPC
        delete_temp2_def delete_temp1_def Let_def DeleteThread_Cond_def<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> Unwind_NC_IPC1 dequeue_ready_NC_IPC
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> in_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Sigma0_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_Sigma0_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_Sigma0_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_Sigma0_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def Inv_Sigma0_Space_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_IntThreads_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_IntThreads_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_IntThreads_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_IntThreads_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def Inv_IntThreads_Space_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeleteThread_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_RootServer_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp3_Inv_RootServer_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp2_Inv_RootServer_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> delete_temp1_Inv_RootServer_Space<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteThread_Cond_def Inv_RootServer_Space_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> 
    DeleteThread_Inv_Idle_NotIn_Threads DeleteThread_Inv_Idle_Space_Is_KernelSpace
    DeleteThread_Inv_Sigma0_In_Active DeleteThread_Inv_Sigma0_Space
    DeleteThread_Inv_IntThreads_Space DeleteThread_Inv_RootServer_In_Active
    DeleteThread_Inv_RootServer_Space DeleteThread_Inv_IntThreads_In_Active
    DeleteThread_Inv_Threads_In_Config DeleteThread_Inv_Active_In_Threads
    DeleteThread_Inv_NThreads_Is_None DeleteThread_Inv_Threads_IsNot_None
    DeleteThread_Inv_Threads_Space_Dom DeleteThread_Inv_Threads_Space_In_Spaces 
    DeleteThread_Inv_Threads_Eq_Space_Threads DeleteThread_Inv_Threads_Sche_In_Threads
    DeleteThread_Inv_NActive_Utcb_Is_None DeleteThread_Inv_Active_Utcb_IsNot_None
    DeleteThread_Inv_IntThreads_Utcb_Is_None DeleteThread_Inv_Threads_Partner_In_Threads 
    DeleteThread_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteThread_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>DeleteThread <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> DeleteThread_Inv_Current DeleteThread_Inv_Space DeleteThread_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Inv_Thread_def<span class="main">)</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetScheduler›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetScheduler_Inv_Current_Thread_In_Active SetScheduler_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetScheduler_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetScheduler_rtran SetScheduler_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetScheduler_valid SetScheduler_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetScheduler_direct_eq SetScheduler_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetScheduler_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetScheduler_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetScheduler_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetScheduler_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetScheduler_Inv_Space_HasNot_Loop SetScheduler_Inv_Space_Valid_Has_Real
   SetScheduler_Inv_Space_Perms_IsNot_Empty SetScheduler_Inv_Space_Spaces_In_Config 
   SetScheduler_Inv_Space_InitialSpaces_In_Spaces SetScheduler_Inv_Space_Perms_Subset
   SetScheduler_Inv_Space_Spaces_IsNot_None SetScheduler_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_IntThreads_In_Active_def Inv_NThreads_Is_None_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetScheduler_def SetThreadScheduler_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetScheduler_def
    SetThreadScheduler_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetScheduler_def
    SetThreadScheduler_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetScheduler_def
    SetThreadScheduler_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> SetScheduler_Inv_Idle_Space_Is_KernelSpace
    SetScheduler_Inv_Idle_NotIn_Threads 
    SetScheduler_Inv_Sigma0_In_Active SetScheduler_Inv_RootServer_In_Active 
    SetScheduler_Inv_IntThreads_In_Active 
    SetScheduler_Inv_Threads_In_Config SetScheduler_Inv_Active_In_Threads 
    SetScheduler_Inv_NThreads_Is_None SetScheduler_Inv_Threads_IsNot_None
    SetScheduler_Inv_Threads_Space_Dom
    SetScheduler_Inv_Threads_Space_In_Spaces SetScheduler_Inv_Threads_Eq_Space_Threads
    SetScheduler_Inv_Threads_Sche_In_Threads 
    SetScheduler_Inv_NActive_Utcb_Is_None SetScheduler_Inv_Active_Utcb_IsNot_None
    SetScheduler_Inv_IntThreads_Utcb_Is_None SetScheduler_Inv_Threads_Partner_In_Threads
    SetScheduler_Inv_Threads_Incoming_In_Threads SetScheduler_Inv_Sigma0_Space
    SetScheduler_Inv_RootServer_Space SetScheduler_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetScheduler_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetScheduler <span class="free">s</span> <span class="free">gno</span> <span class="free">scheduler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> SetScheduler_Inv_Current SetScheduler_Inv_Space SetScheduler_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetPager›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetPager_Inv_Current_Thread_In_Active SetPager_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetPager_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetPager_rtran SetPager_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetPager_valid SetPager_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetPager_direct_eq SetPager_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetPager_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetPager_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetPager_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetPager_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetPager_Inv_Space_HasNot_Loop SetPager_Inv_Space_Valid_Has_Real
   SetPager_Inv_Space_Perms_IsNot_Empty SetPager_Inv_Space_Spaces_In_Config 
   SetPager_Inv_Space_InitialSpaces_In_Spaces SetPager_Inv_Space_Perms_Subset
   SetPager_Inv_Space_Spaces_IsNot_None SetPager_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_IntThreads_In_Active_def Inv_NThreads_Is_None_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def Let_def
  <span class="keyword1"><span class="command">using</span></span> assms SetError_Inv_Threads_Eq_Space_Threads SetThreadPager_Inv_Threads_Eq_Space_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetPager_def SetThreadPager_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def
    SetPager_def SetThreadPager_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def 
    SetPager_def SetThreadPager_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def
    SetPager_def SetThreadPager_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> SetPager_Inv_Idle_Space_Is_KernelSpace
    SetPager_Inv_Idle_NotIn_Threads 
    SetPager_Inv_Sigma0_In_Active SetPager_Inv_RootServer_In_Active 
    SetPager_Inv_IntThreads_In_Active 
    SetPager_Inv_Threads_In_Config SetPager_Inv_Active_In_Threads 
    SetPager_Inv_NThreads_Is_None SetPager_Inv_Threads_IsNot_None
    SetPager_Inv_Threads_Space_Dom
    SetPager_Inv_Threads_Space_In_Spaces SetPager_Inv_Threads_Eq_Space_Threads
    SetPager_Inv_Threads_Sche_In_Threads 
    SetPager_Inv_NActive_Utcb_Is_None SetPager_Inv_Active_Utcb_IsNot_None
    SetPager_Inv_IntThreads_Utcb_Is_None SetPager_Inv_Threads_Partner_In_Threads
    SetPager_Inv_Threads_Incoming_In_Threads SetPager_Inv_Sigma0_Space
    SetPager_Inv_RootServer_Space SetPager_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetPager_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetPager <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> SetPager_Inv_Current SetPager_Inv_Space SetPager_Inv_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹SetState›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Current_Isar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetState_Inv_Current_Thread_In_Active SetState_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Current<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> Inv_Current <span class="bound">s</span> <span class="main">⟶</span> Inv_Current <span class="main">(</span>SetState <span class="bound">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> SetState_Inv_Current_Isar
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetState_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetState_rtran SetState_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SetState_valid SetState_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> SetState_direct_eq SetState_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetState_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetState_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetState_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>SetState_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> SetState_Inv_Space_HasNot_Loop SetState_Inv_Space_Valid_Has_Real
   SetState_Inv_Space_Perms_IsNot_Empty SetState_Inv_Space_Spaces_In_Config 
   SetState_Inv_Space_InitialSpaces_In_Spaces SetState_Inv_Space_Perms_Subset
   SetState_Inv_Space_Spaces_IsNot_None SetState_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_IntThreads_In_Active_def Inv_NThreads_Is_None_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">val</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">error</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def Let_def
  <span class="keyword1"><span class="command">using</span></span> assms SetError_Inv_Threads_Eq_Space_Threads SetThreadState_Inv_Threads_Eq_Space_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SetState_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def SetState_def
    SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def SetState_def
    SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">pager</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def SetState_def
    SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> SetState_Inv_Idle_Space_Is_KernelSpace
    SetState_Inv_Idle_NotIn_Threads 
    SetState_Inv_Sigma0_In_Active SetState_Inv_RootServer_In_Active 
    SetState_Inv_IntThreads_In_Active 
    SetState_Inv_Threads_In_Config SetState_Inv_Active_In_Threads 
    SetState_Inv_NThreads_Is_None SetState_Inv_Threads_IsNot_None 
    SetState_Inv_Threads_Space_Dom
    SetState_Inv_Threads_Space_In_Spaces SetState_Inv_Threads_Eq_Space_Threads
    SetState_Inv_Threads_Sche_In_Threads 
    SetState_Inv_NActive_Utcb_Is_None SetState_Inv_Active_Utcb_IsNot_None
    SetState_Inv_IntThreads_Utcb_Is_None SetState_Inv_Threads_Partner_In_Threads
    SetState_Inv_Threads_Incoming_In_Threads SetState_Inv_Sigma0_Space
    SetState_Inv_RootServer_Space SetState_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SetState_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>SetState <span class="free">s</span> <span class="free">gno</span> <span class="free">state</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> SetState_Inv_Current SetState_Inv_Space SetState_Inv_Thread 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Migrate›</span></span></span>
<span class="keyword1"><span class="command">thm</span></span> Migrate_def<span class="main">[</span><span class="language"><span class="operator">no_vars</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">Migrate_branch1</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">gno</span></span> <span class="free"><span class="bound">space</span></span> <span class="main">≡</span> 
<span class="free"><span class="bound">s</span></span><span class="main">⦇</span>thread_space <span class="main">:=</span> 
    <span class="main">(</span><span class="main">(</span>thread_space <span class="free"><span class="bound">s</span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound">gno</span></span> <span class="main">:=</span> Some <span class="free"><span class="bound">space</span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
      space_threads <span class="main">:=</span> <span class="main">(</span>space_threads <span class="free"><span class="bound">s</span></span><span class="main">)</span>
          <span class="main">(</span><span class="free"><span class="bound">space</span></span><span class="main">:=</span> Some <span class="main">(</span>the <span class="main">(</span>space_threads <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">space</span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound">gno</span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">Migrate_branch2</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">gno</span></span> <span class="free"><span class="bound">space</span></span> <span class="main">≡</span> 
<span class="free"><span class="bound">s</span></span><span class="main">⦇</span>thread_space <span class="main">:=</span> <span class="main">(</span><span class="main">(</span>thread_space <span class="free"><span class="bound">s</span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound">gno</span></span> <span class="main">:=</span> Some <span class="free"><span class="bound">space</span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
  space_threads <span class="main">:=</span> <span class="main">(</span>space_threads <span class="free"><span class="bound">s</span></span><span class="main">)</span>
       <span class="main">(</span><span class="free"><span class="bound">space</span></span><span class="main">:=</span> Some <span class="main">(</span>the <span class="main">(</span>space_threads <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">space</span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound">gno</span></span><span class="main">}</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">gno</span></span><span class="main">)</span><span class="main">)</span><span class="main">:=</span> 
            Some <span class="main">(</span>the <span class="main">(</span>space_threads <span class="free"><span class="bound">s</span></span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">gno</span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound">gno</span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span> <span class="main">=</span> 
<span class="main">(</span><span class="keyword1">if</span> Migrate_Cond SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span>
 <span class="keyword1">then</span> SetError <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>
      <span class="keyword1">then</span> Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">space</span>
      <span class="keyword1">else</span> Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span> <span class="main">(</span>current_thread <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>
      <span class="keyword1">then</span> Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">space</span>
      <span class="keyword1">else</span> Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">)</span> eNoError
 <span class="keyword1">else</span> <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def Migrate_branch1_def Migrate_branch2_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span> <span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch1_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">" <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> one_path.hyps
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> tran_path.intros<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tran_path.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_direct_eq h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h3 tran_path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_direct_eq tran_path.intros Migrate_branch1_tran1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_direct_eq valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_branch1_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Migrate_branch1_rtran Migrate_branch1_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_valid
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def Migrate_branch1_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Migrate_branch1_direct_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span> <span class="main">=</span> space_mapping <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch1_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Migrate_branch1_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Migrate_branch1_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Migrate_branch1_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>Migrate_branch1 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch1_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span> <span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">" <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> one_path.hyps
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> tran_path.intros<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tran_path.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_direct_eq h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h3 tran_path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_direct_eq tran_path.intros Migrate_branch2_tran1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_direct_eq valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_branch2_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Migrate_branch2_rtran Migrate_branch2_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_valid
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def Migrate_branch2_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Migrate_branch2_direct_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span> <span class="main">=</span> space_mapping <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Migrate_branch2_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Migrate_branch2_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">gno</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 p3 p4 <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def spaces_def
    Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Migrate_branch2_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">space</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> Migrate_branch2_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def DeleteAddressSpace_Inv_Current_Thread_In_Active
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def DeleteAddressSpace_Inv_Current_Space_IsNot_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_Inv_Current_Thread_In_Active Migrate_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Migrate_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Migrate_Cond SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>SetError_direct_eq<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>direct_path_def<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_direct_eq<span class="main">[</span><span class="language"><span class="operator">unfolded</span> direct_path_def</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>direct_path_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_direct_eq tran_path.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">using</span></span> Migrate_direct_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Migrate_valid_vpage Migrate_valid_rpage
    FatherIsVirtual ValidExSon
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> Migrate_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">∧</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch1_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> DeleteAddressSpace_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch2_Inv_Space_Valid_Has_Real<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch1_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> DeleteAddressSpace_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch2_Inv_Space_Perms_IsNot_Empty<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch1_Inv_Space_Perms_Subset<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> DeleteAddressSpace_Inv_Space_Perms_Subset<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch2_Inv_Space_Perms_Subset<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch1_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> DeleteAddressSpace_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch2_Inv_Space_Spaces_In_Config<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch1_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> DeleteAddressSpace_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch2_Inv_Space_InitialSpaces_In_Spaces<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch1_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> DeleteAddressSpace_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Migrate_Cond_def <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Space_Other2
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Migrate_Cond_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> Migrate_branch2_Inv_Space_Spaces_IsNot_None<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span> Migrate_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> Migrate_Inv_Space_HasNot_Loop Migrate_Inv_Space_Valid_Has_Real
   Migrate_Inv_Space_Perms_IsNot_Empty Migrate_Inv_Space_Spaces_In_Config 
   Migrate_Inv_Space_Spaces_IsNot_None Migrate_Inv_Space_InitialSpaces_In_Spaces Migrate_Inv_Space_Perms_Subset
   Migrate_Inv_Space_Spaces_IsNot_None Migrate_Inv_Space_Vpage_Range
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def DeleteAddressSpace_Inv_Idle_NotIn_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Inv_Idle_Space_Is_KernelSpace_def DeleteAddressSpace_Inv_Idle_Space_Is_KernelSpace
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_Cond_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def DeleteAddressSpace_Inv_Sigma0_In_Active
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def DeleteAddressSpace_Inv_RootServer_In_Active
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def DeleteAddressSpace_Inv_IntThreads_In_Active
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def DeleteAddressSpace_Inv_Threads_In_Config
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def DeleteAddressSpace_Inv_Active_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_NThreads_Is_None_def DeleteAddressSpace_Inv_NThreads_Is_None  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Migrate_Cond_def<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeleteAddressSpace_NC_Thread<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Migrate_Cond_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_NThreads_Is_None_def p1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 DeleteAddressSpace_Inv_Active_In_Threads Inv_Active_In_Threads_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Migrate_Cond_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Inv_Active_In_Threads_def<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Migrate_Cond_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Active_In_Threads_def p2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p1<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def DeleteAddressSpace_Inv_Threads_IsNot_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def Migrate_Cond_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Migrate_Cond SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
        a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
        a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">∈</span> threads <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 Migrate_Cond_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> Migrate_Cond_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">=</span> Some <span class="bound">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> spaces_def dom_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">from</span></span> a3<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Migrate_branch1_def</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h31<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">space</span><span class="main">.</span> <span class="bound">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> thread_space <span class="free">s</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="bound">space</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">space</span></span> <span class="keyword2"><span class="keyword">where</span></span> h32<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> thread_space <span class="free">s</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="skolem">space</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h33<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"thread_space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="skolem">space</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">gno</span> <span class="main">⟹</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">space</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a41<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">gno</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a42<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">space</span>"</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> h32 a2 p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h41<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">≠</span> <span class="free">gno</span> <span class="main">⟹</span> <span class="skolem">space</span> <span class="main">∈</span> dom <span class="main">(</span>space_mapping <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Space_Other2 h32
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">space</span><span class="main">.</span>
            <span class="bound">space</span> <span class="main">∈</span> spaces <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="main">∧</span>
            thread_space <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="bound">space</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch1_def spaces_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span><span class="main">)</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
          <span class="keyword1"><span class="command">using</span></span> h1 h21 DeleteAddressSpace_NC_Space_Other1
          <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
        <span class="keyword1"><span class="command">using</span></span> h41 h33 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">using</span></span> p1
    <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def Migrate_branch2_def spaces_def
      Migrate_Cond_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch1_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Migrate_Cond SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">space</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p2 Migrate_Cond_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> p4<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Migrate_Cond_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>dIsPrivilegedSpace<span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> dIsPrivilegedSpace_def is_kSigma0Space_def is_kRootServerSpace_def
      <span class="keyword1"><span class="command">using</span></span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Migrate_Cond_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> spaces <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def Migrate_branch1_def spaces_def dom_def <span class="keyword1"><span class="command">using</span></span> h2 h3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">≠</span> the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Migrate_branch1_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span>
               <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace1_def <span class="keyword1"><span class="command">using</span></span> h2 h3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>DeleteAddressSpace_auxi <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">space</span> <span class="main">∈</span> spaces <span class="bound">s</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_auxi_def spaces_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h8 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Eq_Space_Threads_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">=</span> <span class="free">sp</span>"</span></span></span><span class="main">)</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h110<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">=</span> 
        <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch1_def <span class="keyword1"><span class="command">using</span></span> True h5 DeleteAddressSpace_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h112<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span> 
          <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h110 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h220<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> the <span class="main">(</span>space_threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Space_Other h5 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h221<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span> 
          the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch1_def <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span> 
          the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h220 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h112 h12 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h210<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">=</span> 
        <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h211<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch1_def <span class="keyword1"><span class="command">using</span></span> False h5 DeleteAddressSpace_NC_Thread <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h212<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">=</span> 
          <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h210 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h220<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> the <span class="main">(</span>space_threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Space_Other h5 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h221<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> the <span class="main">(</span>space_threads <span class="bound">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch1 <span class="bound">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch1_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch1 <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h220 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h212 h12 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">A</span><span class="main">=</span><span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">B</span><span class="main">-</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">=</span><span class="free">D</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">=</span> <span class="free">D</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Migrate_branch2_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Migrate_Cond SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="main">(</span>the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">space</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p2 Migrate_Cond_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Migrate_branch2_def spaces_def</span><span class="main">]</span> spaces_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Eq_Space_Threads_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">=</span> <span class="free">sp</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def <span class="keyword1"><span class="command">using</span></span> h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> h112<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span> the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def <span class="keyword1"><span class="command">using</span></span> h1 True h2 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h111 h21 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h211<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">=</span> the <span class="main">(</span>thread_space <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h212<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span><span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def <span class="keyword1"><span class="command">using</span></span> h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
        <span class="keyword1"><span class="command">have</span></span> h213<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">gno</span><span class="main">}</span> <span class="main">=</span> the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def <span class="keyword1"><span class="command">using</span></span> h1 True h2 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h212 h21 h213 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h221<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="free">s</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> thread_space <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> Some <span class="skolem">space</span><span class="main">}</span>"</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def <span class="keyword1"><span class="command">using</span></span> h1 h211 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
        <span class="keyword1"><span class="command">have</span></span> h222<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_threads <span class="free">s</span> <span class="skolem">space</span><span class="main">)</span> <span class="main">=</span> the <span class="main">(</span>space_threads <span class="main">(</span>Migrate_branch2 <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">space</span><span class="main">)</span>"</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Migrate_branch2_def <span class="keyword1"><span class="command">using</span></span> False h1 h211 h2 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h221 h222 h21 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> Migrate_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Migrate_branch1_Inv_Threads_Eq_Space_Threads
    Migrate_branch2_Inv_Threads_Eq_Space_Threads
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Sche_In_Threads_def DeleteAddressSpace_Inv_Threads_Sche_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def DeleteAddressSpace_Inv_NActive_Utcb_Is_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def DeleteAddressSpace_Inv_Active_Utcb_IsNot_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_Utcb_Is_None_def DeleteAddressSpace_Inv_IntThreads_Utcb_Is_None
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def 
    DeleteAddressSpace_Inv_Threads_Partner_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def 
    DeleteAddressSpace_Inv_Threads_Incoming_In_Threads
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_Space_def Migrate_Cond_def
    DeleteAddressSpace_Inv_Sigma0_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_Space_def Migrate_Cond_def
    DeleteAddressSpace_Inv_RootServer_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Migrate_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_Space_def Migrate_Cond_def
    DeleteAddressSpace_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> Migrate_Inv_Idle_Space_Is_KernelSpace
    Migrate_Inv_Idle_NotIn_Threads 
    Migrate_Inv_Sigma0_In_Active Migrate_Inv_RootServer_In_Active 
    Migrate_Inv_IntThreads_In_Active 
    Migrate_Inv_Threads_In_Config Migrate_Inv_Active_In_Threads 
    Migrate_Inv_NThreads_Is_None Migrate_Inv_Threads_IsNot_None
    Migrate_Inv_Threads_Space_Dom
    Migrate_Inv_Threads_Space_In_Spaces Migrate_Inv_Threads_Eq_Space_Threads
    Migrate_Inv_Threads_Sche_In_Threads 
    Migrate_Inv_NActive_Utcb_Is_None Migrate_Inv_Active_Utcb_IsNot_None
    Migrate_Inv_IntThreads_Utcb_Is_None Migrate_Inv_Threads_Partner_In_Threads
    Migrate_Inv_Threads_Incoming_In_Threads Migrate_Inv_Sigma0_Space
    Migrate_Inv_RootServer_Space Migrate_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Migrate_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>Migrate SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> Migrate_Inv_Current Migrate_Inv_Space Migrate_Inv_Thread
    Inv_Thread_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹ActivateInterrupt›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> ActivateInterrupt_Inv_Current_Thread_In_Active ActivateInterrupt_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> ActivateInterrupt_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ActivateInterrupt_rtran ActivateInterrupt_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ActivateInterrupt_valid ActivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">pa</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> ActivateInterrupt_direct_eq ActivateInterrupt_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>ActivateInterrupt_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> ActivateInterrupt_Inv_Space_HasNot_Loop ActivateInterrupt_Inv_Space_Valid_Has_Real
   ActivateInterrupt_Inv_Space_Perms_IsNot_Empty ActivateInterrupt_Inv_Space_Spaces_In_Config 
   ActivateInterrupt_Inv_Space_InitialSpaces_In_Spaces ActivateInterrupt_Inv_Space_Perms_Subset
   ActivateInterrupt_Inv_Space_Spaces_IsNot_None ActivateInterrupt_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_IntThreads_In_Active_def Inv_NThreads_Is_None_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span><span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ActivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def ActivateInterrupt_def
    SetThreadScheduler_def SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def ActivateInterrupt_def
    SetThreadScheduler_def SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def ActivateInterrupt_def
    SetThreadScheduler_def SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> ActivateInterrupt_Inv_Idle_Space_Is_KernelSpace
    ActivateInterrupt_Inv_Idle_NotIn_Threads 
    ActivateInterrupt_Inv_Sigma0_In_Active ActivateInterrupt_Inv_RootServer_In_Active 
    ActivateInterrupt_Inv_IntThreads_In_Active 
    ActivateInterrupt_Inv_Threads_In_Config ActivateInterrupt_Inv_Active_In_Threads 
    ActivateInterrupt_Inv_NThreads_Is_None ActivateInterrupt_Inv_Threads_IsNot_None
    ActivateInterrupt_Inv_Threads_Space_Dom
    ActivateInterrupt_Inv_Threads_Space_In_Spaces ActivateInterrupt_Inv_Threads_Eq_Space_Threads 
    ActivateInterrupt_Inv_Threads_Sche_In_Threads 
    ActivateInterrupt_Inv_NActive_Utcb_Is_None ActivateInterrupt_Inv_Active_Utcb_IsNot_None
    ActivateInterrupt_Inv_IntThreads_Utcb_Is_None ActivateInterrupt_Inv_Threads_Partner_In_Threads
    ActivateInterrupt_Inv_Threads_Incoming_In_Threads ActivateInterrupt_Inv_Sigma0_Space
    ActivateInterrupt_Inv_RootServer_Space ActivateInterrupt_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ActivateInterrupt_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>ActivateInterrupt SysConf <span class="free">s</span> <span class="free">gno</span> <span class="free">handler</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> ActivateInterrupt_Inv_Current ActivateInterrupt_Inv_Space ActivateInterrupt_Inv_Thread 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹DeactivateInterrupt›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Thread_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Current_Space_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeactivateInterrupt_Inv_Current_Thread_In_Active DeactivateInterrupt_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> DeactivateInterrupt_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DeactivateInterrupt_rtran DeactivateInterrupt_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DeactivateInterrupt_valid DeactivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> DeactivateInterrupt_direct_eq DeactivateInterrupt_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>DeactivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>DeactivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>DeactivateInterrupt_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>DeactivateInterrupt_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> DeactivateInterrupt_Inv_Space_HasNot_Loop DeactivateInterrupt_Inv_Space_Valid_Has_Real
   DeactivateInterrupt_Inv_Space_Perms_IsNot_Empty DeactivateInterrupt_Inv_Space_Spaces_In_Config 
   DeactivateInterrupt_Inv_Space_InitialSpaces_In_Spaces DeactivateInterrupt_Inv_Space_Perms_Subset
   DeactivateInterrupt_Inv_Space_Spaces_IsNot_None DeactivateInterrupt_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_NotIn_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Idle_Space_Is_KernelSpace<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Sigma0_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_RootServer_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_In_Active<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_In_Config<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NThreads_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p0 p1 p2 Inv_IntThreads_In_Active_def Inv_NThreads_Is_None_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_Dom<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Space_In_Spaces<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Eq_Space_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Sche_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_NActive_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Active_Utcb_IsNot_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_IntThreads_Utcb_Is_None<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_IntThreads_Utcb_Is_None_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Partner_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeactivateInterrupt_def SetThreadScheduler_def SetThreadState_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> elim_if<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> SetError_Inv_Threads_Incoming_In_Threads<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def DeactivateInterrupt_def
    SetThreadScheduler_def SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def DeactivateInterrupt_def
    SetThreadScheduler_def SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def DeactivateInterrupt_def
    SetThreadScheduler_def SetThreadState_def SetError_def SetThreadError_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> DeactivateInterrupt_Inv_Idle_Space_Is_KernelSpace
    DeactivateInterrupt_Inv_Idle_NotIn_Threads 
    DeactivateInterrupt_Inv_Sigma0_In_Active DeactivateInterrupt_Inv_RootServer_In_Active 
    DeactivateInterrupt_Inv_IntThreads_In_Active 
    DeactivateInterrupt_Inv_Threads_In_Config DeactivateInterrupt_Inv_Active_In_Threads 
    DeactivateInterrupt_Inv_NThreads_Is_None DeactivateInterrupt_Inv_Threads_IsNot_None 
    DeactivateInterrupt_Inv_Threads_Space_Dom DeactivateInterrupt_Inv_Threads_Space_In_Spaces 
    DeactivateInterrupt_Inv_Threads_Eq_Space_Threads DeactivateInterrupt_Inv_Threads_Sche_In_Threads 
    DeactivateInterrupt_Inv_NActive_Utcb_Is_None DeactivateInterrupt_Inv_Active_Utcb_IsNot_None
    DeactivateInterrupt_Inv_IntThreads_Utcb_Is_None DeactivateInterrupt_Inv_Threads_Partner_In_Threads
    DeactivateInterrupt_Inv_Threads_Incoming_In_Threads DeactivateInterrupt_Inv_Sigma0_Space
    DeactivateInterrupt_Inv_RootServer_Space DeactivateInterrupt_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeactivateInterrupt_Inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>DeactivateInterrupt <span class="free">s</span> <span class="free">gno</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> DeactivateInterrupt_Inv_Current DeactivateInterrupt_Inv_Space DeactivateInterrupt_Inv_Thread 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre></body>