<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.theories { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }
</style><title>Theory "L4_Space_Lemmas"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> L4_Space_Lemmas
  <span class="keyword2"><span class="keyword">imports</span></span> L4_State_Lemmas
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹basic lemmas›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> basic1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> tran_path
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tran_path.intros<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> refl_tran rtran_tran tran_path.simps<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tran_path.intros<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic13<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tran_path.intros<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic14<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> basic13
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tran_path.intros<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic15<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> direct_path_def rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic16<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">z</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_path <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_tran <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">b</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> basic15 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic17<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">z</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> basic16 rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> basic1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="bound">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span><span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> rtran_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtran_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> basic1 rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic41<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span><span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rtran_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">using</span></span> basic1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic42<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span><span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rtran_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> basic1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> basic5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">=</span> Some <span class="free">mapping</span> <span class="main">⟹</span> <span class="free">mapping</span> <span class="free">v</span> <span class="main">=</span> None <span class="main">⟹</span>
 <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">=</span> Some <span class="free">mapping</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">mapping</span> <span class="free">v</span> <span class="main">=</span> None"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> direct_path_def a1 a2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span>
    <span class="keyword1"><span class="command">using</span></span> a4 a1 a2 a3
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> direct_path_def h1<span class="main">)</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Space_Father_Is_Unique<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y1</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y2</span> <span class="main">⟶</span> <span class="free">y1</span> <span class="main">=</span> <span class="free">y2</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PlusEqOneStar<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">⊢</span> <span class="bound">y</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">z</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rtran_path.intros<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_path rtran_tran tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PlusEqOneStarVirtual<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None
<span class="main">⟹</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">≠</span> None <span class="main">⟹</span>
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">z</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">≠</span> None"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 a2 direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> basic15 a1 h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 basic111 h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="bound">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> path_direct valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span> 
space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span> the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span> <span class="main">≠</span> None"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> ValidVpageMappingNotNone path_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_space1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> 
space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span> the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span> <span class="main">≠</span> None"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> ValidVpageMappingNotNone path_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> FatherIsValid basic3<span class="main">)</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹sys_unmap›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">thm</span></span> option.exhaust
<span class="keyword1"><span class="command">thm</span></span> elim_case_option<span class="main">[</span><span class="language"><span class="operator">no_vars</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> elim_some<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">y</span> <span class="main">≠</span> None <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> the <span class="free">y</span> <span class="main">⟹</span> Some <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="main">∧</span>
 dom <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>space_mapping <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_unmap_def spaces_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">x</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_Space1<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_Space2<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">sp1</span> <span class="main">∈</span> spaces <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">sp1</span> <span class="main">∈</span> spaces <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> spaces_def sys_unmap_def dom_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space_mapping›</span></span></span>
<span class="comment1">―<span class="quoted"><span class="document"><span class="plain_text">‹unmap not in path›</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_pre<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def direct_path_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">spa</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">ya</span> <span class="improper">va</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="improper">spa</span> <span class="improper">va</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">b</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">thm</span></span> sys_unmap_def
<span class="keyword1"><span class="command">lemma</span></span> unmap_not_path_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">⟹</span>
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_not_path_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span>
<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def direct_path_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_not_path_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> unmap_not_path_direct tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path unmap_not_path_direct <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_not_path_tran2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_not_path_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> unmap_not_path_tran1 unmap_not_path_tran2 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="comment1">― <span class="quoted"><span class="document"><span class="plain_text">‹unmap in path›</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> unmap_path_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span>
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def get_perms_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_path_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> unmap_path_space path_space1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_path_tran_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> 
get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> unmap_path_space valid_page_def direct_path_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> option.discI option.sel<span class="main">)</span></span>

<span class="comment1">―<span class="quoted"><span class="document"><span class="plain_text">‹unmap not enough perms›</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span>get_perms1 <span class="free">s</span> <span class="free">x</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span>
<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms1_def direct_path_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> SonIsNoReal <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span>
space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span>
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">≠</span> None <span class="main">∧</span>
fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="bound">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">≠</span> None"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def <span class="keyword1"><span class="command">using</span></span> a2 get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">z</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span>
<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">z</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a3 direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span>
    the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">≠</span> None <span class="main">∧</span>
    fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> unmap_preserve_space a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> direct_path_def h3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_tran_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span>get_perms1 <span class="free">s</span> <span class="free">x</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span> 
Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> unmap_preserve_direct tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sp1</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">sp2</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">x</span> <span class="main">=</span> Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> basic3 FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">meson</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> tran_path Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path get_perms_auxi <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms1 <span class="free">s</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 get_perms_auxi <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path unmap_preserve_tran h1 h3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h4 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_tran_tran2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span>get_perms1 <span class="free">s</span> <span class="free">x</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span> 
Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sp1</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">sp2</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">x</span> <span class="main">=</span> Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> basic3 FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">meson</span></span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path sys_unmap_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> h1 tran_path Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path get_perms_auxi <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms1 <span class="free">s</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 get_perms_auxi <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 h4 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_tran_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>get_perms1 <span class="free">s</span> <span class="free">x</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span> 
Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> unmap_preserve_tran_tran1 unmap_preserve_tran_tran2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_tran_tran'<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span> 
Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> 
<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> unmap_preserve_tran_tran get_perms_auxi
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unmap_preserve_perms_subset<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> 
get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">mapping</span><span class="main">.</span> space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">=</span> Some <span class="bound">mapping</span> <span class="main">∧</span> <span class="bound">mapping</span> <span class="free">v1</span> <span class="main">≠</span> None <span class="main">∧</span>
    snd<span class="main">(</span>the<span class="main">(</span><span class="bound">mapping</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual basic3 direct_def get_perms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> ValidVpageHasSon ValidVpageMappingNotNone option.exhaust_sel<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mapping</span></span> <span class="keyword2"><span class="keyword">where</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">=</span> Some <span class="skolem">mapping</span> <span class="main">∧</span> <span class="skolem">mapping</span> <span class="free">v1</span> <span class="main">≠</span> None <span class="main">∧</span>
    snd<span class="main">(</span>the<span class="main">(</span><span class="skolem">mapping</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"snd<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    snd<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span> <span class="free">perms</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def <span class="keyword1"><span class="command">using</span></span> h2 a2 a1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command">using</span></span> h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span>
    get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Inv›</span></span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_unmap_Inv_Current_Thread_In_Active sys_unmap_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">x</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def get_perms_def valid_page_def direct_path_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">spa</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">y</span> <span class="improper">v_page</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">p2</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def valid_page_def direct_path_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">y</span> <span class="improper">v_page</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="improper">spa</span> <span class="improper">v_page</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">b</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">b</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_HasNot_Loop1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">spa</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">spa</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"False"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre tran_path.intros
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre tran_path.intros
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a3 a4 a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> a1 sys_unmap_Inv_Space_HasNot_Loop1 Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">sp1</span> <span class="skolem">sp2</span> <span class="skolem">v1</span> <span class="skolem">v2</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> YIsValid h1 p2 p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h1 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="skolem">sp2</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 valid_page_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> unmap_path_tran_valid a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a1 valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> unmap_preserve_perms_subset a11 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a11 h1 basic15 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h11 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def</span><span class="main">]</span> h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">have</span></span> h15<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h13 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h16<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">⟹</span> 
          get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a161<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> Virtual <span class="free">sp</span> <span class="free">v</span>"</span></span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> a161 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span><span class="main">)</span> <span class="skolem">v2</span> <span class="main">=</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="skolem">sp2</span><span class="main">)</span> <span class="skolem">v2</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> unmap_not_path_space a161 h4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> h17<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span>
          get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">-</span> <span class="free">perms</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> unmap_preserve_perms_subset h14 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h12 h15 h3 h16 h17 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a21 h1 basic2 one_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> unmap_not_path_space a21 p2 h1 direct_path_def get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">have</span></span> h22<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> unmap_not_path_space h20 h2 p2 direct_path_def valid_page_def
        <span class="keyword1"><span class="command">using</span></span> get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h21 h22 h3
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Valid_Has_Real1<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span>
<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 sys_unmap_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="skolem">x</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Virtual <span class="skolem">x11</span> <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> rtran_tran FatherIsValid basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
    <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> Virtual h3 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h11 unmap_not_path_tran a3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">x11</span> <span class="skolem">x12</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">x11</span> <span class="skolem">x12</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Virtual unmap_path_tran_valid a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> unmap_preserve_tran_tran Virtual a3 a4 a11 get_perms_auxi <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h1111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a3<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h112<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h11 h10 basic17 a3 a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h113<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> unmap_not_path_tran h1111 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h111 basic1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Real <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_path.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Valid_Has_Real2<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="skolem">x</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Virtual <span class="skolem">x11</span> <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 rtran_tran
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> FatherIsValid page_t.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rtran_path.cases<span class="main">)</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Real <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span> p2 p3
    sys_unmap_Inv_Space_Valid_Has_Real1 sys_unmap_Inv_Space_Valid_Has_Real2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
     sys_unmap_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
     sys_unmap_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span> sys_unmap_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span>
    sys_unmap_Inv_Space_HasNot_Loop sys_unmap_Inv_Space_Valid_Has_Real
    sys_unmap_Inv_Space_Perms_IsNot_Empty sys_unmap_Inv_Space_Spaces_In_Config 
   sys_unmap_Inv_Space_InitialSpaces_In_Spaces sys_unmap_Inv_Space_Perms_Subset
   sys_unmap_Inv_Space_Spaces_IsNot_None sys_unmap_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
    sys_unmap_NC_Thread sys_unmap_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
    sys_unmap_NC_Thread sys_unmap_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def sys_unmap_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_unmap_def Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def sys_unmap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def sys_unmap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def sys_unmap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> sys_unmap_Inv_Idle_NotIn_Threads 
    sys_unmap_Inv_Sigma0_In_Active sys_unmap_Inv_Idle_Space_Is_KernelSpace
    sys_unmap_Inv_RootServer_In_Active sys_unmap_Inv_IntThreads_In_Active 
    sys_unmap_Inv_Threads_Space_Dom
    sys_unmap_Inv_Threads_In_Config sys_unmap_Inv_Active_In_Threads 
    sys_unmap_Inv_NThreads_Is_None sys_unmap_Inv_Threads_IsNot_None 
    sys_unmap_Inv_Threads_Space_In_Spaces sys_unmap_Inv_Threads_Eq_Space_Threads
    sys_unmap_Inv_Threads_Sche_In_Threads 
    sys_unmap_Inv_NActive_Utcb_Is_None sys_unmap_Inv_Active_Utcb_IsNot_None
    sys_unmap_Inv_IntThreads_Utcb_Is_None sys_unmap_Inv_Threads_Partner_In_Threads
    sys_unmap_Inv_Threads_Incoming_In_Threads sys_unmap_Inv_Sigma0_Space
    sys_unmap_Inv_RootServer_Space sys_unmap_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Invariants_def sys_unmap_Inv_Current sys_unmap_Inv_Space 
    sys_unmap_Inv_Thread  assms
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹sys_flush›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_flush_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_flush_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_flush_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="main">∧</span>
 dom <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>space_mapping <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_flush_def spaces_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">x</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">‹flush post-node in same path›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> flush_post_tran_vapge<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span>
Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">⟹</span> space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span> 
the<span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a11 a1 basic12 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>fst<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 path_direct path_space direct_path_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ValidVpageMappingNotNone YTranIsValid a3 option.collapse prod.collapse<span class="main">)</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def
    <span class="keyword1"><span class="command">using</span></span> h1 h2 direct_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">using</span></span> direct_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_post_tran_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">⟹</span> 
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> flush_post_tran_vapge direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_post_tran_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">⟹</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> 
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_post_tran_direct tran_path.intros
    <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">smt</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> basic11 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tran_path<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tran_path FatherIsVirtual flush_post_tran_direct <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h12 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_post_tran_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span> <span class="main">⟹</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">⟹</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">x</span> <span class="main">⟹</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> 
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_path <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_post_tran_direct rtran_path.intros
    <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">smt</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_tran <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> basic11 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> refl_tran<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> refl_tran FatherIsVirtual flush_post_tran_direct <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h12 rtran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">thm</span></span> flush_post_tran_tran
<span class="keyword1"><span class="command">thm</span></span> flush_post_tran_rtran

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">‹flush pre-node in same path›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> flush_space_none<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">=</span> None <span class="main">⟹</span> space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_vpage_none<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">=</span> Some <span class="free">mapping</span> <span class="main">⟹</span> <span class="free">mapping</span> <span class="free">vpage1</span> <span class="main">=</span> None <span class="main">⟹</span> 
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_in_path_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">⟹</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span> <span class="main">≠</span> None <span class="main">⟹</span>
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span> snd <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span>
<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_pre_rtran_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> None
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_space_none
       ValidVpageMappingNotNone <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">a</span> <span class="free">vpage1</span>"</span></span></span><span class="main">)</span></span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_vpage_none
        Some ValidVpageMappingNotNone <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_in_path_rtran a1 a2 a3 
          ValidVpageMappingNotNone Some
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> flush_space_none flush_vpage_none get_perms_def option.collapse<span class="main">)</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_pre_tran_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> flush_pre_rtran_valid rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">thm</span></span> flush_pre_rtran_valid
<span class="keyword1"><span class="command">thm</span></span> flush_pre_tran_valid

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">‹flush not enough perms›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_rtran_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="free">vpage</span> <span class="main">≠</span> None <span class="main">⟹</span> space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span>
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span> <span class="main">≠</span> None <span class="main">∧</span>
fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="free">vpage</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space"</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">∨</span> 
            <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span> the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span><span class="free">vpage1</span> <span class="main">≠</span> None"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> path_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def
      <span class="keyword1"><span class="command">using</span></span> a5 a2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> get_perms_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def
      <span class="keyword1"><span class="command">using</span></span> a2 a3 a4 a5 get_perms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_tran_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span>
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span> <span class="main">≠</span> None <span class="main">∧</span>
fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> path_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> path_space direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_self_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span>
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
         a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span> the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="free">vpage</span> <span class="main">≠</span> None <span class="main">∧</span>
    fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span>
    the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span> <span class="main">≠</span> None <span class="main">∧</span>
    fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> flush_preserve_rtran_vpage a1 a2 a3 refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_tran_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">spa</span> <span class="free">va</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">spa</span> <span class="free">va</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
         a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
         a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">spa</span> <span class="free">va</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space"</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">∨</span> 
            <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span><span class="free">vpage1</span> <span class="main">≠</span> None"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> path_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">∧</span>
    the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span> <span class="main">≠</span> None <span class="main">∧</span>
    fst<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Virtual <span class="free">spa</span> <span class="free">va</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a11 a2 a3 a4 flush_preserve_tran_vpage direct_def prod.collapse prod.inject <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_preserve_self_direct a1 a2 a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_self1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>get_perms1 <span class="free">s</span> <span class="free">x</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> 
Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_path <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_preserve_self_direct get_perms_auxi <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_tran <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">b</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> basic11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sp1</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">b</span> <span class="main">=</span> Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sp2</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">a</span> <span class="main">=</span> Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual refl_tran<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms1 <span class="free">s</span> <span class="skolem">b</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> refl_tran h1 get_perms_auxi <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_self<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> 
Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> flush_preserve_self1 get_perms_auxi
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_rtran_auxi<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms1 <span class="free">s</span> <span class="free">x</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_path <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> rtran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>refl_tran <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">spa</span></span> <span class="skolem"><span class="skolem">va</span></span> <span class="keyword2"><span class="keyword">where</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">y</span> <span class="main">=</span> Virtual <span class="skolem">spa</span> <span class="skolem">va</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> rtran_path.cases<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> get_perms1 <span class="free">s</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran Inv_Space_Perms_Subset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> FatherIsVirtual get_perms_auxi in_mono subset_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h22<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">spa</span></span> <span class="skolem"><span class="skolem">va</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">x</span> <span class="main">=</span> Virtual <span class="skolem">spa</span> <span class="skolem">va</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual refl_tran<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> refl_tran flush_preserve_tran_direct get_perms_auxi h21 rtran_path.refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_path.intros h22 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> 
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> flush_preserve_rtran_auxi get_perms_auxi
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">thm</span></span> flush_preserve_rtran

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span> <span class="main">≠</span> None <span class="main">⟹</span> 
snd<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
snd<span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span> <span class="free">perms</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def get_perms_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_space rtran_tran  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_perms_subset_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def get_perms_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_space rtran_tran  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_perms_subset_self<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
 space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">⟹</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span> <span class="main">≠</span> None <span class="main">⟹</span> 
get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def get_perms_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_space rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_preserve_perms_subset_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">⟹</span>
the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">vpage</span> <span class="main">≠</span> None <span class="main">⟹</span> 
get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">vpage1</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def get_perms_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_space rtran_tran  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹flush node in different path›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> flush_not_path_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span> <span class="main">=</span> the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">vpage1</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_not_path_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">vpage</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">vpage</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">vpage1</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def valid_page_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_not_path_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> 
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> flush_not_path_rtran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_not_path_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sp1</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">=</span> Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="skolem">sp1</span> <span class="main">≠</span> None <span class="main">∧</span>
    the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="skolem">sp1</span><span class="main">)</span> <span class="skolem">v1</span> <span class="main">≠</span> None <span class="main">∧</span> fst<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="skolem">sp1</span><span class="main">)</span><span class="skolem">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> direct_path_def valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">force</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span><span class="main">)</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> flush_not_path_rtran a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_not_path_valid a2 h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h2 direct_path_def ValidVpageMappingNotNone <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flush_not_path_tran_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_not_path_direct tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path flush_not_path_direct <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path.tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">thm</span></span> flush_not_path_tran_rtran

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_pre<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def direct_path_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">=</span> Sigma0Space"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">spa</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">ya</span> <span class="improper">va</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv option.discI option.sel<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">using</span></span> sys_flush_pre
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_flush_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sys_flush_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹inv›</span></span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_flush_Inv_Current_Thread_In_Active sys_flush_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">spa</span> <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">sp</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="bound">sp</span> <span class="bound">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="bound">sp</span> <span class="bound">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="skolem">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="skolem">spa</span> <span class="skolem">v1</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="skolem">spa</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">y</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command">using</span></span> sys_flush_pre tran_path.intros
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">using</span></span> sys_flush_pre tran_path.intros
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="skolem">spa</span> <span class="skolem">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="skolem">spa</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h1 a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">spa</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">sp</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="bound">sp</span> <span class="bound">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="bound">sp</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="bound">spa</span> <span class="bound">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="bound">spa</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def get_perms_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span><span class="main">=</span>Sigma0Space"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def direct_path_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">spa</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">y</span> <span class="improper">v_page</span> <span class="main">=</span> Some <span class="main">(</span><span class="improper">p2</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def valid_page_def direct_path_def</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">y</span> <span class="improper">v_page</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="improper">spa</span> <span class="improper">v_page</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">b</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">b</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">x</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">sp1</span> <span class="skolem">sp2</span> <span class="skolem">v1</span> <span class="skolem">v2</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sys_flush_pre a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> YIsValid h1 p2 p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h1 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="skolem">sp2</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 valid_page_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space"</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> flush_pre_tran_valid a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a1 valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> flush_preserve_perms_subset_tran h11 a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a11 h1 basic15 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h11 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def</span><span class="main">]</span> h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">have</span></span> h15<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h13 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h16<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
          get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a161<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> Virtual <span class="free">sp</span> <span class="free">v</span>"</span></span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> p2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> a161 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span><span class="main">)</span> <span class="skolem">v2</span> <span class="main">=</span> the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="skolem">sp2</span><span class="main">)</span> <span class="skolem">v2</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> unmap_not_path_space a161 h4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> h17<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
          get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">-</span> <span class="free">perms</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> unmap_preserve_perms_subset h14 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h15<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>
          <span class="main">∨</span> get_perms <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h15 h16 h17 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">have</span></span> h16<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">=</span> Sigma0Space <span class="main">⟹</span> 
        get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def <span class="keyword1"><span class="command">using</span></span> h3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h17<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span>
        get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h12 h15 h3 
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Diff_mono ValidVpageMappingNotNone flush_preserve_perms_subset_self flush_preserve_perms_subset_tran h13 h14 h2 order_refl page_t.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rtran_tran<span class="main">)</span></span>
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h16 h17 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a21 h1 basic42 one_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">from</span></span> a21 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a211<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h211<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span> the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">≠</span> None"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> path_space h1 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">⊆</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space"</span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> flush_pre_rtran_valid a211 refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a1 valid_page_def a211 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h212<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">-</span> <span class="free">perms</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> a211 flush_preserve_perms_subset_self h211 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">=</span> Sigma0Space <span class="main">⟹</span> get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span>"</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>  <span class="keyword1"><span class="command">using</span></span> h212 a211 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a212<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> flush_not_path_rtran get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> h22<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> flush_not_path_rtran h20 get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h21 h22 h3
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_Valid_Has_Real1<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span>
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 sys_flush_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="skolem">x</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Virtual <span class="skolem">x11</span> <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> rtran_tran FatherIsValid basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
    <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> Virtual h3 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h11 flush_not_path_tran_rtran a3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> h110<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="main">¬</span> get_perms <span class="free">s</span> <span class="skolem">x11</span> <span class="skolem">x12</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">x11</span> <span class="skolem">x12</span> <span class="main">⊆</span> <span class="free">perms</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a112<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space"</span></span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Virtual flush_pre_rtran_valid a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">thm</span></span> YTranIsValid
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> flush_preserve_rtran Virtual a3 a4 a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h112<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">=</span> Sigma0Space <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def <span class="keyword1"><span class="command">using</span></span> a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h113<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h111 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">have</span></span> h114<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h11 h10 basic16 a3 a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="bound">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">y</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> PlusEqOneStar <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> h115<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h116<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> flush_post_tran_rtran<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span> h114 a3 a1 one_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h117<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a11 h110 flush_preserve_self Virtual a4 h115 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h118<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">=</span> Sigma0Space <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def <span class="keyword1"><span class="command">using</span></span> h115 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h119<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> h117 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h113 h116
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> basic1 basic11  rtran_tran<span class="main">)</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Real <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_path.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_Valid_Has_Real2<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="skolem">x</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Virtual <span class="skolem">x11</span> <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 rtran_tran
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> FatherIsValid page_t.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rtran_path.cases<span class="main">)</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Real <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  p2 p3 sys_flush_Inv_Space_Valid_Has_Real1 
    sys_flush_Inv_Space_Valid_Has_Real2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
     sys_flush_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
     sys_flush_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span> sys_flush_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Space_def assms sys_flush_Inv_Space_In_Config
    sys_flush_Inv_Space_HasNot_Loop sys_flush_Inv_Space_Perms_IsNot_Empty
    sys_flush_Inv_Space_Perms_Subset sys_flush_Inv_Space_Valid_Has_Real
    sys_flush_Inv_Space_InitialSpaces_In_Spaces sys_flush_Inv_Space_Spaces_IsNot_None
    sys_flush_Inv_Space_Vpage_Range
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
    sys_flush_NC_Thread sys_flush_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
    sys_flush_NC_Thread sys_flush_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def sys_flush_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_flush_def Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def sys_flush_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def sys_flush_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def sys_flush_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> sys_flush_Inv_Idle_NotIn_Threads 
    sys_flush_Inv_Sigma0_In_Active sys_flush_Inv_Idle_Space_Is_KernelSpace
    sys_flush_Inv_RootServer_In_Active sys_flush_Inv_IntThreads_In_Active 
    sys_flush_Inv_Threads_Space_Dom    
    sys_flush_Inv_Threads_In_Config sys_flush_Inv_Active_In_Threads
    sys_flush_Inv_NThreads_Is_None sys_flush_Inv_Threads_IsNot_None 
    sys_flush_Inv_Threads_Space_In_Spaces sys_flush_Inv_Threads_Eq_Space_Threads
    sys_flush_Inv_Threads_Sche_In_Threads 
    sys_flush_Inv_NActive_Utcb_Is_None sys_flush_Inv_Active_Utcb_IsNot_None
    sys_flush_Inv_IntThreads_Utcb_Is_None sys_flush_Inv_Threads_Partner_In_Threads
    sys_flush_Inv_Threads_Incoming_In_Threads sys_flush_Inv_Sigma0_Space
    sys_flush_Inv_RootServer_Space sys_flush_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_flush_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>sys_flush <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Invariants_def sys_flush_Inv_Current sys_flush_Inv_Space 
    sys_flush_Inv_Thread assms
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Flush_fpage_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_flush_Invariant
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">‹sys_map›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">thm</span></span> prod.case_eq_if
<span class="keyword1"><span class="command">lemma</span></span> sys_map_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="main">∧</span>
 dom <span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>space_mapping <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sys_map_def spaces_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">xa</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_pre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def direct_path_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">=</span> Sigma0Space"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> option.discI<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">sp</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">yaa</span> <span class="improper">v</span> <span class="main">=</span> None <span class="main">∧</span> <span class="main">(</span><span class="improper">sp</span> <span class="main">=</span> <span class="free">sp_to</span> <span class="main">⟶</span> <span class="improper">v</span> <span class="main">≠</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="improper">sp</span> <span class="improper">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">sp</span> <span class="main">=</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="improper">v</span> <span class="main">=</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_pre1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_map_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_pre2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> sys_map_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_pre3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="free">y</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">y</span> <span class="main">≠</span> Virtual <span class="free">sp_from</span> <span class="free">v_from</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_map_pre2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> a2 a3 <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> sys_map_def <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 sys_map_pre
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹not influence other›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_not_path<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span> 
the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> the <span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_not_path_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span> 
snd<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
snd<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_not_path_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_not_path_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> map_not_path_direct FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> tran_path map_not_path_direct FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_not_path_tran2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span> <span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> one_path sys_map_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_path.intros sys_map_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tran_path refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_not_path_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> map_not_path_tran1 map_not_path_tran2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_not_path_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> map_not_path_tran rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">thm</span></span> map_not_path_tran
<span class="keyword1"><span class="command">thm</span></span> map_not_path_rtran

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹influence to _self›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_to_self_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span>
 <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span><span class="main">)</span> <span class="free">v_to</span> <span class="main">≠</span> None <span class="main">∧</span>
fst<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span><span class="main">)</span> <span class="free">v_to</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Virtual <span class="free">sp_from</span> <span class="free">v_from</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">using</span></span> rtran_path.refl_path
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_to_self_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span>
 <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
snd <span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span><span class="main">)</span> <span class="free">v_to</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">perms</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">using</span></span> rtran_path.refl_path
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_to_self_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span>
 <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def direct_path_def
  <span class="keyword1"><span class="command">using</span></span> rtran_path.refl_path
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹influence to _post›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_to_post_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span> 
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> rtran_tran path_space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_to_post_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> map_to_post_space ValidVpageMappingNotNone <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_to_post_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> map_to_post_space path_space1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹not_influence to _pre›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_to_pre_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 a1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> basic14<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> map_not_path_rtran a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹not_influence from _pre›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_from_self_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
snd<span class="main">(</span>the<span class="main">(</span>the<span class="main">(</span>space_mapping <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_from</span><span class="main">)</span><span class="free">v_from</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
snd<span class="main">(</span>the<span class="main">(</span>the<span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span><span class="free">v_from</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_from_pre_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span> <span class="main">=</span> 
<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">thm</span></span> map_not_path_rtran
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> map_not_path_rtran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Inv›</span></span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_map_Inv_Current_Thread_In_Active sys_map_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">x</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_IsNot_Empty1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> map_to_self_perms p2 get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_map_valid p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span></span><span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Perms_IsNot_Empty_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> map_to_post_valid p3 p2 p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> False rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> map_not_path_perms h1 get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_IsNot_Empty2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_map_Inv_Space_Perms_IsNot_Empty1 sys_map_Inv_Space_Perms_IsNot_Empty2
    Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">thm</span></span> map_not_path_tran
<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_HasNot_Loop11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"False"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p4 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> map_to_self_direct p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> basic15 p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> map_from_pre_rtran p1 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_tran p2 a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p2 a11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> map_to_post_tran p1 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_HasNot_Loop12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"False"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> map_not_path_tran p1 p3 p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_HasNot_Loop1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_map_Inv_Space_HasNot_Loop11 sys_map_Inv_Space_HasNot_Loop12
    p1 p2 Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_HasNot_Loop2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 sys_map_Inv_Space_HasNot_Loop1 sys_map_Inv_Space_HasNot_Loop2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_Subset11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p6<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span>
       <span class="main">⊆</span> get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
  <span class="keyword1"><span class="command">thm</span></span> map_to_post_tran
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p5 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> map_to_post_tran p2 p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p6
      <span class="keyword1"><span class="command">using</span></span> one_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h22<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp2</span> <span class="free">v2</span> <span class="main">=</span> Virtual <span class="free">sp_from</span> <span class="free">v_from</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> map_to_self_direct p4 p6 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Space_Father_Is_Unique<span class="main">)</span></span>
    <span class="keyword1"><span class="command">have</span></span> h23<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="main">=</span> <span class="free">perms</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">using</span></span> map_to_self_perms p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">=</span> get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_from</span> <span class="free">v_from</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">using</span></span> map_from_self_perms p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">thm</span></span> map_to_self_perms
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> a21 h22 h23 p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_Subset12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span>
       <span class="main">⊆</span> get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
  <span class="keyword1"><span class="command">thm</span></span> map_not_path_perms
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">using</span></span> p2 map_not_path_perms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p2 refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_map_pre p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">using</span></span> map_not_path_perms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h3 p1 Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h5 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_Subset1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
  <span class="keyword1"><span class="command">using</span></span> assms sys_map_Inv_Space_Perms_Subset11 sys_map_Inv_Space_Perms_Subset12 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_Subset2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_map_Inv_Space_Perms_Subset1 sys_map_Inv_Space_Perms_Subset2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Valid_Has_Real11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> map_to_self_direct p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 p4 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> map_from_pre_rtran p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 refl_tran True <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_map_valid p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span><span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p4 map_to_post_valid p3 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> False rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> map_not_path_rtran h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Valid_Has_Real12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 p3 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Valid_Has_Real1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_map_Inv_Space_Valid_Has_Real11 sys_map_Inv_Space_Valid_Has_Real12
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Valid_Has_Real21<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> map_to_self_direct p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_page_def True <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="bound">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p3 rtran_path.cases <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Valid_Has_Real22<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 p3 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Valid_Has_Real2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_map_Inv_Space_Valid_Has_Real21 sys_map_Inv_Space_Valid_Has_Real22
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="improper">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sys_map_Inv_Space_Valid_Has_Real1 sys_map_Inv_Space_Valid_Has_Real2
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
     sys_map_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
     sys_map_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> page_t.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sys_map_def sys_map_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Space_def assms sys_map_Inv_Space_Spaces_In_Config
    sys_map_Inv_Space_HasNot_Loop sys_map_Inv_Space_Perms_IsNot_Empty
    sys_map_Inv_Space_Perms_Subset sys_map_Inv_Space_Valid_Has_Real
    sys_map_Inv_Space_InitialSpaces_In_Spaces 
    sys_map_Inv_Space_Spaces_IsNot_None sys_map_Inv_Space_Vpage_Range
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
    sys_map_NC_Thread sys_map_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
    sys_map_NC_Thread sys_map_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def sys_map_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_map_def Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def sys_map_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> sys_map_Inv_Idle_NotIn_Threads 
    sys_map_Inv_Sigma0_In_Active sys_map_Inv_Idle_Space_Is_KernelSpace
    sys_map_Inv_RootServer_In_Active sys_map_Inv_IntThreads_In_Active
    sys_map_Inv_Threads_Space_Dom
    sys_map_Inv_Threads_In_Config sys_map_Inv_Active_In_Threads 
    sys_map_Inv_NThreads_Is_None sys_map_Inv_Threads_IsNot_None 
    sys_map_Inv_Threads_Space_In_Spaces sys_map_Inv_Threads_Eq_Space_Threads
    sys_map_Inv_Threads_Sche_In_Threads 
    sys_map_Inv_NActive_Utcb_Is_None sys_map_Inv_Active_Utcb_IsNot_None
    sys_map_Inv_IntThreads_Utcb_Is_None sys_map_Inv_Threads_Partner_In_Threads
    sys_map_Inv_Threads_Incoming_In_Threads sys_map_Inv_Sigma0_Space
    sys_map_Inv_RootServer_Space sys_map_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_map_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>sys_map <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Invariants_def sys_map_Inv_Current sys_map_Inv_Space 
    sys_map_Inv_Thread assms
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Map_fpage_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_map_Invariant
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">‹sys_grant›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Let_def
  <span class="keyword1"><span class="command">using</span></span> sys_flush_NC_Current
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Let_def
  <span class="keyword1"><span class="command">using</span></span> sys_flush_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>    

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="main">∧</span>
 dom <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>space_mapping <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sys_grant_def spaces_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">xa</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_pre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def direct_path_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">=</span> Sigma0Space"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> option.discI<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">sp</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">yaa</span> <span class="improper">v</span> <span class="main">=</span> None <span class="main">∧</span> <span class="main">(</span><span class="improper">sp</span> <span class="main">=</span> <span class="free">sp_to</span> <span class="main">⟶</span> <span class="improper">v</span> <span class="main">≠</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="improper">sp</span> <span class="improper">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="improper">sp</span> <span class="improper">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">sp</span> <span class="main">=</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="improper">v</span> <span class="main">=</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_pre1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> 
<span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span>
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_grant_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_pre2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> sys_grant_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_pre3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="free">y</span> <span class="main">=</span> fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">y</span> <span class="main">≠</span> fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_grant_pre2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> a2 a3 <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> sys_grant_def <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_valid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 sys_grant_pre
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹not influence other›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> grant_not_path<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span> 
<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">⟹</span> 
the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> the <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_not_path_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>  <span class="main">∧</span> 
<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">⟹</span> 
snd<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
snd<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_not_path_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_not_path_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> grant_not_path_direct FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> tran_path grant_not_path_direct FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_not_path_tran2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">x</span> <span class="main">≠</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span> <span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> one_path sys_grant_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> rtran_path.intros sys_grant_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tran_path refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_not_path_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span> 
<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> grant_not_path_tran1 grant_not_path_tran2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_not_path_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span> 
<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> grant_not_path_tran rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">thm</span></span> grant_not_path_tran
<span class="keyword1"><span class="command">thm</span></span> grant_not_path_rtran

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹influence to _self›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> grant_to_self_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> 
<span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span><span class="main">)</span> <span class="free">v_to</span> <span class="main">≠</span> None <span class="main">∧</span>
fst<span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span><span class="main">)</span> <span class="free">v_to</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">using</span></span> rtran_path.refl_path
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_to_self_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span>
 <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
snd <span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp_to</span><span class="main">)</span> <span class="free">v_to</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">perms</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">using</span></span> rtran_path.refl_path
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_to_self_direct<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> 
<span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span>
<span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def direct_path_def
  <span class="keyword1"><span class="command">using</span></span> rtran_path.refl_path
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹influence to or from _post›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> grant_path_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">⟹</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">⟹</span>
space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span> 
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> None"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
    <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="bound">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∄</span><span class="bound">y</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="bound">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a2 a3 rtran_tran <span class="keyword1"><span class="command">using</span></span> basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a11 a1 valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword1"><span class="command">using</span></span> direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_path_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">⟹</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">⟹</span> 
<span class="main">¬</span><span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> grant_path_space ValidVpageMappingNotNone <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹influence to _post›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> grant_to_post_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="main">≠</span> None <span class="main">∧</span> 
the <span class="main">(</span>space_mapping <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> rtran_tran path_space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_to_post_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> grant_to_post_space ValidVpageMappingNotNone <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_to_post_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">⟹</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span>  <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">¬</span><span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> grant_to_post_space path_space1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">‹not influence from _pre›</span></span></span>
<span class="keyword1"><span class="command">thm</span></span> grant_not_path_rtran
<span class="keyword1"><span class="command">lemma</span></span> grant_from_pre_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span> <span class="main">=</span> 
<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
    <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> direct_path_def a1 valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> basic111 a2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> grant_not_path_rtran h1 FatherIsVirtual rtran_path.simps <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">smt</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> grant_from_pre_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Virtual <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span>
get_perms <span class="free">s</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> 
    <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Virtual <span class="free">x</span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> direct_path_def a1 valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> basic111 a2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> grant_not_path_perms get_perms_def h1 FatherIsVirtual rtran_path.simps a3
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">smt</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Inv›</span></span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_grant_Inv_Current_Thread_In_Active sys_grant_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="improper">x</span> <span class="main">=</span> None"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_IsNot_Empty1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> grant_to_self_perms p2 get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_grant_valid p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span></span><span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Perms_IsNot_Empty_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span> 
     <span class="keyword1"><span class="command">using</span></span> grant_path_valid p3 p2 False <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> grant_not_path_perms h1 get_perms_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_IsNot_Empty2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_grant_Inv_Space_Perms_IsNot_Empty1 sys_grant_Inv_Space_Perms_IsNot_Empty2
    Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">thm</span></span> grant_not_path_tran
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_HasNot_Loop11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span>
              <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"False"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp</span> <span class="free">v1</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span>
    <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_to_self_direct p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span>
      <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p3 basic15 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_from_pre_rtran p1 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">thm</span></span> grant_path_valid
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_path_valid p2 p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p3 valid_page_def path_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_HasNot_Loop12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"False"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> grant_not_path_tran p1 p3 p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_HasNot_Loop1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_grant_Inv_Space_HasNot_Loop11 sys_grant_Inv_Space_HasNot_Loop12
    p1 p2 Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_HasNot_Loop2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 sys_grant_Inv_Space_HasNot_Loop1 sys_grant_Inv_Space_HasNot_Loop2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_Subset11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> 
              <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span>
       <span class="main">⊆</span> get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> <span class="free">perms</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_to_self_perms get_perms_def p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp2</span> <span class="free">v2</span> <span class="main">=</span> fst <span class="main">(</span>the<span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_to_self_direct p5 p3 True direct_path_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Space_Father_Is_Unique page_t.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p3 valid_page_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="main">=</span> get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h2 grant_from_pre_perms p2 p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 p3 h3 h4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">thm</span></span> grant_path_valid
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_path_valid p3 p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p5 valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_Subset12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∧</span> 
              <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span>
       <span class="main">⊆</span> get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
  <span class="keyword1"><span class="command">thm</span></span> grant_not_path_perms
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">using</span></span> p2 grant_not_path_perms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p2 refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_grant_pre p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p2 refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_tran p2 h3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def <span class="keyword1"><span class="command">using</span></span> grant_not_path_perms h4 h6 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h3 p1 Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 h7 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_Subset1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> 
            <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span><span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
  <span class="keyword1"><span class="command">using</span></span> assms sys_grant_Inv_Space_Perms_Subset11 sys_grant_Inv_Space_Perms_Subset12 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_Subset2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_grant_Inv_Space_Perms_Subset1 sys_grant_Inv_Space_Perms_Subset2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Valid_Has_Real11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span>
      <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_to_self_direct p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p4 valid_page_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1 p4 Inv_Space_Valid_Has_Real_def rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p4 valid_page_def refl_tran h2 basic15 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> p4 grant_from_pre_rtran p2 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 refl_tran True <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_grant_valid p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span><span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p4 valid_page_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="free">v_to</span><span class="main">)</span> <span class="main">∨</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> p4 grant_path_valid p3 p2 False <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="skolem">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_not_path_rtran h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Valid_Has_Real12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 p3 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Valid_Has_Real1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_grant_Inv_Space_Valid_Has_Real11 sys_grant_Inv_Space_Valid_Has_Real12
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Valid_Has_Real21<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"Virtual <span class="free">sp</span> <span class="free">v</span> <span class="main">=</span> Virtual <span class="free">sp_to</span> <span class="free">v_to</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span>
      <span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> grant_to_self_direct p4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_page_def True <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="bound">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p3 rtran_path.cases <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">thm</span></span> sys_grant_def
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Valid_Has_Real22<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp_from</span> <span class="free">v_from</span><span class="main">)</span> <span class="main">∧</span> <span class="free">perms</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="main">∧</span> <span class="free">sp_from</span> <span class="main">≠</span> <span class="free">sp_to</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="main">¬</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>fst <span class="main">(</span>the <span class="main">(</span>the <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp_from</span><span class="main">)</span> <span class="free">v_from</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Virtual <span class="free">sp_to</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="free">sp_to</span> <span class="main">≠</span> Sigma0Space <span class="main">∧</span> <span class="free">perms</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> space_mapping <span class="free">s</span> <span class="free">sp_to</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">v_to</span> <span class="main">&lt;</span> page_maxnum<span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 p3 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Valid_Has_Real2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_grant_Inv_Space_Valid_Has_Real21 sys_grant_Inv_Space_Valid_Has_Real22
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="improper">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sys_grant_Inv_Space_Valid_Has_Real1 sys_grant_Inv_Space_Valid_Has_Real2
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
     sys_grant_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
     sys_grant_NC_Space 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> page_t.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sys_grant_def sys_grant_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Inv_Space_def assms sys_grant_Inv_Space_Spaces_In_Config
    sys_grant_Inv_Space_HasNot_Loop sys_grant_Inv_Space_Perms_IsNot_Empty
    sys_grant_Inv_Space_Perms_Subset sys_grant_Inv_Space_Valid_Has_Real
    sys_grant_Inv_Space_InitialSpaces_In_Spaces 
    sys_grant_Inv_Space_Spaces_IsNot_None sys_grant_Inv_Space_Vpage_Range
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span>
    sys_grant_NC_Thread sys_grant_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Eq_Space_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span>
    sys_grant_NC_Thread sys_grant_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def sys_grant_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sys_grant_def Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def sys_grant_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def sys_grant_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def sys_grant_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> sys_grant_Inv_Idle_NotIn_Threads 
    sys_grant_Inv_Sigma0_In_Active sys_grant_Inv_Idle_Space_Is_KernelSpace
    sys_grant_Inv_RootServer_In_Active sys_grant_Inv_IntThreads_In_Active 
    sys_grant_Inv_Threads_Space_Dom
    sys_grant_Inv_Threads_In_Config sys_grant_Inv_Active_In_Threads 
    sys_grant_Inv_NThreads_Is_None sys_grant_Inv_Threads_IsNot_None 
    sys_grant_Inv_Threads_Space_In_Spaces sys_grant_Inv_Threads_Eq_Space_Threads
    sys_grant_Inv_Threads_Sche_In_Threads 
    sys_grant_Inv_NActive_Utcb_Is_None sys_grant_Inv_Active_Utcb_IsNot_None
    sys_grant_Inv_IntThreads_Utcb_Is_None sys_grant_Inv_Threads_Partner_In_Threads
    sys_grant_Inv_Threads_Incoming_In_Threads sys_grant_Inv_Sigma0_Space
    sys_grant_Inv_RootServer_Space sys_grant_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_grant_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>sys_grant <span class="free">s</span> <span class="free">sp_from</span> <span class="free">v_from</span> <span class="free">sp_to</span> <span class="free">v_to</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Invariants_def sys_grant_Inv_Current sys_grant_Inv_Space 
    sys_grant_Inv_Thread assms
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Grant_fpage_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_grant_Invariant
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Unmap_fpage›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="main">∧</span>
 dom <span class="main">(</span>space_mapping <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>space_mapping <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_unmap_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_Space1<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>space_mapping <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None<span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_unmap_NC_Space1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_Space2<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="free">sp1</span> <span class="main">∈</span> spaces <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">sp1</span> <span class="main">∈</span> spaces <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_unmap_NC_Space2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space_mapping›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_path_space1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> 
<span class="main">⟹</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> <span class="free">perms</span> <span class="main">⟹</span>
the <span class="main">(</span>space_mapping <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="main">1</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> unmap_path_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_unmap_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹memory›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_unmap_pre
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_direct_eq tran_path.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_valid_vpage<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_direct_eq valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> ValidVpageHasSon<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Inv›</span></span></span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_unmap_Inv_Space_HasNot_Loop
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_unmap_Inv_Space_Perms_IsNot_Empty
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">Inv_Space_Three</span> <span class="free"><span class="bound">s</span></span> <span class="main">≡</span> Inv_Space_Perms_Subset <span class="free"><span class="bound">s</span></span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free"><span class="bound">s</span></span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free"><span class="bound">s</span></span>"</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_Inv_Space_Three<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Three <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Three <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Three_def
  <span class="keyword1"><span class="command">using</span></span> sys_unmap_Inv_Space_Valid_Has_Real sys_unmap_Inv_Space_HasNot_Loop sys_unmap_Inv_Space_Perms_Subset
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_Inv_Space_Three<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Three <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Three <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> sys_unmap_Inv_Space_Three
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Unmap_fpage_Inv_Space_Three Inv_Space_Three_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Unmap_fpage_Inv_Space_Three Inv_Space_Three_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_unmap_Inv_Space
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_Invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Invariants <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sys_unmap_Invariant
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Flush_fpage›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Flush_fpage_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_flush_NC_User<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Flush_fpage_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_flush_NC_Current<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Flush_fpage_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_flush_NC_Thread<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Flush_fpage_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_flush_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Flush_fpage_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_flush_NC_IPC<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Flush_fpage_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>Flush_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_flush_NC_Scheduling<span class="main">)</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Map_fpage›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Map_fpage_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_map_NC_User<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Map_fpage_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_map_NC_Current<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Map_fpage_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_map_NC_Thread<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Map_fpage_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span>  <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_map_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Map_fpage_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_map_NC_IPC<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Map_fpage_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>Map_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_map_NC_Scheduling<span class="main">)</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Grant_fpage›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Grant_fpage_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_grant_NC_User<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Grant_fpage_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_grant_NC_Current<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Grant_fpage_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_grant_NC_Thread<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Grant_fpage_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 initialised_spaces <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span>  <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_grant_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Grant_fpage_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_grant_NC_IPC<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> Grant_fpage_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>Grant_fpage <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="free">perms</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">sp1</span></span></span> <span class="quoted"><span class="language"><span class="free">v1</span></span></span> <span class="quoted"><span class="language"><span class="free">sp2</span></span></span> <span class="quoted"><span class="language"><span class="free">v2</span></span></span> <span class="quoted"><span class="language"><span class="free">perms</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sys_grant_NC_Scheduling<span class="main">)</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹CreateAddressSpace›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_C_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> <span class="main">(</span>Address_Space SysConf<span class="main">)</span> <span class="main">∧</span> <span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span> <span class="main">⟶</span>
   <span class="main">(</span>spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∪</span> <span class="main">{</span><span class="free">sp</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span>initialised_spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span>space_threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp</span> <span class="main">=</span> Some <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span>space_mapping <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp</span> <span class="main">=</span> Some <span class="main">(</span><span class="main">λ</span><span class="bound">vp</span><span class="main">.</span> None<span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">sp</span> <span class="main">∈</span> <span class="main">(</span>Address_Space SysConf<span class="main">)</span> <span class="main">∧</span> <span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span><span class="main">)</span> <span class="main">⟶</span>
 <span class="main">(</span>spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>initialised_spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>space_threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>space_mapping <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_mapping <span class="free">s</span> <span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_Space_Other<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp1</span> <span class="main">≠</span> <span class="free">sp</span> <span class="main">⟶</span>
 <span class="main">(</span>space_threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>space_mapping <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">=</span> space_mapping <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>CreateAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹memory›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_space<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None <span class="main">⟹</span> 
space_mapping <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">=</span> space_mapping <span class="free">s</span> <span class="free">sp1</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def direct_path_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> Address_Space SysConf <span class="main">∧</span> <span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">spa</span> <span class="main">=</span> <span class="free">sp</span>"</span></span></span><span class="main">)</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def direct_path_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> Address_Space SysConf <span class="main">∧</span> <span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">using</span></span> Inv_Space_Valid_In_Spaces_lemma ValidVpageMappingNotNone <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">" <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">thm</span></span> one_path.hyps
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> tran_path.intros<span class="main">)</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tran_path.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_direct_eq h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h3 tran_path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_direct_eq tran_path.intros CreateAddressSpace_tran1
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"
<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_direct_eq valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"
   <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_valid_vpage CreateAddressSpace_valid_rpage FatherIsVirtual ValidExSon
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_NC_Memory_Cond<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">sp</span> <span class="main">∈</span> <span class="main">(</span>Address_Space SysConf<span class="main">)</span> <span class="main">∧</span> <span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span><span class="main">)</span> <span class="main">⟹</span> 
 <span class="free">pt_walk</span> <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> <span class="free">pt_walk</span> <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹InitialiseAddressSpace›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_C_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">⟶</span>
  <span class="main">(</span>spaces <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>initialised_spaces <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">∪</span> <span class="main">{</span><span class="free">sp</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>space_threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>space_mapping <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_mapping <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_C_Space_Cond<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span> <span class="main">⟶</span>
  initialised_spaces <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">" spaces <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∧</span>
 space_threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="main">∧</span>
 space_mapping <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_mapping <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span>  thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹memory›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def direct_path_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> direct_path_def InitialiseAddressSpace_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_tran1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> one_path.hyps
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> tran_path.intros<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tran_path.hyps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_direct_eq h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h3 tran_path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_direct_eq tran_path.intros InitialiseAddressSpace_tran1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">=</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_direct_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_valid_vpage InitialiseAddressSpace_valid_rpage
    FatherIsVirtual ValidExSon
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹DeleteAddressSpace›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹user›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_User<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_pager <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_pager <span class="free">s</span> <span class="main">∧</span>
 thread_handler <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_handler <span class="free">s</span> <span class="main">∧</span>
 thread_message <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_message <span class="free">s</span> <span class="main">∧</span>
 thread_rcvWindow <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_rcvWindow <span class="free">s</span> <span class="main">∧</span>
 thread_error <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_error <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_def Let_def Unmap_fpage_NC_User<span class="main">)</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Current<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_thread <span class="free">s</span> <span class="main">∧</span>
 current_time <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_time <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_def Let_def Unmap_fpage_NC_Current<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Thread<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> threads <span class="free">s</span> <span class="main">∧</span>
 active_threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> active_threads <span class="free">s</span> <span class="main">∧</span>
 thread_space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_space <span class="free">s</span> <span class="main">∧</span>
 thread_scheduler <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_scheduler <span class="free">s</span> <span class="main">∧</span>
 thread_state <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_state <span class="free">s</span> <span class="main">∧</span>
 thread_priority <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_priority <span class="free">s</span> <span class="main">∧</span>
 thread_total_quantum <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_total_quantum <span class="free">s</span> <span class="main">∧</span>
 thread_timeslice_length <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_timeslice_length <span class="free">s</span> <span class="main">∧</span>
 thread_current_timeslice <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_def Let_def Unmap_fpage_NC_Thread<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_C_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span> <span class="main">⟹</span>
  <span class="main">(</span>spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">-</span> <span class="main">{</span><span class="free">sp</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>initialised_spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span> <span class="main">-</span> <span class="main">{</span><span class="free">sp</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>space_threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>space_mapping <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp</span> <span class="main">=</span> None<span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def 
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Space<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span><span class="main">)</span> <span class="main">⟶</span>
 <span class="main">(</span>spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>initialised_spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> initialised_spaces <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>space_threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_threads <span class="free">s</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span>space_mapping <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> space_mapping <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_def<span class="main">)</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Space_Other<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="free">sp1</span> <span class="main">⟹</span> 
  <span class="main">(</span>space_threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">=</span> space_threads <span class="free">s</span> <span class="free">sp1</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_def Let_def Unmap_fpage_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Space_Other1<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="free">sp1</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span>space_mapping <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="main">≠</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>space_mapping <span class="free">s</span> <span class="free">sp1</span> <span class="main">≠</span> None<span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Space1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Space_Other2<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="free">sp1</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">sp1</span> <span class="main">∈</span> spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">sp1</span> <span class="main">∈</span> spaces <span class="free">s</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>spaces_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Space1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹IPC›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_IPC<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"thread_ipc_partner <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_ipc_partner <span class="free">s</span> <span class="main">∧</span>
 thread_ipc_timeout <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_ipc_timeout <span class="free">s</span> <span class="main">∧</span>
 thread_incoming <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> thread_incoming <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_def Let_def Unmap_fpage_NC_IPC<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹scheduling›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_NC_Scheduling<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"wait_queuing <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> wait_queuing <span class="free">s</span> <span class="main">∧</span>
 ready_queuing <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> ready_queuing <span class="free">s</span> <span class="main">∧</span>
 current_timeslice <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> current_timeslice <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DeleteAddressSpace_def Let_def Unmap_fpage_NC_Scheduling<span class="main">)</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹memory›</span></span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">DeleteAddressSpace_auxi</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">sp</span></span> <span class="main">=</span> 
   <span class="free"><span class="bound">s</span></span><span class="main">⦇</span> initialised_spaces<span class="main">:=</span> initialised_spaces <span class="free"><span class="bound">s</span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound">sp</span></span><span class="main">}</span><span class="main">,</span>
      space_threads<span class="main">:=</span> <span class="main">(</span>space_threads <span class="free"><span class="bound">s</span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound">sp</span></span><span class="main">:=</span> None<span class="main">)</span><span class="main">,</span>
      space_mapping<span class="main">:=</span> <span class="main">(</span>space_mapping <span class="free"><span class="bound">s</span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound">sp</span></span><span class="main">:=</span> None<span class="main">)</span><span class="main">⦈</span>"</span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">DeleteAddressSpace1</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">sp</span></span> <span class="main">=</span> 
<span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound">sp</span></span> <span class="main">∈</span> spaces <span class="free"><span class="bound">s</span></span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free"><span class="bound">sp</span></span> 
  <span class="keyword1">then</span> DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">sp</span></span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free"><span class="bound">sp</span></span>
  <span class="keyword1">else</span> <span class="free"><span class="bound">s</span></span>
<span class="main">)</span>"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span> <span class="main">=</span> DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace1_def DeleteAddressSpace_def DeleteAddressSpace_auxi_def
    Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_auxi_def direct_path_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">spa</span> <span class="main">=</span> <span class="free">sp</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_pre<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"sp_name <span class="free">x</span> <span class="main">≠</span> <span class="free">sp</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> 
<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_auxi_def direct_path_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_pre3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="bound">z</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">z</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟶</span> sp_name <span class="bound">z</span> <span class="main">≠</span> <span class="free">sp</span> <span class="main">⟹</span> 
<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"sp_name <span class="skolem">x</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> refl_path tran_path.one_path<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> one_path DeleteAddressSpace_auxi_pre tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"sp_name <span class="skolem">x</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rtran_tran tran_path.tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tran_path DeleteAddressSpace_auxi_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">from</span></span> tran_path <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">za</span><span class="main">.</span> <span class="free">s</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="bound">za</span> <span class="main">∧</span> <span class="free">s</span><span class="main">⊢</span><span class="bound">za</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span> <span class="main">⟶</span> sp_name <span class="bound">za</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> refl_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 tran_path.intros <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_pre1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> sp_name <span class="free">x</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_auxi_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_pre2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sp1</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def DeleteAddressSpace_auxi_def direct_path_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_direct_eq tran_path.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_valid_vpage<span class="main">:</span>
<span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_direct_eq valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> ValidVpageHasSon<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_valid_vpage <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_valid_rpage <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_perms<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp1</span> <span class="main">≠</span> <span class="free">sp</span> <span class="main">⟹</span>
get_perms <span class="main">(</span><span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_auxi_def get_perms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="comment1">(*DeleteAddressSpace1*)</span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace1_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace1_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_direct_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_direct_eq<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_eq DeleteAddressSpace1_direct_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> tran_path.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_direct_eq tran_path.intros
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_rtran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_tran rtran_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_valid_vpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v_page</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_direct_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_valid_rpage<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Real <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_page_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_valid_vpage DeleteAddressSpace_valid_rpage
    FatherIsVirtual ValidExSon
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="comment1">(*11*)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre></body>