<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/26bc0faa-7540-4229-b677-c1c2fe8f0f45/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.theories { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }
</style><title>Theory "L4_Inv_Space"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> L4_Inv_Space
  <span class="keyword2"><span class="keyword">imports</span></span> L4_Inv_s0
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹CreateAddressSpace›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_Current_Thread_In_Active CreateAddressSpace_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> CreateAddressSpace_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CreateAddressSpace_rtran CreateAddressSpace_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateAddressSpace_valid<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_NC_Space_Other CreateAddressSpace_C_Space
    CreateAddressSpace_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Inv_Space_Valid_In_Spaces_lemma<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">sp1</span> <span class="skolem">sp2</span> <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp1</span> <span class="skolem">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_direct_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> YIsValid p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="skolem">sp1</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h1 direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="skolem">sp1</span> <span class="main">=</span> space_mapping <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">sp1</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="skolem">sp2</span> <span class="main">≠</span> None"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 valid_page_def direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"space_mapping <span class="free">s</span> <span class="skolem">sp2</span> <span class="main">=</span> space_mapping <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">sp2</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Perms_Subset_def h1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⊆</span>
        get_perms <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h4 h6 get_perms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">x</span> <span class="main">∈</span> get_perms <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">sp1</span> <span class="skolem">v1</span> <span class="main">⟹</span>
       <span class="skolem">x</span> <span class="main">∈</span> get_perms <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
    CreateAddressSpace_NC_Space_Other CreateAddressSpace_NC_Space CreateAddressSpace_C_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Diff_eq_empty_iff Un_empty_right Un_insert_right insert_Diff_if<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
    CreateAddressSpace_NC_Space_Other CreateAddressSpace_NC_Space CreateAddressSpace_C_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_assoc subset_Un_eq<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> <span class="main">(</span>Address_Space SysConf<span class="main">)</span> <span class="main">∧</span> <span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"dom <span class="main">(</span>space_threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>space_threads <span class="free">s</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">sp</span><span class="main">}</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True CreateAddressSpace_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> spaces <span class="free">s</span> <span class="main">∪</span> <span class="main">{</span><span class="free">sp</span><span class="main">}</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True CreateAddressSpace_C_Space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def
    <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span> h1
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_NC_Space Inv_Space_Spaces_IsNot_None_def
      p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CreateAddressSpace_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_Inv_Space_HasNot_Loop CreateAddressSpace_Inv_Space_Valid_Has_Real
   CreateAddressSpace_Inv_Space_Perms_IsNot_Empty CreateAddressSpace_Inv_Space_Perms_Subset
   CreateAddressSpace_Inv_Space_Spaces_In_Config CreateAddressSpace_Inv_Space_InitialSpaces_In_Spaces 
   CreateAddressSpace_Inv_Space_Spaces_IsNot_None CreateAddressSpace_Inv_Space_Vpage_Range 
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> CreateAddressSpace_NC_Thread<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">t</span> <span class="main">∈</span> threads <span class="free">s</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">space</span><span class="main">.</span> <span class="bound">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> thread_space <span class="free">s</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="bound">space</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">space</span></span> <span class="keyword2"><span class="keyword">where</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> thread_space <span class="free">s</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="skolem">space</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">space</span><span class="main">.</span>
            <span class="bound">space</span> <span class="main">∈</span> spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">∧</span>
            thread_space <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> Some <span class="bound">space</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> <span class="main">(</span>Address_Space SysConf<span class="main">)</span> <span class="main">∧</span> <span class="free">sp</span> <span class="main">∉</span> spaces <span class="free">s</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">space</span> <span class="main">∈</span> spaces <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_C_Space h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_NC_Thread h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> CreateAddressSpace_NC_Thread CreateAddressSpace_NC_Space h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∉</span> kIntThreads"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def CreateAddressSpace_def SetThreadError_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> p0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CreateAddressSpace_def Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def CreateAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def CreateAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def CreateAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CreateAddressSpace_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∉</span> kIntThreads"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>CreateAddressSpace SysConf <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> CreateAddressSpace_Inv_Idle_NotIn_Threads 
    CreateAddressSpace_Inv_Sigma0_In_Active CreateAddressSpace_Inv_Idle_Space_Is_KernelSpace
    CreateAddressSpace_Inv_RootServer_In_Active CreateAddressSpace_Inv_IntThreads_In_Active 
    CreateAddressSpace_Inv_Threads_In_Config CreateAddressSpace_Inv_Active_In_Threads 
    CreateAddressSpace_Inv_NThreads_Is_None CreateAddressSpace_Inv_Threads_IsNot_None 
    CreateAddressSpace_Inv_Threads_Space_In_Spaces
    CreateAddressSpace_Inv_Threads_Sche_In_Threads 
    CreateAddressSpace_Inv_NActive_Utcb_Is_None CreateAddressSpace_Inv_Active_Utcb_IsNot_None
    CreateAddressSpace_Inv_IntThreads_Utcb_Is_None CreateAddressSpace_Inv_Threads_Partner_In_Threads
    CreateAddressSpace_Inv_Threads_Incoming_In_Threads CreateAddressSpace_Inv_Sigma0_Space
    CreateAddressSpace_Inv_RootServer_Space CreateAddressSpace_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹InitialiseAddressSpace›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_Inv_Current_Thread_In_Active InitialiseAddressSpace_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_HasNot_Loop_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">subst</span> InitialiseAddressSpace_tran<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Valid_Has_Real_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> InitialiseAddressSpace_rtran InitialiseAddressSpace_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_IsNot_Empty_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> InitialiseAddressSpace_valid<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_C_Space InitialiseAddressSpace_NC_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def get_perms_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Perms_Subset_def get_perms_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> InitialiseAddressSpace_direct_eq InitialiseAddressSpace_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
     InitialiseAddressSpace_NC_Space InitialiseAddressSpace_C_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>InitialiseAddressSpace_def spaces_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_IsNot_None_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_IsNot_None_def</span><span class="main">]</span>
    InitialiseAddressSpace_NC_Space InitialiseAddressSpace_C_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> InitialiseAddressSpace_valid<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_Inv_Space_HasNot_Loop InitialiseAddressSpace_Inv_Space_Valid_Has_Real
   InitialiseAddressSpace_Inv_Space_Perms_IsNot_Empty InitialiseAddressSpace_Inv_Space_Spaces_In_Config 
   InitialiseAddressSpace_Inv_Space_InitialSpaces_In_Spaces InitialiseAddressSpace_Inv_Space_Perms_Subset
   InitialiseAddressSpace_Inv_Space_Spaces_IsNot_None InitialiseAddressSpace_Inv_Space_Vpage_Range
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Idle_NotIn_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_Space_Is_KernelSpace_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Sigma0_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_RootServer_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_IntThreads_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Threads_Space_Dom_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Threads_In_Config_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Active_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_NThreads_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Threads_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_Space_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_In_Spaces <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Space_In_Spaces_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> InitialiseAddressSpace_NC_Thread<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_In_Spaces_def</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_Eq_Space_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Eq_Space_Threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Threads_Eq_Space_Threads_def spaces_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Eq_Space_Threads_def</span><span class="main">]</span> spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Threads_Sche_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_NActive_Utcb_Is_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Active_Utcb_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∉</span> kIntThreads"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def InitialiseAddressSpace_def SetThreadError_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> p0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> InitialiseAddressSpace_def Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def InitialiseAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def InitialiseAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def InitialiseAddressSpace_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv_Thread<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"current_thread <span class="free">s</span> <span class="main">∉</span> kIntThreads"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Thread <span class="main">(</span>InitialiseAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Thread_def
  <span class="keyword1"><span class="command">using</span></span> p0 p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Thread_def</span><span class="main">]</span> InitialiseAddressSpace_Inv_Idle_NotIn_Threads 
    InitialiseAddressSpace_Inv_Sigma0_In_Active InitialiseAddressSpace_Inv_Idle_Space_Is_KernelSpace
    InitialiseAddressSpace_Inv_RootServer_In_Active InitialiseAddressSpace_Inv_IntThreads_In_Active
    InitialiseAddressSpace_Inv_Threads_Space_Dom
    InitialiseAddressSpace_Inv_Threads_In_Config InitialiseAddressSpace_Inv_Active_In_Threads 
    InitialiseAddressSpace_Inv_NThreads_Is_None InitialiseAddressSpace_Inv_Threads_IsNot_None 
    InitialiseAddressSpace_Inv_Threads_Space_In_Spaces InitialiseAddressSpace_Inv_Threads_Eq_Space_Threads
    InitialiseAddressSpace_Inv_Threads_Sche_In_Threads 
    InitialiseAddressSpace_Inv_NActive_Utcb_Is_None InitialiseAddressSpace_Inv_Active_Utcb_IsNot_None
    InitialiseAddressSpace_Inv_IntThreads_Utcb_Is_None InitialiseAddressSpace_Inv_Threads_Partner_In_Threads
    InitialiseAddressSpace_Inv_Threads_Incoming_In_Threads InitialiseAddressSpace_Inv_Sigma0_Space
    InitialiseAddressSpace_Inv_RootServer_Space InitialiseAddressSpace_Inv_IntThreads_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> InitialiseAddressSpace_Inv<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">error</span><span class="main">.</span> current_thread <span class="bound">s</span> <span class="main">∉</span> kIntThreads <span class="main">⟶</span> Invariants <span class="bound">s</span> <span class="main">⟶</span> Invariants <span class="main">(</span>InitialiseAddressSpace <span class="bound">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Invariants_def
  <span class="keyword1"><span class="command">using</span></span> InitialiseAddressSpace_Inv_Current InitialiseAddressSpace_Inv_Space InitialiseAddressSpace_Inv_Thread  
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="document"><span class="plain_text">‹DeleteAddressSpace›</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Current›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Current_Thread_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Thread_In_Active <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def Inv_Current_Thread_In_Active_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Thread_In_Active_def</span><span class="main">]</span> Unmap_fpage_NC_Current
    Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Current_Space_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current_Space_IsNot_None <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def Inv_Current_Space_IsNot_None_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Current_Space_IsNot_None_def</span><span class="main">]</span> Unmap_fpage_NC_Current
    Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Current<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Current <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_Inv_Current_Thread_In_Active DeleteAddressSpace_Inv_Current_Space_IsNot_None
    Inv_Current_def p1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Space›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Vpage_Range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Vpage_Range_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Vpage_Range_def</span><span class="main">]</span> DeleteAddressSpace_valid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_HasNot_Loop_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_tran
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_pre1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="free">x</span> <span class="main">≠</span> Real <span class="bound">r</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> SonIsNoReal basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> sys_unmap_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 h1 unmap_path_tran_valid
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> FatherIsVirtual ValidExSon subset_UNIV<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_IsNot_Empty_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">spa</span> <span class="skolem">v_page</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">spa</span> <span class="skolem">v_page</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span>
     a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">spa</span> <span class="skolem">v_page</span> <span class="main">=</span> <span class="main">{}</span>"</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="skolem">spa</span> <span class="skolem">v_page</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_valid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="skolem">spa</span> <span class="skolem">v_page</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Perms_IsNot_Empty_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="skolem">spa</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 DeleteAddressSpace_auxi_pre2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="skolem">spa</span> <span class="skolem">v_page</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h2
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def DeleteAddressSpace_auxi_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_auxi_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="free">sp2</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">from</span></span> p2 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">from</span></span> p2 <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="free">sp1</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_pre1 page_t.sel<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def DeleteAddressSpace_auxi_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="main">=</span> get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_perms_def DeleteAddressSpace_auxi_def <span class="keyword1"><span class="command">using</span></span> p3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 h4 h5 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_HasNot_Loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">thm</span></span> DeleteAddressSpace_def<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Let_def</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">from</span></span> p1 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_Inv_Space_HasNot_Loop <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_Inv_Space_HasNot_Loop <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def 
    <span class="keyword1"><span class="command">using</span></span> p1 h2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> DeleteAddressSpace_auxi_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Perms_IsNot_Empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">from</span></span> p1 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_Inv_Space_Perms_IsNot_Empty <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_IsNot_Empty <span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_Inv_Space_Perms_IsNot_Empty <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def 
    <span class="keyword1"><span class="command">using</span></span> p1 h2<span class="main">[</span><span class="language"><span class="operator">unfolded</span> DeleteAddressSpace_auxi_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_univ<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> 
  the <span class="main">(</span>space_mapping <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> None"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> one_path unmap_path_space <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_not_influence_next<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"
  <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span>Suc <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span>Suc <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span>Suc <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span>Suc <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Inv_Space_Father_Is_Unique_def Space_Father_Is_Unique a1 n_not_Suc_n p1 tran_one_unique unmap_not_path_direct<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span>Suc <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span>Suc <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 sys_unmap_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sys_unmap_not_influence_any<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">v</span> <span class="main">≠</span> <span class="free">v2</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"
  <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Inv_Space_HasNot_Loop_def a1 basic15 p1 p2 page_t.inject<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rtran_tran unmap_not_path_direct<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 sys_unmap_pre <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_sep<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">" Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Unmap_fpage <span class="main">(</span>sys_unmap <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV<span class="main">)</span> <span class="free">sp</span> <span class="main">(</span>Suc <span class="free">v</span><span class="main">)</span> UNIV <span class="free">n</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_not_influence_other<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span><span class="free">v</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span>
<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV <span class="free">n</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span><span class="free">v</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="language"><span class="free">s</span></span></span> <span class="quoted"><span class="language"><span class="free">v</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="skolem">s</span> <span class="free">sp</span> <span class="main">(</span>Suc <span class="skolem">v</span><span class="main">)</span> UNIV <span class="skolem">n</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">v</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> add_Suc_shift<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Suc.IH Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Unmap_fpage_sep add_Suc_shift add_cancel_left_right nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> sys_unmap_Inv_Space_HasNot_Loop sys_unmap_not_influence_any<span class="main">)</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_univ<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v2</span> <span class="main">≥</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">v2</span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">+</span> <span class="free">n</span> <span class="main">⟹</span>
  the <span class="main">(</span>space_mapping <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV <span class="free">n</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> None"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">n</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">v2</span> <span class="main">=</span> <span class="free">v</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc sys_unmap_univ Unmap_fpage_not_influence_other <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_mapping <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV <span class="skolem">n</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> None"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> ValidVpageMappingNotNone path_space1 sys_unmap_valid unmap_not_path_space<span class="main">)</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_pre1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="free">x</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="free">y</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> FatherEqValid Space_Father_Is_Unique Unmap_fpage_direct_eq<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_univ_valid<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">v2</span> <span class="main">≥</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">v2</span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">+</span> <span class="free">n</span> <span class="main">⟹</span>
  <span class="main">¬</span><span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="free">v</span> UNIV <span class="free">n</span><span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_univ ValidVpageMappingNotNone
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_univ_valid1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Vpage_Range <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">⟹</span> 
  Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_univ_valid YIsValid
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> Inv_Space_Vpage_Range_def trans_less_add2<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Unmap_fpage_univ_valid_tran<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>Virtual <span class="free">sp</span> <span class="free">v2</span><span class="main">)</span> <span class="main">⟹</span> Inv_Space_Vpage_Range <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">⟹</span> 
  Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">⟹</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>tran_path.induct<span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>one_path <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_univ_valid1 FatherIsVirtual <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>tran_path <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?case</span></span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">x</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="skolem">y</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_pre1 tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">y</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> YIsValid tran_path Unmap_fpage_Inv_Space_Valid_Has_Real <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> tran_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Perms_Subset11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span> <span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span><span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> get_perms <span class="main">(</span><span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
  <span class="keyword1"><span class="command">thm</span></span> DeleteAddressSpace_auxi_pre1
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="operator">-</span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p3 p2 DeleteAddressSpace1_def
     DeleteAddressSpace_auxi_direct_eq Unmap_fpage_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="free">s</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span> get_perms <span class="free">s</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp1</span> <span class="main">≠</span> <span class="free">sp2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_HasNot_Loop_def one_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">from</span></span> p3 <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="main">(</span>Virtual <span class="free">sp1</span> <span class="free">v1</span><span class="main">)</span><span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span><span class="main">(</span>Virtual <span class="free">sp2</span> <span class="free">v2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace1_def <span class="keyword1"><span class="command">using</span></span> p2 DeleteAddressSpace_auxi_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">⊆</span>
                 get_perms <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_Inv_Space_Perms_Subset p1 h1 Inv_Space_Perms_Subset_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="free">sp1</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_pre1 p2 p3 DeleteAddressSpace1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h31<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span> <span class="main">=</span> 
                 get_perms <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp1</span> <span class="free">v1</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_perms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">≠</span> <span class="free">sp2</span>"</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">thm</span></span> p3<span class="main">[</span><span class="language"><span class="operator">unfolded</span> direct_path_def</span><span class="main">]</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">=</span> <span class="free">sp2</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_mapping <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> None"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_univ Inv_Space_Vpage_Range_def h1 valid_page_def p1
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> YIsValid plus_nat.add_0 zero_le<span class="main">)</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"the <span class="main">(</span>space_mapping <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp1</span><span class="main">)</span> <span class="free">v1</span> <span class="main">=</span> None"</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace1_def DeleteAddressSpace_auxi_def <span class="keyword1"><span class="command">using</span></span> p2 h3
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span> <span class="keyword1"><span class="command">using</span></span> p3 direct_path_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h41<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"get_perms <span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span> <span class="main">=</span> 
                 get_perms <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp2</span> <span class="free">v2</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_perms <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace1_def
    <span class="keyword1"><span class="command">using</span></span> p2 h21 h31 h41 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Perms_Subset1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Perms_Subset_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 DeleteAddressSpace_Inv_Space_Perms_Subset11
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Perms_Subset2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Perms_Subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Perms_Subset <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 DeleteAddressSpace_Inv_Space_Perms_Subset1 DeleteAddressSpace_Inv_Space_Perms_Subset2
    DeleteAddressSpace_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Valid_Has_Real11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span> <span class="main">∧</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Virtual <span class="skolem">x11</span> <span class="skolem">x12</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p3 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_valid DeleteAddressSpace_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> Virtual rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="keyword2"><span class="keyword">where</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="skolem">r1</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="bound">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> h111<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="skolem">y1</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">⊢</span> <span class="skolem">y1</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Real <span class="skolem">r1</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> basic15 h11 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_auxi_valid p3 p2 DeleteAddressSpace1_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_Inv_Space_Valid_Has_Real p1 Inv_Space_Valid_Has_Real_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Virtual rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> h21<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="skolem">r2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="bound">y</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> h211<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="skolem">y2</span> <span class="main">∧</span> 
    <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="skolem">y2</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Real <span class="skolem">r2</span><span class="main">)</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> basic15 h21 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">y1</span> <span class="main">=</span> <span class="skolem">y2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h111 h211 Space_Father_Is_Unique Unmap_fpage_direct_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">r2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> h11 h21 Unmap_fpage_tran
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> Real_HasNo_Father_tran basic16 page_t.inject<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rtran_tran<span class="main">)</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="skolem">y2</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">z</span> <span class="main">⟹</span> 
      <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="main">⊢</span> <span class="bound">z</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="skolem">r2</span><span class="main">)</span> <span class="main">⟹</span> sp_name <span class="bound">z</span> <span class="main">≠</span> <span class="free">sp</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">y2</span><span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
       a2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">z</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r2</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> 
       a3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"sp_name <span class="skolem">z</span> <span class="main">=</span> <span class="free">sp</span>"</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">y2</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span> <span class="main">∨</span> <span class="skolem">y2</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="language">False</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">y2</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h51<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">y2</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="skolem">z</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">have</span></span> h52<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">z</span> <span class="main">=</span> Virtual <span class="free">sp</span> <span class="bound">v</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> a3 a2
        <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> FatherIsValid basic3 page_t.exhaust_sel<span class="main">)</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h53<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">y2</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> p1 h51 Unmap_fpage_univ_valid_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">have</span></span> h54<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="skolem">y2</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a11 FatherEqValid PlusEqOneStar <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h53 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">y2</span><span class="main">=</span><span class="skolem">z</span>"</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> h121<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">sp2</span> <span class="bound">v2</span><span class="main">.</span> <span class="skolem">y2</span> <span class="main">=</span> Virtual <span class="bound">sp2</span> <span class="bound">v2</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> FatherIsVirtual a12 a2 basic3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sp2</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> h1211<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">y2</span> <span class="main">=</span> Virtual <span class="skolem">sp2</span> <span class="skolem">v2</span>"</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
      <span class="keyword1"><span class="command">have</span></span> h122<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">s</span><span class="main">⊢</span><span class="skolem">y2</span>"</span></span></span> <span class="keyword1"><span class="command">using</span></span> YIsValid h111 h3 p1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h1221<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">v2</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">v2</span> <span class="main">&lt;</span> page_maxnum"</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Vpage_Range_def h1211 h122 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_univ p1 h111 h3 h1211 h1221 Virtual 
          valid_page_def direct_path_def a12 a3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">thm</span></span> DeleteAddressSpace_auxi_pre3
  <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>1</sup></span> <span class="skolem">y2</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span>  Space_Father_Is_Unique h211 p2 p3 valid_page_def DeleteAddressSpace1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeleteAddressSpace_auxi_pre DeleteAddressSpace_auxi_pre2 Virtual<span class="main">)</span></span>
  <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="skolem">y2</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Real <span class="skolem">r2</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="skolem">y2</span></span></span><span class="main">)</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Virtual <span class="skolem">x11</span> <span class="skolem">x12</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="skolem">y2</span><span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span>Real <span class="skolem">r2</span><span class="main">)</span>"</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> h5 DeleteAddressSpace_auxi_pre3 h211 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Virtual
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtran_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Real <span class="skolem">x2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_path Real_HasNo_Father_tran h211 rtran_tran <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace_auxi <span class="main">(</span>Unmap_fpage <span class="free">s</span> <span class="free">sp</span> <span class="main">0</span> UNIV page_maxnum<span class="main">)</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="skolem">r2</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> h6 h7 basic111 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace1_def p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Virtual
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtran_tran<span class="main">)</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Real <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> refl_path <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">qed</span></span>            

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Valid_Has_Real12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p3<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span><span class="main">⊢</span><span class="free">x</span>"</span></span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="language"><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="language"><span class="free">x</span></span></span><span class="main">)</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Virtual <span class="skolem">x11</span> <span class="skolem">x12</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p3 <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span> <span class="main">⊢</span> <span class="free">x</span> <span class="main">↝<span class="hidden">⇧</span><sup>+</sup></span> <span class="main">(</span>Real <span class="bound">r</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Virtual rtran_tran<span class="main">)</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> basic3 valid_page_def FatherEqValid <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Real <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_page_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Valid_Has_Real1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>  <span class="main">∧</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>DeleteAddressSpace1 <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 p2 DeleteAddressSpace_Inv_Space_Valid_Has_Real11
  DeleteAddressSpace_Inv_Space_Valid_Has_Real12 Inv_Space_Valid_Has_Real_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Valid_Has_Real2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>"</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span><span class="main">(</span><span class="free">sp</span> <span class="main">∈</span> spaces <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> dIsPrivilegedSpace <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def
  <span class="keyword1"><span class="command">using</span></span> p1 p2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Valid_Has_Real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="free">s</span>  <span class="main">∧</span> Inv_Space_Perms_Subset <span class="free">s</span> <span class="main">∧</span> Inv_Space_HasNot_Loop <span class="free">s</span> <span class="main">∧</span> Inv_Space_Vpage_Range <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Valid_Has_Real <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 DeleteAddressSpace_Inv_Space_Valid_Has_Real1 DeleteAddressSpace_Inv_Space_Valid_Has_Real2
    DeleteAddressSpace_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Spaces_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_In_Config <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_Spaces_In_Config_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_Spaces_In_Config_def</span><span class="main">]</span>
     DeleteAddressSpace_NC_Space DeleteAddressSpace_C_Space
  <span class="keyword1"><span class="command">using</span></span> DiffD1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_InitialSpaces_In_Spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_InitialSpaces_In_Spaces <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_InitialSpaces_In_Spaces_def 
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_InitialSpaces_In_Spaces_def</span><span class="main">]</span>
     DeleteAddressSpace_NC_Space DeleteAddressSpace_C_Space
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space_Spaces_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space_Spaces_IsNot_None <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> p1 Inv_Space_Spaces_IsNot_None_def
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Let_def spaces_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Unmap_fpage_NC_Space<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Space_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_Inv_Space_HasNot_Loop DeleteAddressSpace_Inv_Space_Valid_Has_Real
   DeleteAddressSpace_Inv_Space_Perms_IsNot_Empty DeleteAddressSpace_Inv_Space_Spaces_In_Config 
   DeleteAddressSpace_Inv_Space_InitialSpaces_In_Spaces DeleteAddressSpace_Inv_Space_Perms_Subset
   DeleteAddressSpace_Inv_Space_Spaces_IsNot_None DeleteAddressSpace_Inv_Space_Vpage_Range 
   p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Space_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="document"><span class="plain_text">‹Thread›</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Idle_NotIn_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_NotIn_Threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Idle_NotIn_Threads_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Idle_NotIn_Threads_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Idle_Space_Is_KernelSpace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Idle_Space_Is_KernelSpace <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Idle_Space_Is_KernelSpace_def
  <span class="keyword1"><span class="command">using</span></span> DeleteAddressSpace_NC_Thread 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Sigma0_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_In_Active <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Sigma0_In_Active_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Sigma0_In_Active_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_RootServer_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_In_Active <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_RootServer_In_Active_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_RootServer_In_Active_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_IntThreads_In_Active<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_In_Active <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_IntThreads_In_Active_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_In_Active_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Threads_Space_Dom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Space_Dom <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Threads_Space_Dom_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Space_Dom_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Threads_In_Config<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_In_Config <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Threads_In_Config_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_In_Config_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Active_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_In_Threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Active_In_Threads_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_In_Threads_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_NThreads_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NThreads_Is_None <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_NThreads_Is_None_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NThreads_Is_None_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
    Unmap_fpage_NC_IPC Unmap_fpage_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Threads_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_IsNot_None <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Threads_IsNot_None_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_IsNot_None_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
    Unmap_fpage_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Threads_Sche_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Sche_In_Threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Threads_Sche_In_Threads_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Sche_In_Threads_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_NActive_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_NActive_Utcb_Is_None <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_NActive_Utcb_Is_None_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_NActive_Utcb_Is_None_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
    Unmap_fpage_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Active_Utcb_IsNot_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Active_Utcb_IsNot_None <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DeleteAddressSpace_def Inv_Active_Utcb_IsNot_None_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Active_Utcb_IsNot_None_def</span><span class="main">]</span> Unmap_fpage_NC_Thread
    Unmap_fpage_NC_User
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_IntThreads_Utcb_Is_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="free">s</span>"</span></span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Utcb_Is_None <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Utcb_Is_None_def DeleteAddressSpace_def Let_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_IntThreads_Utcb_Is_None_def</span><span class="main">]</span> Unmap_fpage_NC_User
    Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Threads_Partner_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Partner_In_Threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Partner_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Partner_In_Threads_def</span><span class="main">]</span> 
    DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Threads_Incoming_In_Threads<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Threads_Incoming_In_Threads <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Inv_Threads_Incoming_In_Threads_def
  <span class="keyword1"><span class="command">using</span></span> p1<span class="main">[</span><span class="language"><span class="operator">unfolded</span> Inv_Threads_Incoming_In_Threads_def</span><span class="main">]</span> 
    DeleteAddressSpace_NC_Thread DeleteAddressSpace_NC_IPC
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_Sigma0_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_Sigma0_Space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_Sigma0_Space_def DeleteAddressSpace_def Let_def
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_RootServer_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_RootServer_Space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_RootServer_Space_def DeleteAddressSpace_def Let_def
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DeleteAddressSpace_Inv_IntThreads_Space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="free">s</span>"</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted"><span class="language">"Inv_IntThreads_Space <span class="main">(</span>DeleteAddressSpace <span class="free">s</span> <span class="free">sp</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Inv_IntThreads_Space_def DeleteAddressSpace_def Let_def
  <span class="keyword1"><span class="command">using</span></span> Unmap_fpage_NC_Thread
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre></body>