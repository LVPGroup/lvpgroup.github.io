<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory picore_CSimpl (Isabelle2019: June 2019)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory picore_CSimpl</h1>

<span class="command">theory</span> <span class="name">picore_CSimpl</span><br/>
<span class="keyword">imports</span> <a href="LocalRG_HoareDef.html"><span class="name">LocalRG_HoareDef</span></a> <a href="PiCore_RG_Invariant.html"><span class="name">PiCore_RG_Invariant</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
Created by Yongwang Zhao (zhaoyw@buaa.edu.cn)
and School of Computer Science &amp; Engineering, Beihang University, China
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Integrating the CSimpl language into Picore&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>picore_CSimpl</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;CSimpl.LocalRG_HoareDef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;../picore/PiCore_RG_Invariant&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;p</span><span class="delimiter">,</span><span class="tfree">&#39;f</span><span class="delimiter">,</span><span class="tfree">&#39;e</span><span class="delimiter">)</span><span> </span><span>configI</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e)com &#215; (&#39;s,&#39;f) xstate&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;p</span><span class="delimiter">,</span><span class="tfree">&#39;f</span><span class="delimiter">,</span><span class="tfree">&#39;e</span><span class="delimiter">)</span><span> </span><span>confsI</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#39;s,&#39;p,&#39;f,&#39;e) configI) list&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;p</span><span class="delimiter">,</span><span class="tfree">&#39;f</span><span class="delimiter">,</span><span class="tfree">&#39;e</span><span class="delimiter">)</span><span> </span><span>Env</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#215; (&#39;s,&#39;p,&#39;f,&#39;e) sextuple set&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;p</span><span class="delimiter">,</span><span class="tfree">&#39;f</span><span class="delimiter">,</span><span class="tfree">&#39;e</span><span class="delimiter">)</span><span> </span><span>confs&#39;</span><span> </span><span class="delimiter">=</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env &#215;((&#39;s,&#39;p,&#39;f,&#39;e) config) list&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
locale PicoreCSimpl =
fixes Env :: &quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env&quot;
assumes proc_sat: &quot;&#8704;(c,p,R,G,q,a)&#8712; snd Env. fst Env &#8872;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;
begin
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>ptranI</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env &#8658; ((&#39;s,&#39;p,&#39;f,&#39;e) configI &#215; (&#39;s,&#39;p,&#39;f,&#39;e) configI) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ptranI &#936; &#8801; {(P,Q). fst &#936; &#8866;<span class="hidden">&#8681;</span><sub>c</sub> P &#8594; Q}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>ptranI&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env &#8658; (&#39;s,&#39;p,&#39;f,&#39;e) configI &#8658; (&#39;s,&#39;p,&#39;f,&#39;e) configI &#8658; bool&quot;</span></span></span><span>
</span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>I</sub> _ &#8594; _&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">]</span><span> </span><span>80</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#936; &#8866;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>I</sub> P &#8594; Q &#8801; (P,Q) &#8712; ptranI &#936;&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>none_no_tranI&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((Q, s),(P,t)) &#8712; ptranI &#936; &#10233; Q &#8800; Skip&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>ptranI_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>stepc.cases</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>none_no_tranI</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((Skip, s),(P,t)) &#8713; ptranI &#936;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>none_no_tranI&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ptran_neq&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((P, s),(Q,t)) &#8712; ptranI &#936; &#10233; P &#8800; Q&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>ptranI_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>stepc.cases</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>stepc.cases</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>mod_env_not_component</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_change_p_or_eq_s</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>step_change_p_or_eq_s</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ptran_neqI</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((P, s),(P,t)) &#8713; ptranI &#936;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ptran_neq&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* inductive_set cpts_p :: &quot;&#39;s imp_pconfs set&quot;
where
  CptsPOne: &quot;[(P,s)] &#8712; cpts_p&quot;
| CptsPEnv: &quot;(P, t)#xs &#8712; cpts_p &#10233; (P,s)#(P,t)#xs &#8712; cpts_p&quot;
| CptsPComp: &quot;&#10214;(P,s) -impc&#8594; (Q,t); (Q, t)#xs &#8712; cpts_p&#10215; &#10233; (P,s)#(Q,t)#xs &#8712; cpts_p&quot; *)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* inductive_set cptn :: &quot;((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot;
where
  CptnOne: &quot; (&#936;, [(P,s)]) &#8712; cptn&quot;
| CptnEnv: &quot;&#10214;&#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (P,t); (&#936;,(P, t)#xs) &#8712; cptn &#10215; &#10233;
             (&#936;,(P,s)#(P,t)#xs) &#8712; cptn&quot;
| CptnComp: &quot;&#10214;&#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>(P,s) &#8594; (Q,t); (&#936;,(Q, t)#xs) &#8712; cptn &#10215; &#10233;
              (&#936;,(P,s)#(Q,t)#xs) &#8712; cptn&quot; *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">inductive_set</span></span><span> </span><span>cptn&#39;</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#39;s,&#39;p,&#39;f,&#39;e) confs&#39;) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>CptnOne&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; (&#936;, [(P,s)]) &#8712; cptn&#39;&quot;</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>CptnEnv&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;,(P, t)#xs) &#8712; cptn&#39; &#10233; (&#936;,(P,s)#(P,t)#xs) &#8712; cptn&#39;&quot;</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>CptnComp&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>I</sub>(P,s) &#8594; (Q,t); (&#936;,(Q, t)#xs) &#8712; cptn&#39; &#10215; &#10233;
              (&#936;,(P,s)#(Q,t)#xs) &#8712; cptn&#39;&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>tl_in_cptn&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; (&#936;,a#xs) &#8712;cptn&#39;; xs&#8800;[] &#10215; &#10233; (&#936;,xs)&#8712;cptn&#39;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>elim</span><span class="delimiter">:</span><span> </span><span>cptn&#39;.cases</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ab_cptn&#39;_c_or_eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;,a#b#l) &#8712; cptn&#39; &#10233; (&#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>I</sub> a &#8594; b) &#8744; fst a = fst b&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>force</span><span> </span><span>elim</span><span class="delimiter">:</span><span> </span><span>cptn&#39;.cases</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_not_empty&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;,l) &#8712; cptn &#10233; l &#8800; []&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>force</span><span> </span><span>elim</span><span class="delimiter">:</span><span>cptn.cases</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn&#39;_not_empty&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;,l) &#8712; cptn&#39; &#10233; l &#8800; []&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>force</span><span> </span><span>elim</span><span class="delimiter">:</span><span>cptn&#39;.cases</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_in_cptn&#39;_h</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((fst &#936;, l) &#8712; cptn &#10233; (&#936;, l) &#8712; cptn&#39;) &#10233; (fst &#936;, a # l) &#8712; cptn &#10233; (&#936;, a # l) &#8712; cptn&#39;&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>cptn.cases</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a#l&quot;</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnOne&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnComp&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>ptranI&#39;_def</span><span> </span><span>ptranI_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_in_cptn&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst &#936;,l) &#8712; cptn &#10233; (&#936;,l) &#8712; cptn&#39;&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>l</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_not_empty&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_in_cptn&#39;_h</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>cpts_pI</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env &#8658; ((&#39;s,&#39;p,&#39;f,&#39;e) confsI) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpts_pI &#936; &#8801; {l. &#8707;l&#39;. (&#936;,l&#39;) &#8712; cptn&#39; &#8743; l = l&#39;}&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* assumes cpts_of_p_def: &quot;cpts_of_p &#936; P s &#8801; {l. l!0=(P,s) &#8743; l &#8712; cpts_p &#936;}&quot;  *)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* definition cp :: &quot;(&#39;s,&#39;p,&#39;f,&#39;e) body &#8658; (&#39;s,&#39;p,&#39;f,&#39;e) com &#8658;
                  (&#39;s,&#39;f) xstate &#8658; ((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot; where
  &quot;cp &#936; P s &#8801; {(&#936;1,l). l!0=(P,s) &#8743; (&#936;,l) &#8712; cptn &#8743; &#936;1=&#936;}&quot;  *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>cpts_of_pI</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env &#8658; ((&#39;s,&#39;p,&#39;f,&#39;e) com) &#8658; (&#39;s,&#39;f) xstate &#8658; ((&#39;s,&#39;p,&#39;f,&#39;e) confsI) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;cpts_of_pI &#936; P s &#8801;  {l. l!0=(P,s) &#8743; l &#8712; cpts_pI &#936;}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_in_cpts_pI</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;,l&#39;) &#8712; cptn&#39; &#8743; l = l&#39;
      &#10233; l &#8712; cpts_pI &#936;&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_pI_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cptn_not_emptyI</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;[] &#8713; cpts_pI &#936;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_pI_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>force</span><span> </span><span>elim</span><span class="delimiter">:</span><span>cptn&#39;.cases</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpts_of_pI_emptyI</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l &#8712; cpts_of_pI &#936; P s &#10233; l &#8800; []&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_pI_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_not_emptyI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
lemma cpts_of_p_defI: &quot;cpts_of_pI &#936; P s &#8801; {l. l!0=(P,s) &#8743; l &#8712; cpts_pI &#936;}&quot;
  by(simp add:cpts_of_pI_def)
*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpts_of_p_defI</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l!0=(P,s) &#8743; l &#8712; cpts_pI &#936; &#10233; l &#8712; cpts_of_pI &#936; P s&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_pI_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* inductive
lrghoare :: &quot;[(&#39;s,&#39;p,&#39;f,&#39;e) body,
             (&#39;s,&#39;p,&#39;f,&#39;e) sextuple set,
              &#39;f set,
              (&#39;s,&#39;p,&#39;f,&#39;e) com,
              (&#39;s set),
              ((&#39;s,&#39;f) tran) set, ((&#39;s,&#39;f) tran) set,
              &#39;s set,
               &#39;s set] &#8658; bool&quot;
    (&quot;_,_ &#8866;<span class="hidden">&#8664;</span><sub>&#39;/_<span class="hidden">&#8665;</span></sub> _ sat [_, _, _, _,_]&quot; [61,61,60,60,0,0,0,0] 45) *)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* &#936; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> Pr sat [p, R, G, q,a] *)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* lemma localRG_sound: &quot;&#936;,&#920; &#8866;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, R, G, q,a] &#10233; &#936;,&#920; &#8872;<span class="hidden">&#8664;</span><sub>/F<span class="hidden">&#8665;</span></sub> c sat [p, R, G, q,a]&quot; *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>rghoare_pI</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env &#8658; [(&#39;s,&#39;p,&#39;f,&#39;e)com, (&#39;s,&#39;f) xstate set, ((&#39;s,&#39;f) xstate &#215; (&#39;s,&#39;f) xstate) set,
                            ((&#39;s,&#39;f) xstate &#215; (&#39;s,&#39;f) xstate) set, (&#39;s,&#39;f) xstate set] &#8658; bool&quot;</span></span></span><span>
</span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866;<span class="hidden">&#8681;</span><sub>I</sub> _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rghoare_pI &#936; c p R G q
  &#8801; (p &#8838; Normal ` UNIV) &#8743; (q &#8838; Normal ` UNIV)
    &#8743; (&#8704;(c,p,R,G,q,a)&#8712; snd &#936;. fst &#936;,{} &#8866;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a])
    &#8743; (fst &#936;,snd &#936; &#8866;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> c sat [{s. Normal s &#8712; p}, R, G, {s. Normal s &#8712; q}, {}]) 
    &#8743; (&#8704;(s,t)&#8712;R. s &#8713; Normal ` UNIV &#10230; s = t)&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* definition assum ::
  &quot;(&#39;s set &#215; (&#39;s,&#39;f) tran set) &#8658; ((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot; where
  &quot;assum &#8801; &#955;(pre, rely).
             {c. snd((snd c)!0) &#8712; Normal ` pre &#8743;
                 (&#8704;i. Suc i&lt;length (snd c) &#10230;
                 (fst c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd c)!i)  &#8594;<span class="hidden">&#8681;</span><sub>e</sub> ((snd c)!(Suc i)) &#10230;
                   (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712;  rely)}&quot; *)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* assume_p_def: &quot;assume_p &#936; &#8801; &#955;(pre, rely). {c. gets_p (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230;
               &#936; &#8866; c!i -pe&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; rely)}&quot; *)</span></span></span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* definition comm ::
  &quot;((&#39;s,&#39;f) tran) set &#215;
   (&#39;s set &#215; &#39;s set) &#8658;
   &#39;f set &#8658;
     ((&#39;s,&#39;p,&#39;f,&#39;e) confs) set&quot; where
  &quot;comm &#8801; &#955;(guar, (q,a)) F.
            {c. snd (last (snd c)) &#8713; Fault ` F  &#10230;
                (&#8704;i.
                 Suc i&lt;length (snd c) &#10230;
                 (fst c)&#8866;<span class="hidden">&#8681;</span><sub>c</sub>((snd c)!i)  &#8594; ((snd c)!(Suc i)) &#10230;
                   (snd((snd c)!i), snd((snd c)!(Suc i))) &#8712; guar) &#8743;
                 (final (last (snd c))  &#10230;
                    ((fst (last (snd c)) = Skip &#8743;
                      snd (last (snd c)) &#8712; Normal ` q)) &#8744;
                    (fst (last (snd c)) = Throw &#8743;
                      snd (last (snd c)) &#8712; Normal ` a))}&quot; *)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* commit_p_def: &quot;commit_p &#936; &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230;
               &#936; &#8866; c!i -c&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; guar) &#8743;
               (getspc_p (last c) = None &#10230; gets_p (last c) &#8712; post)}&quot; *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>prog_validityI</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s,&#39;p,&#39;f,&#39;e) Env &#8658; (&#39;s,&#39;p,&#39;f,&#39;e)com &#8658; (&#39;s,&#39;f) xstate set
    &#8658; ((&#39;s,&#39;f) xstate &#215; (&#39;s,&#39;f) xstate) set
    &#8658; ((&#39;s,&#39;f) xstate &#215; (&#39;s,&#39;f) xstate) set &#8658; (&#39;s,&#39;f) xstate set &#8658; bool&quot;</span></span></span><span>
</span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872;<span class="hidden">&#8681;</span><sub>I</sub> _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prog_validityI &#936; P pre rely guar post &#8801;
   &#8704;s. cpts_of_pI &#936; P s &#8745; assume pre rely &#8838; commit (ptranI &#936;) {Skip} guar post&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
lemma prog_validity_defI: &quot;prog_validityI &#936; P pre rely guar post &#8801;
   &#8704;s. cpts_of_pI &#936; P s &#8745; assume_pI &#936; (pre, rely) &#8838; commit_pI &#936; (guar, post)&quot;
  by(simp add:prog_validityI_def)
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>CptnComp_h</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub>a &#8594; b; (&#936;,b#xs) &#8712; cptn &#10215; &#10233; (&#936;,a#b#xs) &#8712; cptn&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rgsound_pI_h</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;, l) &#8712; cptn&#39; &#10233;
    &#8704;(s, t)&#8712;rely. s &#8713; range Normal &#10230; s = t &#10233;
    x = l &#10233;
    &#8704;i. Suc i &lt; length x &#10230; (x ! i &#9472;e&#8594; x ! Suc i) &#10230; (gets_p (x ! i), gets_p (x ! Suc i)) &#8712; rely &#10233;
    (fst &#936;, l) &#8712; cptn&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>l</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn&#39;_not_empty&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>a</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;x. (&#936;, l) &#8712; cptn&#39; &#10233;
                  &#8704;(s, t)&#8712;rely. s &#8713; range Normal &#10230; s = t &#10233;
                  x = l &#10233;
                  &#8704;i. Suc i &lt; length x &#10230; (x ! i &#9472;e&#8594; x ! Suc i) &#10230; (gets_p (x ! i), gets_p (x ! Suc i)) &#8712; rely &#10233; (fst &#936;, l) &#8712; cptn&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;, a # l) &#8712; cptn&#39;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(s, t)&#8712;rely. s &#8713; range Normal &#10230; s = t&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x = (a # l)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length x &#10230; (x ! i &#9472;e&#8594; x ! Suc i) &#10230; (gets_p (x ! i), gets_p (x ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = []&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnOne</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>l_ne_empty</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l &#8800; []&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>b</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>l&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = b # l&#39;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>list.exhaust</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_in_cptn&#39;</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;, l) &#8712; cptn&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tl_in_cptn&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_x_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length x = length (a # l)&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span>len_x_l</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>y</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>y</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;y = tl x &#8743; y = l&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>y</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>y_pe_rely</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length y &#10230; (y ! i &#9472;e&#8594; y ! Suc i) &#10230; (gets_p (y ! i), gets_p (y ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>List.nth_tl</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_mono</span><span> </span><span>len_x_l</span><span> </span><span>length_Cons</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>y_pe_rely</span><span> </span><span>y</span><span> </span><span>l_in_cptn&#39;</span><span> </span><span>p0</span><span class="delimiter">[</span><span>of</span><span> </span><span>y</span><span class="delimiter">]</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_in_cptn</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst &#936;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>I</sub> a &#8594; b &#8744; fst a = fst b&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ab_cptn&#39;_c_or_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>I</sub> a &#8594; b&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>l_in_cptn</span><span> </span><span>l</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnComp_h</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;&quot;</span></span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>l&#39;</span><span class="delimiter">]</span><span> </span><span>ptranI&#39;_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#936;</span><span> </span><span>a</span><span> </span><span>b</span><span class="delimiter">]</span><span> </span><span>ptranI_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#936;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ab_spec</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst a = fst b&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>l</span><span> </span><span>p4</span><span> </span><span>len_x_l</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (x ! 0) = fst (x ! Suc 0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x ! 0 &#9472;e&#8594; x ! Suc 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>len_x_l</span><span> </span><span>l</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_p (x ! 0), gets_p (x ! Suc 0)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span>len_x_l</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (x ! 0) = snd a&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_p_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>l_ne_empty</span><span> </span><span>p4</span><span> </span><span>l</span><span> </span><span>len_x_l</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (x ! Suc 0) = snd b&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_p_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> a &#8594;<span class="hidden">&#8681;</span><sub>e</sub> b&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>case_tac</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;t&#39;. snd a &#8800; Normal t&#39;&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Env_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd a&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst a&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>p2</span><span> </span><span>ab_spec</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>b</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Env</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst a&quot;</span></span></span><span> </span><span>_</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd b&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>p2</span><span> </span><span>ab_spec</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>b</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptnEnv</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst a&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd a&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd b&quot;</span></span></span><span> </span><span>l&#39;</span><span class="delimiter">]</span><span> </span><span>l</span><span> </span><span>l_in_cptn</span><span> </span><span>ab_spec</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span>surjective_pairing</span><span class="delimiter">[</span><span>of</span><span> </span><span>b</span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rgsound_pI</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;rghoare_pI &#936; P pre rely guar post &#10230; prog_validityI &#936; P pre rely guar post&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rghoare_pI &#936; P pre rely guar post&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre &#8838; range Normal &#8743; post &#8838; range Normal&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;,snd &#936; &#8866;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> P sat [{s. Normal s &#8712; pre}, rely, guar, {s. Normal s &#8712; post},{}]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;(s,t)&#8712;rely. s &#8713; Normal ` UNIV &#10230; s = t)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; snd &#936;. fst &#936;,{} &#8866;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rghoare_pI_def</span><span class="delimiter">,</span><span> </span><span>fast</span><span class="delimiter">)</span><span class="delimiter">+</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rghoare_pI_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rghoare_pI_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rghoare_pI_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;,snd &#936; &#8872;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> P sat [{s. Normal s &#8712; pre},rely, guar, {s. Normal s &#8712; post},{}]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>localRG_sound</span><span> </span><span>com_cnvalid_to_cvalid</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; snd &#936;. fst &#936;,{} &#8872;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>localRG_sound</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>com_cnvalid_to_cvalid</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(c,p,R,G,q,a)&#8712; snd &#936;. fst &#936; &#8872;<span class="hidden">&#8664;</span><sub>/{}<span class="hidden">&#8665;</span></sub> (Call c) sat [p, R, G, q,a]&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>com_cvalidity_def</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. cp (fst &#936;) P s &#8745; assum ({s. Normal s &#8712; pre}, rely) &#8838; comm (guar, {s. Normal s &#8712; post}, {}) {}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>com_cvalidity_def</span><span> </span><span>com_validity_def</span><span> </span><span>localRG_sound</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. {(&#936;1, l). l ! 0 = (P, s) &#8743; (fst &#936;, l) &#8712; cptn &#8743; &#936;1 = fst &#936;} &#8745;
               {c. snd (snd c ! 0) &#8712; Normal ` {s. Normal s &#8712; pre} &#8743;
                   (&#8704;i. Suc i &lt; length (snd c) &#10230;
                        fst c&#8866;<span class="hidden">&#8681;</span><sub>c</sub> snd c ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> snd c ! Suc i &#10230; (snd (snd c ! i), snd (snd c ! Suc i)) &#8712; rely)}
               &#8838; {c. (&#8704;i. Suc i &lt; length (snd c) &#10230;
                           fst c&#8866;<span class="hidden">&#8681;</span><sub>c</sub> snd c ! i &#8594; snd c ! Suc i &#10230; (snd (snd c ! i), snd (snd c ! Suc i)) &#8712; guar) &#8743;
                      (final (last (snd c)) &#10230;
                       fst (last (snd c)) = Skip &#8743; snd (last (snd c)) &#8712; Normal ` {s. Normal s &#8712; post} &#8744;
                       fst (last (snd c)) = Throw &#8743; snd (last (snd c)) &#8712; {})}&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assum_def</span><span> </span><span>comm_def</span><span> </span><span>cp_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x &#8712; cpts_of_pI &#936; P s &#8745; assume pre rely&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x ! 0 = (P, s) &#8743;
               (&#8707;l&#39;. (&#936;, l&#39;) &#8712; cptn&#39; &#8743; x = l&#39;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_pI_def</span><span> </span><span>cpts_pI_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span>
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;(&#936;, l) &#8712; cptn&#39; &#8743;  x = l&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>x_not_empty</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_pI_emptyI</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>x_not_empty</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_not_empty</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd(x!0) &#8712; pre &#8743; (&#8704;i. Suc i &lt; length x &#10230; (x ! i &#9472;e&#8594; x ! Suc i)
                        &#10230; (gets_p (x ! i), gets_p (x ! Suc i)) &#8712; rely)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assume_def</span><span> </span><span>gets_p_def</span><span> </span><span>cpts_of_pI_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8712; cpts_pI &#936;&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>cptn_not_emptyI</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x &#8800; []&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x ! 0 = (P, s)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;snd (hd x) &#8712; pre&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>hd_conv_nth</span><span class="delimiter">[</span><span>OF</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;x&#8800;[]&#8250;</span></span></span><span class="delimiter">]</span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;s&#8712;pre&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>l_not_empty</span><span> </span><span>x_not_empty</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l ! 0 = (P, s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>x_not_empty</span><span> </span><span>b2</span><span> </span><span>l0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>x0_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (x!0) = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>l0</span><span> </span><span>a10</span><span> </span><span>b3</span><span> </span><span>x0_s</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l0_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! 0) &#8712; Normal ` {s. Normal s &#8712; pre}&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_x_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length x = length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_rely</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length l &#10230;
                        (fst &#936; &#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i) &#10230; (snd (l ! i), snd (l ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length l&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936; &#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594;<span class="hidden">&#8681;</span><sub>e</sub> l ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x ! i &#9472;e&#8594; x ! Suc i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>erule</span><span> </span><span>step_e.cases</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_p (x ! i), gets_p (x ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! i) = gets_p (x ! i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span>  </span><span>gets_p_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! Suc i) = gets_p (x ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span>gets_p_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>length_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (l ! i), snd (l ! Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*from b2 b3 have &quot;&#8704;i. Suc i &lt; length l &#10230; &#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> (l ! i) &#8594;<span class="hidden">&#8681;</span><sub>e</sub> (l ! Suc i) &#10230; (snd (l ! i), snd (l ! Suc i)) &#8712; rely&quot;
      using stepe_imp_petranI[of x l] len_x_l using l_rely by blast *)</span></span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a12</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_in_cptn</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(fst &#936;, l) &#8712; cptn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rgsound_pI_h</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a11</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span>l0</span><span> </span><span>a2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>s</span><span class="delimiter">]</span><span> </span><span>l0_s</span><span> </span><span>l_rely</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i &lt; length (l) &#10230;
                           fst &#936;&#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594; l ! Suc i &#10230; (snd (l ! i), snd (l ! Suc i)) &#8712; guar) &#8743;
                      (SmallStepCon.final (last l) &#10230;
                       fst (last l) = Skip &#8743; snd (last l) &#8712; Normal ` {s. Normal s &#8712; post} &#8744;
                       fst (last l) = Throw &#8743; snd (last l) &#8712; {})&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_in_cptn</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length x&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936; &#8866;<span class="hidden">&#8681;</span><sub>c</sub> x!i &#8594; x!(Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936; &#8866;<span class="hidden">&#8681;</span><sub>c</sub> l ! i &#8594; l ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! i) = snd (x ! i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (l ! Suc i) = snd (x ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(snd (x!i), snd (x!Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>g0</span><span> </span><span>c0</span><span> </span><span>len_x_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last x) = Skip&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (last l) = Skip&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn&#39;_not_empty&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#936;</span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span>len_x_l</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;final (last l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>final_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last l) = snd (last x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>gets_p_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>case_prod_unfold</span><span> </span><span>l_not_empty</span><span> </span><span>last_map</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;snd (last x) &#8712; post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cptn_not_empty&#39;</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst &#936;&quot;</span></span></span><span> </span><span>l</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>g0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x &#8712; commit (ptranI &#936;) {Skip} guar post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_def</span><span> </span><span>ptranI_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. cpts_of_pI &#936; P s &#8745; assume pre rely &#8838; commit (ptranI &#936;) {Skip} guar post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prog_validityI &#936; P pre rely guar post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>prog_validityI_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eventI</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;event ptranI Skip&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>event.intro</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>none_no_tranI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>ptran_neqI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">interpretation</span></span><span> </span><span>event</span><span> </span><span>ptranI</span><span> </span><span>Skip</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eventI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>event_compI</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;event_comp ptranI Skip&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>event_comp.intro</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eventI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">interpretation</span></span><span> </span><span>event_comp</span><span> </span><span>ptranI</span><span> </span><span>Skip</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>event_compI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpts_equiv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpts_pI &#915; = cpts (ptranI &#915;)&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpts_pI &#915; &#8838; cpts (ptranI &#915;)&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>cpt</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpt &#8712; cpts_pI &#915;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(&#915;, cpt) &#8712; cptn&#39;&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_pI_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpt &#8712; cpts (ptranI &#915;)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span class="delimiter">,</span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>Q</span><span> </span><span>t</span><span> </span><span>xs</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(a, b) &#8866;<span class="hidden">&#8681;</span><sub>c</sub><span class="hidden">&#8681;</span><sub>I</sub> (P, s) &#8594; (Q, t)&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>2</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(Q, t) # xs &#8712; cpts (ptranI (a, b))&#8250;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;(P, s) # (Q, t) # xs &#8712; cpts (ptranI (a, b))&#8250;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>CptsComp</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ptranI_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>1</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ptranI&#39;_def</span><span> </span><span>ptranI_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpts (ptranI &#915;) &#8838; cpts_pI &#915;&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>cpt</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpt &#8712; cpts (ptranI &#915;)&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpt &#8712; cpts_pI &#915;&#8250;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsOne</span><span> </span><span>P</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_pI_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>CptnOne&#39;</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEnv</span><span> </span><span>P</span><span> </span><span>t</span><span> </span><span>cs</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_pI_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>erule</span><span> </span><span>CptnEnv&#39;</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsComp</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>Q</span><span> </span><span>t</span><span> </span><span>cs</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_pI_def</span><span> </span><span>ptranI_def</span><span> </span><span>ptranI&#39;_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>CptnComp&#39;</span><span class="delimiter">)</span><span>
</span><span>         </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ptranI&#39;_def</span><span> </span><span>ptranI_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>assumption</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpts_inter_assume_equiv</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;cpts_of_pI &#915; P s &#8745; assume pre rely = {cpt &#8712; cpts (ptranI &#915;). hd cpt = (P, s)} &#8745; assume pre rely&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_of_pI_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_equiv</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>cptn_not_emptyI</span><span> </span><span>hd_conv_nth</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>prog_validity_defI&#39;</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8704;s. cpts_of_pI &#915; P s &#8745; assume pre rely &#8838; commit (ptranI &#915;) {Skip} guar post &#10233;
   validity (ptranI &#915;) {LanguageCon.com.Skip} P pre rely guar post&#8250;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_inter_assume_equiv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">interpretation</span></span><span> </span><span>event_hoare</span><span> </span><span>ptranI</span><span> </span><span>Skip</span><span> </span><span>prog_validityI</span><span> </span><span>rghoare_pI</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>event_hoare.intro</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>event_validity.intro</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>event_compI</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>event_validity_axioms.intro</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prog_validityI_def</span><span class="delimiter">)</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>drule</span><span> </span><span>prog_validity_defI&#39;</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>event_hoare_axioms.intro</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>erule</span><span> </span><span>rgsound_pI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>

</div>
</body>
</html>
