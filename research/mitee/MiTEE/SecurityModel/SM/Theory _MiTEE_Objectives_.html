<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0149)http://localhost:55320/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/preview?%2FUsers%2Fxywang%2FDesktop%2Fmi-tee%2FMiTEE_SecurityModel%2FMiTEE_Objectives.thy -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/08bb8c71-e114-4783-a8d9-5f7c1bfaf9ab/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.contents { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }


/* formal entities */

.entity_def {
  color: inherit;
  text-decoration: inherit;
}

.entity_def:hover {
  color: inherit;
  text-decoration: inherit;
  background-color: rgba(50,50,50,20%);
}

.entity_ref {
  color: inherit;
  text-decoration: inherit;
  border: 0.5px solid rgba(0,0,0,0);
}

.entity_ref:hover {
  color: inherit;
  text-decoration: inherit;
  background-color: rgba(50,50,50,20%);
  border: 0.5px solid black;
}
</style><title>Theory "MiTEE_Objectives"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> MiTEE_Objectives
  <span class="keyword2"><span class="keyword">imports</span></span> Main
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_TA_AUTHENTICITY"</span></span></span>
<span class="comment1">(*
FROM PP
==================
O.TA_AUTHENTICITY
The TEE shall verify the authenticity of the Trusted Applications’ binary code.

Application Note:
Verification of authenticity of TA code can be performed together with verification of the TEE firmware if 
both are bundled together or during the loading of the TA code in volatile memory.
===============
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_TA_AUTHENTICITY
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">verify</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'bc</span> <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="comment1">(* use a key 'k to authenticate whether a TA code 'bc is the CODE the TEE thinks *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_CA_TA_IDENTIFICATION"</span></span></span>

<span class="comment1">(* 
FROM PP
===============================
O.CA_TA_IDENTIFICATION

The TEE shall provide means to protect the identity of each Trusted Application from use by another 
resident Trusted Application and to distinguish Client Applications from Trusted Applications.

Application Note:
Client properties are managed either by the Regular OS or by the Trusted OS and these must ensure that 
a Client cannot tamper with its own properties in the following sense:
❖ The Client identity of a TA must always be determined by the Trusted OS and the determination 
of whether it is a TA or not must be as trustworthy as the Trusted OS itself; 
❖ When the Client identity corresponds to a TA, then the Trusted OS must ensure that the other 
Client properties are equal to the properties of the calling TA up to the same level of trustworthiness 
that the target TA places in the Trusted OS; 
❖ When the Client identity does not correspond to a TA, then the Regular OS is responsible for 
ensuring that the Client Application cannot tamper with its own properties. However, this 
information is not trusted by the Trusted OS.

note: after discussion, property here means identity
 *)</span>

<span class="comment1">(*
(*version 2*)
locale O_CA_TA_IDENTIFICATION
   =
  (* The Client identity of a TA must always be determined by the Trusted OS *)
  fixes ta_client :: "'s ⇒ ('ta ⇀ 'cid)" (*search for TA client, if some, find one*)
  fixes ta_client_identification :: "'s⇒'cid⇒bool"(*judge the client_identity's type(TA/CA),if TA then True*)
  
  fixes ta_identification :: "'s⇒'cid⇒'ta"(*get ta's information by client_identity *)
  fixes ca_identification :: "'s⇒'cid⇒'ca"
  (* ta client identities are different *)
  assumes ta_ident: "∀s cid cid'. cid ≠ cid' ∧ ta_client_identification s cid ∧ ta_client_identification s cid'
                                        ⟶  ta_identification s cid ≠ ta_identification s cid'"

  fixes ta_props :: "'s ⇒ 'ta ⇒ 'tap" (* TA properties *)
  (*fixes ca_props :: "'s ⇒ 'ca ⇒ 'cap" (* CA properties *)*)
  fixes client_props :: "'s ⇒ 'cid ⇒ 'cp" (* client properties *)
  (* a func to decide whether the other Client properties are equal to the properties of TA *)
  fixes ta_ci_prop_eq :: "'cp ⇒ 'tap ⇒ bool" 
  (* Client properties are equal to the properties of the calling TA *)
  assumes tap_cip: "∀s ta. ta_client s ta ≠ None ⟶ 
            (ta_ci_prop_eq (client_props s (the (ta_client s ta))) (ta_props s ta))"
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_CA_TA_IDENTIFICATION
   <span class="main">=</span>
  <span class="comment1">(* The Client identity of a TA must always be determined by the Trusted OS *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ta_client</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'ta</span> <span class="main">⇀</span> <span class="tfree">'cid</span><span class="main">)</span>"</span></span> <span class="comment1">(*search for TA client, if some, find one*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ta_client_identification</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'cid</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*judge the client_identity's type(TA/CA),if TA then True*)</span>
  
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ta_identification</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span><span class="tfree">'cid</span>"</span></span><span class="comment1">(*get ta's client_identity if it is as a client *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ca_identification</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span><span class="tfree">'cid</span>"</span></span><span class="comment1">(*here CA is REE cause we dont identify different CA*)</span>
  <span class="comment1">(* ta client identities are different *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ta_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ta</span> <span class="bound">ta'</span><span class="main">.</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="bound">ta'</span> <span class="main">⟶</span>  <span class="free">ta_identification</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">ta_identification</span> <span class="bound">s</span> <span class="bound">ta'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ca_ta_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ta</span> <span class="bound">ca</span><span class="main">.</span>  <span class="free">ta_identification</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">ca_identification</span> <span class="bound">s</span> <span class="bound">ca</span>"</span></span>

<span class="comment1">(*
  fixes ta_props :: "'s ⇒ 'ta ⇒ 'tap" (* TA properties *)
  (*fixes ca_props :: "'s ⇒ 'ca ⇒ 'cap" (* CA properties *)*)
  fixes client_props :: "'s ⇒ 'cid ⇒ 'cp" (* client properties *)
  (* a func to decide whether the other Client properties are equal to the properties of TA *)
  fixes ta_ci_prop_eq :: "'cp ⇒ 'tap ⇒ bool" 

  (* a func to decide whether the other Client properties are equal to the properties of TA *)
  fixes ta_ci_prop_eq :: "'cid ⇒ 'cid ⇒ bool"
  (* Client properties are equal to the properties of the calling TA *)
  assumes tap_cip: "∀s ta ta'. ta_client s ta ≠ None ⟶ 
            (ta_ci_prop_eq (client_props s (the (ta_client s ta))) (ta_props s ta))"
*)</span>

  <span class="comment1">(* a func to decide whether the other Client properties are equal to the properties of TA *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ta_ci_prop_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'cid</span> <span class="main">⇒</span> <span class="tfree">'cid</span> <span class="main">⇒</span> bool"</span></span>
  <span class="comment1">(* Client properties are equal to the properties of the calling TA *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tap_cip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ta</span><span class="main">.</span> <span class="free">ta_client</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="free">ta_client_identification</span> <span class="bound">s</span> <span class="main">(</span>the <span class="main">(</span><span class="free">ta_client</span> <span class="bound">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟶</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">ta'</span><span class="main">.</span> <span class="main">(</span><span class="free">ta_ci_prop_eq</span> <span class="main">(</span>the <span class="main">(</span><span class="free">ta_client</span> <span class="bound">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ta_identification</span> <span class="bound">s</span> <span class="bound">ta'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_INSTANCE_TIME"</span></span></span>

<span class="comment1">(*
FROM PP
======================
O.INSTANCE_TIME

The TEE shall provide TA instance time and shall ensure that this time is monotonic during TA instance 
lifetime – from the TA instance creation until the TA instance is destroyed – and not impacted by
transitions through low power states.
======================

*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_INSTANCE_TIME
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">query_time</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'sc</span><span class="main">⇒</span><span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'tid</span><span class="main">⇒</span><span class="tfree">'instime</span><span class="main">::</span>linorder"</span></span><span class="comment1">(*get TA instance time, system time + offset*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">trans</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span>
  <span class="comment1">(*The TEE shall ensure that this time is monotonic during TA instance lifetime*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monotonic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">sc</span> <span class="bound">a</span> <span class="bound">t</span> <span class="bound">tid</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">query_time</span> <span class="bound">sc</span> <span class="bound">s</span> <span class="bound">tid</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">query_time</span> <span class="bound">sc</span> <span class="bound">t</span> <span class="bound">tid</span><span class="main">)</span>"</span></span>

<span class="comment1">(*it may not model here but in one part of our project, the time is updated by the timer*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_KEYS_USAGE"</span></span></span>

<span class="comment1">(*
FROM PP
======================
O.KEYS_USAGE

The TEE shall enforce the cryptographic keys usage restrictions set by their creators.
//we only care about TA checksum, but not included here,this object may ignore
======================
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_KEYS_USAGE
  <span class="main">=</span>
  <span class="comment1">(*check whether the key is used by its owner*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">checksum</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'k</span><span class="main">⇒</span><span class="tfree">'kuser</span><span class="main">⇒</span>bool"</span></span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_OPERATION"</span></span></span>

<span class="comment1">(*
O.OPERATION

The TEE shall ensure the correct operation of its security functions. In particular, the TEE shall:
o Protect itself against abnormal situations caused by programmer errors or violation of good 
practices by the REE (and the CAs indirectly) or by the TAs;
//maybe when TA get dead lock or call API without a proper order,

o Control access to its services by the REE and TAs: The TEE shall check the validity of any 
operation requested from either the REE or a TA, at any entry point into the TEE;

o Enter a secure state upon failure detection, without exposure of any sensitive data.

Application Note:
o Programmer errors or violation of good practices (e.g. that exploit multi-threading or 
context/session management) might become attack-enablers. However, the TEE must guarantee 
the stability and security of its resources and services independent of the REE, which may have 
been corrupted. In any case, a Trusted Application must not be able to use a programmer error 
on purpose to circumvent the TEE security functionality.

o Software in the REE must not be able to call directly to TEE resources or functions. The REE 
software must go through protocols such that the Trusted OS or Trusted Application performs the 
verification of the acceptability of the operation that the REE software has requested.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_OPERATION
   <span class="main">=</span>
  <span class="comment1">(*Control access to its services by the REE and TAs*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ca_access</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*1. whether CA can call some API. 
                  2. whether obey the policy for controlling access to TA and TEE execution spaces*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ta_access</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span>bool"</span></span>

  <span class="comment1">(*the allowed API for TA and CA are different
  assumes access_diff:"∀s a ca ta. valid_ca_access s a ca ≠ valid_ta_access s a ta"*)</span>

  <span class="comment1">(*Programmer errors or violation of good practices*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ca_action</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span>bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ta_action</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span>bool"</span></span>
  <span class="comment1">(*
  with three dimension: 1. the action is a defined API?(unexpected commands) 
                        2. bad parameter?(programmer error)
                        3. other programmer error
  *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">move_to_secure_state</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'s</span>"</span></span><span class="comment1">(*Enter a secure state,like trans1, but different actions*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">secure_state</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*judge whether the state is secure*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">trans</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">failure_detect</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span>bool"</span></span>
  <span class="comment1">(*Protect itself against abnormal situations caused by programmer errors or violation of good practices*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> action_cor_use<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ca_action</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ta_action</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ta</span><span class="main">)</span> 
                          <span class="main">⟶</span> <span class="free">failure_detect</span> <span class="bound">s</span>"</span></span>
  <span class="comment1">(*Control access to its services by the REE and TAs*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> access_cor_use<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ca_access</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ta_access</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ta</span><span class="main">)</span> 
                          <span class="main">⟶</span> <span class="free">failure_detect</span> <span class="bound">s</span>"</span></span>
  <span class="comment1">(*the TEE shall Enter a secure state upon failure detection*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">=</span> <span class="free">move_to_secure_state</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">failure_detect</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">secure_state</span> <span class="bound">s'</span>"</span></span>






<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_ISOLATION"</span></span></span>
  
<span class="comment1">(*
Isolation includes the 4 objectives below:

- O.RUNTIME_CONFIDENTIALITY

The TEE shall ensure that confidential TEE runtime data and TA data and keys are protected against 
unauthorized disclosure. In particular:
o The TEE shall not export any sensitive data, random numbers or secret keys to the REE;
o The TEE shall grant access to sensitive data, random numbers or secret keys only to authorized 
TAs;
o The TEE shall clean up sensitive resources as soon as it can determine that their values are no 
longer needed.

- O.RUNTIME_INTEGRITY

The TEE shall ensure that the TEE firmware, TEE runtime data, TA code, and TA data and keys are 
protected against unauthorized modification at runtime when stored in volatile memory

- O.TA_ISOLATION

The TEE shall isolate the TAs from each other: Each TA shall access its own execution and storage space, 
which is shared among all the instances of the TA but separated from the spaces of any other TA.
Application Note:
This objective contributes to the enforcement of the confidentiality and integrity of TA data.

- O.TEE_ISOLATION

The TEE shall prevent the REE and the TAs from accessing the TEE’s own execution and storage space 
and resources.
Application Note:
This objective contributes to the enforcement of the correct execution of the TEE. Note that resource 
allocation can change during runtime as long as it does not break isolation between resources used by the 
TEE and the REE/TAs.
// maybe tee's accessing ta's data is allowed
*)</span>


<span class="keyword1"><span class="command">locale</span></span> O_ISOLATION
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="comment1">(* state machine of the whole system *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span> option"</span></span> <span class="comment1">(* domain of actions *)</span>
 <span class="comment1">(* fixes elist :: "'s⇒('c×'b) list"*)</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">elist</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'const</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">vpeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">∼</span> _ <span class="keyword1">∼</span> _<span class="keyword3">)</span>"</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">interference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">↝</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="comment1">(*
  fixes write_interference :: "'d ⇒ 'd ⇒ bool" ("(_ ↝ _)")(*including sensitive data and params*)
  fixes ta_data::"'s⇒'d⇒'data"(*ta runtime data, parameter not included*)
  fixes tee_data::"'s⇒'d⇒'data"(*tee runtime data, parameter not included*)
  (*because REE data can be accessed by all, so we don't model it*)
  fixes access::"'s⇒'d⇒'data⇒bool"(*ta/tee runtime data access management*)
  fixes clean_up::"'s⇒'data⇒bool"(*The TEE shall clean up sensitive resources*)
  fixes read_interference :: "'d ⇒ 'd ⇒ bool" ("(_↪_)")
*)</span>

<span class="comment1">(*
   // in this project TA is TA instance so we may not distinguish them
*)</span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TEE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the TEE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">REE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the REE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TA_domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span> <span class="tfree">'ta</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>  <span class="comment1">(* domain id of TAs *)</span>
<span class="comment1">(* fixes CA_domain :: "'ca ⇒ 'd"*)</span>  <span class="comment1">(* domain id of CAs *)</span> 
    <span class="comment1">(* CAs as clients have to be identified, as well as their actions, 
    so we consider each CA as an identity. When define security, we consider them as the whole REE domain  *)</span>
  <span class="comment1">(*
  assumes "TEE ≠ REE"
    and   "∀ta s. TA_domain s ta ≠ TEE ∧ TA_domain s ta ≠ REE"
    and   "∀s. inj (TA_domain s)"
    and   "∀d s. d = TEE ∨ d = REE ∨ (∃ta. TA_domain s ta = d)" 
  *)</span>
  <span class="comment1">(*we can write this in specification because we proof security in requirement layer,not secure layer*)</span> 



   <span class="comment1">(* CAs as clients have to be identified, as well as their actions, 
      so we consider each CA as a domain. When define security, we consider them as the whole REE domain  *)</span>

<span class="comment1">(* 
  (*The TEE shall not export any sensitive data, random numbers or secret keys to the REE*)
  assumes ree_no_access: "∀s data d. (data = ta_data s d) ∨ (data = tee_data s d) ⟶ ¬ access s REE data"
  assumes 
    ta_data_diff:"∀s ta ta'. ta_data s (TA_domain ta) ≠ ta_data s (TA_domain ta')"
    and ta_tee_diff:"∀s ta. ta_data s (TA_domain ta) ≠ tee_data s TEE"
    (*The TEE shall grant access to sensitive data, random numbers or secret keys only to authorized TAs*)
    (*Each TA shall access its own execution and storage space*)
    and ta_data_iso:"∀s ta data. access s (TA_domain ta) data ⟶ data = (ta_data s (TA_domain ta)) "
    (*The TEE shall prevent the REE and the TAs from accessing the TEE’s own execution and storage space and resources.*)
    and ta_tee_iso:"∀s ta. TA_domain ta ≠ TEE ⟶ ¬ access s (TA_domain ta) (tee_data s TEE)"
*)</span>

  <span class="keyword2"><span class="keyword">assumes</span></span> 
    vpeq_transitive_lemma <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">r</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    vpeq_symmetric_lemma <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">t</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    vpeq_reflexive_lemma <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="comment1">(* tee_vpeq : "∀s t a. (s ∼ TEE ∼ t) ⟶ (domain s a) = (domain t a)" and*)</span>
    tee_intf_all <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">TEE</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_intf_tee <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="free">TEE</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    interf_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> 
<span class="comment1">(*
    tee_vpeq : "∀s t. (s ∼ TEE ∼ t) ⟶ (tee_data s TEE) = (tee_data t TEE)" and
    ta_vpeq : "∀s t ta. (s ∼ TA_domain ta ∼ t) ⟶ ta_data s (TA_domain ta) = ta_data t (TA_domain ta)" and
*)</span> 


<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">non_interference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">∖↝</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main"><span class="free">∖↝</span></span>  <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main"><span class="free">↝</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*definition non_read_interference :: "'d ⇒ 'd ⇒ bool" ("(_ ∖↪ _)")
  where "(u ∖↪  v) ≡ ¬ (u ↪ v)"
*)</span>


<span class="comment1">(*state transition after the execution of an event list in which each event is executed by function "trans"*)</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">run</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list<span class="main">⇒</span><span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  run_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="main">[]</span> <span class="main">=</span> Id"</span></span> <span class="main">|</span>
  run_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">O</span> <span class="free">run</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span>"</span></span>

<span class="comment1">(*judge whether s' is reachable after the execution of an event list with an initial state s*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reachable</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'s</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">∈</span> run <span class="bound">as</span><span class="main">)</span>"</span></span>
  
<span class="comment1">(*judge whether s is reachable from initial state s0*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reachable0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable0</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> reachable <span class="free">s0</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">execute</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'s</span> set"</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">execute</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Image <span class="main">(</span>run <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">}</span> "</span></span> 


<span class="keyword1"><span class="command">declare</span></span> non_interference_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> reachable_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> reachable0_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> execute_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> run.simps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
            run.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">cong</span><span class="main">]</span>

    <span class="keyword1"><span class="command">lemma</span></span> reachable_s0 <span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="free">s0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reachable0_def reachable_def run_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
    
    <span class="keyword1"><span class="command">lemma</span></span> reachable_self <span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">s</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reachable_def run.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">lemma</span></span> reachable_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="free">a</span> <span class="main">⟹</span> reachable <span class="free">s</span> <span class="free">s'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span>run <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> run_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="bound">T</span> <span class="bound">V</span> <span class="bound">as</span> <span class="bound">bs</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="bound">T</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">T</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span><span class="main">∈</span>run <span class="main">(</span><span class="bound">as</span><span class="main">@</span><span class="bound">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span> <span class="skolem">V</span> <span class="skolem">as</span> <span class="skolem">bs</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="skolem">T</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">as</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span><span class="main">∈</span>run <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">cs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span> "</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">bs</span>"</span></span>
                    <span class="keyword1"><span class="command">from</span></span> b0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">C'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">C'</span><span class="main">,</span><span class="skolem">T</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> a0 b0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C'</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span><span class="main">∈</span>run <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">with</span></span> b2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> append_Cons relcomp.relcompI run_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> reachable_transitive <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>reachable <span class="free">C</span> <span class="free">T</span><span class="main">;</span> reachable <span class="free">T</span> <span class="free">V</span><span class="main">⟧</span> <span class="main">⟹</span> reachable <span class="free">C</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">C</span> <span class="free">T</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">T</span> <span class="free">V</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> a0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">T</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">V</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span><span class="free">V</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> a0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 b0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">T</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">V</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span><span class="free">V</span>"</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">from</span></span> b0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">T</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> c0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d0  run_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> reachableStep <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>reachable0 <span class="free">C</span><span class="main">;</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">C'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="free">a</span><span class="main">⟧</span> <span class="main">⟹</span> reachable0 <span class="free">C'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> reachable0_def reachable_def reachable_trans run_trans<span class="main">)</span>
     
     
    <span class="keyword1"><span class="command">lemma</span></span> reachable0_reach <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>reachable0 <span class="free">C</span><span class="main">;</span> reachable <span class="free">C</span> <span class="free">C'</span><span class="main">⟧</span> <span class="main">⟹</span> reachable0 <span class="free">C'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_transitive<span class="main">)</span>
      
    <span class="keyword1"><span class="command">declare</span></span> reachable_def<span class="main">[</span><span class="operator">cong</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> reachable0_def<span class="main">[</span><span class="operator">cong</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"security properties"</span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">integrity</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">integrity</span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="bound">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
      
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">integrity_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">integrity_e</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
   


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">confidentiality</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">confidentiality</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">a</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="bound">a</span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="free">elist</span> <span class="bound">s</span><span class="main">=</span><span class="free">elist</span> <span class="bound">t</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="bound">a</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">confidentiality_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">confidentiality_e</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="free">elist</span> <span class="bound">s</span><span class="main">=</span><span class="free">elist</span> <span class="bound">t</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_confidentiality</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">weak_confidentiality</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">a</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="bound">a</span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="free">elist</span> <span class="bound">s</span><span class="main">=</span><span class="free">elist</span> <span class="bound">t</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="bound">a</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_confidentiality_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">weak_confidentiality_e</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="free">elist</span> <span class="bound">s</span><span class="main">=</span><span class="free">elist</span> <span class="bound">t</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">declare</span></span> confidentiality_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> confidentiality_e_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          weak_confidentiality_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> weak_confidentiality_e_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          integrity_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> integrity_e_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> confidentiality_all_evt<span class="main">:</span> <span class="quoted"><span class="quoted">"confidentiality <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> confidentiality_e <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> weak_confidentiality_all_evt<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_confidentiality <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> weak_confidentiality_e <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> integrity_all_evt<span class="main">:</span> <span class="quoted"><span class="quoted">"integrity <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> integrity_e <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> weak_with_step_cons<span class="main">:</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted">weak_confidentiality</span>
        <span class="keyword2"><span class="keyword">and</span></span>   p2<span class="main">:</span><span class="quoted">integrity</span>
      <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted">confidentiality</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">a</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span> <span class="main">∧</span> reachable0 <span class="skolem">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="free">elist</span> <span class="skolem">s</span><span class="main">=</span><span class="free">elist</span> <span class="skolem">t</span><span class="main">)</span><span class="main">∧</span> 
              <span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="skolem">a</span>
              <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
           <span class="keyword1"><span class="command">{</span></span>
             <span class="keyword3"><span class="command">assume</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span> <span class="main">∧</span> reachable0 <span class="skolem">t</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">elist</span> <span class="skolem">s</span><span class="main">=</span><span class="free">elist</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span><span class="main">∈</span><span class="free">trans</span> <span class="skolem">a</span>"</span></span>
             <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t'</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span>"</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aa a0 a1 a2 b0 p1 weak_confidentiality_def a3 a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1 <span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> b1 <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main"><span class="free">∼</span></span><span class="skolem">d</span><span class="main"><span class="free">∼</span></span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aa b1  p2 a3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main"><span class="free">∼</span></span><span class="skolem">d</span><span class="main"><span class="free">∼</span></span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aa b3 p2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a0 b4 vpeq_symmetric_lemma vpeq_transitive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>
           <span class="keyword1"><span class="command">}</span></span>
           <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
           <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> confidentiality_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>








<span class="comment1">(*
subsection "New Integrity Definition"
(*TA cant modify REE*)
definition REE_TA_integrity :: "bool" where
      "REE_TA_integrity ≡ ∀ a s s'. reachable0 s ∧ ((the (domain s a)) ≠ REE) ∧ ((the (domain s a)) ≠ TEE)
                                     ∧ s' = trans s a  ⟶ (s ∼ REE ∼ s')"
(*REE cant modify TA*)
definition TA_REE_integrity :: "bool" where
      "TA_REE_integrity ≡ ∀ a d s s'. reachable0 s ∧ ((the (domain s a)) = REE) ∧ s' = trans s a  
                                ⟶ (s ∼ d ∼ s') ∧ (d ≠ TEE) ∧ (d ≠ REE) "
(*TA cant modify TEE*)
definition TEE_TA_integrity :: "bool" where
      "TEE_TA_integrity ≡ ∀ a s s'. reachable0 s ∧ ((the (domain s a)) ≠ REE) ∧ ((the (domain s a)) ≠ TEE)
                                     ∧ s' = trans s a  ⟶ (s ∼ TEE ∼ s')"
(*REE cant modify TEE*)
definition TEE_REE_integrity :: "bool" where
      "TEE_REE_integrity ≡ ∀ a s s'. reachable0 s ∧ ((the (domain s a)) = REE)
                                     ∧ s' = trans s a  ⟶ (s ∼ TEE ∼ s')"
(*TA cant modify TA*)
definition TA_TA_integrity :: "bool" where
      "TA_TA_integrity ≡ ∀ a d s s'. reachable0 s ∧ ((the (domain s a)) ≠ REE) ∧ ((the (domain s a)) ≠ TEE) 
                                      ∧ ((the (domain s a)) ≠ d)∧ s' = trans s a  
                                      ⟶ (s ∼ d ∼ s') ∧ (d ≠ TEE) ∧ (d ≠ REE)"

(*So we define ↝ as write access, a↝b means a can modify memory in domain b*)
definition new_integrity :: "bool" where
      "new_integrity ≡ ∀ a d s s'. reachable0 s ∧ ((the (domain s a)) ∖↝ d) ∧ s' = trans s a  ⟶ (s ∼ d ∼ s')"

subsection "New Confidentiality Definition"

(*REE cant read TA*)
definition REE_TA_confidentiality :: "bool" where
      "REE_TA_confidentiality ≡ ∀a s t. reachable0 s ∧ reachable0 t ∧ (s ∼ REE ∼ t) ∧ (domain s a = domain t a)
                                ∧((the (domain s a)) ≠ REE) ∧ ((the (domain s a)) ≠ TEE)  ⟶ 
                                (∀ s' t'. s' = trans s a  ∧ t' = trans t a ⟶ (s' ∼ REE ∼ t'))"
(*delete ∧ (s ∼ (the (domain s a)) ∼ t) for all confidentiality*)

(*REE cant read TEE*)
definition REE_TEE_confidentiality :: "bool" where
      "REE_TEE_confidentiality ≡ ∀a s t. reachable0 s ∧ reachable0 t ∧ (s ∼ REE ∼ t) ∧ (domain s a = domain t a)
                                ∧ ((the (domain s a)) = TEE) ⟶ 
                                (∀ s' t'. s' = trans s a  ∧ t' = trans t a ⟶ (s' ∼ REE ∼ t'))"

(*TA cant read TA*)
definition TA_TA_confidentiality :: "bool" where
      "TA_TA_confidentiality ≡ ∀a d s t. reachable0 s ∧ reachable0 t ∧ (s ∼ d ∼ t) ∧ (domain s a = domain t a)
                                ∧((the (domain s a)) ≠ REE) ∧ ((the (domain s a)) ≠ TEE) ∧ ((the (domain s a)) ≠ d) 
                                     ⟶ 
                                (∀ s' t'. s' = trans s a  ∧ t' = trans t a ⟶ (s' ∼ d ∼ t')) ∧ (d ≠ TEE) ∧ (d ≠ REE)"

(*TA cant read TEE*)
(*TBD: TA need to access TA bin in TEE's memory when initializing*)
definition TA_TEE_confidentiality :: "bool" where
      "TA_TEE_confidentiality ≡ ∀a d s t. reachable0 s ∧ reachable0 t ∧ (s ∼ d ∼ t) ∧ (domain s a = domain t a)
                                ∧((the (domain s a)) =TEE)  ⟶ 
                                (∀ s' t'. s' = trans s a  ∧ t' = trans t a ⟶ (s' ∼ d ∼ t')) ∧ (d ≠ TEE) ∧ (d ≠ REE)"

(*define ↪ as read access, a↪b means b can read data in domain a*)

definition new_confidentiality :: "bool" where
        "new_confidentiality ≡ ∀a d s t. reachable0 s ∧ reachable0 t ∧ (s ∼ d ∼ t) ∧ (domain s a = domain t a)
                                ∧((the (domain s a)) ∖↪ d) ⟶ 
                                (∀ s' t'. s' = trans s a  ∧ t' = trans t a ⟶ (s' ∼ d ∼ t'))"
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body></html>