<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0167)http://localhost:60012/e878375a-7f83-431b-a556-7f03b63e3c91/preview?%2FUsers%2Fxywang%2FDesktop%2Fmi-tee%2FMITEE_Design_Layer%2FSecurity%2FDesign_Sec_InvokeCommand.thy -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.contents { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }


/* formal entities */

.entity_def {
  color: inherit;
  text-decoration: inherit;
}

.entity_def:hover {
  color: inherit;
  text-decoration: inherit;
  background-color: rgba(50,50,50,20%);
}

.entity_ref {
  color: inherit;
  text-decoration: inherit;
  border: 0.5px solid rgba(0,0,0,0);
}

.entity_ref:hover {
  color: inherit;
  text-decoration: inherit;
  background-color: rgba(50,50,50,20%);
  border: 0.5px solid black;
}
</style><title>Theory "Design_Sec_InvokeCommand"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> Design_Sec_InvokeCommand
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"../Design_Instantiation"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"auxiliary lemma"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Driver_Read_not_change_old<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">⇑</span><span class="main">(</span>Driver_Read <span class="bound">s</span> smc_ex_init_read zx_mgr<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Driver_Read_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Driver_Write_smc_not_change_old<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> 
              <span class="main">(</span><span class="main">⇑</span><span class="main">(</span>fst<span class="main">(</span>Driver_Write_smc <span class="bound">s</span> zx_mgr ZX_OKr smc_ex_init<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Driver_Write_smc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> tee_invokeTACommand_TEEDomain2R_notchnew<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s'</span><span class="main">=</span><span class="main">(</span>fst <span class="main">(</span>tee_invokeTACommand_TEEDomain2R <span class="free">sc</span> <span class="free">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">∼.</span> <span class="free">d</span> <span class="keyword1">.∼Δ</span> <span class="free">s'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> tee_invokeTACommand_TEEDomain2R_def abstract_state_def abstract_state_rev_def vpeq_ipc_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.ext_inject State.update_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> StateR.ext_inject StateR.surjective p1 surjective_pairing <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand1R_notchnew<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s'</span><span class="main">=</span><span class="main">(</span>fst<span class="main">(</span>TEE_InvokeTACommand1R sysconf <span class="free">s</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">∼.</span> <span class="free">d</span> <span class="keyword1">.∼Δ</span> <span class="free">s'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand1R_def abstract_state_def abstract_state_rev_def vpeq_ipc_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.ext_inject State.update_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> StateR.ext_inject StateR.surjective p1 surjective_pairing <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand2R_notchnew<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s'</span><span class="main">=</span><span class="main">(</span>fst<span class="main">(</span>TEE_InvokeTACommand2R sysconf <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">∼.</span> <span class="free">d</span> <span class="keyword1">.∼Δ</span> <span class="free">s'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand2R_def abstract_state_def abstract_state_rev_def vpeq_ipc_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.ext_inject State.update_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> StateR.ext_inject StateR.surjective p1 surjective_pairing <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand4R_notchnew<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s'</span><span class="main">=</span><span class="main">(</span>fst<span class="main">(</span>TEE_InvokeTACommand4R sysconf <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">∼.</span> <span class="free">d</span> <span class="keyword1">.∼Δ</span> <span class="free">s'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand4R_def abstract_state_def abstract_state_rev_def vpeq_ipc_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.ext_inject State.update_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> StateR.ext_inject StateR.surjective p1 surjective_pairing <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TA_InvokeCommandEntryPoint_refine <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>TA_InvokeCommandEntryPoint <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span> <span class="free">opt</span> <span class="free">tid</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>TA_InvokeCommandEntryPointR <span class="free">sc</span> <span class="bound">s</span> <span class="free">opt</span> <span class="free">tid</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_def TA_InvokeCommandEntryPointR_def abstract_state_def abstract_state_rev_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1"><span class="command">lemma</span></span> abs_rev_lemma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⇑</span><span class="main">(</span><span class="free">s</span><span class="main">⇓</span><span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span><span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> mgr_ta_sessions_findSesServTid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span> <span class="bound">ses_id</span> <span class="bound">ses_id_t</span><span class="main">.</span> 
    <span class="bound">ses_id</span> <span class="main">=</span> <span class="bound">ses_id_t</span> <span class="main">∧</span> mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="bound">t</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⟶</span> findSesServTid <span class="bound">s</span> <span class="bound">ses_id</span> <span class="main">=</span> findSesServTid <span class="bound">t</span> <span class="bound">ses_id_t</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"State"</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"State"</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ses_id</span><span class="main">::</span><span class="quoted"><span class="quoted">"SESSION_ID_TYPE"</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ses_id_t</span><span class="main">::</span><span class="quoted"><span class="quoted">"SESSION_ID_TYPE"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaSesList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaSes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findTaSesInMgrBySesId <span class="var">?mgrTaSesList</span> <span class="skolem">ses_id</span>"</span></span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaSesList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaSes_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findTaSesInMgrBySesId <span class="var">?mgrTaSesList_t</span> <span class="skolem">ses_id_t</span>"</span></span>
    
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ses_id</span> <span class="main">=</span> <span class="skolem">ses_id_t</span>"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mgrTaSesList</span> <span class="main">=</span> <span class="var">?mgrTaSesList_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a2<span class="main">)</span>  
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ses_id</span> <span class="main">=</span> <span class="skolem">ses_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mgrTaSes</span> <span class="main">=</span> <span class="var">?mgrTaSes_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b1 b2<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="skolem">s</span> <span class="skolem">ses_id</span> <span class="main">=</span> findSesServTid <span class="skolem">t</span> <span class="skolem">ses_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b3 findSesServTid_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"refinement proof"</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC side"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1R_refine<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEEC_InvokeCommand1 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst <span class="main">(</span>TEEC_InvokeCommand1R <span class="free">sc</span> <span class="bound">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1_def TEEC_InvokeCommand1R_def abstract_state_def abstract_state_rev_def
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2R_refine<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEEC_InvokeCommand2 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst<span class="main">(</span>TEEC_InvokeCommand2R <span class="free">sc</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"fst<span class="main">(</span>TEEC_InvokeCommand2R <span class="free">sc</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⇑</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>TEEC_InvokeCommand2 <span class="free">sc</span> <span class="var">?t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="var">?t</span><span class="main">∧</span>TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="var">?t</span><span class="main">∧</span>exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="var">?t</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a01<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span><span class="main">⇑</span><span class="main">(</span><span class="var">?s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE <span class="free">sc</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE <span class="free">sc</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_def a1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> a0 fstI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="var">?s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_def a1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> TEEC_InvokeCommand2R_def fstI<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> a2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE <span class="free">sc</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2R <span class="free">sc</span> <span class="var">?s_rev_event</span> <span class="var">?ses_id</span> <span class="var">?time_out</span> <span class="var">?cmd_id</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2 <span class="free">sc</span> <span class="var">?t_rev_event</span> <span class="var">?ses_id</span> <span class="var">?time_out</span> <span class="var">?cmd_id</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?s_invoke</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?t_invoke</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Driver_Read <span class="var">?s_state</span> smc_ex_init_read zx_mgr"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_origin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span><span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_state</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span><span class="var">?s_state</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> tee_invokeTACommand_TEEDomain2R_def a5
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_rev_lemma fstI<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_state</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span><span class="var">?s2</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> Driver_Read_not_change_old a6 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">have</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">=</span> <span class="var">?s2</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a4 TEEC_InvokeCommand2R_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="var">?t_state</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> a0 a4 TEEC_InvokeCommand2_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a8 a9
              <span class="keyword1"><span class="command">using</span></span> a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3R_refine<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEEC_InvokeCommand3 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst<span class="main">(</span>TEEC_InvokeCommand3R <span class="free">sc</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>TEEC_InvokeCommand3R <span class="free">sc</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>TEEC_InvokeCommand3 <span class="free">sc</span> <span class="var">?t</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="var">?t</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="var">?t</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="var">?t</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState_t</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList_t</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR <span class="free">sc</span> <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPoint <span class="free">sc</span> <span class="var">?t_rev_event</span> <span class="var">?cmd_id_t</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?s_invoke</span><span class="main">)</span> <span class="var">?server_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_MgrPostOps <span class="var">?t_invoke</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_rev_event</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_error_t</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_postOps</span><span class="main">)</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_postOps</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_success_t</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="var">?t</span> <span class="main">∧</span> TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="var">?t</span> <span class="main">∧</span> exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">have</span></span> a00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="var">?exec_t</span> <span class="main">∧</span> <span class="var">?p</span> <span class="main">=</span> <span class="var">?p_t</span> <span class="main">∧</span> <span class="var">?ses_id</span> <span class="main">=</span> <span class="var">?ses_id_t</span> <span class="main">∧</span> <span class="var">?time_out</span> <span class="main">=</span> <span class="var">?time_out_t</span> 
            <span class="main">∧</span> <span class="var">?cmd_id</span> <span class="main">=</span> <span class="var">?cmd_id_t</span> <span class="main">∧</span> <span class="var">?in_params</span> <span class="main">=</span> <span class="var">?in_params_t</span> <span class="main">∧</span> <span class="var">?out_params</span> <span class="main">=</span> <span class="var">?out_params_t</span>
            <span class="main">∧</span> <span class="var">?sesID</span> <span class="main">=</span> <span class="var">?sesID_t</span> <span class="main">∧</span> <span class="var">?serverID</span> <span class="main">=</span> <span class="var">?serverID_t</span> <span class="main">∧</span> <span class="var">?server_tid</span> <span class="main">=</span> <span class="var">?server_tid_t</span> 
            <span class="main">∧</span> <span class="var">?isSessIdInSessList</span> <span class="main">=</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">∧</span> <span class="var">?curServSessList</span> <span class="main">=</span> <span class="var">?curServSessList_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span><span class="var">?s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def True a1 a0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> eq_fst_iff nintf_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_def True a1 a0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> eq_fst_iff nintf_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="var">?t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a0 a4<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> a5_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> a5 a0 a00  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">=</span> <span class="var">?s_error_ret</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_def a5 a4 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="var">?t_error_ret</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def a5 a4 a6 a0 a00 a4_1 a5_1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a5
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">have</span></span> a8_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span> <span class="main">=</span> TA_InvokeCommandEntryPoint <span class="free">sc</span> <span class="var">?t_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_invoke</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPointR_def TA_InvokeCommandEntryPoint_def a8 a8_0 a00 TA_InvokeCommandEntryPoint_refine
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_postOps</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_postOps</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a9 abs_rev_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_error_ret</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_error_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a00 a8 abs_rev_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_error_ret</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_error_ret</span> <span class="main">=</span> <span class="var">?s'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> a11 a12 a13
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3 <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3 <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a0 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
        <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_success_ret</span> <span class="main">=</span> <span class="var">?s'</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_def d1 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_success_ret</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def d2 a00
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_rev_event</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">have</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_invoke</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPointR_def TA_InvokeCommandEntryPoint_def
          <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_refine a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_success_ret</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_success_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a00 a9 abs_rev_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> d3 d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4R_refine<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEEC_InvokeCommand4 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst<span class="main">(</span>TEEC_InvokeCommand4R <span class="free">sc</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"fst<span class="main">(</span>TEEC_InvokeCommand4R <span class="free">sc</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⇑</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>TEEC_InvokeCommand4 <span class="free">sc</span> <span class="var">?t</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?teec_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param12 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?teec_ret_code_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param12 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tee_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param13 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tee_ret_code_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param13 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_driver_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>Driver_Write_smc <span class="var">?s_rev_event</span> zx_mgr ZX_OKr smc_ex_init2<span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span> 
          param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
          param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12 <span class="main">=</span> <span class="var">?teec_ret_code</span><span class="main">,</span> param13 <span class="main">=</span> <span class="var">?tee_ret_code</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_call_closeSession_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span> 
          param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
          param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12 <span class="main">=</span> <span class="var">?teec_ret_code_t</span><span class="main">,</span> param13 <span class="main">=</span> <span class="var">?tee_ret_code_t</span><span class="main">⦈</span>"</span></span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_call_closeSession</span><span class="main">,</span> TEEC_CS2<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_rev_event</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_call_closeSession_t</span><span class="main">,</span> TEEC_CS2<span class="main">)</span>"</span></span>
        
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_driver_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>Driver_Write_smc <span class="var">?s_call_closeSession</span> zx_mgr ZX_ERR_INTERNALr smc_ex_init<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="var">?t</span> <span class="main">∧</span> TEE_state <span class="skolem">s</span> <span class="main">=</span> TEE_state <span class="var">?t</span> <span class="main">∧</span> exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> current <span class="skolem">s</span> <span class="main">=</span> current <span class="var">?t</span> <span class="main">∧</span> <span class="var">?teec_ret_code</span> <span class="main">=</span> <span class="var">?teec_ret_code_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a01<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span><span class="main">⇑</span><span class="main">(</span><span class="var">?s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE <span class="free">sc</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE <span class="free">sc</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="var">?s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4R_def a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE <span class="free">sc</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="var">?t</span> <span class="main">≠</span> TEE <span class="free">sc</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> False a00 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_call_closeSession</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_call_closeSession</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a5 abs_rev_lemma
          <span class="keyword1"><span class="command">using</span></span> a00 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⇑</span><span class="var">?s_call_closeSession</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⇑</span><span class="var">?s_driver_error</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Driver_Write_smc_not_change_old Driver_Write_smc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⇑</span><span class="var">?s_driver_success</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Driver_Write_smc_not_change_old Driver_Write_smc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> b1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code_t</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">=</span> <span class="var">?s_driver_error</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4R_def a4 b1
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="var">?t_call_closeSession</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def b1 b2 a4 a0 a00 a4_1 b1_1
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b2 b3
                <span class="keyword1"><span class="command">using</span></span> a6 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?teec_ret_code_t</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="var">?t_rev_event</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> b5 TEEC_InvokeCommand4_def a4_1
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">=</span> <span class="var">?s_driver_success</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> b5 TEEC_InvokeCommand4R_def a4 TEEC_OpenSession4_def abstract_state_def abstract_state_rev_def Driver_Write_smc_def
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 b7 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a5 a8<span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">}</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEE side"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand1R_refine<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEE_InvokeTACommand1 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span> <span class="free">memBlock_memRef</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst <span class="main">(</span>TEE_InvokeTACommand1R <span class="free">sc</span> <span class="bound">s</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand1R_def TEE_InvokeTACommand1_def abstract_state_def abstract_state_rev_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
    State.select_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.surjective 
    State.update_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
    State.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fstI old.unit.exhaust<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand2R_refine<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEE_InvokeTACommand2 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst <span class="main">(</span>TEE_InvokeTACommand2R <span class="free">sc</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand2_def TEE_InvokeTACommand2R_def abstract_state_def abstract_state_rev_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_rev_lemma fstI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand3R_refine<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEE_InvokeTACommand3 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst<span class="main">(</span>TEE_InvokeTACommand3R <span class="free">sc</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>TEE_InvokeTACommand3R <span class="free">sc</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⇑</span><span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>TEE_InvokeTACommand3 <span class="free">sc</span> <span class="var">?t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="var">?t</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="var">?t</span> <span class="var">?sesID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="var">?t</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList_t</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR <span class="free">sc</span> <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPoint <span class="free">sc</span> <span class="var">?t_rev_event</span> <span class="var">?cmd_id_t</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?s_invoke</span><span class="main">)</span> <span class="var">?server_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_MgrPostOps <span class="var">?t_invoke</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_ERROR_BAD_PARAMETERS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_ERROR_BAD_PARAMETERS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_rev_event</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_error_t</span><span class="main">,</span> TEE_IC4<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_SUCCESS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_SUCCESS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_postOps</span><span class="main">)</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_postOps</span> <span class="main">(</span>TEE <span class="free">sc</span><span class="main">)</span> <span class="main">(</span><span class="var">?param_success_t</span><span class="main">,</span> TEE_IC4<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="var">?t</span> <span class="main">∧</span> TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="var">?t</span> <span class="main">∧</span> exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a00<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="var">?exec_t</span> <span class="main">∧</span> <span class="var">?p</span> <span class="main">=</span> <span class="var">?p_t</span> <span class="main">∧</span> <span class="var">?ses_id</span> <span class="main">=</span> <span class="var">?ses_id_t</span> <span class="main">∧</span> <span class="var">?time_out</span> <span class="main">=</span> <span class="var">?time_out_t</span> 
            <span class="main">∧</span> <span class="var">?cmd_id</span> <span class="main">=</span> <span class="var">?cmd_id_t</span> <span class="main">∧</span> <span class="var">?in_params</span> <span class="main">=</span> <span class="var">?in_params_t</span> <span class="main">∧</span> <span class="var">?out_params</span> <span class="main">=</span> <span class="var">?out_params_t</span>
            <span class="main">∧</span> <span class="var">?sesID</span> <span class="main">=</span> <span class="var">?sesID_t</span> <span class="main">∧</span> <span class="var">?serverID</span> <span class="main">=</span> <span class="var">?serverID_t</span> <span class="main">∧</span> <span class="var">?server_tid</span> <span class="main">=</span> <span class="var">?server_tid_t</span> 
            <span class="main">∧</span> <span class="var">?isSessIdInSessList</span> <span class="main">=</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">∧</span> <span class="var">?curServSessList</span> <span class="main">=</span> <span class="var">?curServSessList_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span><span class="var">?s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
                <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
                <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> a1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> 
                <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a0 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3_def True a1 a0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> eq_fst_iff nintf_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_def True a1 a0 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> eq_fst_iff nintf_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
                <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> 
                <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> a5_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> a5 a0 a00  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s'</span> <span class="main">=</span> <span class="var">?s_error_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_def a5 a4 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t'</span> <span class="main">=</span> <span class="var">?t_error_ret</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3_def a5 a4 a6 a0 a00 a4_1 a5_1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a5
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> a8_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span> <span class="main">=</span> TA_InvokeCommandEntryPoint <span class="free">sc</span> <span class="var">?t_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_invoke</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPointR_def TA_InvokeCommandEntryPoint_def a8 a8_0 a00 TA_InvokeCommandEntryPoint_refine
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_postOps</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_postOps</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a9 abs_rev_lemma
          <span class="keyword1"><span class="command">using</span></span> a00 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_error_ret</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_error_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a00 a8 abs_rev_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_error_ret</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_error_ret</span> <span class="main">=</span> <span class="var">?s'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> a11 a12 a13
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3 <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> TEE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">=</span> REE <span class="free">sc</span> <span class="main">∨</span> current <span class="var">?t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="var">?t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3 <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a0 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
        <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_success_ret</span> <span class="main">=</span> <span class="var">?s'</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_def d1 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_success_ret</span> <span class="main">=</span> <span class="var">?t'</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3_def d2 a00
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_rev_event</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">have</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_invoke</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPointR_def TA_InvokeCommandEntryPoint_def
          <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_refine a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_success_ret</span> <span class="main">=</span> <span class="main">⇑</span><span class="var">?s_success_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a00 a9 abs_rev_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> d3 d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand4R_refine<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> fst <span class="main">(</span>TEE_InvokeTACommand4 <span class="free">sc</span> <span class="main">(</span><span class="main">⇑</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⇑</span><span class="main">(</span>fst<span class="main">(</span>TEE_InvokeTACommand4R <span class="free">sc</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand4_def TEE_InvokeTACommand4R_def abstract_state_def abstract_state_rev_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_rev_lemma fstI<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"security proof"</span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC side"</span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand1R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1R_notchnew<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s'</span><span class="main">=</span><span class="main">(</span>fst <span class="main">(</span>TEEC_InvokeCommand1R <span class="free">sc</span> <span class="free">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">∼.</span> <span class="free">d</span> <span class="keyword1">.∼Δ</span> <span class="free">s'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1R_def abstract_state_def abstract_state_rev_def vpeq_ipc_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.ext_inject State.update_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 
  State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> StateR.ext_inject StateR.surjective p1 surjective_pairing <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1R_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand1R sysconf <span class="skolem">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a3 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1R_notchnew b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand1R sysconf <span class="skolem">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a7 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand1R sysconf <span class="skolem">t</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a8 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b2 TEEC_InvokeCommand1R_notchnew a3 vpeqR_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> vpeq_ipc_symmetric_lemma vpeq_ipc_transitive_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> prod.inject<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand2R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2R_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2R sysconf <span class="var">?s_rev_event</span> <span class="var">?ses_id</span> <span class="var">?time_out</span> <span class="var">?cmd_id</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?s_invoke</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Driver_Read <span class="var">?s_state</span> smc_ex_init_read zx_mgr"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_origin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_eventR <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_InvokeCommand2R sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  p1 exec_eventR_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 nintf_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">=</span>  <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def
      <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2R_def a41
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> a5 a7 eq_fst_iff nintf_neq<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> vpeq_ipc_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tee_no_ree vpeq_ipc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>REE sysconf"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="var">?s_rev_event</span> <span class="main">=</span>TEE_state <span class="skolem">s</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_state</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a6 a7 b1 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s2</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_state</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a6 a7 b1 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> a6 a7 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> b9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False ins_no_intf_tee interference1_def vpeq_ipc_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2R sysconf <span class="var">?s_rev_event</span> <span class="var">?ses_id</span> <span class="var">?time_out</span> <span class="var">?cmd_id</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?s_invoke</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Driver_Read <span class="var">?s_state</span> smc_ex_init_read zx_mgr"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_origin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2R sysconf <span class="var">?t_rev_event</span> <span class="var">?ses_id_t</span> <span class="var">?time_out_t</span> <span class="var">?cmd_id_t</span> <span class="var">?in_params_t</span> <span class="var">?out_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?t_invoke</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Driver_Read <span class="var">?t_state</span> smc_ex_init_read zx_mgr"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_origin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="var">?t_invoke</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="skolem">t</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="var">?exec_t</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 b1 TEEC_InvokeCommand2R_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 b2 TEEC_InvokeCommand2R_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> a31 b3 prod.collapse prod.inject<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> a3 c2 vpeqR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> c4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> b3 b4 c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TEE sysconf <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TEE_def c4
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TEE sysconf <span class="skolem">d</span> <span class="main">=</span> True"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True is_TEE_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_rev_event</span> <span class="skolem">d</span> <span class="var">?t_rev_event</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> a3 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_state</span> <span class="skolem">d</span> <span class="var">?t_state</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> d1 tee_invokeTACommand_TEEDomain2R_notchnew 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> vpeq_ipc_symmetric_lemma vpeq_ipc_transitive_lemma<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s2</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> Driver_Read_def d2 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s2</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> c4 TEEC_InvokeCommand2R_def b1 fst_conv 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> c4_1 TEEC_InvokeCommand2R_def b2 fst_conv
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> d3 d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">using</span></span> is_TEE_def vpeq_ipc_def c7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> is_TA_def False c7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">have</span></span> c9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
                <span class="keyword1"><span class="command">using</span></span> c7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand3R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3R_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR sysconf <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?s_invoke</span><span class="main">)</span> <span class="var">?server_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_postOps</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_eventR <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_InvokeCommand3R sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  p1 exec_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand3R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 nintf_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">=</span>  <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def
      <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_def a41 b0 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> eq_fst_iff nintf_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> vpeq_ipc_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_error_ret</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_def b1 b2 a41
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> tee_no_ree vpeq_ipc_def
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="var">?s_rev_event</span> <span class="main">=</span>TEE_state <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_invoke</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TA_InvokeCommandEntryPointR_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_invoke</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_postOps</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TEE_MgrPostOps_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_postOps</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_error_ret</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def setCurDomainAndEvent_def c2 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c4 b3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False b4 is_TA_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> b9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3 <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_success_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_def d1 a41
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> tee_no_ree vpeq_ipc_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="var">?s_rev_event</span> <span class="main">=</span> TEE_state <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e1_0<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="skolem">s</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_rev_event</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_invoke</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TA_InvokeCommandEntryPointR_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_invoke</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_postOps</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TEE_MgrPostOps_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_postOps</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_success_ret</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def setCurDomainAndEvent_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_success_ret</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d2<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e1 e1_0 e2 e3 e4 e5 vpeq_ipc_def
                  <span class="keyword1"><span class="command">using</span></span> d5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span> <span class="quoted"><span class="quoted">"TAs_state <span class="skolem">s</span> <span class="main">=</span>TAs_state <span class="skolem">t</span>  "</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR sysconf <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?s_invoke</span><span class="main">)</span> <span class="var">?server_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_postOps</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">t</span><span class="main">)</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">t</span><span class="main">)</span> <span class="var">?sesID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState_t</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList_t</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR sysconf <span class="var">?t_rev_event</span> <span class="var">?cmd_id_t</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?t_invoke</span><span class="main">)</span> <span class="var">?server_tid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error_t</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?t_postOps</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success_t</span><span class="main">,</span> TEEC_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
   
    
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand3R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand3R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 vpeq1_def a51 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sesID</span> <span class="main">=</span> <span class="var">?sesID_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?serverID</span> <span class="main">=</span> <span class="var">?serverID_t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mgr_ta_sessions_findSesServTid a14 a51 abstract_state_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> <span class="var">?ses_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cmd_id</span> <span class="main">=</span> <span class="var">?cmd_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSessIdInSessList</span> <span class="main">=</span> <span class="var">?isSessIdInSessList_t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> isSessIdInTaInsSessList_def a52
      <span class="keyword1"><span class="command">using</span></span> a15 a31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst<span class="main">(</span>TEEC_InvokeCommand3R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst<span class="main">(</span>TEEC_InvokeCommand3R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="var">?exec_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span> 
      
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> True<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> c1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a15 b3 b4 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 b1 TEEC_InvokeCommand3R_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> c1 b2 b3 b4 TEEC_InvokeCommand3R_def a31 c1_1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> a3 c2 vpeqR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c4<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> a5 c5 domain_of_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> a5 c5 <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def c6
              <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span>True"</span></span>
              <span class="keyword1"><span class="command">using</span></span> c6 is_TEE_def vpeq_ipc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand4R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4R_integrity<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="main">(</span><span class="var">?exec</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_InvokeCommand4R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a3 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4R_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b0 domain_of_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b0 domain_of_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>  
          <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 a2 interference1_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> vpeq_transitive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?teec_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param12 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tee_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param13 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_driver_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>Driver_Write_smc <span class="var">?s_rev_event</span> zx_mgr ZX_OKr smc_ex_init2<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span> 
          param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
          param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span><span class="var">?teec_ret_code</span><span class="main">,</span> param13<span class="main">=</span><span class="var">?tee_ret_code</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_call_closeSession</span><span class="main">,</span> TEEC_CS2<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_driver_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>Driver_Write_smc <span class="var">?s_call_closeSession</span> zx_mgr ZX_ERR_INTERNALr smc_ex_init<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?teec_ret_code_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param12 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tee_ret_code_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param13 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_driver_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>Driver_Write_smc <span class="var">?t_rev_event</span> zx_mgr ZX_OKr smc_ex_init2<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_call_closeSession_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span> 
          param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
          param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span><span class="var">?teec_ret_code_t</span><span class="main">,</span> param13<span class="main">=</span><span class="var">?tee_ret_code_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_call_closeSession_t</span><span class="main">,</span> TEEC_CS2<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_driver_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>Driver_Write_smc <span class="var">?t_call_closeSession</span> zx_mgr ZX_ERR_INTERNALr smc_ex_init<span class="main">)</span>"</span></span>  
    
    <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span> current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span> <span class="main">∧</span> <span class="var">?teec_ret_code</span> <span class="main">=</span> <span class="var">?teec_ret_code_t</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a31 a4 domain_of_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst<span class="main">(</span>TEEC_InvokeCommand4R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_InvokeCommand4R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="skolem">t</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">using</span></span> a0 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 b1 TEEC_InvokeCommand4R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 b2 TEEC_InvokeCommand4R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 c3 vpeqR_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> a0 c5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_rev_event</span> <span class="skolem">d</span> <span class="var">?t_rev_event</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_driver_success</span> <span class="skolem">d</span> <span class="var">?t_driver_success</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> d1 a3 Driver_Write_smc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_call_closeSession</span> <span class="skolem">d</span> <span class="var">?t_call_closeSession</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> d2 a3 setCurDomainAndEvent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_driver_error</span> <span class="skolem">d</span> <span class="var">?t_driver_error</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> d3 Driver_Write_smc_def a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code_t</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a0 c7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">have</span></span> c9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_driver_error</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> c7 c5 b1 TEEC_InvokeCommand4R_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>  
            <span class="keyword1"><span class="command">have</span></span> c10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_driver_error</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> c8 c6 b2 TEEC_InvokeCommand4R_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>  
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> c9 c10 d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> c11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> c11_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?teec_ret_code_t</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a0 c11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword1"><span class="command">have</span></span> c10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_driver_success</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> b1 c11 c5 TEEC_InvokeCommand4R_def 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> c11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_driver_success</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> b2 c11_1 c6 TEEC_InvokeCommand4R_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c10 c11 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEE side"</span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEE_InvokeTACommand1R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand1R_integrity<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND1 <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="skolem">s</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEE_InvokeTACommand1R sysconf <span class="skolem">s</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a3 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand1R_notchnew b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand1R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND1 <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand1R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand1R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND1 <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand1R sysconf <span class="skolem">s</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a7 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand1R sysconf <span class="skolem">t</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a8 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b2 TEE_InvokeTACommand1R_notchnew a3 vpeqR_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> vpeq_ipc_symmetric_lemma vpeq_ipc_transitive_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> prod.inject<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand1R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND1 <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand1R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEE_InvokeTACommand2R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand2R_integrity<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND2<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="skolem">s</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand2R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a3 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand2R_notchnew b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand2R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND2<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand2R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand2R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand2R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a7 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand2R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a8 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b2 TEE_InvokeTACommand2R_notchnew a3 vpeqR_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> vpeq_ipc_symmetric_lemma vpeq_ipc_transitive_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> prod.inject<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand2R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND2<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand2R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEE_InvokeTACommand3R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand3R_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR sysconf <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?s_invoke</span><span class="main">)</span> <span class="var">?server_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_ERROR_BAD_PARAMETERS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_SUCCESS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_postOps</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_eventR <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEE_InvokeTACommand3R sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  p1 exec_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEE_InvokeTACommand3R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 nintf_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">=</span>  <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def
      <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_def a41 b0 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> eq_fst_iff nintf_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> vpeq_ipc_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_error_ret</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_def b1 b2 a41
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> tee_no_ree vpeq_ipc_def
              <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="var">?s_rev_event</span> <span class="main">=</span>TEE_state <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_invoke</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TA_InvokeCommandEntryPointR_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_invoke</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_postOps</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TEE_MgrPostOps_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_postOps</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_error_ret</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def setCurDomainAndEvent_def c2 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c4 b3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False b4 is_TA_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> b9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3 <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_success_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_def d1 a41
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> tee_no_ree vpeq_ipc_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="var">?s_rev_event</span> <span class="main">=</span> TEE_state <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e1_0<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="skolem">s</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_rev_event</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_invoke</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TA_InvokeCommandEntryPointR_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_invoke</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_postOps</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def TEE_MgrPostOps_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_ipc <span class="var">?s_postOps</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="var">?s_success_ret</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> abstract_state_def abstract_state_rev_def 
                        vpeq_ipc_def setCurDomainAndEvent_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_success_ret</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d2<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e1 e1_0 e2 e3 e4 e5 vpeq_ipc_def
                  <span class="keyword1"><span class="command">using</span></span> d5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand3R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND3<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand3R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span> <span class="quoted"><span class="quoted">"TAs_state <span class="skolem">s</span> <span class="main">=</span>TAs_state <span class="skolem">t</span>  "</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR sysconf <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?s_invoke</span><span class="main">)</span> <span class="var">?server_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_ERROR_BAD_PARAMETERS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_SUCCESS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?s_postOps</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">t</span><span class="main">)</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="main">(</span><span class="main">⇑</span><span class="skolem">t</span><span class="main">)</span> <span class="var">?sesID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="main">(</span><span class="main">⇑</span><span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState_t</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList_t</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPointR sysconf <span class="var">?t_rev_event</span> <span class="var">?cmd_id_t</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_invoke</span><span class="main">⇓</span><span class="main">(</span>TEE_MgrPostOps <span class="main">(</span><span class="main">⇑</span><span class="var">?t_invoke</span><span class="main">)</span> <span class="var">?server_tid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_ERROR_BAD_PARAMETERS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error_t</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>Some TEE_SUCCESS<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span><span class="main">⇓</span><span class="main">(</span>setCurDomainAndEvent <span class="main">(</span><span class="main">⇑</span><span class="var">?t_postOps</span><span class="main">)</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success_t</span><span class="main">,</span> TEE_IC4<span class="main">)</span><span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEE_InvokeTACommand3R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEE_InvokeTACommand3R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 vpeq1_def a51 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sesID</span> <span class="main">=</span> <span class="var">?sesID_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?serverID</span> <span class="main">=</span> <span class="var">?serverID_t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mgr_ta_sessions_findSesServTid a14 a51 abstract_state_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> a16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> <span class="var">?ses_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cmd_id</span> <span class="main">=</span> <span class="var">?cmd_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSessIdInSessList</span> <span class="main">=</span> <span class="var">?isSessIdInSessList_t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> isSessIdInTaInsSessList_def a52
      <span class="keyword1"><span class="command">using</span></span> a15 a31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst<span class="main">(</span>TEE_InvokeTACommand3R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst<span class="main">(</span>TEE_InvokeTACommand3R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_eventR_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="var">?exec_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a31<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> True<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> c1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a15 b3 b4 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 b1 TEE_InvokeTACommand3R_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> c1 b2 b3 b4 TEE_InvokeTACommand3R_def a31 c1_1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> a3 c2 vpeqR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> 
          <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEE_IC3<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c4<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> a5 c5 domain_of_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> a5 c5 <span class="keyword1"><span class="command">using</span></span> domain_of_eventR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def c6
              <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span>True"</span></span>
              <span class="keyword1"><span class="command">using</span></span> c6 is_TEE_def vpeq_ipc_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand3R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND3<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand3R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEE_InvokeTACommand4R"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand4R_integrity<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND4<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="skolem">s</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand4R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a3 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand4R_notchnew b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand4R_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND4<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand4R_integrity integrity_new_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand4R_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND4<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_primeR <span class="bound">s</span><span class="main">=</span>get_exec_primeR <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼.</span> <span class="bound">d</span> <span class="keyword1">.∼Δ</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼.</span><span class="skolem">d</span><span class="main">.∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_eventR <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼.</span> <span class="main">(</span>the <span class="main">(</span>domain_of_eventR <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">.∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_eventR <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand4R sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a7 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst <span class="main">(</span>TEE_InvokeTACommand4R sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> exec_eventR_def a8 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∼.</span> <span class="skolem">d</span> <span class="keyword1">.∼Δ</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b2 TEE_InvokeTACommand4R_notchnew a3 vpeqR_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> vpeq_ipc_symmetric_lemma vpeq_ipc_transitive_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> prod.inject<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEE_InvokeTACommand4R_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_new_e <span class="main">(</span>hyperc' <span class="main">(</span>TEE_INVOKETACOMMAND4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEE_InvokeTACommand4R_weak_confidentiality weak_confidentiality_new_e_def get_exec_primeR_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body></html>