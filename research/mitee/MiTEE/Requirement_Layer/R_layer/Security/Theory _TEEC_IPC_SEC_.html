<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0160)http://localhost:60012/e878375a-7f83-431b-a556-7f03b63e3c91/preview?%2FUsers%2Fxywang%2FDesktop%2Fmi-tee%2FMiTEE_Requirement_Layer%2FSecurity%2FTEEC_IPC_SEC.thy -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/e878375a-7f83-431b-a556-7f03b63e3c91/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.contents { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }


/* formal entities */

.entity_def {
  color: inherit;
  text-decoration: inherit;
}

.entity_def:hover {
  color: inherit;
  text-decoration: inherit;
  background-color: rgba(50,50,50,20%);
}

.entity_ref {
  color: inherit;
  text-decoration: inherit;
  border: 0.5px solid rgba(0,0,0,0);
}

.entity_ref:hover {
  color: inherit;
  text-decoration: inherit;
  background-color: rgba(50,50,50,20%);
  border: 0.5px solid black;
}
</style><title>Theory "TEEC_IPC_SEC"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> TEEC_IPC_SEC
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"../MiTEE_Instantiation"</span> <span class="quoted">"./TEEC_SEC_Common"</span> <span class="quoted">"./TEE_SEC_Common"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_OpenSession proof"</span></span></span> 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"Integrity"</span></span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="document"><span class="plain_text">"integrity ≡ ∀ a d s s'. reachable0 s ∧ ((the (domain s a)) ∖↝ d) ∧ (s, s') ∈ trans a  ⟶ (s ∼ d ∼ s')"</span></span></span>



<span class="keyword1"><span class="command">lemma</span></span> TEEC_InitializeContext_integrity<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INITIALIZECONTEXT <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
  <span class="comment1">(*
  have a6: "(the (domain_of_event s a)) = REE sysconf"  
        using p1 by fastforce
*)</span> 
 <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="bound">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  p1 exec_event_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span>REE sysconf"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span>fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> REE sysconf"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tctext</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> a3 a4 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tn</span><span class="main">≠</span>TEE_name sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
              <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span> "</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def REE_AddContext_def 
                   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> b21<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tctext</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> a3 a4 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tn</span><span class="main">≠</span>TEE_name sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
              <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span> "</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def REE_AddContext_def 
                   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 b21 vpeq_TEE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b3 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a6 a2 nintf_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def c1
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">{</span></span>
       <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tctext</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tn</span><span class="main">≠</span>TEE_name sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
              <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span> "</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def REE_AddContext_def 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">}</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InitializeContext_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INITIALIZECONTEXT <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_integrity integrity_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
   



<span class="keyword1"><span class="command">lemma</span></span> TEEC_FinalizeContext_integrity<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_FINALIZECONTEXT <span class="free">tctext</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span>TEEC_FinalizeContext sysconf <span class="bound">s</span> <span class="free">tctext</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">≠</span>REE sysconf<span class="main">∨</span>exec_prime <span class="skolem">s</span> <span class="main">≠</span><span class="main">[]</span><span class="main">∨</span><span class="free">tctext</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span>TEEC_FinalizeContext sysconf <span class="skolem">s</span> <span class="free">tctext</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 a4 case_prodD mem_Collect_eq singletonD vpeq_reflexive_lemma<span class="main">)</span> 
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>REE sysconf<span class="main">∧</span>exec_prime <span class="skolem">s</span> <span class="main">=</span><span class="main">[]</span><span class="main">∧</span><span class="free">tctext</span> <span class="main">≠</span> None"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>TEEC_FinalizeContext sysconf <span class="skolem">s</span> <span class="free">tctext</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> exec_event_def 
            <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="skolem">s'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca_fd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ca_fd <span class="main">(</span>the <span class="free">tctext</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?IDlst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_getDriverSessionByFd <span class="skolem">s</span> <span class="var">?ca_fd</span>"</span></span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl updateListForTEECCS <span class="skolem">s</span> <span class="var">?IDlst</span>"</span></span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_RemoveContext <span class="var">?s1</span> <span class="var">?ca_fd</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="var">?s1</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> foldl_induct_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span> <span class="main">=</span> <span class="var">?s1</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">⦇</span>
                             tee_ctx_list <span class="main">:=</span> remove1 <span class="main">(</span>getTEEcontextByFd <span class="var">?s1</span> <span class="var">?ca_fd</span><span class="main">)</span> <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span>
                                                              <span class="main">⦈</span>
                                                <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> REE_RemoveContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="var">?s2</span> <span class="main">=</span>TEE_state <span class="var">?s1</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1 c3 b2 
                  <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">}</span></span>   
           <span class="keyword1"><span class="command">qed</span></span>
           <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TEE_def <span class="keyword1"><span class="command">using</span></span> b3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 domain_of_event_def
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b1 nintf_neq option.sel<span class="main">)</span>
              <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="skolem">s'</span>"</span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca_fd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ca_fd <span class="main">(</span>the <span class="free">tctext</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?IDlst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_getDriverSessionByFd <span class="skolem">s</span> <span class="var">?ca_fd</span>"</span></span>
                  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl updateListForTEECCS <span class="skolem">s</span> <span class="var">?IDlst</span>"</span></span>
                  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_RemoveContext <span class="var">?s1</span> <span class="var">?ca_fd</span>"</span></span>
                  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="var">?s1</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> foldl_induct_rule <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span> <span class="main">=</span> <span class="var">?s1</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">⦇</span>
                                 tee_ctx_list <span class="main">:=</span> remove1 <span class="main">(</span>getTEEcontextByFd <span class="var">?s1</span> <span class="var">?ca_fd</span><span class="main">)</span> <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span>
                                                                  <span class="main">⦈</span>
                                                    <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> REE_RemoveContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="var">?s2</span> <span class="main">=</span>TEE_state <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1 c3 b2 
                    <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d3 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">qed</span></span>
           <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_FinalizeContext_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_FINALIZECONTEXT <span class="free">tctext</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_integrity integrity_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession1_integrity<span class="main">:</span>
  
 <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION1 <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">uuid</span> <span class="free">cm</span> <span class="free">cd</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst<span class="main">(</span>TEEC_OpenSession1 sysconf <span class="bound">s</span> <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">uuid</span> <span class="free">cm</span> <span class="free">cd</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession1 sysconf <span class="skolem">s</span> <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">uuid</span> <span class="free">cm</span> <span class="free">cd</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def a4 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">≠</span>REE sysconf<span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span><span class="main">∨</span><span class="free">ctx1</span> <span class="main">=</span> None<span class="main">∨</span> <span class="free">ses1</span> <span class="main">=</span> None<span class="main">∨</span>TEEC_pre_process_operation <span class="free">opt</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession1 sysconf <span class="skolem">s</span> <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">uuid</span> <span class="free">cm</span> <span class="free">cd</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession1_def TEEC_pre_process_operation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> exec_prime <span class="skolem">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">ctx1</span> <span class="main">=</span> None 
            <span class="main">∨</span> <span class="free">ses1</span> <span class="main">=</span> None <span class="main">∨</span> TEEC_pre_process_operation <span class="free">opt</span> <span class="main">≠</span> TEEC_SUCCESS<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> vpeq1_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="skolem">s'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="free">uuid</span><span class="main">,</span>param2<span class="main">=</span>None<span class="main">,</span>param3<span class="main">=</span><span class="free">opt</span><span class="main">,</span>
                         param4<span class="main">=</span>Some <span class="var">?cli</span><span class="main">,</span>param5<span class="main">=</span><span class="free">ctx1</span><span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
                            <span class="main">,</span>param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> a6 TEEC_OpenSession1_def  b0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span>TEE_state <span class="skolem">s'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="free">uuid</span><span class="main">,</span>param2<span class="main">=</span>None<span class="main">,</span>param3<span class="main">=</span><span class="free">opt</span><span class="main">,</span>
                             param4<span class="main">=</span>Some <span class="var">?cli</span><span class="main">,</span>param5<span class="main">=</span><span class="free">ctx1</span><span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
                             <span class="main">,</span>param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
                 <span class="keyword1"><span class="command">using</span></span> a6 TEEC_OpenSession1_def b0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b8 b7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession1_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION1 <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">uuid</span> <span class="free">cm</span> <span class="free">cd</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession1_integrity integrity_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> non_interference1_def non_interference_def<span class="main">)</span>




<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession2_integrity<span class="main">:</span>
  
 <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION2<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="main">(</span><span class="var">?exec</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?opt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>param3 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uuid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param1 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param4 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ctx1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param5 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst<span class="main">(</span>TEEC_OpenSession2 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def a4 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">≠</span>TEE sysconf<span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span>TEEC_OP2"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> exec_prime <span class="skolem">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_OP2<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="var">?s0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?s0</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b2 
      <span class="keyword1"><span class="command">using</span></span> vpeq_transitive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession2_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION2<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_integrity integrity_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>




<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession3_integrity<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION3 <span class="free">sid</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="main">(</span><span class="var">?exec</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param2 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?opt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>param3 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uuid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param1 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ctx1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param5 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initTAProcess <span class="var">?s0</span> <span class="var">?opt</span> <span class="var">?uuid</span> <span class="var">?ses_id</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ta_ses</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TA_sessions<span class="main">(</span>the<span class="main">(</span><span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?init1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>TA_instance_init<span class="main">(</span>the<span class="main">(</span><span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"TA_OpenSessionEntryPoint sysconf <span class="var">?s1</span> <span class="var">?opt</span> <span class="var">?uuid</span>"</span></span>
<span class="comment1">(*
2023.2.7
  let ?s3 = "MgrPostOperation ?s2 ?uuid"
  let ?s4 = "addREESession ?s3 ?ses_id ?ctx1"
*)</span> 
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="var">?uuid</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="var">?ses_id</span><span class="main">,</span>param3<span class="main">=</span>None<span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>
            param5<span class="main">=</span>None<span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None<span class="main">,</span>param10<span class="main">=</span>None<span class="main">,</span>param11<span class="main">=</span>None<span class="main">,</span>param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s5</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s2</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_OpenSession3 sysconf <span class="bound">s</span> <span class="free">sid</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  p1 exec_event_def
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_OpenSession3 sysconf <span class="skolem">s</span> <span class="free">sid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">≠</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 nintf_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?domain</span> <span class="main">=</span>  <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def
      <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span>"</span></span>

  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span><span class="main">≠</span>TEEC_OP3<span class="main">∨</span><span class="free">sid</span><span class="main">≠</span><span class="var">?ses_id</span><span class="main">∨</span>TEE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span>REE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span>current <span class="skolem">s</span><span class="main">≠</span><span class="var">?uuid</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession3_def a41
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> vpeq_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">≠</span><span class="main">[]</span><span class="main">∧</span>snd <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span> <span class="main">=</span>TEEC_OP3<span class="main">∧</span><span class="free">sid</span><span class="main">=</span><span class="var">?ses_id</span><span class="main">∧</span>TEE sysconf<span class="main">≠</span>current <span class="skolem">s</span><span class="main">∧</span>REE sysconf<span class="main">≠</span>current <span class="skolem">s</span><span class="main">∧</span>current <span class="skolem">s</span><span class="main">=</span><span class="var">?uuid</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span>  <span class="skolem">s'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tee_no_ree vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                          <span class="main">∧</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>  
    <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="var">?s0</span> <span class="main">=</span>REE_state <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="var">?s0</span> <span class="main">=</span>REE_state <span class="var">?s1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span><span class="var">?ta_ses</span><span class="main">)</span><span class="main">∧</span><span class="bound">a</span><span class="main">=</span><span class="var">?ses_id</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">=</span><span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?init1</span> <span class="main">=</span>False"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def TA_CreateEntryPoint_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s1</span> <span class="main">=</span>vpeq_REE <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 vpeq_REE_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="var">?s2</span> <span class="main">=</span> REE_state <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_OpenSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="comment1">(*    have c5:"REE_state ?s3 = REE_state ?s2" using MgrPostOperation_def MgrPostOperation_not_change_REE by blast
    have c6:"ree_total_size(REE_state ?s4) = ree_total_size(REE_state ?s3)
                          ∧driver_mem(REE_state ?s4) = driver_mem(REE_state ?s3)" 
                      using addREESession_def addREESession_not_change_REE_mem by blast
*)</span>
    <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s2</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 c3 c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s5</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_OpenSession3_def a41 fst_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c9<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> c7 c8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c9 vpeq_REE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     
    <span class="keyword1"><span class="command">}</span></span>  <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b3 b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

 
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
<span class="comment1">(*when d is TEE*)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span>  <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>  
    <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="var">?s0</span> <span class="main">=</span>TEE_state <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="var">?s0</span> <span class="main">=</span>TEE_state <span class="var">?s1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span><span class="var">?ta_ses</span><span class="main">)</span><span class="main">∧</span><span class="bound">a</span><span class="main">=</span><span class="var">?ses_id</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">=</span><span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?init1</span> <span class="main">=</span>False"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def TA_CreateEntryPoint_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s1</span> <span class="main">=</span>vpeq_TEE <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 vpeq_TEE_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s2</span> <span class="main">=</span> vpeq_TEE <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_OpenSessionEntryPoint_def OpenSessionEntryPoint_not_change_TEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="comment1">(*    have c5:"tee_memories(TEE_state ?s3 )=tee_memories( TEE_state ?s2)" 
                      using MgrPostOperation_def MgrPostOperation_not_change_TEE_mem by blast
    have c51:"vpeq_TEE ?s3 = vpeq_TEE ?s2" using c5 by fastforce 
    have c6:"tee_memories(TEE_state ?s4) = tee_memories(TEE_state ?s3)" 
                      using addREESession_def addREESession_not_change_TEE by presburger
    have c61:"vpeq_TEE ?s4 = vpeq_TEE ?s3" using c6 by fastforce 
*)</span>    <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s2</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c3 c4  <span class="keyword1"><span class="command">using</span></span> vpeq_TEE_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s'1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"addREESession <span class="main">(</span>MgrPostOperation <span class="main">(</span>TA_OpenSessionEntryPoint sysconf 
                  <span class="main">(</span>initTAProcess <span class="var">?s0</span> <span class="var">?opt</span> <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span> <span class="var">?opt</span> <span class="var">?uuid</span><span class="main">)</span> <span class="var">?uuid</span><span class="main">)</span> <span class="var">?ses_id</span> <span class="var">?ctx1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession3_def 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_OpenSession3_def a41 b1 fst_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c7 c8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 b7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="comment1">(*when d is TA*)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="var">?uuid</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b00<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>current <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>  
    <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="var">?s0</span> <span class="main">=</span>TEE_state <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"TEE_state <span class="var">?s0</span> <span class="main">=</span>TEE_state <span class="var">?s1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span><span class="var">?ta_ses</span><span class="main">)</span><span class="main">∧</span><span class="bound">a</span><span class="main">=</span><span class="var">?ses_id</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">=</span><span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?init1</span> <span class="main">=</span>False"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def TA_CreateEntryPoint_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s1</span> <span class="main">=</span>vpeq_TA <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 vpeq_TA_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s2</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                           <span class="keyword1"><span class="command">using</span></span> TA_OpenSessionEntryPoint_def OpenSessionEntryPoint_not_change_other_TA b00
                           <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="comment1">(*    have c5:"tee_memories(TEE_state ?s3 )=tee_memories( TEE_state ?s2)" 
                      using MgrPostOperation_def MgrPostOperation_not_change_TEE_mem by blast
    have c6:"tee_memories(TEE_state ?s4) = tee_memories(TEE_state ?s3)" 
                      using addREESession_def addREESession_not_change_TEE by presburger
*)</span>    <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s2</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 c3 c4  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s5</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_OpenSession3_def a41 b1 fst_conv<span class="main">)</span>
   
    <span class="keyword1"><span class="command">have</span></span> c9<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> c7 c8 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c9 vpeq_TA_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b9 b10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession3_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION3 <span class="free">sid</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession3_integrity integrity_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="comment1">(*added 2023.1.9*)</span>
<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession4_integrity<span class="main">:</span>
  
 <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION4<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span> 
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="main">(</span><span class="var">?exec</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tid1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>param1 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param2 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param4 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?res</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param12 <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span>  <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst<span class="main">(</span>TEEC_OpenSession4 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">s'</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 ins_no_intf_tee ins_tee_intf_all non_interference1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def a4 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">≠</span>TEE sysconf<span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span>TEEC_OP4"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> exec_prime <span class="skolem">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_OP4<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="var">?s0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?s0</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b2 
      <span class="keyword1"><span class="command">using</span></span> vpeq_transitive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession4_integrity_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION4<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession4_integrity integrity_e_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"Confidentiality"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InitializeContext_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INITIALIZECONTEXT <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span><span class="main">=</span>get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dom</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?new_ree</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_state <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?new_tee_ctx_list</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>ctx_fd <span class="main">=</span> newContextFd <span class="skolem">s</span><span class="main">,</span>reg_mem <span class="main">=</span> False<span class="main">,</span>session_list <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_ctx_list <span class="var">?new_ree</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?new_REE_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?new_ree</span><span class="main">⦇</span>tee_ctx_list <span class="main">:=</span> <span class="var">?new_tee_ctx_list</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?new_ree_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_state <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?new_tee_ctx_list_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>ctx_fd <span class="main">=</span> newContextFd <span class="skolem">t</span><span class="main">,</span>reg_mem <span class="main">=</span> False<span class="main">,</span>session_list <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_ctx_list <span class="var">?new_ree_t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?new_REE_state_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?new_ree_t</span><span class="main">⦇</span>tee_ctx_list <span class="main">:=</span> <span class="var">?new_tee_ctx_list_t</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">s</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> p1 a7 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst <span class="main">(</span>TEEC_InitializeContext sysconf <span class="skolem">t</span> <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(*
      have b3:"the (domain_of_event s a) = REE sysconf" 
        using domain_of_event_def p1  by force 
*)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tctext</span> <span class="main">=</span>None <span class="main">∨</span> <span class="free">tn</span><span class="main">≠</span>TEE_name sysconf <span class="main">∨</span>current <span class="skolem">s</span><span class="main">≠</span>REE sysconf <span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">≠</span><span class="main">[]</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span>current <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4
          <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def p1
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True b1 fstI<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def p1 a4 c0 a31
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True b2 fstI<span class="main">)</span>
          
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 a3
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
           <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> REE sysconf"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> domain_of_event_def p1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
          <span class="keyword1"><span class="command">have</span></span> c00<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span>current <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> b31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">t</span><span class="main">=</span><span class="main">[]</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> False a31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="skolem">s</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="var">?new_REE_state</span><span class="main">⦈</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def False REE_AddContext_def b1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="skolem">t</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="var">?new_REE_state_t</span><span class="main">⦈</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def False REE_AddContext_def b2 b31 c00 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TEE sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True a5 b3 tee_no_ree <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">have</span></span> d21<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True a5 b3 tee_no_ree <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 d21
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_REE sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def REE_AddContext_def c3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def REE_AddContext_def c3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def REE_AddContext_def c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_def REE_AddContext_def c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d3 d4 d5 d6 d7
                    <span class="keyword1"><span class="command">using</span></span> True a3 tee_no_ree <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a5 b3 ins_no_intf_tee is_REE_def is_TA_def<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a5 b3
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False ins_no_intf_tee interference1_def is_REE_def tee_no_ree<span class="main">)</span>
             
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>

<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>

    
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_InitializeContext_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INITIALIZECONTEXT <span class="free">tn</span> <span class="free">tctext</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_InitializeContext_weak_confidentiality weak_confidentiality_e_def get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
    <span class="comment1">(*
    by (smt (verit, ccfv_threshold))
    *)</span>
    
    
    
<span class="keyword1"><span class="command">lemma</span></span> TEEC_FinalizeContext_weak_confidentiality<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_FINALIZECONTEXT <span class="free">tctext</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
    reachable0 <span class="bound">s</span> <span class="main">∧</span>
    reachable0 <span class="bound">t</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>get_exec_prime <span class="bound">s</span><span class="main">=</span>get_exec_prime <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="main">(</span>TEEC_FinalizeContext sysconf <span class="skolem">s</span> <span class="free">tctext</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="main">(</span>TEEC_FinalizeContext sysconf <span class="skolem">t</span> <span class="free">tctext</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tctext</span> <span class="main">=</span>None <span class="main">∨</span>current <span class="skolem">s</span><span class="main">≠</span>REE sysconf <span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">≠</span><span class="main">[]</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span>current <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4
        <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_def p1 b1
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_def p1 a4 a31 b2 c0
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1 c2 a3
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tctext</span><span class="main">≠</span>None<span class="main">∧</span>current <span class="skolem">s</span><span class="main">=</span>REE sysconf <span class="main">∧</span>current <span class="skolem">t</span><span class="main">=</span>REE sysconf
        <span class="main">∧</span> exec_prime <span class="skolem">s</span><span class="main">=</span><span class="main">[]</span><span class="main">∧</span> exec_prime <span class="skolem">t</span><span class="main">=</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 a31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 a5 interference1_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domain_of_event_def ins_no_intf_tee option.sel tee_no_ree<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca_fd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ca_fd <span class="main">(</span>the <span class="free">tctext</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?IDlst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_getDriverSessionByFd <span class="skolem">s</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl updateListForTEECCS <span class="skolem">s</span> <span class="var">?IDlst</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_RemoveContext <span class="var">?s1</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> foldl_induct_rule2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span> <span class="main">=</span> <span class="var">?s1</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">⦇</span>
            tee_ctx_list <span class="main">:=</span> remove1 <span class="main">(</span>getTEEcontextByFd <span class="var">?s1</span> <span class="var">?ca_fd</span><span class="main">)</span> <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⦈</span>
            <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> REE_RemoveContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1 c3 b1 
            <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca_fd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ca_fd <span class="main">(</span>the <span class="free">tctext</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?IDlst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_getDriverSessionByFd <span class="skolem">s</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl updateListForTEECCS <span class="skolem">s</span> <span class="var">?IDlst</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_RemoveContext <span class="var">?s1</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> foldl_induct_rule3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span> <span class="main">=</span> <span class="var">?s1</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">⦇</span>
            tee_ctx_list <span class="main">:=</span> remove1 <span class="main">(</span>getTEEcontextByFd <span class="var">?s1</span> <span class="var">?ca_fd</span><span class="main">)</span> <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⦈</span>
            <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> REE_RemoveContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> c1 c3 b1  TEEC_FinalizeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca_fd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ca_fd <span class="main">(</span>the <span class="free">tctext</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?IDlst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_getDriverSessionByFd <span class="skolem">t</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl updateListForTEECCS <span class="skolem">t</span> <span class="var">?IDlst</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_RemoveContext <span class="var">?s1</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> foldl_induct_rule2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span> <span class="main">=</span> <span class="var">?s1</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">⦇</span>
            tee_ctx_list <span class="main">:=</span> remove1 <span class="main">(</span>getTEEcontextByFd <span class="var">?s1</span> <span class="var">?ca_fd</span><span class="main">)</span> <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⦈</span>
            <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> REE_RemoveContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1 c3 b2 
            <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca_fd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ca_fd <span class="main">(</span>the <span class="free">tctext</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?IDlst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_getDriverSessionByFd <span class="skolem">t</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"foldl updateListForTEECCS <span class="skolem">t</span> <span class="var">?IDlst</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"REE_RemoveContext <span class="var">?s1</span> <span class="var">?ca_fd</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> foldl_induct_rule3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span> <span class="main">=</span> <span class="var">?s1</span><span class="main">⦇</span>REE_state <span class="main">:=</span> <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">⦇</span>
            tee_ctx_list <span class="main">:=</span> remove1 <span class="main">(</span>getTEEcontextByFd <span class="var">?s1</span> <span class="var">?ca_fd</span><span class="main">)</span> <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⦈</span>
            <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> REE_RemoveContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> c1 c3 b2  TEEC_FinalizeContext_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 d3 d4 c5 vpeq_REE_def True a3 c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 a5 interference1_def domain_of_event_def tee_no_ree <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">lemma</span></span> TEEC_FinalizeContext_weak_confidentiality_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_FINALIZECONTEXT <span class="free">tctext</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_FinalizeContext_weak_confidentiality weak_confidentiality_e_def get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
    
    
    <span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession1_weak_confidentiality<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION1 <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">id1</span> <span class="free">md</span> <span class="free">str</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
    reachable0 <span class="bound">s</span> <span class="main">∧</span>
    reachable0 <span class="bound">t</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>get_exec_prime <span class="bound">s</span><span class="main">=</span>get_exec_prime <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession1 sysconf <span class="skolem">s</span> <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">id1</span> <span class="free">md</span> <span class="free">str</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession1 sysconf <span class="skolem">t</span> <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">id1</span> <span class="free">md</span> <span class="free">str</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="skolem">t</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">≠</span>REE sysconf<span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span><span class="main">∨</span><span class="free">ctx1</span> <span class="main">=</span> None<span class="main">∨</span> <span class="free">ses1</span> <span class="main">=</span> None<span class="main">∨</span>TEEC_pre_process_operation <span class="free">opt</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_pre_process_operation_def TEEC_OpenSession1_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 a31 b1 b2 b3 fstI<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> exec_prime <span class="skolem">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">ctx1</span> <span class="main">=</span> None <span class="main">∨</span> <span class="free">ses1</span> <span class="main">=</span> None <span class="main">∨</span> TEEC_pre_process_operation <span class="free">opt</span> <span class="main">≠</span> TEEC_SUCCESS<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a5 interference1_def domain_of_event_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c1 ins_no_intf_tee option.sel tee_no_ree<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> vpeq1_def True <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="free">id1</span><span class="main">,</span>param2<span class="main">=</span>None<span class="main">,</span>param3<span class="main">=</span><span class="free">opt</span><span class="main">,</span>
            param4<span class="main">=</span>Some <span class="var">?cli</span><span class="main">,</span>param5<span class="main">=</span><span class="free">ctx1</span><span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
            <span class="main">,</span>param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  TEEC_OpenSession1_def b1 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="free">id1</span><span class="main">,</span>param2<span class="main">=</span>None<span class="main">,</span>param3<span class="main">=</span><span class="free">opt</span><span class="main">,</span>
            param4<span class="main">=</span>Some <span class="var">?cli</span><span class="main">,</span>param5<span class="main">=</span><span class="free">ctx1</span><span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
            <span class="main">,</span>param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  TEEC_OpenSession1_def b1 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="free">id1</span><span class="main">,</span>param2<span class="main">=</span>None<span class="main">,</span>param3<span class="main">=</span><span class="free">opt</span><span class="main">,</span>
            param4<span class="main">=</span>Some <span class="var">?cli</span><span class="main">,</span>param5<span class="main">=</span><span class="free">ctx1</span><span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
            <span class="main">,</span>param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  TEEC_OpenSession1_def b2 c1 b3 a31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="free">id1</span><span class="main">,</span>param2<span class="main">=</span>None<span class="main">,</span>param3<span class="main">=</span><span class="free">opt</span><span class="main">,</span>
            param4<span class="main">=</span>Some <span class="var">?cli</span><span class="main">,</span>param5<span class="main">=</span><span class="free">ctx1</span><span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
            <span class="main">,</span>param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">mem_t</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  TEEC_OpenSession1_def b2 c1 b3 a31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">}</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 d3 d4 d5 vpeq_REE_def 
          <span class="keyword1"><span class="command">using</span></span> True a3 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a5 interference1_def domain_of_event_def c1 
        <span class="keyword1"><span class="command">using</span></span> tee_no_ree <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession1_weak_confidentiality_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION1 <span class="free">ctx1</span> <span class="free">ses1</span> <span class="free">id1</span> <span class="free">md</span> <span class="free">str</span> <span class="free">opt</span> <span class="free">mem_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession1_weak_confidentiality weak_confidentiality_e_def get_exec_prime_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
    
    <span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession2_weak_confidentiality<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION2<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
    reachable0 <span class="bound">s</span> <span class="main">∧</span>
    reachable0 <span class="bound">t</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>get_exec_prime <span class="bound">s</span><span class="main">=</span>get_exec_prime <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a32<span class="main">:</span><span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> "</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">t</span>"</span></span>  
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="main">(</span><span class="var">?exec</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?opt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>param3 <span class="var">?p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uuid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param1 <span class="var">?p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cli</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param4 <span class="var">?p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ctx1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param5 <span class="var">?p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?memt0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>param10 <span class="var">?p</span><span class="main">)</span><span class="main">,</span>the <span class="main">(</span>param11 <span class="var">?p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession2 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="skolem">t</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">≠</span>TEE sysconf<span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span>TEEC_OP2"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession2 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def True a31 b3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> z1 z2 b1 b2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> exec_prime <span class="skolem">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_OP2<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> final<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"newSessionId <span class="var">?s0</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?r1</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"addMgrSession <span class="var">?s0</span> <span class="var">?ses_id</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?attr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findInstanceATTRInMgr <span class="var">?s1</span> <span class="var">?uuid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load_result</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"LoadNewTA sysconf <span class="var">?s1</span> <span class="var">?uuid</span> <span class="var">?opt</span> <span class="var">?ses_id</span> <span class="var">?cli</span> <span class="var">?ctx1</span> <span class="var">?memt0</span>"</span></span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r1_t</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"newSessionId <span class="var">?t0</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?r1_t</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"addMgrSession <span class="var">?t0</span> <span class="var">?ses_id_t</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?attr_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findInstanceATTRInMgr <span class="var">?t1</span> <span class="var">?uuid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load_result_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"LoadNewTA sysconf <span class="var">?t1</span> <span class="var">?uuid</span> <span class="var">?opt</span> <span class="var">?ses_id_t</span> <span class="var">?cli</span> <span class="var">?ctx1</span> <span class="var">?memt0</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?load_result</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?load_result_t</span>"</span></span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ls1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"fst<span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lt1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"fst<span class="main">(</span>addMgrInstance <span class="var">?t1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id_t</span><span class="main">)</span>"</span></span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tid</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"snd<span class="main">(</span><span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tid_t</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"snd<span class="main">(</span><span class="main">(</span>addMgrInstance <span class="var">?t1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="comment1">(*added 12.18*)</span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?memtl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_process <span class="var">?memt0</span> <span class="var">?tid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?memtlft</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_process <span class="var">?memt0</span> <span class="var">?tid_t</span>"</span></span> 
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ls2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_Memory_Init <span class="var">?ls1</span> sysconf bin_mem_size <span class="var">?tid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lt2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_Memory_Init <span class="var">?lt1</span> sysconf bin_mem_size <span class="var">?tid_t</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?size1</span></span></span> <span class="main">=</span><span class="quoted">bin_mem_size</span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?smid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span>
          <span class="bound">new_total</span> <span class="main">=</span> <span class="main">(</span>tee_total_size <span class="main">(</span>TEE_state <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span><span class="var">?size1</span><span class="main">;</span>
          <span class="bound">new_memList</span> <span class="main">=</span> <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?ls1</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid</span><span class="main">,</span>
          access_right <span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="var">?tid</span><span class="main">:=</span>Some READWRITE<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related<span class="main">=</span> None<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_memories<span class="main">(</span>TEE_state <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
          <span class="bound">s1</span> <span class="main">=</span> <span class="var">?ls1</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?ls1</span><span class="main">)</span>
          <span class="main">⦇</span>tee_total_size <span class="main">:=</span> <span class="bound">new_total</span><span class="main">,</span> tee_memories <span class="main">:=</span> <span class="bound">new_memList</span><span class="main">,</span>
          ta_mgr<span class="main">:=</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?ls1</span><span class="main">)</span><span class="main">⦇</span>BIDpointer<span class="main">:=</span>BIDpointer<span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span> <span class="keyword1">in</span> <span class="bound">s1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tmid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span>
          <span class="bound">new_total</span> <span class="main">=</span> <span class="main">(</span>tee_total_size <span class="main">(</span>TEE_state <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span><span class="var">?size1</span><span class="main">;</span>
          <span class="bound">new_memList</span> <span class="main">=</span> <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?lt1</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid_t</span><span class="main">,</span>
          access_right <span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="var">?tid_t</span><span class="main">:=</span>Some READWRITE<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related<span class="main">=</span> None<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_memories<span class="main">(</span>TEE_state <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
          <span class="bound">s1</span> <span class="main">=</span> <span class="var">?lt1</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?lt1</span><span class="main">)</span>
          <span class="main">⦇</span>tee_total_size <span class="main">:=</span> <span class="bound">new_total</span><span class="main">,</span> tee_memories <span class="main">:=</span> <span class="bound">new_memList</span><span class="main">,</span>
          ta_mgr<span class="main">:=</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?lt1</span><span class="main">)</span><span class="main">⦇</span>BIDpointer<span class="main">:=</span>BIDpointer<span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span> <span class="keyword1">in</span> <span class="bound">s1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ls3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"InitMgrSession <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id</span>  <span class="var">?tid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lt3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"InitMgrSession <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id_t</span>  <span class="var">?tid_t</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ls4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?ls3</span><span class="main">⦇</span>current<span class="main">:=</span><span class="var">?tid</span><span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="main">⦇</span>param1<span class="main">=</span>Some <span class="var">?tid</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="var">?ses_id</span><span class="main">,</span>param3<span class="main">=</span>Some <span class="var">?opt</span><span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>param5<span class="main">=</span>Some <span class="var">?ctx1</span>
          <span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
          <span class="main">,</span>param10<span class="main">=</span>Some<span class="main">(</span>fst <span class="var">?memtl</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some<span class="main">(</span>snd <span class="var">?memtl</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span><span class="main">,</span>TEEC_OP3<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?ls3</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lt4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?lt3</span><span class="main">⦇</span>current<span class="main">:=</span><span class="var">?tid_t</span><span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="main">⦇</span>param1<span class="main">=</span>Some <span class="var">?tid_t</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="var">?ses_id_t</span><span class="main">,</span>param3<span class="main">=</span>Some <span class="var">?opt</span><span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>param5<span class="main">=</span>Some <span class="var">?ctx1</span>
          <span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
          <span class="main">,</span>param10<span class="main">=</span>Some<span class="main">(</span>fst <span class="var">?memtlft</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some<span class="main">(</span>snd <span class="var">?memtlft</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span><span class="main">,</span>TEEC_OP3<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?lt3</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ins_lst</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ins_lst_t</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cur_instance</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set <span class="var">?ins_lst</span> <span class="main">∧</span> ta_id <span class="bound">a</span> <span class="main">=</span> <span class="var">?uuid</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cur_instance_t</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set <span class="var">?ins_lst_t</span> <span class="main">∧</span> ta_id <span class="bound">a</span> <span class="main">=</span> <span class="var">?uuid</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cnt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reference_cnt <span class="var">?cur_instance</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"busy <span class="var">?cur_instance</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tid1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cur_ta_thread_id <span class="var">?cur_instance</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tid1_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cur_ta_thread_id <span class="var">?cur_instance_t</span>"</span></span>
          <span class="comment1">(*added 12.18*)</span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?memt1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_process <span class="var">?memt0</span> <span class="var">?tid1</span>"</span></span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?memtft</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_process <span class="var">?memt0</span> <span class="var">?tid1_t</span>"</span></span>
          
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="var">?tid1</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="var">?ses_id</span><span class="main">,</span>param3<span class="main">=</span>Some <span class="var">?opt</span><span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>param5<span class="main">=</span>Some <span class="var">?ctx1</span><span class="main">,</span>
          param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
          <span class="main">,</span>param10<span class="main">=</span>Some<span class="main">(</span>fst <span class="var">?memt1</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some<span class="main">(</span>snd <span class="var">?memt1</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="var">?tid1_t</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="var">?ses_id_t</span><span class="main">,</span>param3<span class="main">=</span>Some <span class="var">?opt</span><span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>param5<span class="main">=</span>Some <span class="var">?ctx1</span><span class="main">,</span>
          param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None
          <span class="main">,</span>param10<span class="main">=</span>Some<span class="main">(</span>fst <span class="var">?memtft</span><span class="main">)</span><span class="main">,</span>param11<span class="main">=</span>Some<span class="main">(</span>snd <span class="var">?memtft</span><span class="main">)</span><span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s3</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"plusRefInstance <span class="var">?s1</span> <span class="var">?uuid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s4</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"InitMgrSession <span class="var">?s3</span> <span class="var">?cli</span> <span class="var">?ses_id</span> <span class="var">?tid1</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s5</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"setBusyInstance <span class="var">?s4</span> <span class="var">?uuid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s6</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="var">?s5</span><span class="main">⦇</span>current<span class="main">:=</span><span class="var">?tid1</span><span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP3<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s5</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t3</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"plusRefInstance <span class="var">?t1</span> <span class="var">?uuid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t4</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"InitMgrSession <span class="var">?t3</span> <span class="var">?cli</span> <span class="var">?ses_id_t</span> <span class="var">?tid1</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t5</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"setBusyInstance <span class="var">?t4</span> <span class="var">?uuid</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t6</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="var">?t5</span><span class="main">⦇</span>current<span class="main">:=</span><span class="var">?tid1_t</span><span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP3<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?t5</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span><span class="quoted"><span class="quoted">"newMemBlockID3 <span class="var">?ls1</span> <span class="main">=</span>newMemBlockID3 <span class="var">?lt1</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> a32 addMgrSession_not_change_BID addMgrInstance_not_change_BID
                  <span class="keyword1"><span class="command">using</span></span> newMemBlockID3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> e22<span class="main">:</span><span class="quoted"><span class="quoted">"BIDpointer<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> BIDpointer<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a32 addMgrSession_not_change_BID addMgrInstance_not_change_BID
                  <span class="keyword1"><span class="command">using</span></span> newMemBlockID3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> e23<span class="main">:</span><span class="quoted"><span class="quoted">"BIDpointer<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> BIDpointer<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> e24<span class="main">:</span><span class="quoted"><span class="quoted">"BIDpointer<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> BIDpointer<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span><span class="quoted"><span class="quoted">"newMemBlockID3 <span class="var">?smid</span><span class="main">=</span>newMemBlockID3 <span class="var">?tmid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e22 newMemBlockID3_def e23 e24
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
          <span class="keyword1"><span class="command">have</span></span> a9<span class="main">:</span><span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
          <span class="keyword1"><span class="command">have</span></span> a91<span class="main">:</span><span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?r1</span><span class="main">=</span><span class="var">?r1_t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> newSessionId_def a9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c11<span class="main">:</span><span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a9 a10 addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c12<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">using</span></span>  addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c13<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span><span class="var">?attr_t</span>"</span></span>
          <span class="comment1">(*findInstanceATTRInMgr*)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">have</span></span> c21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">a</span> <span class="main">=</span> <span class="var">?uuid</span><span class="main">)</span> 
            <span class="main">=</span><span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">a</span> <span class="main">=</span> <span class="var">?uuid</span><span class="main">)</span> "</span></span>
            <span class="keyword1"><span class="command">using</span></span> c11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">a</span> <span class="main">=</span> <span class="var">?uuid</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span><span class="main">(</span>Some <span class="main">(</span>attribute <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">a</span> <span class="main">=</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> findInstanceATTRInMgr_def True
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="main">::</span> <span class="quoted">TA_INSTANCE_CTX_TYPE</span> <span class="keyword2"><span class="keyword">where</span></span>
            f1<span class="main">:</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param1 <span class="main">(</span>fst <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ta_id <span class="skolem">tt</span> <span class="main">∧</span> <span class="skolem">tt</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> True<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">t</span> <span class="main">=</span> ta_id <span class="skolem">tt</span><span class="main">)</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>attribute <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">t</span> <span class="main">=</span> ta_id <span class="skolem">tt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>attribute <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">t</span> <span class="main">=</span> the <span class="main">(</span>param1 <span class="main">(</span>fst <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> findInstanceATTRInMgr_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr_t</span><span class="main">=</span><span class="main">(</span>Some <span class="main">(</span>attribute <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">a</span> <span class="main">=</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> findInstanceATTRInMgr_def True a10 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="main">::</span> <span class="quoted">TA_INSTANCE_CTX_TYPE</span> <span class="keyword2"><span class="keyword">where</span></span>
            f1<span class="main">:</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param1 <span class="main">(</span>fst <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ta_id <span class="skolem">tt</span> <span class="main">∧</span> <span class="skolem">tt</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a10 
            <span class="keyword1"><span class="command">using</span></span> True a31 c11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">t1</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">t1</span> <span class="main">=</span> ta_id <span class="skolem">tt</span><span class="main">)</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> Some <span class="main">(</span>attribute <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">t1</span> <span class="main">=</span> ta_id <span class="skolem">tt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>attribute <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> set <span class="main">(</span>mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="main">(</span>addMgrSession <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>newSessionId <span class="main">(</span><span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> ta_id <span class="bound">t1</span> <span class="main">=</span> the <span class="main">(</span>param1 <span class="main">(</span>fst <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> f1 findInstanceATTRInMgr_def
            <span class="keyword1"><span class="command">using</span></span> c11 z1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z1 z2 c11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="comment1">(*attr≠None*)</span><span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">using</span></span> findInstanceATTRInMgr_def False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr_t</span><span class="main">=</span>None"</span></span> <span class="keyword1"><span class="command">using</span></span> findInstanceATTRInMgr_def False c21 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z1 z2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>    
          
          
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TEE_def a9 a3 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> c01<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> block_id <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> block_id <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 vpeq_TEE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          
          <span class="keyword1"><span class="command">have</span></span> c14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> block_id <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> 
          <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> block_id <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c12 c13 c01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s1</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TEE_def c11 c14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="comment1">(*addMgrSession*)</span>
          
          <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s1</span> <span class="main">=</span><span class="var">?s0</span><span class="main">⦇</span>TEE_state <span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">⦇</span>ta_mgr<span class="main">:=</span>
          <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>mgr_ta_sessions<span class="main">:=</span>
          <span class="main">⦇</span>session_id<span class="main">=</span><span class="var">?ses_id</span><span class="main">,</span>session_ctx<span class="main">=</span>DefaultThreadID<span class="main">,</span>client_id<span class="main">=</span>DefaultClientID<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword1"><span class="command">have</span></span> c1t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t1</span> <span class="main">=</span><span class="var">?t0</span><span class="main">⦇</span>TEE_state <span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">⦇</span>ta_mgr<span class="main">:=</span>
          <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>mgr_ta_sessions<span class="main">:=</span>
          <span class="main">⦇</span>session_id<span class="main">=</span><span class="var">?ses_id_t</span><span class="main">,</span>session_ctx<span class="main">=</span>DefaultThreadID<span class="main">,</span>client_id<span class="main">=</span>DefaultClientID<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span>None"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span>None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s2</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Load_TA_Service sysconf  <span class="main">(</span>Some <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="var">?load</span><span class="main">)</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True 
            <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t2</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z3 z4 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            
            <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?ls1</span> <span class="skolem">d</span> <span class="var">?lt1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d3 addMgrInstance_not_change_TEE_mem  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:addMgrInstance*)</span>
            <span class="keyword1"><span class="command">have</span></span> z13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  TA_Memory_Init_def TA_Memory_Init_not_change_TEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  TA_Memory_Init_def TA_Memory_Init_not_change_TEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z13 z14 
            <span class="keyword1"><span class="command">using</span></span> addMgrInstance_not_change_TEE_mem c14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="comment1">(*LoadNewTA:TA_Memory_Init*)</span>
            <span class="keyword1"><span class="command">have</span></span> z17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem z16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z18<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span> <span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="comment1">(*LoadNewTA:InitMgrSession*)</span>
            <span class="keyword1"><span class="command">have</span></span> z19<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 z18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ls3</span><span class="main">=</span> <span class="main">(</span>InitMgrSession <span class="main">(</span>fst <span class="main">(</span>TA_Memory_Init <span class="main">(</span>fst<span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span> sysconf bin_mem_size <span class="var">?tid</span><span class="main">)</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id</span>  <span class="var">?tid</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z20<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z200<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?lt3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z22<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z20 
            State.fold_congs<span class="main">(</span>1<span class="main">)</span> State.fold_congs<span class="main">(</span>6<span class="main">)</span> fst_conv vpeq_TEE_symmetric vpeq_TEE_transitive
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> z23<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z200    
            State.fold_congs<span class="main">(</span>1<span class="main">)</span> State.fold_congs<span class="main">(</span>6<span class="main">)</span> fst_conv vpeq_TEE_symmetric vpeq_TEE_transitive a10
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z24<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?s2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z22 z23 z19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> LoadNewTA_def  z24 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 TEEC_OpenSession2_def b4 ioctrl_def z1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 TEEC_OpenSession2_def a31 b3 b4 ioctrl_def z1 c2
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 c4 c5 <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="comment1">(*?attr≠None*)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">≠</span>None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">have</span></span> x11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr_t</span><span class="main">≠</span>None"</span></span> <span class="keyword1"><span class="command">using</span></span> z1 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> True"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr_t</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> z2 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr_t</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> z3 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def b1 b4 ioctrl_def z1 z2 z3
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Eps_cong State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> z5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def b2 b4 ioctrl_def x11 z21 z31 a31 b3 a91
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Eps_cong State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z4 z5 c0 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword1"><span class="command">have</span></span> z7<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s3</span> <span class="skolem">d</span> <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> plusRefInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z8<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s4</span> <span class="skolem">d</span> <span class="var">?s3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z9<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s5</span> <span class="skolem">d</span> <span class="var">?s4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> setBusyInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z10<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s6</span> <span class="skolem">d</span> <span class="var">?s5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z71<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?t3</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> plusRefInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z81<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?t4</span> <span class="skolem">d</span> <span class="var">?t3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z91<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?t5</span> <span class="skolem">d</span> <span class="var">?t4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> setBusyInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z101<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?t6</span> <span class="skolem">d</span> <span class="var">?t5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z11<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s6</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z7 z8 z9 z10 c12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z111<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?t6</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z71 z81 z91 z101 c13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z14<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">s'</span><span class="main">=</span> <span class="var">?s6</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Eps_cong State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_OpenSession2_def b1 b4 fst_conv ioctrl_def z1 z2 z6<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> z15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t6</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Eps_cong State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_OpenSession2_def a31 a91 b2 b3 b4 c2 fst_conv ioctrl_def z1 z2 z6 a10<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 d1 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z14 z15 z11 z111 a3 d1 z16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>    
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z222<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">≠</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="comment1">(*Load_result again*)</span>
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s2</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Load_TA_Service sysconf  <span class="main">(</span>Some <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="var">?load</span><span class="main">)</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True 
            <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t2</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z3 z4 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?ls1</span> <span class="skolem">d</span> <span class="var">?lt1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  d3 addMgrInstance_not_change_TEE_mem  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:addMgrInstance*)</span>
            <span class="keyword1"><span class="command">have</span></span> z13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  TA_Memory_Init_def TA_Memory_Init_not_change_TEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  TA_Memory_Init_def TA_Memory_Init_not_change_TEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z13 z14 
            <span class="keyword1"><span class="command">using</span></span> addMgrInstance_not_change_TEE_mem c14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="comment1">(*LoadNewTA:TA_Memory_Init*)</span>
            <span class="keyword1"><span class="command">have</span></span> z17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem z16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z18<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span> <span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="comment1">(*LoadNewTA:InitMgrSession*)</span>
            <span class="keyword1"><span class="command">have</span></span> z19<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 z18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ls3</span><span class="main">=</span> <span class="main">(</span>InitMgrSession <span class="main">(</span>fst <span class="main">(</span>TA_Memory_Init <span class="main">(</span>fst<span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span> sysconf bin_mem_size <span class="var">?tid</span><span class="main">)</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id</span>  <span class="var">?tid</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z20<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z200<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?lt3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z22<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z20
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span>best<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_TEE_symmetric vpeq_TEE_transitive<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z23<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z200
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_TEE_symmetric vpeq_TEE_transitive<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z24<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="main">(</span><span class="var">?s2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z22 z23 z19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> LoadNewTA_def  z24 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 TEEC_OpenSession2_def c2 b4 ioctrl_def z1 z222
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 TEEC_OpenSession2_def a31 b3 b4 ioctrl_def z1 c2 z222
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 c4 c5 <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="comment1">(*when d = REE*)</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 vpeq1_def False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_REE_def d1 a3  False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s1</span> <span class="main">=</span><span class="var">?s0</span><span class="main">⦇</span>TEE_state <span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">⦇</span>ta_mgr<span class="main">:=</span>
          <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>mgr_ta_sessions<span class="main">:=</span>
          <span class="main">⦇</span>session_id<span class="main">=</span><span class="var">?ses_id</span><span class="main">,</span>session_ctx<span class="main">=</span>DefaultThreadID<span class="main">,</span>client_id<span class="main">=</span>DefaultClientID<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword1"><span class="command">have</span></span> c1t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t1</span> <span class="main">=</span><span class="var">?t0</span><span class="main">⦇</span>TEE_state <span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">⦇</span>ta_mgr<span class="main">:=</span>
          <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>mgr_ta_sessions<span class="main">:=</span>
          <span class="main">⦇</span>session_id<span class="main">=</span><span class="var">?ses_id_t</span><span class="main">,</span>session_ctx<span class="main">=</span>DefaultThreadID<span class="main">,</span>client_id<span class="main">=</span>DefaultClientID<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s1</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TEE_def c0 c1 c1t <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="comment1">(*addMgrSession*)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span>None"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span>None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s2</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Load_TA_Service sysconf <span class="main">(</span>Some <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="var">?load</span><span class="main">)</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True 
            <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t2</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z3 z4 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?ls1</span> <span class="skolem">d</span> <span class="var">?lt1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  d3 addMgrInstance_not_change_REE addMgrInstance_def a10
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> del_insts<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.surjective State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> fst_conv vpeq_REE_def<span class="main">)</span> 
            <span class="comment1">(*LoadNewTA:addMgrInstance*)</span>
            <span class="keyword1"><span class="command">have</span></span> z14<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">=</span>REE_state <span class="main">(</span> <span class="var">?ls1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z15<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">=</span>REE_state <span class="main">(</span> <span class="var">?lt1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  z14 z15 e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:TA_Memory_Init*)</span>
            <span class="keyword1"><span class="command">have</span></span> z18<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span> <span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z16 InitMgrSession_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:InitMgrSession*)</span>
            <span class="keyword1"><span class="command">have</span></span> z19<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 z18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ls3</span><span class="main">=</span> <span class="main">(</span>InitMgrSession <span class="main">(</span>fst <span class="main">(</span>TA_Memory_Init <span class="main">(</span>fst<span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span> sysconf bin_mem_size <span class="var">?tid</span><span class="main">)</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id</span>  <span class="var">?tid</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z20<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z200<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?lt3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z22<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z20 
                State.fold_congs<span class="main">(</span>1<span class="main">)</span> State.fold_congs<span class="main">(</span>6<span class="main">)</span> fst_conv vpeq_REE_reflexive 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_REE_reflexive<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> z23<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z200
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_REE_reflexive<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> z24<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?s2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z22 z23 z19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> LoadNewTA_def  z24 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 TEEC_OpenSession2_def b4 ioctrl_def z1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 TEEC_OpenSession2_def a31 b3 b4 ioctrl_def z1 c2
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 c4 c5 <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">≠</span>None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">have</span></span> x11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr_t</span><span class="main">≠</span>None"</span></span> <span class="keyword1"><span class="command">using</span></span> z1 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> True"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr_t</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> z2 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr_t</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> z3 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def b1 b4 ioctrl_def z1 z2 z3
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Eps_cong State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> z5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def b2 b4 ioctrl_def x11 z21 z31 a31 b3 a91
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Eps_cong State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z4 z5 c0 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z7<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s3</span> <span class="skolem">d</span> <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> plusRefInstance_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z8<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s4</span> <span class="skolem">d</span> <span class="var">?s3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z9<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s5</span> <span class="skolem">d</span> <span class="var">?s4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> setBusyInstance_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z10<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s6</span> <span class="skolem">d</span> <span class="var">?s5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z71<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?t3</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> plusRefInstance_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z81<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?t4</span> <span class="skolem">d</span> <span class="var">?t3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z91<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?t5</span> <span class="skolem">d</span> <span class="var">?t4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> setBusyInstance_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z101<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?t6</span> <span class="skolem">d</span> <span class="var">?t5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c21<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s1</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> addMgrSession_not_change_REE addMgrSession_def a114 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c31<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?t1</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> addMgrSession_not_change_REE addMgrSession_def a114 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z11<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s5</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z7 z8 z9 z10 c21 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z111<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?t5</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z71 z81 z91 z101 c31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z14<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">s'</span><span class="main">=</span> <span class="var">?s6</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Eps_cong State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_OpenSession2_def b1 b4 fst_conv ioctrl_def z1 z2 z6<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> z15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t6</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Eps_cong State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_OpenSession2_def a31 a91 b2 b3 b4 c2 fst_conv ioctrl_def z1 z2 z6 a10<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 d1 vpeq1_def d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z14 z15 z11 z111 a3 d1 z16 d0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>    
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z222<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">≠</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="comment1">(*Load_result again*)</span>
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s2</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Load_TA_Service sysconf <span class="main">(</span>Some <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="var">?load</span><span class="main">)</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True 
            <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t2</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z3 z4 d3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?ls1</span> <span class="skolem">d</span> <span class="var">?lt1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d3 addMgrInstance_not_change_REE addMgrInstance_def a10
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> del_insts<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> State.surjective State.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> State.update_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> fst_conv vpeq_REE_def<span class="main">)</span>
            <span class="comment1">(*LoadNewTA:addMgrInstance*)</span>
            <span class="keyword1"><span class="command">have</span></span> z14<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">=</span>REE_state <span class="main">(</span> <span class="var">?ls1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z15<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">=</span>REE_state <span class="main">(</span> <span class="var">?lt1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z14 z15 e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:TA_Memory_Init*)</span>
            <span class="keyword1"><span class="command">have</span></span> z18<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span> <span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z16 InitMgrSession_not_change_REE InitMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:InitMgrSession*)</span>
            <span class="keyword1"><span class="command">have</span></span> z19<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 z18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ls3</span><span class="main">=</span> <span class="main">(</span>InitMgrSession <span class="main">(</span>fst <span class="main">(</span>TA_Memory_Init <span class="main">(</span>fst<span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span> sysconf bin_mem_size <span class="var">?tid</span><span class="main">)</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id</span>  <span class="var">?tid</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z20<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z200<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?lt3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z22<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z20 Load_TA_Service_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_REE_reflexive<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> z23<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z200
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_REE_reflexive<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z24<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="main">(</span><span class="var">?s2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z22 z23 z19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> LoadNewTA_def  z24 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 TEEC_OpenSession2_def c2 b4 ioctrl_def z1 z222
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 TEEC_OpenSession2_def a31 b3 b4 ioctrl_def z1 c2 z222
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 c4 c5 <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          
          <span class="comment1">(*when d = TA*)</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d0 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TA_def a9 a3 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> c01<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> c14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> 
          <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c12 c13 c01 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s1</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TA_def c11 c14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="comment1">(*addMgrSession*)</span>
          
          <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s1</span> <span class="main">=</span><span class="var">?s0</span><span class="main">⦇</span>TEE_state <span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">⦇</span>ta_mgr<span class="main">:=</span>
          <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>mgr_ta_sessions<span class="main">:=</span>
          <span class="main">⦇</span>session_id<span class="main">=</span><span class="var">?ses_id</span><span class="main">,</span>session_ctx<span class="main">=</span>DefaultThreadID<span class="main">,</span>client_id<span class="main">=</span>DefaultClientID<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword1"><span class="command">have</span></span> c1t<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t1</span> <span class="main">=</span><span class="var">?t0</span><span class="main">⦇</span>TEE_state <span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">⦇</span>ta_mgr<span class="main">:=</span>
          <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>mgr_ta_sessions<span class="main">:=</span>
          <span class="main">⦇</span>session_id<span class="main">=</span><span class="var">?ses_id_t</span><span class="main">,</span>session_ctx<span class="main">=</span>DefaultThreadID<span class="main">,</span>client_id<span class="main">=</span>DefaultClientID<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  addMgrSession_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span>None"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">=</span>None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s2</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Load_TA_Service sysconf <span class="main">(</span>Some <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="var">?load</span><span class="main">)</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True 
            <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t2</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z3 z4 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?ls1</span> <span class="skolem">d</span> <span class="var">?lt1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d3 addMgrInstance_not_change_TEE_mem  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:addMgrInstance*)</span>
            <span class="keyword1"><span class="command">have</span></span> z111<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?tid</span><span class="main">=</span>newInstancethread <span class="var">?s1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> addMgrInstance_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snd_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z112<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?tid_t</span><span class="main">=</span>newInstancethread <span class="var">?t1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> addMgrInstance_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snd_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z113<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?tid</span><span class="main">=</span><span class="var">?tid_t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z111 z112 newInstancethread_def c11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span><span class="var">?tid</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> z161<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span>
              <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_otherTA TA_Memory_Init_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> z162<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span>
              <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_otherTA TA_Memory_Init_def True a10 z113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z161 z162 e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> z163<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">new_total1</span> <span class="main">=</span> <span class="main">(</span>tee_total_size <span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span><span class="var">?size1</span><span class="main">;</span>
              <span class="bound">new_memList1</span> <span class="main">=</span> <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?smid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_memories<span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
              <span class="bound">s2</span> <span class="main">=</span><span class="var">?smid</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span>
              <span class="main">⦇</span>tee_total_size <span class="main">:=</span> <span class="bound">new_total1</span><span class="main">,</span> tee_memories <span class="main">:=</span> <span class="bound">new_memList1</span><span class="main">,</span>
              ta_mgr<span class="main">:=</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">⦇</span>BIDpointer<span class="main">:=</span>BIDpointer<span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span> <span class="keyword1">in</span> 
              <span class="bound">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> z164<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">new_total1</span> <span class="main">=</span> <span class="main">(</span>tee_total_size <span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span><span class="var">?size1</span><span class="main">;</span>
              <span class="bound">new_memList1</span> <span class="main">=</span> <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?tmid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid_t</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_memories<span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
              <span class="bound">s2</span> <span class="main">=</span><span class="var">?tmid</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span>
              <span class="main">⦇</span>tee_total_size <span class="main">:=</span> <span class="bound">new_total1</span><span class="main">,</span> tee_memories <span class="main">:=</span> <span class="bound">new_memList1</span><span class="main">,</span>
              ta_mgr<span class="main">:=</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">⦇</span>BIDpointer<span class="main">:=</span>BIDpointer<span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span> <span class="keyword1">in</span> 
              <span class="bound">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span>
              
              <span class="keyword1"><span class="command">have</span></span> z165<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?ls1</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid</span><span class="main">,</span>
              access_right <span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="var">?tid</span><span class="main">:=</span>Some READWRITE<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related<span class="main">=</span> None<span class="main">⦈</span> <span class="main">=</span>
              <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?lt1</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid_t</span><span class="main">,</span>
              access_right <span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="var">?tid_t</span><span class="main">:=</span>Some READWRITE<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related<span class="main">=</span> None<span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z113 e2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> z166<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?smid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span><span class="main">=</span>
              <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?tmid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid_t</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z113 e3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> z167<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?smid</span> <span class="skolem">d</span> <span class="var">?tmid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e1  False z165 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z163 z164 z113 e1 False z166 z167 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
            <span class="comment1">(*LoadNewTA:TA_Memory_Init*)</span>
            <span class="keyword1"><span class="command">have</span></span> z17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem z16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z18<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span> <span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            
            <span class="comment1">(*LoadNewTA:InitMgrSession*)</span>
            <span class="keyword1"><span class="command">have</span></span> z19<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 z18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ls3</span><span class="main">=</span> <span class="main">(</span>InitMgrSession <span class="main">(</span>fst <span class="main">(</span>TA_Memory_Init <span class="main">(</span>fst<span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span> sysconf bin_mem_size <span class="var">?tid</span><span class="main">)</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id</span>  <span class="var">?tid</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z20<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z200<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?lt3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z22<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z20 Load_TA_Service_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_TA_reflexive<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> z23<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z200 Load_TA_Service_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_TA_reflexive<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z24<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?s2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z22 z23 z19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> LoadNewTA_def  z24 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 TEEC_OpenSession2_def b4 ioctrl_def z1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 TEEC_OpenSession2_def a31 b3 b4 ioctrl_def z1 c2
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 c4 c5 <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr</span><span class="main">≠</span>None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">have</span></span> x11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?attr_t</span><span class="main">≠</span>None"</span></span> <span class="keyword1"><span class="command">using</span></span> z1 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> True"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr_t</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> z2 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr_t</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> z3 c2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def b1 b4 ioctrl_def z1 z2 z3
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Eps_cong State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> z5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_def b2 b4 ioctrl_def x11 z21 z31 a31 b3 a91
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> Eps_cong State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z4 z5 c0 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>multiSession <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">=</span> False <span class="main">∧</span> <span class="var">?cnt</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="var">?b</span> <span class="main">=</span> True<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z7<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s3</span> <span class="skolem">d</span> <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> plusRefInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z8<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s4</span> <span class="skolem">d</span> <span class="var">?s3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z9<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s5</span> <span class="skolem">d</span> <span class="var">?s4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> setBusyInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z10<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s6</span> <span class="skolem">d</span> <span class="var">?s5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z71<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?t3</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> plusRefInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z81<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?t4</span> <span class="skolem">d</span> <span class="var">?t3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z91<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?t5</span> <span class="skolem">d</span> <span class="var">?t4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> setBusyInstance_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z101<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?t6</span> <span class="skolem">d</span> <span class="var">?t5</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> z11<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s5</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z7 z8 z9 z10 c12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z111<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?t5</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z71 z81 z91 z101 c13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> z14<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">s'</span><span class="main">=</span> <span class="var">?s6</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Eps_cong State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_OpenSession2_def b1 b4 fst_conv ioctrl_def z1 z2 z6<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> z15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t6</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Eps_cong State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_OpenSession2_def a31 a91 b2 b3 b4 c2 fst_conv ioctrl_def z1 z2 z6 a10<span class="main">)</span>
          
          <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 d1 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z14 z15 z16 z11 z111 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>    
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z222<span class="main">:</span><span class="quoted"><span class="quoted">"singleInstance <span class="main">(</span>the <span class="var">?attr</span><span class="main">)</span> <span class="main">≠</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="comment1">(*Load_result again*)</span>
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s2</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?load</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Load_TA_Service sysconf <span class="main">(</span>Some <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="var">?load</span><span class="main">)</span><span class="main">≠</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True 
            <span class="keyword1"><span class="command">have</span></span> z3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> z4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t2</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z3 z4 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> z9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">attr</span> <span class="main">=</span> getATTRfromBin sysconf <span class="var">?uuid</span><span class="main">;</span>
            <span class="bound">ctid</span> <span class="main">=</span> <span class="main">(</span>newInstancethread <span class="var">?s1</span><span class="main">)</span> <span class="keyword1">in</span> 
            <span class="main">⦇</span>ta_id<span class="main">=</span><span class="var">?uuid</span><span class="main">,</span>cur_ta_session_list<span class="main">=</span><span class="main">[</span><span class="var">?ses_id</span><span class="main">]</span><span class="main">,</span>reference_cnt<span class="main">=</span><span class="main">1</span><span class="main">,</span>
            busy<span class="main">=</span>True<span class="main">,</span>cur_ta_thread_id<span class="main">=</span><span class="bound">ctid</span><span class="main">,</span>attribute<span class="main">=</span><span class="bound">attr</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">let</span> <span class="bound">attr</span> <span class="main">=</span> getATTRfromBin sysconf <span class="var">?uuid</span><span class="main">;</span>
            <span class="bound">ctid</span> <span class="main">=</span> <span class="main">(</span>newInstancethread <span class="var">?t1</span><span class="main">)</span> <span class="keyword1">in</span> 
            <span class="main">⦇</span>ta_id<span class="main">=</span><span class="var">?uuid</span><span class="main">,</span>cur_ta_session_list<span class="main">=</span><span class="main">[</span><span class="var">?ses_id_t</span><span class="main">]</span><span class="main">,</span>reference_cnt<span class="main">=</span><span class="main">1</span><span class="main">,</span>
            busy<span class="main">=</span>True<span class="main">,</span>cur_ta_thread_id<span class="main">=</span><span class="bound">ctid</span><span class="main">,</span>attribute<span class="main">=</span><span class="bound">attr</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a10
            <span class="keyword1"><span class="command">using</span></span> c11 newInstancethread_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?ls1</span> <span class="skolem">d</span> <span class="var">?lt1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d3 addMgrInstance_not_change_TEE_mem  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="comment1">(*LoadNewTA:addMgrInstance*)</span>
            
            <span class="keyword1"><span class="command">have</span></span> z111<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?tid</span><span class="main">=</span>newInstancethread <span class="var">?s1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> addMgrInstance_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snd_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z112<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?tid_t</span><span class="main">=</span>newInstancethread <span class="var">?t1</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> addMgrInstance_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> snd_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z113<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?tid</span><span class="main">=</span><span class="var">?tid_t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z111 z112 newInstancethread_def c11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z16<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span><span class="var">?tid</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> z161<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span>
              <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?ls1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_otherTA TA_Memory_Init_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> z162<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span>
              <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_not_change_otherTA TA_Memory_Init_def True a10 z113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z161 z162 e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> z163<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="var">?ls2</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">new_total1</span> <span class="main">=</span> <span class="main">(</span>tee_total_size <span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span><span class="var">?size1</span><span class="main">;</span>
              <span class="bound">new_memList1</span> <span class="main">=</span> <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?smid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_memories<span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
              <span class="bound">s2</span> <span class="main">=</span><span class="var">?smid</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span>
              <span class="main">⦇</span>tee_total_size <span class="main">:=</span> <span class="bound">new_total1</span><span class="main">,</span> tee_memories <span class="main">:=</span> <span class="bound">new_memList1</span><span class="main">,</span>
              ta_mgr<span class="main">:=</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">⦇</span>BIDpointer<span class="main">:=</span>BIDpointer<span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?smid</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span> <span class="keyword1">in</span> 
              <span class="bound">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> z164<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="var">?lt2</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">new_total1</span> <span class="main">=</span> <span class="main">(</span>tee_total_size <span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span><span class="var">?size1</span><span class="main">;</span>
              <span class="bound">new_memList1</span> <span class="main">=</span> <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?tmid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid_t</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span><span class="main">#</span><span class="main">(</span>tee_memories<span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
              <span class="bound">s2</span> <span class="main">=</span><span class="var">?tmid</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span>
              <span class="main">⦇</span>tee_total_size <span class="main">:=</span> <span class="bound">new_total1</span><span class="main">,</span> tee_memories <span class="main">:=</span> <span class="bound">new_memList1</span><span class="main">,</span>
              ta_mgr<span class="main">:=</span>ta_mgr<span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">⦇</span>BIDpointer<span class="main">:=</span>BIDpointer<span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?tmid</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span> <span class="main">⦈</span><span class="main">⦈</span><span class="main">⦈</span> <span class="keyword1">in</span> 
              <span class="bound">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TA_Memory_Init_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span>
              
              <span class="keyword1"><span class="command">have</span></span> z165<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?ls1</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid</span><span class="main">,</span>
              access_right <span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="var">?tid</span><span class="main">:=</span>Some READWRITE<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related<span class="main">=</span> None<span class="main">⦈</span> <span class="main">=</span>
              <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?lt1</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid_t</span><span class="main">,</span>
              access_right <span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="var">?tid_t</span><span class="main">:=</span>Some READWRITE<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related<span class="main">=</span> None<span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z113 e2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> z166<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?smid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span><span class="main">=</span>
              <span class="main">⦇</span>block_id <span class="main">=</span> newMemBlockID3 <span class="var">?tmid</span><span class="main">,</span>size<span class="main">=</span><span class="var">?size1</span><span class="main">,</span>ownership <span class="main">=</span> <span class="var">?tid_t</span><span class="main">,</span>
              access_right <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> None<span class="main">)</span><span class="main">(</span><span class="main">(</span>TEE sysconf<span class="main">)</span><span class="main">:=</span>Some READ<span class="main">)</span> <span class="main">,</span>is_SecureMem<span class="main">=</span>True<span class="main">,</span>related <span class="main">=</span>None<span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z113 e3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> z167<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?smid</span> <span class="skolem">d</span> <span class="var">?tmid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e1  False z165 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z163 z164 z113 e1 False z166 z167 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
            <span class="comment1">(*LoadNewTA:TA_Memory_Init*)</span>
            <span class="keyword1"><span class="command">have</span></span> z17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> InitMgrSession_not_change_TEE_mem z16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z18<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span> <span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span> <span class="var">?lt3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="comment1">(*LoadNewTA:InitMgrSession*)</span>
            <span class="keyword1"><span class="command">have</span></span> z19<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a113 z18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ls3</span><span class="main">=</span> <span class="main">(</span>InitMgrSession <span class="main">(</span>fst <span class="main">(</span>TA_Memory_Init <span class="main">(</span>fst<span class="main">(</span>addMgrInstance <span class="var">?s1</span> sysconf <span class="var">?uuid</span> <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span> sysconf bin_mem_size <span class="var">?tid</span><span class="main">)</span><span class="main">)</span> <span class="var">?cli</span> <span class="var">?ses_id</span>  <span class="var">?tid</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> z20<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?ls3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z200<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?lt3</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False a113 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> z22<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?ls4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z20 Load_TA_Service_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_TA_reflexive<span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> z23<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?lt4</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  LoadNewTA_def False z200 Load_TA_Service_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv vpeq_TA_reflexive<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> z24<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="main">(</span><span class="var">?s2</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span><span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z22 z23 z19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> LoadNewTA_def  z24 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 TEEC_OpenSession2_def c2 b4 ioctrl_def z1 z222
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 TEEC_OpenSession2_def a31 b3 b4 ioctrl_def z1 c2 z222
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c3 c4 c5 <span class="keyword1"><span class="command">using</span></span> d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span> 
        
        <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession2_weak_confidentiality_e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION2<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession2_weak_confidentiality weak_confidentiality_e_def get_exec_prime_def
    
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession3_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION3 <span class="free">sid</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span><span class="main">=</span>get_exec_prime <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="main">(</span><span class="var">?exec</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param2 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?opt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>param3 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uuid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param1 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ctx1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param5 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initTAProcess <span class="var">?s0</span> <span class="var">?opt</span> <span class="var">?uuid</span> <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ta_ses</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TA_sessions<span class="main">(</span>the<span class="main">(</span><span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?init1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>TA_instance_init<span class="main">(</span>the<span class="main">(</span><span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"TA_OpenSessionEntryPoint sysconf <span class="var">?s1</span> <span class="var">?opt</span> <span class="var">?uuid</span>"</span></span>
<span class="comment1">(*
    let ?s3 = "MgrPostOperation ?s2 ?uuid"
    let ?s4 = "addREESession ?s3 ?ses_id ?ctx1"
*)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initTAProcess <span class="var">?t0</span> <span class="var">?opt</span> <span class="var">?uuid</span> <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ta_ses_t</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TA_sessions<span class="main">(</span>the<span class="main">(</span><span class="main">(</span>TAs_state <span class="skolem">t</span><span class="main">)</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?init1_t</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>TA_instance_init<span class="main">(</span>the<span class="main">(</span><span class="main">(</span>TAs_state <span class="skolem">t</span><span class="main">)</span> <span class="var">?uuid</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"TA_OpenSessionEntryPoint sysconf <span class="var">?t1</span> <span class="var">?opt</span> <span class="var">?uuid</span>"</span></span>
<span class="comment1">(*    let ?t3 = "MgrPostOperation ?t2 ?uuid"
    let ?t4 = "addREESession ?t3 ?ses_id ?ctx1"
*)</span>    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="var">?uuid</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="var">?ses_id</span><span class="main">,</span>param3<span class="main">=</span>None<span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>
            param5<span class="main">=</span>None<span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None<span class="main">,</span>param10<span class="main">=</span>None<span class="main">,</span>param11<span class="main">=</span>None<span class="main">,</span>param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s5</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s2</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s2</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t5</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_OP4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?t2</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession3 sysconf <span class="skolem">s</span> <span class="free">sid</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession3 sysconf <span class="skolem">t</span> <span class="free">sid</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="skolem">t</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span><span class="main">≠</span>TEEC_OP3<span class="main">∨</span><span class="free">sid</span><span class="main">≠</span><span class="var">?ses_id</span><span class="main">∨</span>TEE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span>REE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span><span class="var">?uuid</span><span class="main">≠</span>current <span class="skolem">s</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span><span class="main">≠</span>TEEC_OP3<span class="main">∨</span><span class="free">sid</span><span class="main">≠</span><span class="var">?ses_id</span><span class="main">∨</span>TEE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span>REE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span><span class="var">?uuid</span><span class="main">≠</span>current <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 b1 TEEC_OpenSession3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 b2 TEEC_OpenSession3_def a31 b3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a3 c2 c3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span><span class="main">≠</span>TEEC_OP3<span class="main">∨</span><span class="free">sid</span><span class="main">≠</span><span class="var">?ses_id</span><span class="main">∨</span>TEE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span>REE sysconf<span class="main">=</span>current <span class="skolem">s</span><span class="main">∨</span><span class="var">?uuid</span><span class="main">≠</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="main">(</span>current <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a5 c5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a5 c5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c7<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>current <span class="skolem">s</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a5 domain_of_event_def c5 interference1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c71<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>current <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c72<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span><span class="var">?uuid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> c73<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c74<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c7 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> c8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s0</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span><span class="var">?ta_ses</span><span class="main">)</span><span class="main">∧</span><span class="bound">a</span><span class="main">=</span><span class="var">?ses_id</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">=</span><span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?init1</span> <span class="main">=</span>False"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def TA_CreateEntryPoint_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 vpeq_TA_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t0</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span>set<span class="main">(</span><span class="var">?ta_ses_t</span><span class="main">)</span><span class="main">∧</span><span class="bound">a</span><span class="main">=</span><span class="var">?ses_id</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t1</span><span class="main">=</span><span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def a31 b3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?init1_t</span> <span class="main">=</span>False"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def TA_CreateEntryPoint_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> initTAProcess_def addTASession_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d4 d5 vpeq_TA_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s1</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d3 d6 vpeq_TA_def c74 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s2</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t2</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                           <span class="keyword1"><span class="command">using</span></span> d7 OpenSessionEntryPoint_not_change_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
      <span class="comment1">(*we can't prove this part as the behavior in s and t isn't specified ,which is different*)</span>
<span class="comment1">(*    have d9:"tee_memories(TEE_state ?s3 )=tee_memories( TEE_state ?s2)" 
                      using MgrPostOperation_def MgrPostOperation_not_change_TEE_mem by blast
    have d10:"tee_memories(TEE_state ?s4) = tee_memories(TEE_state ?s3)" 
                      using addREESession_def addREESession_not_change_TEE by presburger
    have d11:"vpeq_TA ?s4 d ?s2" using d9 d10 by auto
*)</span>  
    <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s5</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_OpenSession3_def c4 b1 fst_conv<span class="main">)</span>    
    <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="var">?s2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  d12 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="comment1">(*for t*)</span>
<span class="comment1">(*     have d14:"tee_memories(TEE_state ?t3 )=tee_memories( TEE_state ?t2)" 
                      using MgrPostOperation_def MgrPostOperation_not_change_TEE_mem by blast
    have d15:"tee_memories(TEE_state ?t4) = tee_memories(TEE_state ?t3)" 
                      using addREESession_def addREESession_not_change_TEE by presburger
    have d16:"vpeq_TA ?t4 d ?t2" using d14 d15 by auto
*)</span>    <span class="keyword1"><span class="command">have</span></span> d17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t5</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_OpenSession3_def c4 b3 b2 a31 fst_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> d18<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">t'</span> <span class="skolem">d</span> <span class="var">?t2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> d17 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d8 d13 d18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c73 c8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession3_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION3 <span class="free">sid</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession3_weak_confidentiality weak_confidentiality_e_def get_exec_prime_def
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession4_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_OPENSESSION4<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span><span class="main">=</span>get_exec_prime <span class="bound">t</span><span class="main">)</span><span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span><span class="main">=</span>exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?domain</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">t</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="main">(</span><span class="var">?exec</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param2 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tid1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param1 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ctx1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param5 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?res</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>param12 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?memt0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>param10 <span class="var">?p</span><span class="main">)</span><span class="main">,</span>the <span class="main">(</span>param11 <span class="var">?p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime<span class="main">:=</span>tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="comment1">(*2023.2.7*)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sa</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"MgrPostOperation <span class="var">?s0</span> <span class="var">?tid1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ta</span></span></span><span class="main">=</span> <span class="quoted"><span class="quoted">"MgrPostOperation <span class="var">?t0</span> <span class="var">?tid1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span>Some <span class="var">?sesid</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="var">?tid1</span><span class="main">,</span>param3<span class="main">=</span>None<span class="main">,</span>param4<span class="main">=</span>Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span>
               param5<span class="main">=</span>None<span class="main">,</span>param6<span class="main">=</span>None<span class="main">,</span>param7<span class="main">=</span>None<span class="main">,</span>param8<span class="main">=</span>None<span class="main">,</span>param9<span class="main">=</span>None<span class="main">,</span>param10<span class="main">=</span>None<span class="main">,</span>param11<span class="main">=</span>None<span class="main">,</span>param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="var">?sa</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_CS2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?sa</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="var">?ta</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_CS2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?ta</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession4 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exec_event_def p1 a8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>current <span class="skolem">t</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">≠</span>TEE sysconf<span class="main">∨</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span><span class="main">∨</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span>TEEC_OP4"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span>fst<span class="main">(</span>TEEC_OpenSession4 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession4_def True a31 b3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> z1 z2 b1 b2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> exec_prime <span class="skolem">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_OP4<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">s</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?res</span><span class="main">=</span>TEEC_SUCCESS"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="comment1">(*
    have b6:"s'=s" using b1 b4 True TEEC_OpenSession4_def  by auto
    have b61:"t'=t" using b2 b4 True TEEC_OpenSession4_def b3 a31 by auto
    *)</span>
    <span class="keyword1"><span class="command">have</span></span> b7 <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?res</span><span class="main">=</span>TEEC_SUCCESS"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c31<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?sa</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c32<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?ta</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?sa</span> <span class="skolem">d</span> <span class="var">?ta</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c3 a3 c1 c31 c32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sa</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b4 b7 TEEC_OpenSession4_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ta</span><span class="main">=</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 b4 b7 TEEC_OpenSession4_def b3 a31
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 c4 c5 c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 c1 c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c31<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="var">?sa</span> <span class="main">=</span> REE_state <span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c32<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="var">?ta</span> <span class="main">=</span> REE_state <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?sa</span> <span class="skolem">d</span> <span class="var">?ta</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c3 a3 c1 c0 c31 c32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sa</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b4 b7 TEEC_OpenSession4_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ta</span><span class="main">=</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 b4 b7 TEEC_OpenSession4_def b3 a31
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 c4 c5 c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def c0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c31<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?sa</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c32<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?ta</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?sa</span> <span class="skolem">d</span> <span class="var">?ta</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c3 a3 c1 c31 c32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sa</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b4 b7 TEEC_OpenSession4_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ta</span><span class="main">=</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 b4 b7 TEEC_OpenSession4_def b3 a31
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 c4 c5 c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
<span class="comment1">(*main proof body begin*)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?res</span><span class="main">≠</span>TEEC_SUCCESS"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c31<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?sa</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c32<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?ta</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TEE <span class="var">?s1</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c3 a3 c1 c31 c32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b4 b7 TEEC_OpenSession4_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t1</span><span class="main">=</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 b4 b7 TEEC_OpenSession4_def b3 a31
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 c4 c5 c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 c1 c0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c31<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="var">?sa</span> <span class="main">=</span> REE_state <span class="var">?s0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c32<span class="main">:</span><span class="quoted"><span class="quoted">"REE_state <span class="var">?ta</span> <span class="main">=</span> REE_state <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_REE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_REE <span class="var">?s1</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c3 a3 c1 c0 c31 c32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b4 b7 TEEC_OpenSession4_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t1</span><span class="main">=</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 b4 b7 TEEC_OpenSession4_def b3 a31
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 c4 c5 c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_TA_def c0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span>  <span class="skolem">t'</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s0</span> <span class="skolem">d</span> <span class="var">?t0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 c1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c31<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?sa</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c32<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?ta</span> <span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t0</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> MgrPostOperation_def MgrPostOperation_not_change_TEE_mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span><span class="quoted"><span class="quoted">"vpeq_TA <span class="var">?s1</span> <span class="skolem">d</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c3 a3 c1 c31 c32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1 b4 b7 TEEC_OpenSession4_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?t1</span><span class="main">=</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b2 b4 b7 TEEC_OpenSession4_def b3 a31
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prod.exhaust_sel<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2 c4 c5 c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">lemma</span></span> TEEC_OpenSession4_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_OPENSESSION4<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TEEC_OpenSession4_weak_confidentiality weak_confidentiality_e_def get_exec_prime_def
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>





<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand proof"</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand1"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1_integrity <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessionInREECtxList <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span><span class="free">ses_id</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="free">time_out</span><span class="main">,</span>param3<span class="main">=</span>None<span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>param5<span class="main">=</span>None<span class="main">,</span>
                param6<span class="main">=</span>Some <span class="free">cmd_id</span><span class="main">,</span>param7<span class="main">=</span>Some <span class="free">in_params</span><span class="main">,</span>param8<span class="main">=</span>Some <span class="free">out_params</span><span class="main">,</span>param9<span class="main">=</span>None<span class="main">,</span> 
                param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">,</span> param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">,</span>
                param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_IC2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_InvokeCommand1 sysconf <span class="bound">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand1 sysconf <span class="skolem">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None<span class="main">∨</span><span class="main">(</span>findSesCliTid <span class="skolem">s</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∨</span> <span class="var">?sesin</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1_def a4_1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fstI<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None<span class="main">∨</span><span class="main">(</span>findSesCliTid <span class="skolem">s</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∨</span> <span class="var">?sesin</span> <span class="main">=</span> False<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> p1 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>TEEC_InvokeCommand1 sysconf <span class="skolem">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s1</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_InvokeCommand1_def b1 prod.exhaust_sel<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a4_1 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> f2 f4 f5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> f3 f4 f5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">∧</span>
                            ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> f6 f7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> f8 vpeq_TEE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>TEEC_InvokeCommand1 sysconf <span class="skolem">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s1</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_InvokeCommand1_def b1 prod.exhaust_sel<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a4_1 e4 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="comment1">(*  by (simp add: a4_1 e4)*)</span>
              <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> e2 e4 e5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> e3 e4 e5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> e9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                   <span class="main">∧</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e6 e7<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e8 vpeq_REE_def<span class="main">)</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False p2<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False True p2 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                    <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>TEEC_InvokeCommand1 sysconf <span class="skolem">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s1</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TEEC_InvokeCommand1_def b1 prod.exhaust_sel<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a4_1 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="comment1">(*    by (simp add: a4_1 d3) *)</span>
                    <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> d2 d4 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                         <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> d5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> d6 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> p6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False is_TA_def p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1_integrity_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1_integrity integrity_e_def get_exec_prime_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> integrity_e <span class="bound">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">s</span> <span class="bound">sa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> reachable0 <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span> non_interference <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">sa</span><span class="main">)</span> <span class="main">∉</span> exec_event <span class="bound">e</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">n</span> <span class="main">∼</span> <span class="bound">sa</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrity_e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">s</span> <span class="bound">sa</span><span class="main">.</span> <span class="main">¬</span> reachable0 <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span> the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">n</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">sa</span><span class="main">)</span> <span class="main">∉</span> exec_event <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">n</span> <span class="main">∼</span> <span class="bound">sa</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1_integrity <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 non_interference1_def non_interference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span><span class="quoted"><span class="quoted">"ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessionInREECtxList <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span><span class="free">ses_id</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="free">time_out</span><span class="main">,</span>param3<span class="main">=</span>None<span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>param5<span class="main">=</span>None<span class="main">,</span>
                param6<span class="main">=</span>Some <span class="free">cmd_id</span><span class="main">,</span>param7<span class="main">=</span>Some <span class="free">in_params</span><span class="main">,</span>param8<span class="main">=</span>Some <span class="free">out_params</span><span class="main">,</span>param9<span class="main">=</span>None<span class="main">,</span>
                param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">,</span> param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">,</span>
                param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param</span><span class="main">,</span>TEEC_IC2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesin_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessionInREECtxList <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1<span class="main">=</span><span class="free">ses_id</span><span class="main">,</span>param2<span class="main">=</span>Some <span class="free">time_out</span><span class="main">,</span>param3<span class="main">=</span>None<span class="main">,</span>param4<span class="main">=</span>None<span class="main">,</span>param5<span class="main">=</span>None<span class="main">,</span>
                param6<span class="main">=</span>Some <span class="free">cmd_id</span><span class="main">,</span>param7<span class="main">=</span>Some <span class="free">in_params</span><span class="main">,</span>param8<span class="main">=</span>Some <span class="free">out_params</span><span class="main">,</span>param9<span class="main">=</span>None<span class="main">,</span>
                param10<span class="main">=</span>Some <span class="main">(</span>fst <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">,</span> param11<span class="main">=</span>Some <span class="main">(</span>snd <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">,</span>
                param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>current<span class="main">:=</span>TEE sysconf<span class="main">,</span>exec_prime<span class="main">:=</span><span class="main">(</span><span class="var">?param_t</span><span class="main">,</span>TEEC_IC2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    
    <span class="comment1">(*
      hyperc (TEEC_INVOKECOMMAND1 ses_id timeout cmd pt1 pt2) ⇒{fst (TEEC_InvokeCommand1 sysconf s ses_id timeout cmd pt1 pt2)}
    *)</span>
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand1 sysconf <span class="skolem">s</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand1 sysconf <span class="skolem">t</span> <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span>   
    <span class="keyword1"><span class="command">have</span></span> a14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>findSesCliTid <span class="skolem">s</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>findSesCliTid <span class="skolem">t</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a51 findSesCliTid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None<span class="main">∨</span><span class="main">(</span>findSesCliTid <span class="skolem">s</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None<span class="main">∨</span><span class="main">(</span>findSesCliTid <span class="skolem">t</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a5 a14 True a12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a10 TEEC_InvokeCommand1_def True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a11 TEEC_InvokeCommand1_def d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b1 b2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None<span class="main">∨</span><span class="main">(</span>findSesCliTid <span class="skolem">s</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">t</span> <span class="main">≠</span> REE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span><span class="main">[]</span> 
      <span class="main">∨</span> <span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None<span class="main">∨</span><span class="main">(</span>findSesCliTid <span class="skolem">t</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a5 a14 d2 a12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True d2 TEEC_InvokeCommand1_def a10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin_t</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True d2 TEEC_InvokeCommand1_def a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a3 b3 b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sesin_t</span> <span class="main">=</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d3 d4 TEEC_InvokeCommand1_def a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TEE_def b3 b5 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_REE_def b3 b5 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TA_def b3 b5 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def d7 d6 d5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sesin</span> <span class="main">=</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d2 d8 TEEC_InvokeCommand1_def a10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin_t</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True TEEC_InvokeCommand1_def a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TEE_def b6 b7 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_REE_def b6 b7 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_TA_def b6 b7 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d8 d9 d10 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sesin_t</span> <span class="main">=</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d11 d3 TEEC_InvokeCommand1_def a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand1_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND1 <span class="free">ses_id</span> <span class="free">time_out</span> <span class="free">cmd_id</span> <span class="free">in_params</span> <span class="free">out_params</span> <span class="free">memBlock_memRef</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand1_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand2"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2 sysconf <span class="var">?s_rev_event</span> <span class="var">?ses_id</span> <span class="var">?time_out</span> <span class="var">?cmd_id</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?s_invoke</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_origin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>    

    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_InvokeCommand2 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_def a4_1 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">using</span></span> vpeq_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_state</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_def a4_1 d1 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_state</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a4_1 d2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> tmp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> a2 tmp1 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert the target *)</span>
              <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                                <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              
              <span class="comment1">(* ree_total_size proof step *)</span>
              <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ree_total_size_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e3 e4<span class="main">)</span> 
              <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_state</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> e5 e6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

              <span class="comment1">(* driver_mem proof step *)</span>
              <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> e9<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> e10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> e9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> e11<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> e6 e10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              
              <span class="comment1">(* Proof of summary *)</span>
              <span class="keyword1"><span class="command">have</span></span> e12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> e13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                          <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e11 e7<span class="main">)</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> e12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False p2<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> is_TA sysconf <span class="skolem">d</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert the target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False True p2 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 

                  <span class="comment1">(* tee_memories proof step *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e2 e3<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_state</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
                     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                     <span class="keyword1"><span class="command">using</span></span> e4 e5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                
                  <span class="comment1">(* Proof of summary *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                         <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e6<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e8
                    <span class="keyword1"><span class="command">using</span></span> e7 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> p6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> False p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False is_TA_def p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2_integrity_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_integrity integrity_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2 sysconf <span class="var">?s_rev_event</span> <span class="var">?ses_id</span> <span class="var">?time_out</span> <span class="var">?cmd_id</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?s_invoke</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_origin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_invokeTACommand_TEEDomain2 sysconf <span class="var">?t_rev_event</span> <span class="var">?ses_id_t</span> <span class="var">?time_out_t</span> <span class="var">?cmd_id_t</span> <span class="var">?in_params_t</span> <span class="var">?out_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_state</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?t_invoke</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_origin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="var">?t_invoke</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span>
    
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a5 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b1 TEEC_InvokeCommand2_def a10 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fstI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b2 TEEC_InvokeCommand2_def a11
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fstI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a3 b3 b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_state</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_def a10 d1 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_state</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a10 d2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC2<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a5 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_state</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand2 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_def a11 d4
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_state</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a11 d5<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d7<span class="main">)</span> 
              <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d7<span class="main">)</span> 
              <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

              <span class="comment1">(* Proof tee_memories *)</span>
              <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                     <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> h6 h7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> h10 h9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

              <span class="comment1">(* Proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                     <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> h5 h8 h11 h12 h13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">using</span></span> d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> g5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">have</span></span> g6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          
              <span class="comment1">(* step1: Proof ree_total_size *)</span>
              <span class="keyword1"><span class="command">have</span></span> g7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">have</span></span> g8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ree_total_size_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
              <span class="keyword1"><span class="command">have</span></span> g9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> g10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">have</span></span> g11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ree_total_size_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> g12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              
              <span class="comment1">(* step2: Proof driver_mem *)</span>
              <span class="keyword1"><span class="command">have</span></span> g13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> g14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> g15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> g16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> g17<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">have</span></span> g18<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              
              <span class="comment1">(* Proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> g19<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> g20<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d6<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> g21<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g13 g14 g15 g16 g6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
              <span class="keyword1"><span class="command">have</span></span> g22<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> g21 g19 g20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">have</span></span> g23<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> g24<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d6<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> g25<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_state</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_state</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g10 g11 g5 g9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">have</span></span> g26<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>  
                <span class="keyword1"><span class="command">using</span></span> g23 g24 g25 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">have</span></span> g27<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g22 g26<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d8<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False True d8 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True d8 vpeq1_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    
                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a3 f3 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                    <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_invokeTACommand_TEEDomain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f6 f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f7 f9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_state</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d6<span class="main">)</span>
                    
                    <span class="comment1">(* proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f10 f12 f13 f5 f7 f9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand2_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND2<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand2_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand3"</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="skolem">s</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="skolem">s</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPoint sysconf <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_MgrPostOps <span class="var">?s_invoke</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?s_postOps</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_InvokeCommand3 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand3 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a3 a4  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def a4_1 k1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fstI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> vpeq_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> k4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_error_ret</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def a4_1 k4 k3
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> a4_1 old.prod.inject prod.collapse<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p5<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_error_ret</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> b1 e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> p6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> p7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> p6 p7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                            <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_error_ret</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> ree_total_size_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_error_ret</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> b1 f1 f2 f3 f4 f5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> p8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> p9<span class="main">:</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> p6 p8 p9 vpeq1_def<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_error_ret</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> b1 g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> p10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> p11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> p10 p6 p8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                       <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                         <span class="keyword1"><span class="command">using</span></span> is_TA_def p10 p6 p8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                     <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>  
            <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3 <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> k3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_success_ret</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_InvokeCommand3_def a4_1 b2 fst_conv<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p0<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  
                <span class="comment1">(* step1: exec_prime tl *)</span>
                <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="comment1">(* step2: TA_InvokeCommandEntryPoint *)</span>
                <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_not_change_TEE
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="comment1">(* step3: setTaInsBusyByThreadId *)</span>
                <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> h5_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_postOps</span> <span class="main">=</span> TEE_MgrPostOps <span class="var">?s_invoke</span> <span class="var">?server_tid</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h5_1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_MgrPostOps <span class="var">?s_invoke</span> <span class="var">?server_tid</span> <span class="main">=</span> setTaInsBusyByThreadId <span class="var">?s_invoke</span> <span class="var">?server_tid</span> False"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> h5_2<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>setTaInsBusyByThreadId <span class="var">?s_invoke</span> <span class="var">?server_tid</span> False<span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def<span class="main">)</span> 
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="comment1">(* summary proof *)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_not_change_TEE b3 h1 h5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                            <span class="main">∧</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                    <span class="comment1">(* step1: ree_total_size *)</span>
                    <span class="keyword1"><span class="command">have</span></span> i3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> i4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> ree_total_size_TA_InvokeCommandEntryPoint
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> i5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def ree_total_size_setTaInsBusy<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> i5_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_setCurDomainAndEvent<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> i6<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> b3 i3 i4 i5 i5_1
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="comment1">(* step2: driver_mem *)</span>
                    <span class="keyword1"><span class="command">have</span></span> i7<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> i8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> driver_mem_TA_InvokeCommandEntryPoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> i9<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def driver_mem_tee_setTaInsBusy<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> i9_1<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_tee_setCurDomainAndEvent<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> i10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> b3 i7 i8 i9 i9_1
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> i1 i6 i10 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False p2<span class="main">)</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> is_TA sysconf <span class="skolem">d</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">have</span></span> tmp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                        <span class="keyword1"><span class="command">using</span></span> a2 p5 tmp1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">case</span></span> False
                    <span class="keyword1"><span class="command">have</span></span> tmp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> current <span class="skolem">s</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>  
                          <span class="keyword1"><span class="command">{</span></span>
                            <span class="comment1">(* Convert proof target *)</span>
                            <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="var">?server_tid</span>"</span></span>
                              <span class="keyword1"><span class="command">using</span></span> b2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                            <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?server_tid</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
                              <span class="keyword1"><span class="command">using</span></span> d0 tmp2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                            <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> p5 vpeq1_def<span class="main">)</span> 
                            <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                                                        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                            
                            <span class="comment1">(* step1: exec_prime *)</span>
                            <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                            <span class="comment1">(* step2: TA_InvokeCommandEntryPoint *)</span>
                            <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                                          <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                              <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_not_change_other_TA
                              <span class="keyword1"><span class="command">using</span></span> d0 tee_memories_TA_InvokeCommandEntryPoint tmp2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
                            <span class="comment1">(* step3: TEE_MgrPostOps *)</span>
                            <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def tee_memories_setTaInsBusy<span class="main">)</span>
                            <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_setCurDomainAndEvent<span class="main">)</span> 
                            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                              <span class="keyword1"><span class="command">using</span></span> b3 d2 d5 d6 d7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                          <span class="keyword1"><span class="command">}</span></span>
                        <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span> 
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> False is_TA_def p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>   
            <span class="keyword1"><span class="command">qed</span></span>   
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3_integrity_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_integrity integrity_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span> <span class="quoted"><span class="quoted">"TAs_state <span class="skolem">s</span> <span class="main">=</span>TAs_state <span class="skolem">t</span>  "</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="skolem">s</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="skolem">s</span> <span class="var">?sesID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPoint sysconf <span class="var">?s_rev_event</span> <span class="var">?cmd_id</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_MgrPostOps <span class="var">?s_invoke</span> <span class="var">?server_tid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?s_postOps</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?serverID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesServTid <span class="skolem">t</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?server_tid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findSesServTid <span class="skolem">t</span> <span class="var">?sesID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServTaState_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?serverID_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curServSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_sessions <span class="main">(</span>the <span class="var">?curServTaState_t</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSessIdInSessList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaInsSessList <span class="var">?curServSessList_t</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_invoke</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_InvokeCommandEntryPoint sysconf <span class="var">?t_rev_event</span> <span class="var">?cmd_id_t</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_postOps</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_MgrPostOps <span class="var">?t_invoke</span> <span class="var">?server_tid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?post_param_ops_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_post_param_operation <span class="var">?in_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_error_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_ERROR_BAD_PARAMETERS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_error_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_error_t</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_success_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> None<span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> 
              param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
              param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span>Some TEEC_SUCCESS<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_success_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_postOps</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_success_t</span><span class="main">,</span> TEEC_IC4<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand3 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand3 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span>   
    <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 vpeq1_def a51 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sesID</span> <span class="main">=</span> <span class="var">?sesID_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> a15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?serverID</span> <span class="main">=</span> <span class="var">?serverID_t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> mgr_ta_sessions_findSesServTid
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a13 a5<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> a16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> <span class="var">?ses_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> a17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cmd_id</span> <span class="main">=</span> <span class="var">?cmd_id_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSessIdInSessList</span> <span class="main">=</span> <span class="var">?isSessIdInSessList_t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a52 isSessIdInTaInsSessList_def
                  <span class="keyword1"><span class="command">using</span></span> a15 a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a15 a5 k1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def k1 a10
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> k4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def k2 a11
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a3 k3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> k5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> k6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a15 a5 k5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a12 a5 b1 a15 a18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_error_ret</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def b1 a10 k5
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_error_ret</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_def b2 a11 k6
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d6<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> i3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d6<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> i4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> i5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 i3 i4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                
                <span class="comment1">(* Proof tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> i6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> i7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_error_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> i8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> i9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_error_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> i10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                     <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> i6 i7 i8 i9 b3 b4 i5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> i1 i2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> j3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                 <span class="comment1">(* step: Proof ree_total_size and driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> j6<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j6_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_error_ret</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j7_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_error_ret</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j8_1<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_error_ret</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j9<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j9_1<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_error_ret</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 j3 j4 j8 j9<span class="main">)</span>  
                <span class="keyword1"><span class="command">have</span></span> j11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> j5 j6 j7<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_error_ret</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b3<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_error_ret</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b4<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_error_ret</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b3<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_error_ret</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b4<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j10 j11 j12 j13 j14 j15
                  <span class="keyword1"><span class="command">using</span></span> j6_1 j7_1 j8_1 j9_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> j1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d8<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span> <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True d8 vpeq1_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False True d8 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  <span class="keyword1"><span class="command">have</span></span> k4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> k5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 k3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                  <span class="comment1">(* Proof tee_memories *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> k7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_error_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> k8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> k9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_error_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    
                  <span class="comment1">(* Proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> k5 k6 k7 k8 k9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> b4 b3 d11 k1 k2 k7 k9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False d10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> <span class="var">?server_tid</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3 <span class="main">∨</span> <span class="var">?ses_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False k5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_success_ret</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> False Pair_inject State.surjective State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_InvokeCommand3_def a10 p1 surjective_pairing<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?exec_t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> TEE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">=</span> REE sysconf <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> <span class="var">?server_tid_t</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC3 <span class="main">∨</span> <span class="var">?ses_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?cmd_id_t</span> <span class="main">=</span> None <span class="main">∨</span> <span class="var">?isSessIdInSessList_t</span> <span class="main">≠</span> True <span class="main">∨</span> <span class="var">?serverID_t</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a12 a15 a18 a5 p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_success_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a11 TEE_InvokeTACommand3_def a12 a15 a5 p3 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> False Pair_inject State.surjective State.update_convs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> TEEC_InvokeCommand3_def a10 p1 surjective_pairing<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> l3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g1<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> l4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> l5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 l3 l4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                
                <span class="comment1">(* Proof tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> l6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
                <span class="keyword1"><span class="command">have</span></span> l7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_not_change_TEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> l8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> TEE_MgrPostOps_def tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> l8_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> l9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
                <span class="keyword1"><span class="command">have</span></span> l10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_not_change_TEE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> l11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> TEE_MgrPostOps_def tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> l11_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> l12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> l6 l7 l8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> l13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> l10 l11 l9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">have</span></span> l14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                     <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> l12 l13 l2 l5 p2 p4 l11_1 l8_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> l1 l2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> True g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> True g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> vpeq_REE_def<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 m3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 m3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                  <span class="comment1">(* step1: Proof ree_total_size *)</span>
                  <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> ree_total_size_TA_InvokeCommandEntryPoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                  <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def ree_total_size_setTaInsBusy<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> m10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_setCurDomainAndEvent<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> m10_sree<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> m8 m9 m10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> m7_t<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> m8_t<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_invoke</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> ree_total_size_TA_InvokeCommandEntryPoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                  <span class="keyword1"><span class="command">have</span></span> m9_t<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_invoke</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_postOps</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def ree_total_size_setTaInsBusy<span class="main">)</span>  
                  <span class="keyword1"><span class="command">have</span></span> m10_t<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_postOps</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_setCurDomainAndEvent<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> m10_sree<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> m8_t m9_t m10_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  
                  
                  <span class="comment1">(* step2: Proof driver_mem *)</span>
                  <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
                  <span class="keyword1"><span class="command">have</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> driver_mem_TA_InvokeCommandEntryPoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> m13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_invoke</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def driver_mem_tee_setTaInsBusy<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> m13_1<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_postOps</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_tee_setCurDomainAndEvent<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> m14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> m12 m13 m13_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> m11_t<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
                  <span class="keyword1"><span class="command">have</span></span> m12_t<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_invoke</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> driver_mem_TA_InvokeCommandEntryPoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> m13_t<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_invoke</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_postOps</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_MgrPostOps_def driver_mem_tee_setTaInsBusy<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> m13_t_1<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_postOps</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_tee_setCurDomainAndEvent<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> m14_t<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_postOps</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> m12_t m13_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                  <span class="comment1">(* Proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> m15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> m16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p4<span class="main">)</span>  
                  <span class="keyword1"><span class="command">have</span></span> m17<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> m11_t m12_t m13_t m13_t_1 m14 m6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  <span class="keyword1"><span class="command">have</span></span> m18<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m15 m16 m17<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> m19<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> m20<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p4<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> m21<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_success_ret</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_success_ret</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> m10 m10_t m5 m7 m7_t m8 m8_t m9 m9_t <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="keyword1"><span class="command">have</span></span> m22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m18 m19 m20 m21<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g2<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="var">?server_tid</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> f9_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="var">?server_tid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> f9_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="var">?server_tid_t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True
                  <span class="keyword1"><span class="command">using</span></span> a15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> g5 vpeq1_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                    <span class="keyword1"><span class="command">have</span></span> n3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> g5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> n5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a3 n3 n4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> n6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                        <span class="keyword1"><span class="command">{</span></span>
                          <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span> TEE_state <span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> f9_1 tee_memories_TA_InvokeCommandEntryPoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                        <span class="keyword1"><span class="command">}</span></span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">have</span></span> n8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TEE_MgrPostOps_def tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n8_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> n10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f9_2 tee_memories_TA_InvokeCommandEntryPoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TEE_MgrPostOps_def tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n11_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">have</span></span> n12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> n10 n11 n9 n11_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                    
                    <span class="comment1">(* Proof Target *)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> n1 n2 n5 n6 n7 n8 n8_1 p2 p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> f10_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="var">?server_tid</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> f10_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="var">?server_tid_t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
                  <span class="keyword1"><span class="command">using</span></span> a15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> f11_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False p1<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> f11_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a12 f11_1<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a3 g5 vpeq1_def<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> g5 vpeq1_def<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> f13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> a3 f12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> f12 m4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                     
                      <span class="comment1">(* Proof tee_memories *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="comment1">(* d = current d TA_InvokeCommandEntryPoint() may change tee_memories *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                       <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_def OpenSessionEntryPoint_not_change_mem TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> TEE_MgrPostOps_def tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                      <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m7 m8 tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                      
                      <span class="keyword1"><span class="command">have</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> TA_InvokeCommandEntryPoint_def OpenSessionEntryPoint_not_change_mem TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_invoke</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> TEE_MgrPostOps_def tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                      <span class="keyword1"><span class="command">have</span></span> m15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_postOps</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                      <span class="keyword1"><span class="command">have</span></span> m17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m13 m14 tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                      
                      <span class="comment1">(* Proof Target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p2<span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> m19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_success_ret</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p4<span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m18 m19
                        <span class="keyword1"><span class="command">using</span></span> m11 m17 m5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> m1 m2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> g4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False g4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand3_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND3<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand3_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_InvokeCommand4"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?teec_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param12 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tee_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param13 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span> 
          param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
          param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span><span class="var">?teec_ret_code</span><span class="main">,</span> param13<span class="main">=</span><span class="var">?tee_ret_code</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_call_closeSession</span><span class="main">,</span> TEEC_CS2<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def a4_1 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> vpeq_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> d1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_call_closeSession</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def a4_1 d1 d1_1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_call_closeSession</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a4_1 d2<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> tmp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> a2 tmp1 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert the target *)</span>
                <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                                  <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* ree_total_size proof step *)</span>
                <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e3 e4<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_call_closeSession</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d4<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> e5 e6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* driver_mem proof step *)</span>
                <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> e9<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> e9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e11<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> e6 e10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* Proof of summary *)</span>
                <span class="keyword1"><span class="command">have</span></span> e12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                            <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e11 e7<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">using</span></span> e12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False p2<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> is_TA sysconf <span class="skolem">d</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert the target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False True p2 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 

                  <span class="comment1">(* tee_memories proof step *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    
                  <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e2 e3<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_call_closeSession</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d4<span class="main">)</span>
                    
                  <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                     <span class="keyword1"><span class="command">using</span></span> e4 e5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                
                  <span class="comment1">(* Proof of summary *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                         <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e6<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e8
                    <span class="keyword1"><span class="command">using</span></span> e7 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> p6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False is_TA_def p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
           <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> p7_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">=</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> p7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span><span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> p8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_rev_event</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> p7 a4_1 TEEC_InvokeCommand4_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> tmp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">using</span></span> a2 tmp1 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert the target *)</span>
                <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                                  <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* ree_total_size proof step *)</span>
                <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* driver_mem proof step *)</span>
                <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* Proof of summary *)</span>
                <span class="keyword1"><span class="command">have</span></span> e12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                            <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> e3 e8 p8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">using</span></span> e12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False p2<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> is_TA sysconf <span class="skolem">d</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False True p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert the target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False True p2 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="comment1">(* Proof of summary *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                         <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> p8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e8
                    <span class="keyword1"><span class="command">using</span></span> e7 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> p6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False is_TA_def p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
           <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">qed</span></span>
        <span class="comment1">(*
        have p8: "s' = s"
          using p7
          by (metis a2 domain_of_event_def ins_tee_intf_all non_interference1_def option.sel)
        then show ?thesis
          by (metis a2 domain_of_event_def interference1_def is_TEE_def non_interference1_def option.sel p7)
        *)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4_integrity_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_integrity integrity_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?teec_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param12 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tee_ret_code</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param13 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span> 
          param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> <span class="var">?cmd_id</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
          param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span><span class="var">?teec_ret_code</span><span class="main">,</span> param13<span class="main">=</span><span class="var">?tee_ret_code</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?s_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_call_closeSession</span><span class="main">,</span> TEEC_CS2<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?time_out_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?teec_ret_code_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param12 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tee_ret_code_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param13 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?param_call_closeSession_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?time_out_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="main">⦇</span>login<span class="main">=</span>DTC_IDENTITY<span class="main">,</span>id<span class="main">=</span>Some <span class="main">0</span><span class="main">⦈</span><span class="main">,</span> 
          param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> <span class="var">?cmd_id_t</span><span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span>
          param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12<span class="main">=</span><span class="var">?teec_ret_code_t</span><span class="main">,</span> param13<span class="main">=</span><span class="var">?tee_ret_code_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_call_closeSession</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setCurDomainAndEvent <span class="var">?t_rev_event</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">(</span><span class="var">?param_call_closeSession_t</span><span class="main">,</span> TEEC_CS2<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a12 a5 b1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b1 TEEC_InvokeCommand4_def a10 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fstI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b2 TEEC_InvokeCommand4_def a11
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fstI<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> a3 b3 b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_IC4 <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a5 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code_t</span> <span class="main">≠</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a5 p3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_call_closeSession</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def a10 d1 p3 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> p6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_call_closeSession</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a10 p5<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> p7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_call_closeSession</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def a10 d2 p4 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> p8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_call_closeSession</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a11 p7<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d7<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d7<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="comment1">(* Proof tee_memories *)</span>
                  <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                         <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> h6 h7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> h10 h9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p6<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p8<span class="main">)</span>
                    
                  <span class="comment1">(* Proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                         <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> h5 h8 h11 h12 h13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> g5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    
                <span class="comment1">(* step1: Proof ree_total_size *)</span>
                <span class="keyword1"><span class="command">have</span></span> g7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> g8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> g11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                
                <span class="comment1">(* step2: Proof driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> g13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">have</span></span> g15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g17<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g18<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> g19<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p6<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g20<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p8<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g21<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g13 g14 g15 g16 g6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">have</span></span> g22<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> g21 g19 g20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">have</span></span> g23<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p6<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g24<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p8<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g25<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_call_closeSession</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_call_closeSession</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g10 g11 g5 g9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">have</span></span> g26<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> g23 g24 g25 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">have</span></span> g27<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g22 g26<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d8<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False True d8 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True d8 vpeq1_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a3 f3 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f6 f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> f11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f7 f9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p6<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_call_closeSession</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p8<span class="main">)</span>

                    <span class="comment1">(* proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f10 f12 f13 f5 f7 f9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code</span> <span class="main">=</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?teec_ret_code_t</span> <span class="main">=</span> <span class="main">(</span>Some TEEC_SUCCESS<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a5 p3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def a10 d1 p3 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> p6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a10 p5<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> p7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_InvokeCommand4 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_def a10 d2 p4 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> p8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a11 p7<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d7<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d7<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="comment1">(* Proof tee_memories *)</span>
                  <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> tee_memories_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p6<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p8<span class="main">)</span>
                  <span class="comment1">(* Proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                         <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> h12 h13 h5 h6 h9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> g5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    
                <span class="comment1">(* step1: Proof ree_total_size *)</span>
                <span class="keyword1"><span class="command">have</span></span> g7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> g10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                
                <span class="comment1">(* step2: Proof driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> g13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> g19<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p6<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g20<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p8<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g21<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> g13 g15 g6<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> g22<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> g21 g19 g20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">have</span></span> g25<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g10 g5 g7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                <span class="keyword1"><span class="command">have</span></span> g26<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> g25 p6 p8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g27<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g22 g26<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d8<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False d8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False True d8 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True d8 vpeq1_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a3 f3 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    
                    <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p6<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p8<span class="main">)</span>
                    <span class="comment1">(* proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> f14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f12 f13 f5 f6 f7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_InvokeCommand4_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_INVOKECOMMAND4<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_InvokeCommand4_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_CloseSession proof"</span></span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"TEEC_CloseSession1"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession1_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION1 <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientTid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesCliTid <span class="skolem">s</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessionInREECtxList <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeSessionInContext <span class="var">?s_rev_event</span> <span class="free">fd</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pre_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_param_operation <span class="main">(</span>Some <span class="free">in_params</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getTAInsCtx <span class="var">?s1</span> <span class="main">(</span>the <span class="var">?clientTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taId_cli</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ta_id <span class="var">?taIns</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nextFuncStepParam</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="free">ses_id</span><span class="main">,</span> param2 <span class="main">=</span> None<span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="var">?ca</span><span class="main">,</span>
               param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span>None<span class="main">,</span> param7 <span class="main">=</span>Some <span class="free">in_params</span><span class="main">,</span> param8 <span class="main">=</span>Some <span class="free">out_params</span><span class="main">,</span> 
               param9 <span class="main">=</span> None<span class="main">,</span>param10<span class="main">=</span>None<span class="main">,</span> param11<span class="main">=</span>None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s1</span><span class="main">)</span><span class="main">⦈</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_CloseSession1 sysconf <span class="bound">s</span> <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession1 sysconf <span class="skolem">s</span> <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_pre_param_operation_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span>  current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span>  current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b1 TEEC_CloseSession1_def a4_1
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fstI<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span>  current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_pre_param_operation_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> d1_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin</span> <span class="main">=</span> False"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_rev_event</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a4_1 d1 d1_1 d2 TEEC_CloseSession1_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b2<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="comment1">(* step1: tee_memories *)</span>
                  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="comment1">(* Proof result *)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">using</span></span> d6 f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="comment1">(* Convert the target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b3 b4 vpeq1_def<span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                                                <span class="main">∧</span> driver_mem <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="comment1">(* step1: ree_total_size proof step *)</span>
                      <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      
                      <span class="comment1">(* step2: ree_total_size proof step *)</span>
                      <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                      
                      <span class="comment1">(* Proof result *)</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d6 e1 e2 e3<span class="main">)</span> 
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b3<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                        <span class="keyword1"><span class="command">{</span></span>
                          <span class="comment1">(* Convert the target *)</span>
                          <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> False True b3 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                                                        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="comment1">(* step1: tee_memories *)</span>
                          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                          <span class="comment1">(* Proof result *)</span>
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command">using</span></span> d1 d2 d6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                        <span class="keyword1"><span class="command">}</span></span>
                   <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                        <span class="keyword1"><span class="command">{</span></span>
                          <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> False b5 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                        <span class="keyword1"><span class="command">}</span></span>
                      <span class="keyword1"><span class="command">qed</span></span> 
                   <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span>  current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?sesin</span> <span class="main">=</span> False<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span>  current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?sesin</span> <span class="main">=</span> False<span class="main">)</span> <span class="main">∧</span> <span class="var">?pre_param_ops</span> <span class="main">≠</span> TEE_SUCCESS<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a4_1 d1 d2 d3 d4 TEEC_CloseSession1_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b2<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  
                  <span class="comment1">(* step1: tee_memories *)</span>
                  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> State.select_convs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> State.surjective State.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                  <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> f3 f4 f5
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="comment1">(* Proof result *)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">using</span></span> d6 f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="comment1">(* Convert the target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b3 b4 vpeq1_def<span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                                                <span class="main">∧</span> driver_mem <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="comment1">(* step1: ree_total_size proof step *)</span>
                      <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> ree_total_size_removeSessionInContext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s2</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d6<span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> e5_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> e5  e4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      
                      <span class="comment1">(* step2: ree_total_size proof step *)</span>
                      <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                      <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeSessionInContext<span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> e5 e6 e7
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                      
                      <span class="comment1">(* Proof result *)</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> e5 e8 e1 e2 e5_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b3<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                        <span class="keyword1"><span class="command">{</span></span>
                          <span class="comment1">(* Convert the target *)</span>
                          <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> False True b3 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                          <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                                                        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="comment1">(* step1: tee_memories *)</span>
                          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                          <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s2</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> tee_memories_removeSessionInContext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="comment1">(* Proof result *)</span>
                          <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s2</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d6<span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> d3 d4 d5 d6
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                            <span class="keyword1"><span class="command">using</span></span> d2 d5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                        <span class="keyword1"><span class="command">}</span></span>
                   <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False b5 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>   
  <span class="keyword1"><span class="command">}</span></span>  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession1_integrity_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION1 <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession1_integrity integrity_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def 

  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> integrity_e <span class="bound">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">s</span> <span class="bound">sa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> reachable0 <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span> non_interference <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">sa</span><span class="main">)</span> <span class="main">∉</span> exec_event <span class="bound">e</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">n</span> <span class="main">∼</span> <span class="bound">sa</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> integrity_e_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Event <span class="main">⇒</span> State"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Event <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ssa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Event <span class="main">⇒</span> State"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> integrity_e <span class="bound">e</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">s</span> <span class="bound">sa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> reachable0 <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span> non_interference <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">sa</span><span class="main">)</span> <span class="main">∉</span> exec_event <span class="bound">e</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">n</span> <span class="main">∼</span> <span class="bound">sa</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>integrity_e <span class="bound">e</span> <span class="main">∨</span> <span class="main">(</span>reachable0 <span class="main">(</span><span class="skolem">ss</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> non_interference <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="main">(</span><span class="skolem">ss</span> <span class="bound">e</span><span class="main">)</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ss</span> <span class="bound">e</span><span class="main">,</span> <span class="skolem">ssa</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">ss</span> <span class="bound">e</span> <span class="main">∼</span> <span class="skolem">nn</span> <span class="bound">e</span> <span class="main">∼</span> <span class="skolem">ssa</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">s</span> <span class="bound">sa</span><span class="main">.</span> <span class="main">¬</span> reachable0 <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span> the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION1 <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">n</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">sa</span><span class="main">)</span> <span class="main">∉</span> exec_event <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION1 <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∼</span> <span class="bound">n</span> <span class="main">∼</span> <span class="bound">sa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> TEEC_CloseSession1_integrity<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 non_interference1_def non_interference_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession1_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION1 <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientTid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesCliTid <span class="skolem">s</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessionInREECtxList <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeSessionInContext <span class="var">?s_rev_event</span> <span class="free">fd</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pre_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_param_operation <span class="main">(</span>Some <span class="free">in_params</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getTAInsCtx <span class="var">?s1</span> <span class="main">(</span>the <span class="var">?clientTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taId_cli</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ta_id <span class="var">?taIns</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nextFuncStepParam</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="free">ses_id</span><span class="main">,</span> param2 <span class="main">=</span> None<span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="var">?ca</span><span class="main">,</span>
               param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span>None<span class="main">,</span> param7 <span class="main">=</span>Some <span class="free">in_params</span><span class="main">,</span> param8 <span class="main">=</span>Some <span class="free">out_params</span><span class="main">,</span> 
               param9 <span class="main">=</span> None<span class="main">,</span> param10<span class="main">=</span>None<span class="main">,</span> param11<span class="main">=</span>None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s1</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s1</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientTid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesCliTid <span class="skolem">t</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesin_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessionInREECtxList <span class="main">(</span>tee_ctx_list <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeSessionInContext <span class="var">?t_rev_event</span> <span class="free">fd</span> <span class="main">(</span>the <span class="free">ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pre_param_ops_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_param_operation <span class="main">(</span>Some <span class="free">in_params</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taIns_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getTAInsCtx <span class="var">?t1</span> <span class="main">(</span>the <span class="var">?clientTid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taId_cli_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ta_id <span class="var">?taIns_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ca_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DefaultClientID"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nextFuncStepParam_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="free">ses_id</span><span class="main">,</span> param2 <span class="main">=</span> None<span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> Some <span class="var">?ca_t</span><span class="main">,</span>
               param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span>None<span class="main">,</span> param7 <span class="main">=</span>Some <span class="free">in_params</span><span class="main">,</span> param8 <span class="main">=</span>Some <span class="free">out_params</span><span class="main">,</span> 
               param9 <span class="main">=</span> None<span class="main">,</span> param10<span class="main">=</span>None<span class="main">,</span> param11<span class="main">=</span>None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t1</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam_t</span><span class="main">,</span> TEEC_CS2<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?t1</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
 
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession1 sysconf <span class="skolem">s</span> <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession1 sysconf <span class="skolem">t</span> <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 vpeq1_def a51 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?clientTid</span> <span class="main">=</span> <span class="var">?clientTid_t</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> a13  mgr_ta_sessions_findSesCliTid
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>    
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a5 b1 a15
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b1 TEEC_CloseSession1_def a10
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b2 TEEC_CloseSession1_def a11 findSesServTid_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> a3 b3 b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">s</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">ses_id</span> <span class="main">=</span> None <span class="main">∨</span> current <span class="skolem">t</span> <span class="main">≠</span> REE sysconf<span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS1<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 a12 a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True d1 TEEC_CloseSession1_def a10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin_t</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t_rev_event</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True d2 TEEC_CloseSession1_def a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b5 b6 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sesin_t</span> <span class="main">=</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops_t</span> <span class="main">≠</span> TEE_SUCCESS"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True d3 d2 TEEC_CloseSession1_def a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True b5 b7 a3 vpeq_TEE_def removeSessionInContext_def
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> filter_related tee_memories_exec_prime_tl tee_memories_removeSessionInContext vpeq1_def<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b57<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> a3 True d4 b5 b7 removeSessionInContext_def vpeq_REE_def vpeq1_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> ree_total_size_exec_prime_tl ree_total_size_removeSessionInContext<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> b57_1<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> a3 True d4 b5 b7 removeSessionInContext_def vpeq_REE_def vpeq1_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> driver_mem_exec_prime_tl driver_mem_removeSessionInContext<span class="main">)</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b57 b57_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="keyword1"><span class="command">have</span></span> b57_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> True vpeq1_def vpeq_TA_def b5 d4 d5
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> b57_3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> b7 True vpeq1_def vpeq_TA_def
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> b57_4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> b7 True vpeq1_def vpeq_TA_def removeSessionInContext_def tee_memories_removeSessionInContext 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>    
                      <span class="keyword1"><span class="command">have</span></span> b57_5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> b57_3 b57_4
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b57_2 b57_5 a3 b5 b7 vpeq1_def vpeq_TA_def True
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def d5 d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def d4 d5
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?pre_param_ops_t</span> <span class="main">≠</span> TEE_SUCCESS<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d6 d3 d2 TEEC_CloseSession1_def a11
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True b5 b8 a3 vpeq_TEE_def removeSessionInContext_def vpeq1_def
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6 d1 domain_of_event_def ins_no_intf_tee option.collapse option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.inject tee_no_ree<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b58<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> b5
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_1<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> b5
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_2<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_3<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def ree_total_size_removeSessionInContext
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_4<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_8<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b8 b58_2 b58_3 b58_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_5<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_6<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def driver_mem_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_7<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b58_9<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b8 b58_5 b58_6 b58_7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_REE_def b58 b58_1 b58_8 b58_9 a3 True d7
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def d7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="keyword1"><span class="command">have</span></span> b58_10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> True vpeq1_def vpeq_TA_def b5 d7 d8
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> b58_11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> b8 True vpeq1_def vpeq_TA_def
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> b58_12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> b8 True vpeq1_def vpeq_TA_def removeSessionInContext_def tee_memories_removeSessionInContext 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>    
                      <span class="keyword1"><span class="command">have</span></span> b58_13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t2</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> b58_14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> b58_11 b58_12 b58_13 vpeq_TA_def True d7 d8 a6 d1 domain_of_event_def interference1_def is_TEE_def
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  option.collapse option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.inject tee_no_ree<span class="main">)</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b58_10 b58_14 a3 b5 b8 vpeq1_def vpeq_TA_def True
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a3 vpeq1_def True
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def d7 d8 False
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sesin</span> <span class="main">=</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops</span> <span class="main">≠</span> TEE_SUCCESS"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> d10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops_t</span> <span class="main">≠</span> TEE_SUCCESS"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> b9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True d9 d1 TEEC_CloseSession1_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_pre_param_operation_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?sesin_t</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t_rev_event</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True d2 TEEC_CloseSession1_def TEE_pre_param_operation_def d10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">using</span></span> True b9 b10 a3 vpeq_TEE_def removeSessionInContext_def vpeq1_def filter_related tee_memories_exec_prime_tl tee_memories_removeSessionInContext
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b910<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> b910_1<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b910_2<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b910_3<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ree_total_size_removeSessionInContext<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> b910_4<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b910_5<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def driver_mem_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b910 b910_1 b910_2 b910_3 b910_4 b910_5 vpeq_REE_def True a3 b9 d11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def d11
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="keyword1"><span class="command">have</span></span> b910_6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> True vpeq1_def vpeq_TA_def b10 d11 d12
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> b910_7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> b910_8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def tee_memories_removeSessionInContext 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b910_6 b910_7 b910_8 vpeq_TA_def True d11 d12 a3 vpeq1_def b9 b10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def d12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def d11 d12 False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sesin_t</span> <span class="main">=</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> b11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d13 d2 d10 TEEC_CloseSession1_def
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_pre_param_operation_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True b9 b11 a3 vpeq_TEE_def removeSessionInContext_def vpeq1_def filter_related tee_memories_exec_prime_tl tee_memories_removeSessionInContext
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b911<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_1<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ree_total_size_removeSessionInContext<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_2<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def driver_mem_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_4<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b911 b911_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_5<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b911_2 b911_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_6<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_7<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ree_total_size_removeSessionInContext<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_8<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_9<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def driver_mem_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_10<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b911_6 b911_7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_11<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b911_8 b911_9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq_REE_def b911_4 b911_5 b911_10 b911_11 True a3 b9 b11 d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def b9 b11 d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> d15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b911_12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def tee_memories_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b911_15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def tee_memories_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> b911_12 b911_13 b911_14 b911_15 vpeq_TA_def True d14 d15 a3 vpeq1_def b9 b11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def False d14 d15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?pre_param_ops</span> <span class="main">≠</span> TEE_SUCCESS<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> d17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?pre_param_ops_t</span> <span class="main">≠</span> TEE_SUCCESS<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> b12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">=</span><span class="var">?s2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d16 d1 d9 TEEC_CloseSession1_def a10
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?sesin_t</span> <span class="main">=</span> False<span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d2 True TEEC_CloseSession1_def a11 d17
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> False State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True b12 b13 a3 vpeq_TEE_def removeSessionInContext_def vpeq1_def filter_related tee_memories_exec_prime_tl tee_memories_removeSessionInContext
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6 d1 domain_of_event_def ins_no_intf_tee option.sel tee_no_ree<span class="main">)</span> 
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b1213<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_1<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ree_total_size_removeSessionInContext<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_2<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def driver_mem_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_4<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_5<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1213 b1213_1 b1213_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_6<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1213_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_7<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_8<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ree_total_size_removeSessionInContext<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_9<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_10<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_11<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def driver_mem_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_12<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_13<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1213_11  b1213_7 b1213_8 b1213_9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_14<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1213_11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b1213_13  b1213_14 b1213_5 b1213_6 vpeq_REE_def True a3 b12 b13 d18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def True d18 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> d19<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def tee_memories_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s2</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_19<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def tee_memories_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t2</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b1213_15 b1213_16 b1213_17 b1213_18 b1213_19 b1213_20 vpeq_TA_def True a3 b12 b13 d18 d19
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6 d1 domain_of_event_def ins_no_intf_tee interference1_def option.collapse option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.inject tee_no_ree<span class="main">)</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False vpeq1_def d18 d19 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> d20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?sesin_t</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> b14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">=</span><span class="var">?t_rev_event</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d20 d2 TEEC_CloseSession1_def a11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True b12 b14 a3 vpeq_TEE_def removeSessionInContext_def vpeq1_def filter_related tee_memories_exec_prime_tl tee_memories_removeSessionInContext
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6 d1 domain_of_event_def ins_no_intf_tee option.sel tee_no_ree<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span> 
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> d21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>TEE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b1213<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_1<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ree_total_size_removeSessionInContext<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_2<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_3<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def driver_mem_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_4<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s1</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_5<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1213 b1213_1 b1213_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_6<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b1213_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_7<span class="main">:</span><span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_10<span class="main">:</span><span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b1213_5 b1213_6 b1213_7 b1213_10 vpeq_REE_def True d21 a3 b12 b14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def True a3 d21 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> d22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">d</span><span class="main">=</span>REE sysconf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> removeSessionInContext_def tee_memories_removeSessionInContext 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s2</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> b1213_18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b1213_15 b1213_16 b1213_17 b1213_18  vpeq_TA_def True a3 b12 b14 d21 d22 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6 d1 domain_of_event_def ins_no_intf_tee interference1_def option.collapse option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.inject tee_no_ree<span class="main">)</span>
                  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vpeq1_def True a3 d21 d22
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a6 d1 domain_of_event_def interference1_def is_TEE_def option.sel tee_no_ree<span class="main">)</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False vpeq1_def d21 d22
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession1_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION1 <span class="free">fd</span> <span class="free">ses_id</span> <span class="free">in_params</span> <span class="free">out_params</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession1_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> get_exec_prime_def<span class="main">)</span>

 <span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"CloseSession2"</span></span></span>
 <span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"integrity"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession2_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?client_type</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param4 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pre_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSesIdinMgrSesIdList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSesIdinMgrSesList <span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_ta_close_session_teeDomain2_pre sysconf <span class="var">?s_rev_event</span> <span class="var">?ses_id</span> <span class="var">?client_type</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_CloseSession2 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_pre_param_operation_def<span class="main">)</span> 
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS2"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession2_def a4_1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> vpeq_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS2 <span class="main">∧</span> <span class="var">?pre_param_ops</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a4_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domain_of_event_def option.sel<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b4 ins_tee_intf_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_rev_event</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> a3 a4 b1 b2 a4_1 TEEC_CloseSession2_def a2 b6 non_interference1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> b6 a2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> b6 a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession2_integrity_e <span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION2<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession2_integrity integrity_e_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"Confidentiality"</span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession2_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?client_type</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param4 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?client_tid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesCliTid <span class="var">?s_rev_event</span> <span class="var">?sesID</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pre_param_ops</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_param_operation <span class="var">?in_params</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getTAInsCtx <span class="var">?s_rev_event</span> <span class="main">(</span>the <span class="var">?client_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taId_cli</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ta_id <span class="var">?taIns</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaInsCtxs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientTaIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getTAInsCtx <span class="var">?s_rev_event</span> <span class="main">(</span>the <span class="var">?client_tid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?client_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ta_id <span class="var">?clientTaIns</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getClientType TRUSTED_APP <span class="var">?client_id</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSesIdinMgrSesIdList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSesIdinMgrSesList <span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_ta_close_session_teeDomain2_pre sysconf <span class="var">?s_rev_event</span> <span class="var">?ses_id</span> <span class="var">?client_type</span> <span class="var">?in_params</span> <span class="var">?out_params</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?client_type_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param4 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cmd_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param6 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sesID_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="var">?ses_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?client_tid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findSesCliTid <span class="var">?t_rev_event</span> <span class="var">?sesID_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pre_param_ops_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TEE_pre_param_operation <span class="var">?in_params_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taIns_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getTAInsCtx <span class="var">?t_rev_event</span> <span class="main">(</span>the <span class="var">?client_tid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taId_cli_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ta_id <span class="var">?taIns_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaInsCtxs_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientTaIns_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getTAInsCtx <span class="var">?t_rev_event</span> <span class="main">(</span>the <span class="var">?client_tid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?client_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ta_id <span class="var">?clientTaIns_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"getClientType TRUSTED_APP <span class="var">?client_id_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSesIdinMgrSesIdList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSesIdinMgrSesList <span class="main">(</span>mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?ses_id_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_ret</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tee_ta_close_session_teeDomain2_pre sysconf <span class="var">?t_rev_event</span> <span class="var">?ses_id_t</span> <span class="var">?client_type_t</span> <span class="var">?in_params_t</span> <span class="var">?out_params_t</span>"</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession2 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession2 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 vpeq1_def a51 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?sesID</span> <span class="main">=</span> <span class="var">?sesID_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span> 

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS2"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS2"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">≠</span> TEE sysconf <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS2"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a5 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b1 TEEC_CloseSession2_def a10 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b2 TEEC_CloseSession2_def a11 findSesServTid_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> a3 b3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS2"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_pre_param_operation_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?pre_param_ops_t</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TEE_pre_param_operation_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS2 <span class="main">∧</span> <span class="var">?pre_param_ops</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">=</span> TEE sysconf <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS2 <span class="main">∧</span> <span class="var">?pre_param_ops_t</span> <span class="main">=</span> TEE_SUCCESS"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False a12 a5 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList</span> <span class="main">=</span> <span class="var">?isSesIdinMgrSesIdList_t</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> isSesIdinMgrSesList_cur_ta_session_list a13 d8
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> d10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList_t</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d6  d9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> d11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_rev_event</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> a10 d2 d4 d6 TEEC_CloseSession2_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_rev_event</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> a11 d3 d5 d10 TEEC_CloseSession2_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d13<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d13<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 e3 e4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

              <span class="comment1">(* Proof tee_memories *)</span>
              <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              
              <span class="comment1">(* Proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                     <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d11 d12 e5 e6 e7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> d15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> j3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> j4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  
                <span class="comment1">(* step1: Proof ree_total_size *)</span>
                <span class="keyword1"><span class="command">have</span></span> j7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j5 j7 j8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                
                <span class="comment1">(* step2: Proof driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> j10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j11<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j12<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j10 j11 j6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                
                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d12<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j14<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d11<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d12<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d11<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> j9 j12 j13 j14 j15 j16
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> j17 j1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d14<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True d14 vpeq1_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False d14 is_TA_def vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  <span class="keyword1"><span class="command">have</span></span> k4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                  <span class="keyword1"><span class="command">have</span></span> k5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 k3 k4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  
                  <span class="comment1">(* Proof tee_memories *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> k7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  
                  <span class="comment1">(* Proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> k5 k6 k7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> d11 d12 k1 k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d16<span class="main">)</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False d16 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList</span> <span class="main">=</span> True"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdinMgrSesIdList_t</span> <span class="main">=</span> True"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False d9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="var">?s_ret</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> d4 f1 TEEC_CloseSession2_def a10 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="var">?t_ret</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d5 f2 TEEC_CloseSession2_def a11 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f5<span class="main">)</span> 
              <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
              <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f5<span class="main">)</span> 
              <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
              <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                    <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 m3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              
              <span class="comment1">(* Proof tee_memories *)</span>
              <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_ta_close_session_teeDomain2
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_ta_close_session_teeDomain2 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> m10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f4<span class="main">)</span> 

              <span class="comment1">(* Proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                     <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> m5 m10 m11 m6 m7 m8 m9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True tee_no_ree vpeq1_def<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> g5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                
                <span class="comment1">(* step1: Proof ree_total_size *)</span>
                <span class="keyword1"><span class="command">have</span></span> g7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> g8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_tee_ta_close_session_teeDomain2
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> g9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_tee_ta_close_session_teeDomain2
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> g12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                
                <span class="comment1">(* step2: Proof driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> g13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_ta_close_session_teeDomain2
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> g15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> g16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g17<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_ta_close_session_teeDomain2
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> g18<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                
                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> g19<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f3<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> g20<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                <span class="keyword1"><span class="command">have</span></span> g21<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g13 g14 g16 g17 g6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">have</span></span> g22<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g19 g20 g21<span class="main">)</span>  
                <span class="keyword1"><span class="command">have</span></span> g23<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f3<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g24<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f4<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> g25<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g10 g11 g5 g7 g8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                <span class="keyword1"><span class="command">have</span></span> g26<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g23 g24 g25<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> g27<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> g22 g26 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> g1 g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f6<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True f6 vpeq1_def<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True f6 vpeq1_def<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 h3 h4<span class="main">)</span>
          
                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_ta_close_session_teeDomain2
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_tee_ta_close_session_teeDomain2
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                    <span class="comment1">(* Proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?s_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>fst <span class="var">?t_ret</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> h5 h6 h7 h8 h9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> f3 f4 h1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f10 False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession2_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION2<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession2_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"CloseSession3"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession3_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?servTid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param4 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSesIdInTaStateSesList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaStateSessList <span class="skolem">s</span> <span class="var">?ses_id</span> <span class="var">?servTid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nextFuncStepParam</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?servTid</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> <span class="var">?clientType</span><span class="main">,</span>
               param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span>None<span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span> 
               param10<span class="main">=</span>None<span class="main">,</span> param11<span class="main">=</span>None<span class="main">,</span> param12<span class="main">=</span>None<span class="main">,</span> param13<span class="main">=</span>None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_taCloseSessionEntry</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_CloseSessionEntryPoint <span class="var">?s_rev_event</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeSess_inTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAllSessIdInTaStateSessList <span class="var">?s_taCloseSessionEntry</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?in_params</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?out_params</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taSesListInTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TA_sessions <span class="main">(</span>the <span class="var">?taState</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ta_attr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_attribute <span class="main">(</span>the <span class="var">?taState</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSingleInstance</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"singleInstance <span class="var">?ta_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isKeepAlive</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"keepAlive <span class="var">?ta_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_sesIdNotInTaStateSesList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_taDestroyEntryPoint</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_DestroyEntryPoint <span class="var">?s_removeSess_inTaState</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_deleteTaStateBackTEE</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_taDestroyEntryPoint</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_notDeleteTaStateBackTEE</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_removeSess_inTaState</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_CloseSession3 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession3 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a4_1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> vpeq_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdInTaStateSesList</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> c1 <span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> 
          <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> c2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_sesIdNotInTaStateSesList</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a4_1 c1 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
              <span class="comment1">(* step1 : tee_memories *)</span>
              <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_sesIdNotInTaStateSesList</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> c2 d1 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True 
            <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                        <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* step1: ree_total_size proof *)</span>
                <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_sesIdNotInTaStateSesList</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* step2:driver_mem proof *)</span>
                <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_sesIdNotInTaStateSesList</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* proof result *)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> c2 f1 f2 f5 f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> c6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False c4<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> b7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> is_TA sysconf <span class="skolem">d</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False True c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">have</span></span> tmp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 domain_of_event_def nintf_neq option.sel<span class="main">)</span> 
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">have</span></span> tmp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> current <span class="skolem">s</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> b7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                       <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_sesIdNotInTaStateSesList</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> c2 g1 g2 g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> b8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> False c6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False c6 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> b9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdInTaStateSesList</span> <span class="main">≠</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> b10<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">≠</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> b1 b9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?isSingleInstance</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∧</span> <span class="var">?taSesListInTaState</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> b11<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">≠</span> False
                  <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="var">?isSingleInstance</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∧</span> <span class="var">?taSesListInTaState</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True b1 b9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> b12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_deleteTaStateBackTEE</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a4_1 b11 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_eqD<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b13<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                               <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* step1 : tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> CloseSessionEntryPoint_not_change_TEE TA_CloseSessionEntryPoint_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d3<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> d3 d4 d5 d6 d7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> b12 d1 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> b15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">using</span></span> b14 True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert the target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> True b14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                                    <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="comment1">(* ree_total_size proof step *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> e7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="comment1">(* driver_mem proof step *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> e9<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> e10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> e11<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> e12<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                  <span class="comment1">(* Proof of summary *)</span>
                  <span class="keyword1"><span class="command">have</span></span> e13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> e14<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                          <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> e1 e2 e3 e4 e5 e6 e7 e8 e9 e10 e11 e12 e13 b12 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e14
                    <span class="keyword1"><span class="command">using</span></span> e13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False b14<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> False b14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 b10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> current <span class="skolem">s</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b1<span class="main">)</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> d13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="keyword1"><span class="command">have</span></span> u1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span> TEE_state <span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> u2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def CloseSessionEntryPoint_not_change_other_TA d14 
                        <span class="keyword1"><span class="command">using</span></span> False CloseSessionEntryPoint_not_change_other_TA_aux b10 get_exec_prime_def mem_Collect_eq u1
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> u3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_removeAllSessIdInTaStateSessList<span class="main">)</span>
                      <span class="keyword1"><span class="command">have</span></span> u4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                      <span class="keyword1"><span class="command">have</span></span> u5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> u6<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> u1 u2 u3 u4 u5 b12 vpeq_TA_def 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> t1
                    <span class="keyword1"><span class="command">using</span></span> d15 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">qed</span></span> 
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> is_TA_def p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d16<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">≠</span> False
                   <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="var">?isSingleInstance</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∨</span> <span class="var">?taSesListInTaState</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False b1 b9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> d17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_notDeleteTaStateBackTEE</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> d16 TEEC_CloseSession3_def a4_1 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_eqD<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> d18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d18<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                               <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="comment1">(* step1 : tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> CloseSessionEntryPoint_not_change_TEE TA_CloseSessionEntryPoint_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e3<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> d17 e1 e3 e4 e5 vpeq_TEE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> p5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> True p4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                          <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="comment1">(* step1: ree_total_size proof *)</span>
                  <span class="keyword1"><span class="command">have</span></span> q3<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> q4<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> q5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> q6<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="comment1">(* driver_mem proof step *)</span>
                  <span class="keyword1"><span class="command">have</span></span> q8<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> q9<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> q10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> q11<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> driver_mem <span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                  
                  <span class="comment1">(* Proof of summary *)</span>
                  <span class="keyword1"><span class="command">have</span></span> q13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> q1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> q14<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>
                       <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> q1 q2 q3 q4 q5 q6 q8 q9 q10 q11 d17
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> q14 q13 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">have</span></span> p4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False p4<span class="main">)</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 b10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> current <span class="skolem">s</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b1<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> is_TA_def p4 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">have</span></span> t2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span> TEE_state <span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def CloseSessionEntryPoint_not_change_other_TA p14 
                      <span class="keyword1"><span class="command">using</span></span> False CloseSessionEntryPoint_not_change_other_TA_aux b10 get_exec_prime_def mem_Collect_eq v1
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> v3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_removeAllSessIdInTaStateSessList<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> v5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> u6<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">s</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> v1 v2 v3 v5 d17 vpeq_TA_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> t2
                  <span class="keyword1"><span class="command">using</span></span> p15 vpeq_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">qed</span></span> 
            
          <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
      
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession3_integrity_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION3<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_integrity integrity_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession3_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION3<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span> <span class="quoted"><span class="quoted">"TAs_state <span class="skolem">s</span> <span class="main">=</span>TAs_state <span class="skolem">t</span>  "</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?servTid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param4 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSesIdInTaStateSesList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaStateSessList <span class="skolem">s</span> <span class="var">?ses_id</span> <span class="var">?servTid</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nextFuncStepParam</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?servTid</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> param4 <span class="main">=</span> <span class="var">?clientType</span><span class="main">,</span>
               param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span> None<span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params</span><span class="main">,</span> param8 <span class="main">=</span> <span class="var">?out_params</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span> 
               param10 <span class="main">=</span> None<span class="main">,</span> param11 <span class="main">=</span> None<span class="main">,</span> param12 <span class="main">=</span> None<span class="main">,</span> param13 <span class="main">=</span> None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_taCloseSessionEntry</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_CloseSessionEntryPoint <span class="var">?s_rev_event</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeSess_inTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAllSessIdInTaStateSessList <span class="var">?s_taCloseSessionEntry</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?in_params</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?out_params</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taSesListInTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TA_sessions <span class="main">(</span>the <span class="var">?taState</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ta_attr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_attribute <span class="main">(</span>the <span class="var">?taState</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSingleInstance</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"singleInstance <span class="var">?ta_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isKeepAlive</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"keepAlive <span class="var">?ta_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_sesIdNotInTaStateSesList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_rev_event</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_taDestroyEntryPoint</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_DestroyEntryPoint <span class="var">?s_removeSess_inTaState</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_deleteTaStateBackTEE</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_taDestroyEntryPoint</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_notDeleteTaStateBackTEE</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?s_removeSess_inTaState</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">⦈</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?servTid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param2 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param4 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSesIdInTaStateSesList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"isSessIdInTaStateSessList <span class="skolem">t</span> <span class="var">?ses_id_t</span> <span class="var">?servTid_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nextFuncStepParam_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>param1 <span class="main">=</span> <span class="var">?ses_id_t</span><span class="main">,</span> param2 <span class="main">=</span> <span class="var">?servTid_t</span><span class="main">,</span> param3 <span class="main">=</span> None<span class="main">,</span> 
                param4 <span class="main">=</span> <span class="var">?clientType_t</span><span class="main">,</span> param5 <span class="main">=</span> None<span class="main">,</span> param6 <span class="main">=</span>None<span class="main">,</span> param7 <span class="main">=</span> <span class="var">?in_params_t</span><span class="main">,</span> 
                param8 <span class="main">=</span> <span class="var">?out_params_t</span><span class="main">,</span> param9 <span class="main">=</span> None<span class="main">,</span> param10<span class="main">=</span>None<span class="main">,</span> param11<span class="main">=</span>None<span class="main">,</span>
                param12 <span class="main">=</span> None<span class="main">,</span> param13 <span class="main">=</span> None<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_taCloseSessionEntry</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_CloseSessionEntryPoint <span class="var">?t_rev_event</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_removeSess_inTaState</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAllSessIdInTaStateSessList <span class="var">?t_taCloseSessionEntry</span> <span class="main">(</span>the <span class="var">?ses_id_t</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?in_params_t</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?out_params_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taState_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?taSesListInTaState_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TA_sessions <span class="main">(</span>the <span class="var">?taState_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ta_attr_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_attribute <span class="main">(</span>the <span class="var">?taState_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSingleInstance_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"singleInstance <span class="var">?ta_attr_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isKeepAlive_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"keepAlive <span class="var">?ta_attr_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_sesIdNotInTaStateSesList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_rev_event</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam_t</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_taDestroyEntryPoint</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"TA_DestroyEntryPoint <span class="var">?t_removeSess_inTaState</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_deleteTaStateBackTEE</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_taDestroyEntryPoint</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam_t</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_notDeleteTaStateBackTEE</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?t_removeSess_inTaState</span><span class="main">⦇</span>current <span class="main">:=</span> TEE sysconf<span class="main">,</span> exec_prime <span class="main">:=</span> <span class="main">(</span><span class="var">?nextFuncStepParam_t</span><span class="main">,</span> TEEC_CS4<span class="main">)</span><span class="main">#</span><span class="main">(</span>exec_prime <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession3 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession3 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> a14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>TAs_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>TAs_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a52 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?servTid</span> <span class="main">=</span> <span class="var">?servTid_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS3"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a5 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b1 TEEC_CloseSession3_def a10
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b2 TEEC_CloseSession3_def a11
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>  
              <span class="keyword1"><span class="command">using</span></span> a3 b3 b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False a12 a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdInTaStateSesList</span> <span class="main">=</span> <span class="var">?isSesIdInTaStateSesList_t</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> isSessIdInTaStateSessList_def a14  a5
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdInTaStateSesList</span> <span class="main">=</span> False"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdInTaStateSesList</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> 
          <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> 
          <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList_t</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d2 e2 e3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> e5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_sesIdNotInTaStateSesList</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a10 e3 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> e6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_sesIdNotInTaStateSesList</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a11 e4
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 f3 f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

              <span class="comment1">(* Proof tee_memories *)</span>
              <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              
              <span class="comment1">(* Proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> e8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                     <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> e5 e6 f5 f6 f7
                <span class="keyword1"><span class="command">using</span></span> setCurDomainAndEvent_def tee_memories_setCurDomainAndEvent <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> e8
                <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> d15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> j3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> j4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                 <span class="comment1">(* step1: Proof ree_total_size *)</span>
                <span class="keyword1"><span class="command">have</span></span> j7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j5 j7 j8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

                <span class="comment1">(* step2: Proof driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> j10<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j11<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j12<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j10 j11 j6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e6<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j14<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e5<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e6<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e5<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> j9 j12 j13 j14 j15 j16
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> j17 j1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d14<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> False True d14 vpeq1_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False d14 is_TA_def vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  <span class="keyword1"><span class="command">have</span></span> k4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                  <span class="keyword1"><span class="command">have</span></span> k5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 k3 k4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

                  <span class="comment1">(* Proof tee_memories *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> k7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                  <span class="comment1">(* Proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> k10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> k5 k6 k7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> e5 e6 k1 k2
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d16<span class="main">)</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False d16 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdInTaStateSesList</span> <span class="main">=</span> True"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSesIdInTaStateSesList_t</span> <span class="main">=</span> True"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False e2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">≠</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d1 g1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList_t</span> <span class="main">≠</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d2 g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?isSingleInstance</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∧</span> <span class="var">?taSesListInTaState</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> g5<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">≠</span> False
                  <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="var">?isSingleInstance</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∧</span> <span class="var">?taSesListInTaState</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> g6<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList_t</span> <span class="main">≠</span> False
                  <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="var">?isSingleInstance_t</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive_t</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∧</span> <span class="var">?taSesListInTaState_t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True g4
            <span class="keyword1"><span class="command">using</span></span> a14 a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">have</span></span> g7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_deleteTaStateBackTEE</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a10 g5
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_eqD<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> g8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_deleteTaStateBackTEE</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a11 g6 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_eqD<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b13<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b13<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 m3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                <span class="comment1">(* Proof tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> CloseSessionEntryPoint_not_change_TEE_aux tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                
                <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> CloseSessionEntryPoint_not_change_TEE_aux tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
                <span class="keyword1"><span class="command">have</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g7<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g8<span class="main">)</span> 
  
                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                       <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> m5 m10 m11 m6 m7 m8 m9 g6
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> isSesIdinSesIdList.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> isSessIdInTaStateSessList_def<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">using</span></span> f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="comment1">(* Convert proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> True f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> n3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True tee_no_ree vpeq1_def<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> n4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="keyword1"><span class="command">have</span></span> n5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 n3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> n6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> a3 n3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

                  <span class="comment1">(* step1: Proof ree_total_size *)</span>
                  <span class="keyword1"><span class="command">have</span></span> n7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">have</span></span> n8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> n9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                  <span class="keyword1"><span class="command">have</span></span> n12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                  <span class="keyword1"><span class="command">have</span></span> n8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> n9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    
                  <span class="keyword1"><span class="command">have</span></span> n12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> g6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> isSesIdinSesIdList.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> isSessIdInTaStateSessList_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n321<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> g6 isSessIdInTaStateSessList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 

                  <span class="comment1">(* step2: Proof driver_mem *)</span>
                  <span class="keyword1"><span class="command">have</span></span> n13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> n14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> g6 isSessIdInTaStateSessList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                  <span class="keyword1"><span class="command">have</span></span> n15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n17<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> n14 n15 n16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> n18<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> n19<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> g6 isSessIdInTaStateSessList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                  <span class="keyword1"><span class="command">have</span></span> n20<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeAllSessIdInTaStateSessList<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n21<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n22<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> n18 n19 n20 n21 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

                  <span class="comment1">(* Proof target *)</span>
                  <span class="keyword1"><span class="command">have</span></span> n23<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> g7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> n24<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g8<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n25<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> n17 n18 n19 n20 n21 n6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  <span class="keyword1"><span class="command">have</span></span> n26<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> n23 n24 n25 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
                  <span class="keyword1"><span class="command">have</span></span> n27<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g7<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n28<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g8<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> n29<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> n12 n321 n5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  <span class="keyword1"><span class="command">have</span></span> n30<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> n27 n28 n29 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
                  <span class="keyword1"><span class="command">have</span></span> n31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n26 n30<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f6<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> False f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> f9_1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d1<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> f9_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> f9_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True
                    <span class="keyword1"><span class="command">using</span></span> a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> f9 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> f9 vpeq1_def<span class="main">)</span>  
                    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 h3 h4<span class="main">)</span>

                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                        <span class="keyword1"><span class="command">{</span></span>
                          <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span> TEE_state <span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                            <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def CloseSessionEntryPoint_not_change_other_TA f9_1
                            <span class="keyword1"><span class="command">using</span></span> False CloseSessionEntryPoint_not_change_other_TA_aux g5 get_exec_prime_def mem_Collect_eq v1
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                          <span class="keyword1"><span class="command">have</span></span> v3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_removeAllSessIdInTaStateSessList<span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> v5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                          <span class="keyword1"><span class="command">have</span></span> v6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                              <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">}</span></span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> h6 h7 h8 h9 h10
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                    
                    <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                        <span class="keyword1"><span class="command">{</span></span>
                          <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="skolem">t</span> <span class="main">=</span> TEE_state <span class="var">?t_rev_event</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                             <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                            <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def CloseSessionEntryPoint_not_change_other_TA f9_2
                            <span class="keyword1"><span class="command">using</span></span> False CloseSessionEntryPoint_not_change_other_TA_aux g5 get_exec_prime_def mem_Collect_eq v1
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                          <span class="keyword1"><span class="command">have</span></span> v3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_removeAllSessIdInTaStateSessList<span class="main">)</span>
                          <span class="keyword1"><span class="command">have</span></span> v5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                          <span class="keyword1"><span class="command">have</span></span> v6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                              <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">}</span></span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> h16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> h17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">using</span></span> h12 h13 h14 h15 h16
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                    
                    <span class="comment1">(* Proof Target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> g6 isSessIdInTaStateSessList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                    <span class="keyword1"><span class="command">have</span></span> h19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> g8 h14 h15 h16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                    <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> h18 h19
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> h17 h5 h6 h7<span class="main">)</span> 
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">have</span></span> f10_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> f10_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
                    <span class="keyword1"><span class="command">using</span></span> a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> f11_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> f11_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a12 f11_1<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a3 f9 vpeq1_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> f9 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="comment1">(* Convert proof target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> f13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> f9 vpeq1_def<span class="main">)</span>  
                      <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> f12 m4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      
                      <span class="comment1">(* Proof tee_memories *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="comment1">(* d = current d taCloseSessionEntry() may change tee_memories *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                       <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_mem TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                      <span class="keyword1"><span class="command">have</span></span> m10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> g6 isSessIdInTaStateSessList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
                      
                      <span class="keyword1"><span class="command">have</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                       <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_mem TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                      <span class="keyword1"><span class="command">have</span></span> m16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
                      
                      <span class="comment1">(* Proof Target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> g6 isSessIdInTaStateSessList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                      <span class="keyword1"><span class="command">have</span></span> m19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> g8 m14 m15 m16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                      <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m18 m19
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> m17 m5 m6 m7<span class="main">)</span> 
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> m1 m2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span> 
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False f8 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> u5<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList</span> <span class="main">≠</span> False
                  <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isSingleInstance</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∧</span> <span class="var">?taSesListInTaState</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False g3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> u6<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS3 <span class="main">∧</span> <span class="var">?isSesIdInTaStateSesList_t</span> <span class="main">≠</span> False
                  <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isSingleInstance_t</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isKeepAlive_t</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">∧</span> <span class="var">?taSesListInTaState_t</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> False a14 a5 g4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> u7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_notDeleteTaStateBackTEE</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a10 u5
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_eqD<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> u8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_notDeleteTaStateBackTEE</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_def a11 u6
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_eqD<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> b13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b13<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b13<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 m3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                
                <span class="comment1">(* Proof tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> CloseSessionEntryPoint_not_change_TEE_aux tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> CloseSessionEntryPoint_not_change_TEE_aux tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> m10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> m5 m6 m7 m8 m9 u7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> u8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                       <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> m5 m10 m11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> f7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">using</span></span> True f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                   <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> True f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                             <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> n3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True tee_no_ree vpeq1_def<span class="main">)</span> 
                    <span class="keyword1"><span class="command">have</span></span> n4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                             <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> n5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a3 n3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a3 n3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                    <span class="comment1">(* step1: Proof ree_total_size *)</span>
                    <span class="keyword1"><span class="command">have</span></span> n7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                    <span class="keyword1"><span class="command">have</span></span> n8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> n9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeAllSessIdInTaStateSessList<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                    
                    <span class="keyword1"><span class="command">have</span></span> n11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> ree_total_size_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                    <span class="keyword1"><span class="command">have</span></span> n12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> n13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeAllSessIdInTaStateSessList<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n14<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size <span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>

                    <span class="keyword1"><span class="command">have</span></span> n15<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> u5 n7 n8 n9 n10
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                    <span class="keyword1"><span class="command">have</span></span> n16<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> n11 n12 n13 n14
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 

                    <span class="comment1">(* step2: Proof driver_mem *)</span>
                    <span class="keyword1"><span class="command">have</span></span> n13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n14<span class="main">:</span> <span class="quoted"><span class="quoted">"REE_state <span class="var">?s_rev_event</span> <span class="main">=</span> REE_state <span class="var">?s_taCloseSessionEntry</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def
                      <span class="keyword1"><span class="command">using</span></span> OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> n15<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> u5 n14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                    <span class="keyword1"><span class="command">have</span></span> n16<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeAllSessIdInTaStateSessList<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n17<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n18<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> n13 n14 n15 n16 n17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                    <span class="keyword1"><span class="command">have</span></span> n19<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> driver_mem_exec_prime_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n20<span class="main">:</span> <span class="quoted"><span class="quoted">"REE_state <span class="var">?t_rev_event</span> <span class="main">=</span> REE_state <span class="var">?t_taCloseSessionEntry</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def
                      <span class="keyword1"><span class="command">using</span></span> OpenSessionEntryPoint_not_change_REE TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> n21<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> u6 n20 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
                    <span class="keyword1"><span class="command">have</span></span> n22<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeAllSessIdInTaStateSessList<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n23<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n24<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_deleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> n19 n20 n20 n21 n22 n23 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                    <span class="comment1">(* Proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> n25<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> u7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n26<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u8<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n27<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TA_DestroyEntryPoint_def driver_mem_removeAllSessIdInTaStateSessList n18 n20 n6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n28<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> n25 n26 n27 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
                    <span class="keyword1"><span class="command">have</span></span> n29<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u7<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n30<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u8<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> n31<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> n14 n20 n5 ree_total_size_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> n32<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> n29 n30 n31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
                    <span class="keyword1"><span class="command">have</span></span> n31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">∧</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n28 n32<span class="main">)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f6<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> True
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> False f6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">have</span></span> f9_1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d1<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">have</span></span> f9_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> f9_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True
                    <span class="keyword1"><span class="command">using</span></span> a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="comment1">(* Convert proof target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> f9 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> f9 vpeq1_def<span class="main">)</span>  
                      <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 h3 h4<span class="main">)</span>

                      <span class="comment1">(* Proof tee_memories *)</span>
                      <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                          <span class="keyword1"><span class="command">{</span></span>
                            <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="skolem">s</span> <span class="main">=</span> TEE_state <span class="var">?s_rev_event</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                               <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                              <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def CloseSessionEntryPoint_not_change_other_TA f9_1
                              <span class="keyword1"><span class="command">using</span></span> False CloseSessionEntryPoint_not_change_other_TA_aux u5 get_exec_prime_def mem_Collect_eq v1
                              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                            <span class="keyword1"><span class="command">have</span></span> v3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_removeAllSessIdInTaStateSessList<span class="main">)</span>
                            <span class="keyword1"><span class="command">have</span></span> v5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                            <span class="keyword1"><span class="command">have</span></span> v6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                                <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                              <span class="keyword1"><span class="command">using</span></span> v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">}</span></span>
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taDestroyEntryPoint</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TA_DestroyEntryPoint_def<span class="main">)</span> 
                      <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> h6 h7 h8 h9 h10
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 

                      <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                          <span class="keyword1"><span class="command">{</span></span>
                            <span class="keyword1"><span class="command">have</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"TEE_state <span class="skolem">t</span> <span class="main">=</span> TEE_state <span class="var">?t_rev_event</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command">have</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                               <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                              <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def CloseSessionEntryPoint_not_change_other_TA f9_2
                              <span class="keyword1"><span class="command">using</span></span> False CloseSessionEntryPoint_not_change_other_TA_aux u5 get_exec_prime_def mem_Collect_eq v1
                              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                            <span class="keyword1"><span class="command">have</span></span> v3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_removeAllSessIdInTaStateSessList<span class="main">)</span>
                            <span class="keyword1"><span class="command">have</span></span> v5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories<span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">=</span>tee_memories<span class="main">(</span> TEE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                            <span class="keyword1"><span class="command">have</span></span> v6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                                <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                              <span class="keyword1"><span class="command">using</span></span> v2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">}</span></span>
                        <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> h15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> h16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                        <span class="keyword1"><span class="command">using</span></span> h12 h13 h14 h15 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

                      <span class="comment1">(* Proof Target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> h18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> u5 isSessIdInTaStateSessList_def
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u7<span class="main">)</span> 
                      <span class="keyword1"><span class="command">have</span></span> h19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> u8 h14 h15 h16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                      <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> h18 h19
                        <span class="keyword1"><span class="command">using</span></span> h11 h16 h5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">have</span></span> f10_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> f10_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
                    <span class="keyword1"><span class="command">using</span></span> a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> f11_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">s</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> False d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">have</span></span> f11_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a12 f11_1<span class="main">)</span> 
                  <span class="keyword1"><span class="command">have</span></span> f12<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a3 f9 vpeq1_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> f13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span><span class="main">∼</span><span class="skolem">d</span><span class="main">∼</span><span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> f9 vpeq1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="comment1">(* Convert proof target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> f13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> f9 vpeq1_def<span class="main">)</span>  
                      <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                      <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> f12 m4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

                      <span class="comment1">(* Proof tee_memories *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="comment1">(* d = current d taCloseSessionEntry() may change tee_memories *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_mem TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> u6 isSessIdInTaStateSessList_def
                        <span class="keyword1"><span class="command">using</span></span> m6 m7 m8 m9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

                      <span class="keyword1"><span class="command">have</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                       <span class="keyword1"><span class="command">using</span></span> TA_CloseSessionEntryPoint_def OpenSessionEntryPoint_not_change_mem TA_OpenSessionEntryPoint_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_taCloseSessionEntry</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inTaState</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m13 m5 m7 tee_memories_removeAllSessIdInTaStateSessList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m10 m5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

                      <span class="comment1">(* Proof Target *)</span>
                      <span class="keyword1"><span class="command">have</span></span> m18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> u6 isSessIdInTaStateSessList_def
                        <span class="keyword1"><span class="command">using</span></span> u7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                      <span class="keyword1"><span class="command">have</span></span> m19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_notDeleteTaStateBackTEE</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> u8 m14 m15 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
                      <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m18 m19 a113 m10 m12 m13 m5
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> tee_memories_removeAllSessIdInTaStateSessList<span class="main">)</span> 
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> m1 m2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">}</span></span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span> 
              <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">case</span></span> False
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> f8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                  <span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> False f8 is_TA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span> 
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession3_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION3<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession3_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"CloseSession4"</span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession4_integrity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION4<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?servTid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>param2 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrSes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findMgrSessionFromList <span class="skolem">s</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"client_id <span class="var">?mgrSes</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?loginType</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"login <span class="var">?clientType</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaInsList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findTaInsInMgrByTid <span class="var">?mgrTaInsList</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns_attr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"attribute <span class="main">(</span>the <span class="var">?curMgrTaIns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSingleInstance</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"singleInstance <span class="var">?curMgrTaIns_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isKeepAlive</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"keepAlive <span class="var">?curMgrTaIns_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns_refCnt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"reference_cnt <span class="main">(</span>the <span class="var">?curMgrTaIns</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeSess_inMgrTaSes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAllSessionInMgrSesList <span class="var">?s_rev_event</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_setNotBusy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setTaInsBusyByThreadId <span class="var">?s_removeSess_inMgrTaSes</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> False"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_subRef</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>subtractMgrInsRef <span class="var">?s_setNotBusy</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curTa_curTaSessionList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cur_ta_session_list <span class="main">(</span>the <span class="var">?curMgrTaIns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeTaInTaIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>removeTaInsInMgrInsList <span class="var">?s_subRef</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_closeCurTaInsSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"addCloseSessionEvent2 sysconf <span class="var">?s_removeTaInTaIns</span> <span class="main">(</span>the <span class="var">?in_params</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?out_params</span><span class="main">)</span> <span class="var">?curTa_curTaSessionList</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_teeState_deleteCurTa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"deleteTaStateByThreadId <span class="var">?s_closeCurTaInsSessList</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeTaMemInTee</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeTaMemInTeeDomain <span class="var">?s_teeState_deleteCurTa</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_event <span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span><span class="main">∈</span><span class="main">{</span>fst <span class="main">(</span>TEEC_CloseSession4 sysconf <span class="bound">s</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a4_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS4<span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_def a4_1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> vpeq_reflexive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS4<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS4<span class="main">)</span>
            <span class="main">∧</span> <span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">have</span></span> c2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_removeTaMemInTee</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_def a4_1 c1 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> State.unfold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
              <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c3<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                           <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
              <span class="comment1">(* step1 : tee_memories *)</span>
              <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a225 removeAllSessionInMgrSesList_def<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> subtractMgrInsRef_def tee_memories_subtractMgrInsRef
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tee_memories_removeTaInsInMgrInsList<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> tee_memories_addCloseSessionEvent2
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
              <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> deleteTaStateByThreadId_def tee_memories_deleteTaStateByThreadId
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS4<span class="main">)</span>
            <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> b1 d1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>TEE sysconf"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">=</span>REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">≠</span>REE sysconf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> b6<span class="main">:</span><span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b4 b5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b6 a2 interference1_def b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession4_integrity_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"integrity_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION4<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_integrity integrity_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> removeAllBlockbyTid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="free">tid</span> <span class="free">memlist</span><span class="main">)</span><span class="main">⟶</span>ownership <span class="bound">x</span> <span class="main">≠</span> <span class="free">tid</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">memlist</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> prop1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="free">tid</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="free">tid</span> <span class="free">memlist</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> removeAllBlockbyTid 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="free">tid</span> <span class="free">memlist</span><span class="main">)</span> <span class="main">=</span> set<span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ownership <span class="bound">x</span> <span class="main">≠</span> <span class="free">tid</span><span class="main">)</span> <span class="free">memlist</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">memlist</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> prop3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span><span class="free">memlist</span><span class="main">)</span><span class="main">∧</span>ownership <span class="bound">x</span> <span class="main">≠</span> <span class="free">tid</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="free">tid</span> <span class="free">memlist</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">memlist</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prop2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prop4<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>removeTaMemInTeeDomain <span class="free">s</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        tee_memories <span class="main">(</span>TEE_state <span class="main">(</span><span class="free">s</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="free">s</span><span class="main">)</span><span class="main">⦇</span>tee_total_size <span class="main">:=</span> <span class="main">(</span><span class="main">(</span>tee_total_size <span class="main">(</span>TEE_state <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>calMemBlockInMemBlockList <span class="free">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>tee_memories<span class="main">:=</span><span class="main">(</span>removeAllMemBlockInMemBlockList <span class="free">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> removeTaMemInTeeDomain_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> prop5<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>removeTaMemInTeeDomain <span class="free">s</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        tee_memories <span class="main">(</span>TEE_state <span class="main">(</span><span class="free">s</span><span class="main">⦇</span>TEE_state<span class="main">:=</span><span class="main">(</span>TEE_state <span class="free">s</span><span class="main">)</span><span class="main">⦇</span>tee_memories<span class="main">:=</span><span class="main">(</span>removeAllMemBlockInMemBlockList <span class="free">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prop4
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> prop6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="main">(</span>removeTaMemInTeeDomain <span class="free">s</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> removeAllMemBlockInMemBlockList <span class="free">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prop5
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>  prop7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> block_id <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> ownership <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prop8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> ownership <span class="bound">x</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟶</span> block_id <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> prop7
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession4_weak_confidentiality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> hyperc <span class="main">(</span>TEEC_CLOSESESSION4<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>
           reachable0 <span class="bound">s</span> <span class="main">∧</span>
           reachable0 <span class="bound">t</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="bound">t</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span>get_exec_prime <span class="bound">s</span> <span class="main">=</span> get_exec_prime <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main">∼</span> <span class="bound">d</span> <span class="main">∼</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>domain_of_event <span class="skolem">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"exec_prime <span class="skolem">s</span> <span class="main">=</span> exec_prime <span class="skolem">t</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">↝</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="main">(</span>the <span class="main">(</span>domain_of_event <span class="skolem">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∈</span> exec_event <span class="free">a</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?servTid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>param2 <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrSes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findMgrSessionFromList <span class="skolem">s</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"client_id <span class="var">?mgrSes</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?loginType</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"login <span class="var">?clientType</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaInsList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findTaInsInMgrByTid <span class="var">?mgrTaInsList</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns_attr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"attribute <span class="main">(</span>the <span class="var">?curMgrTaIns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSingleInstance</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"singleInstance <span class="var">?curMgrTaIns_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isKeepAlive</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"keepAlive <span class="var">?curMgrTaIns_attr</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns_refCnt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"reference_cnt <span class="main">(</span>the <span class="var">?curMgrTaIns</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeSess_inMgrTaSes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAllSessionInMgrSesList <span class="var">?s_rev_event</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_setNotBusy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setTaInsBusyByThreadId <span class="var">?s_removeSess_inMgrTaSes</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> False"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_subRef</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>subtractMgrInsRef <span class="var">?s_setNotBusy</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curTa_curTaSessionList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cur_ta_session_list <span class="main">(</span>the <span class="var">?curMgrTaIns</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeTaInTaIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>removeTaInsInMgrInsList <span class="var">?s_subRef</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_closeCurTaInsSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"addCloseSessionEvent2 sysconf <span class="var">?s_removeTaInTaIns</span> <span class="main">(</span>the <span class="var">?in_params</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?out_params</span><span class="main">)</span> <span class="var">?curTa_curTaSessionList</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_teeState_deleteCurTa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"deleteTaStateByThreadId <span class="var">?s_closeCurTaInsSessList</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s_removeTaMemInTee</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeTaMemInTeeDomain <span class="var">?s_teeState_deleteCurTa</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exec_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="var">?exec_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ses_id_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param1 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?servTid_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>param2 <span class="var">?p_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?in_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param7 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?out_params_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"param8 <span class="var">?p_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_rev_event</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">⦇</span>exec_prime <span class="main">:=</span> tl <span class="var">?exec_t</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrSes_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the<span class="main">(</span>findMgrSessionFromList <span class="skolem">t</span> <span class="main">(</span>the <span class="var">?ses_id_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?clientType_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"client_id <span class="var">?mgrSes_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?loginType_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"login <span class="var">?clientType_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgrTaInsList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_instances <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"findTaInsInMgrByTid <span class="var">?mgrTaInsList_t</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns_attr_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"attribute <span class="main">(</span>the <span class="var">?curMgrTaIns_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isSingleInstance_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"singleInstance <span class="var">?curMgrTaIns_attr_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?isKeepAlive_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"keepAlive <span class="var">?curMgrTaIns_attr_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curMgrTaIns_refCnt_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"reference_cnt <span class="main">(</span>the <span class="var">?curMgrTaIns_t</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_removeSess_inMgrTaSes</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeAllSessionInMgrSesList <span class="var">?t_rev_event</span> <span class="main">(</span>the <span class="var">?ses_id_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_setNotBusy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"setTaInsBusyByThreadId <span class="var">?t_removeSess_inMgrTaSes</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span> False"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_subRef</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span>subtractMgrInsRef <span class="var">?t_setNotBusy</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?curTa_curTaSessionList_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cur_ta_session_list <span class="main">(</span>the <span class="var">?curMgrTaIns_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_removeTaInTaIns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>removeTaInsInMgrInsList <span class="var">?t_subRef</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_closeCurTaInsSessList</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"addCloseSessionEvent2 sysconf <span class="var">?t_removeTaInTaIns</span> <span class="main">(</span>the <span class="var">?in_params_t</span><span class="main">)</span> <span class="main">(</span>the <span class="var">?out_params_t</span><span class="main">)</span> <span class="var">?curTa_curTaSessionList_t</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_teeState_deleteCurTa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"deleteTaStateByThreadId <span class="var">?t_closeCurTaInsSessList</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t_removeTaMemInTee</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"removeTaMemInTeeDomain <span class="var">?t_teeState_deleteCurTa</span> <span class="main">(</span>the <span class="var">?servTid_t</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> a10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession4 sysconf <span class="skolem">s</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 a8 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> fst <span class="main">(</span>TEEC_CloseSession4 sysconf <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p1 a9 exec_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> current <span class="skolem">t</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> domain_of_event_def a4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.sel<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a3 vpeq1_def a51 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?servTid</span> <span class="main">=</span> <span class="var">?servTid_t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS4<span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">≠</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS4<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">≠</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span>snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> TEEC_CS4<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a12 a5 b1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b1 TEEC_CloseSession4_def a10
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> b2 TEEC_CloseSession4_def a11
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> prod.collapse prod.inject<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>  
              <span class="keyword1"><span class="command">using</span></span> a3 b3 b4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> TEE sysconf"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS4"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"current <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>TEE sysconf<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> snd <span class="main">(</span>hd <span class="main">(</span>exec_prime <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TEEC_CS4"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False a12 a5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> d3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?servTid</span> <span class="main">=</span> <span class="var">?servTid_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5<span class="main">)</span>   
      <span class="keyword1"><span class="command">have</span></span> d4<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a13<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d5<span class="main">:</span> <span class="quoted"><span class="quoted">"ta_mgr<span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ta_mgr<span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d4<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mgrTaInsList</span> <span class="main">=</span> <span class="var">?mgrTaInsList_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d4<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?curMgrTaIns</span> <span class="main">=</span> <span class="var">?curMgrTaIns_t</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> d6 d3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">have</span></span> d8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?curMgrTaIns_attr</span> <span class="main">=</span> <span class="var">?curMgrTaIns_attr_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5 d4<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isSingleInstance</span> <span class="main">=</span> <span class="var">?isSingleInstance_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5 d4<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?isKeepAlive</span> <span class="main">=</span> <span class="var">?isKeepAlive_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5 d4<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d11<span class="main">:</span> <span class="quoted"><span class="quoted">"reference_cnt <span class="main">(</span>the <span class="var">?curMgrTaIns</span><span class="main">)</span> <span class="main">=</span> reference_cnt <span class="main">(</span>the <span class="var">?curMgrTaIns_t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5 d4<span class="main">)</span>  
      <span class="keyword1"><span class="command">have</span></span> d12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="var">?curMgrTaIns_refCnt_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5 d4<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"findMgrSessionFromList <span class="skolem">s</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span> <span class="main">=</span> findMgrSessionFromList <span class="skolem">t</span> <span class="main">(</span>the <span class="var">?ses_id_t</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lst</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?index</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>the <span class="var">?ses_id</span><span class="main">)</span> <span class="main">=</span> session_id <span class="main">(</span><span class="var">?lst</span><span class="main">!</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgr_session</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?lst</span><span class="main">!</span><span class="var">?index</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgr_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ta_mgr<span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lst_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mgr_ta_sessions <span class="main">(</span>ta_mgr <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?index_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>the <span class="var">?ses_id_t</span><span class="main">)</span> <span class="main">=</span> session_id <span class="main">(</span><span class="var">?lst_t</span><span class="main">!</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mgr_session_t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?lst_t</span><span class="main">!</span><span class="var">?index_t</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> d13_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mgr</span> <span class="main">=</span> <span class="var">?mgr_t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d4<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> d13_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lst</span> <span class="main">=</span> <span class="var">?lst_t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d4<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> d13_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?index</span> <span class="main">=</span> <span class="var">?index_t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5 d4<span class="main">)</span> 
          <span class="keyword1"><span class="command">have</span></span> d13_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mgr_session</span> <span class="main">=</span> <span class="var">?mgr_session_t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a5 d4<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> findMgrSessionFromList_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mgrSes</span> <span class="main">=</span> <span class="var">?mgrSes_t</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> d15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?loginType</span> <span class="main">=</span> <span class="var">?loginType_t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d13<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?curMgrTaIns_refCnt_t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive_t</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance_t</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType_t</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a5 c1 d13 d4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
        <span class="keyword1"><span class="command">have</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_removeTaMemInTee</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_def a10 c1 d1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_removeTaMemInTee</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_def a11 c2 d2
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c5<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c5<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 m3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                <span class="comment1">(* Proof tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_removeTaInsInMgrInsList <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                <span class="keyword1"><span class="command">have</span></span> m11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                <span class="keyword1"><span class="command">have</span></span> m13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> m15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_removeTaInsInMgrInsList <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                <span class="keyword1"><span class="command">have</span></span> m18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                <span class="keyword1"><span class="command">have</span></span> m20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> m14 m5 m7 tee_memories_addCloseSessionEvent2 tee_memories_deleteTaStateByThreadId tee_memories_removeTaInsInMgrInsList tee_memories_setTaInsBusy tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                <span class="keyword1"><span class="command">have</span></span> m21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span><span class="keyword1"><span class="command">{</span></span>
                    <span class="keyword1"><span class="command">have</span></span> m211<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_removeTaMemInTee</span> <span class="main">=</span> removeTaMemInTeeDomain <span class="var">?s_teeState_deleteCurTa</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">have</span></span> m212<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_removeTaMemInTee</span> <span class="main">=</span> removeTaMemInTeeDomain <span class="var">?t_teeState_deleteCurTa</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a5
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">have</span></span> m216<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="main">1</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop1 True
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m217<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m211 removeTaMemInTeeDomain_def prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m218<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">=</span> <span class="main">{}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop7 m217 m216
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m219<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="main">1</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop1 True
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m220<span class="main">:</span><span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m212 removeTaMemInTeeDomain_def prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m211<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">=</span> <span class="main">{}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop7 m219 m220
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m218 m220 m211
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">case</span></span> False
                      <span class="keyword1"><span class="command">have</span></span> m213<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">have</span></span> m2131<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop1
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">have</span></span> m2132<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m211 removeTaMemInTeeDomain_def prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m21321<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>ownership <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m2132 prop3
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m21322<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>block_id <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m213 m21321 prop8
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m2134<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop1
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m21341<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>ownership <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m2134 prop3 a5 prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m21342<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>block_id <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m213 m21341 prop8
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m2135<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> m212 m211 removeTaMemInTeeDomain_def prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> m214<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m21322 m2132 prop2
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> m215<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m21342 m2135 prop2
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m214 m215 m20
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">}</span></span>
                <span class="keyword1"><span class="command">qed</span></span>

                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                       <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> m21 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c3 c4<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m22
                  <span class="keyword1"><span class="command">using</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> d15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> j3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> j4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                <span class="comment1">(* step1: Proof ree_total_size *)</span>
                <span class="keyword1"><span class="command">have</span></span> j7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_subtractMgrInsRef<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j11<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeTaInsInMgrInsList<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j12<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j13<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j14<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeTaMemInTeeDomain<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j15<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
                <span class="keyword1"><span class="command">have</span></span> j16<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j17<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j18<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j19<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_subRef</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_subtractMgrInsRef<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j20<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_subRef</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeTaInsInMgrInsList<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j21<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j22<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ree_total_size_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j23<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_removeTaMemInTeeDomain<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j24<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
                <span class="keyword1"><span class="command">have</span></span> j25<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j10 j11 j12 j13 j14 j16 j17 j18 j19 j20 j21 j22 j23 j5 j7 j8 j9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  
                <span class="comment1">(* step2: Proof driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> j26<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j27<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j28<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j29<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_subtractMgrInsRef<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j30<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeTaInsInMgrInsList<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j31<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j32<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j33<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeTaMemInTeeDomain<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j34<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> j35<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j36<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j37<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j38<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_subRef</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_subtractMgrInsRef<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j39<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_subRef</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeTaInsInMgrInsList<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j40<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j41<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j42<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_removeTaMemInTeeDomain<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j44<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j26 j27 j28 j29 j30 j31 j32 j33 j35 j36 j37 j38 j39 j40 j41 j42 j6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c4<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c3<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j15<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c4<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j16<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c3<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">using</span></span> j9 j12 j13 j14 j15 j16 j25 j44
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> j17 j1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d14<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                   <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> d17 vpeq1_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> d17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 h3 h4<span class="main">)</span>

                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
                    <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> h10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_removeTaInsInMgrInsList <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">have</span></span> h11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    
                    <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> h15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
                    <span class="keyword1"><span class="command">have</span></span> h16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> h17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_removeTaInsInMgrInsList <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">have</span></span> h18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaInTaIns</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_addCloseSessionEvent2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_closeCurTaInsSessList</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_deleteTaStateByThreadId <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> h14 h5 h7 tee_memories_addCloseSessionEvent2 tee_memories_deleteTaStateByThreadId tee_memories_removeTaInsInMgrInsList tee_memories_setTaInsBusy tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                    <span class="keyword1"><span class="command">have</span></span> h21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span><span class="main">)</span>                                   
                      <span class="keyword3"><span class="command">case</span></span> True
                      <span class="keyword1"><span class="command">have</span></span> h215<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_removeTaMemInTee</span> <span class="main">=</span> removeTaMemInTeeDomain <span class="var">?s_teeState_deleteCurTa</span> <span class="skolem">d</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> True              
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> h2151<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="skolem">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop1
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
                      <span class="keyword1"><span class="command">have</span></span> h2152<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>removeAllMemBlockInMemBlockList <span class="skolem">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> h215 removeTaMemInTeeDomain_def prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> h217<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> h2151 h2152
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> h219<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_removeTaMemInTee</span> <span class="main">=</span> removeTaMemInTeeDomain <span class="var">?t_teeState_deleteCurTa</span> <span class="skolem">d</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> True a5
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> h2191<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>MemBlock<span class="main">.</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="skolem">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> prop1
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">have</span></span> h2192<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>removeAllMemBlockInMemBlockList <span class="skolem">d</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> h219 removeTaMemInTeeDomain_def prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> h218<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">⟶</span><span class="bound">x</span><span class="main">∉</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> h2191 h2192
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> h217 h218
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">case</span></span> False
                      <span class="keyword1"><span class="command">have</span></span> h216<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s_removeTaMemInTee</span> <span class="main">=</span> removeTaMemInTeeDomain <span class="var">?s_teeState_deleteCurTa</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> h2111<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> removeTaMemInTeeDomain_def h216 prop6
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">have</span></span> h2112<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>ownership <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> h2111 prop3
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">have</span></span> h211<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> False removeTaMemInTeeDomain_def h216 prop2 h2111 h2112
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">have</span></span> h212<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                          <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span><span class="keyword1"><span class="command">{</span></span>
                          <span class="keyword1"><span class="command">have</span></span> h2120<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t_removeTaMemInTee</span> <span class="main">=</span> removeTaMemInTeeDomain <span class="var">?t_teeState_deleteCurTa</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> a5
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                          <span class="keyword1"><span class="command">have</span></span> h2121<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span> <span class="main">=</span> removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> removeTaMemInTeeDomain_def h2120 prop6
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="keyword1"><span class="command">have</span></span> h2122<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>ownership <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>removeAllMemBlockInMemBlockList <span class="main">(</span>the <span class="var">?servTid</span><span class="main">)</span> <span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_teeState_deleteCurTa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> h2120 prop6
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                            <span class="keyword1"><span class="command">using</span></span> h2120 h2121 h2122 removeTaMemInTeeDomain_def False prop2
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">}</span></span>
                      <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">using</span></span> False h20 h211 h212
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">qed</span></span>

                     <span class="comment1">(* Proof Target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> c3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">have</span></span> h23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeTaMemInTee</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> c4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">have</span></span> h24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h21 h22 h23<span class="main">)</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> d13 vpeq1_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?curMgrTaIns_refCnt</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?curMgrTaIns_refCnt_t</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="var">?isKeepAlive_t</span> <span class="main">=</span> True <span class="main">∧</span> <span class="var">?isSingleInstance_t</span> <span class="main">=</span> True<span class="main">)</span> <span class="main">|</span> <span class="var">?loginType_t</span> <span class="main">=</span> DTC_IDENTITY<span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a5 d13 d4 e1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
        <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="var">?s_subRef</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_def a10 e1 d1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> e4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="var">?t_subRef</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_def a11 e2 d2
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> False State.fold_congs<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.prod.inject prod.collapse<span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c5<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c5<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> m4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TEE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> m5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 m3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                <span class="comment1">(* Proof tee_memories *)</span>
                <span class="keyword1"><span class="command">have</span></span> m6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> m8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                <span class="keyword1"><span class="command">have</span></span> m13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> m15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> m16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                
                <span class="keyword1"><span class="command">have</span></span> m20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> m14 m5 m7 tee_memories_addCloseSessionEvent2 tee_memories_deleteTaStateByThreadId tee_memories_removeTaInsInMgrInsList tee_memories_setTaInsBusy tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> m22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span> 
                       <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>block_id <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> m20
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e3 e4<span class="main">)</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m22
                  <span class="keyword1"><span class="command">using</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> d14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> d15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="comment1">(* Convert proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">have</span></span> j3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> True d14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> j4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_REE <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>
                           <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                <span class="keyword1"><span class="command">have</span></span> j5<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j6<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> a3 j3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

                <span class="comment1">(* step1: Proof ree_total_size *)</span>
                <span class="keyword1"><span class="command">have</span></span> j7<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j8<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j9<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j10<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_subtractMgrInsRef<span class="main">)</span> 
                
                <span class="keyword1"><span class="command">have</span></span> j16<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j17<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j18<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j19<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_subRef</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ree_total_size_subtractMgrInsRef<span class="main">)</span> 
                
                <span class="keyword1"><span class="command">have</span></span> j25<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> j16 j17 j18 j5 j7 j8 j9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  
                <span class="comment1">(* step2: Proof driver_mem *)</span>
                <span class="keyword1"><span class="command">have</span></span> j26<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j27<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j28<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j29<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_subtractMgrInsRef<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j35<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j36<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_rev_event</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                <span class="keyword1"><span class="command">have</span></span> j37<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> driver_mem_setTaInsBusy<span class="main">)</span> 
                <span class="keyword1"><span class="command">have</span></span> j44<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_setNotBusy</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="var">?t_setNotBusy</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_tee_setTaInsBusy j26 j27 j35 j36 j6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                  
                <span class="comment1">(* Proof target *)</span>
                <span class="keyword1"><span class="command">have</span></span> j13<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?t_subRef</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_subtractMgrInsRef e4 j44 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> j14<span class="main">:</span> <span class="quoted"><span class="quoted">"driver_mem<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> e3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> j15<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?t_subRef</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e4<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j16<span class="main">:</span> <span class="quoted"><span class="quoted">"ree_total_size<span class="main">(</span>REE_state <span class="var">?s_subRef</span><span class="main">)</span> <span class="main">=</span> ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e3<span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> j17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ree_total_size<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> ree_total_size <span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span>
                         <span class="main">∧</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> driver_mem<span class="main">(</span>REE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> driver_mem_subtractMgrInsRef j10 j13 j14 j15 j16 j19 j25 j26 j27 j28 j35 j36 j37 j6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> j17 j1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d14<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_TA sysconf <span class="skolem">d</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                   <span class="comment1">(* Convert proof target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> d17 vpeq1_def<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> d17 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq_TA <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                    <span class="keyword1"><span class="command">have</span></span> h5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 h3 h4<span class="main">)</span>

                    <span class="comment1">(* Proof tee_memories *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h6<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
                    <span class="keyword1"><span class="command">have</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    
                    <span class="keyword1"><span class="command">have</span></span> h13<span class="main">:</span> <span class="quoted"><span class="quoted">"tee_memories <span class="main">(</span>TEE_state <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">have</span></span> h14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_rev_event</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>   
                      <span class="keyword1"><span class="command">using</span></span> removeAllSessionInMgrSesList_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    <span class="keyword1"><span class="command">have</span></span> h15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_removeSess_inMgrTaSes</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_setTaInsBusy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
                    <span class="keyword1"><span class="command">have</span></span> h16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_setNotBusy</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> tee_memories_subtractMgrInsRef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                    
                    <span class="comment1">(* Proof Target *)</span>
                    <span class="keyword1"><span class="command">have</span></span> h22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?s_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e3<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> h23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="var">?t_subRef</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e4<span class="main">)</span>
                    <span class="keyword1"><span class="command">have</span></span> h24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">s'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span> 
                        <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span>tee_memories <span class="main">(</span>TEE_state <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>ownership <span class="bound">x</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> a3 h14 h15 h16 h22 h23 h3 h7 h8 h9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> h1 h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> d13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> TEE sysconf <span class="main">∧</span> <span class="skolem">d</span> <span class="main">≠</span> REE sysconf <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>is_TA sysconf <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> d16 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span>
                  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">∼</span> <span class="skolem">d</span> <span class="main">∼</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">=</span> vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
                  <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"vpeq1 <span class="skolem">s'</span> <span class="skolem">d</span> <span class="skolem">t'</span> <span class="main">=</span> True"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> d13 vpeq1_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>   
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> TEEC_CloseSession4_weak_confidentiality_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"weak_confidentiality_e <span class="main">(</span>hyperc <span class="main">(</span>TEEC_CLOSESESSION4<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> TEEC_CloseSession4_weak_confidentiality weak_confidentiality_e_def
  <span class="keyword1"><span class="command">using</span></span> get_exec_prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body></html>