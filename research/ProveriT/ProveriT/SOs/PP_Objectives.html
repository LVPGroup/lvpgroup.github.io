<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0250)http://127.0.0.1:50198/c3097003-0149-437b-b27b-41d4929a4424/preview?D%3A%5COneDrive+-+stu.xjtu.edu.cn%5C%E7%A7%91%E7%A0%94%5CPP%E6%A8%A1%E5%9E%8B%E9%A1%B9%E7%9B%AE%5CPP%E8%AE%BA%E6%96%87%5CPP_SecurityModel%28for+the+paper%29%5CSOs%5CPP_Objectives.thy -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('/c3097003-0149-437b-b27b-41d4929a4424/fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.contents { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }
</style><title>Theory "PP_Objectives"</title></head>
<body data-new-gr-c-s-check-loaded="14.1149.0" data-gr-ext-installed=""><pre class="source"><span class="comment1">(*This file describes security objectives defined in GlobePlatFrom Protection Profile.
Written by Zhejiang University, Hangzhou, China.*)</span>

<span class="keyword1"><span class="command">theory</span></span> PP_Objectives 
  <span class="keyword2"><span class="keyword">imports</span></span> Main 
          PP_OSM 
          <span class="quoted">"../SPD/PP_Threats"</span>
          <span class="quoted">"../SPD/PP_DM"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"Security Objectives"</span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_CA_TA_IDENTIFICATION"</span></span></span>

<span class="comment1">(* 
FROM PP
===============================
O.CA_TA_IDENTIFICATION

The TEE shall provide means to protect the identity of each Trusted Application from use by another 
resident Trusted Application and to distinguish Client Applications from Trusted Applications.

Application Note:
Client properties are managed either by the Regular OS or by the Trusted OS and these must ensure that 
a Client cannot tamper with its own properties in the following sense:
❖ The Client identity of a TA must always be determined by the Trusted OS and the determination 
of whether it is a TA or not must be as trustworthy as the Trusted OS itself; 
❖ When the Client identity corresponds to a TA, then the Trusted OS must ensure that the other 
Client properties are equal to the properties of the calling TA up to the same level of trustworthiness 
that the target TA places in the Trusted OS; 
❖ When the Client identity does not correspond to a TA, then the Regular OS is responsible for 
ensuring that the Client Application cannot tamper with its own properties. However, this 
information is not trusted by the Trusted OS.
===============================
note: after discussion, property here means identity
 *)</span>


<span class="keyword1"><span class="command">locale</span></span> O_CA_TA_IDENTIFICATION
   <span class="main">=</span>
  <span class="comment1">(* The Client identity of a TA must always be determined by the Trusted OS *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ta_client</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'ta</span> <span class="main">⇀</span> <span class="tfree">'cid</span><span class="main">)</span>"</span></span> <span class="comment1">(*search for TA client, if some, find one*)</span>
 <span class="comment1">(* fixes ta_client_identification :: "'s⇒'cid⇒bool"(*judge the client_identity's type(TA/CA),if TA then True*)*)</span>
  
  
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ta_id_as_client</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span><span class="tfree">'cid</span>"</span></span><span class="comment1">(*get ta's client_identity if it is as a client *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ca_id_as_client</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span><span class="tfree">'cid</span>"</span></span><span class="comment1">(*here CA is REE cause we dont identify different CA*)</span>
  <span class="comment1">(* ta client identities are different *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ta_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ta</span> <span class="bound">ta'</span><span class="main">.</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="bound">ta'</span> <span class="main">⟶</span>  <span class="free">ta_id_as_client</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">ta_id_as_client</span> <span class="bound">s</span> <span class="bound">ta'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ca_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ca</span> <span class="bound">ca'</span><span class="main">.</span> <span class="bound">ca</span> <span class="main">≠</span> <span class="bound">ca'</span> <span class="main">⟶</span>  <span class="free">ca_id_as_client</span> <span class="bound">s</span> <span class="bound">ca</span> <span class="main">≠</span> <span class="free">ca_id_as_client</span> <span class="bound">s</span> <span class="bound">ca'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ca_ta_ident<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ta</span> <span class="bound">ca</span><span class="main">.</span>  <span class="free">ta_id_as_client</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">ca_id_as_client</span> <span class="bound">s</span> <span class="bound">ca</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ta_props</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'ta</span> <span class="main">⇒</span> <span class="tfree">'tap</span>"</span></span> <span class="comment1">(* TA properties *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ca_props</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'ca</span> <span class="main">⇒</span> <span class="tfree">'cap</span>"</span></span> <span class="comment1">(* CA properties *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">client_props</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'cid</span> <span class="main">⇒</span> <span class="tfree">'tap</span>"</span></span> <span class="comment1">(* client properties *)</span>
  <span class="comment1">(* a func to decide whether the other Client properties are equal to the properties of TA *)</span>
  <span class="comment1">(*fixes ta_ci_prop_eq :: "'cp ⇒ 'tap ⇒ bool" *)</span>
  <span class="comment1">(* Client properties are equal to the properties of the calling TA *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tap_cip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ta</span> <span class="bound">ta'</span><span class="main">.</span> <span class="free">ta_client</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="main">(</span><span class="free">ta_id_as_client</span> <span class="bound">s</span> <span class="bound">ta'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>the <span class="main">(</span><span class="free">ta_client</span> <span class="bound">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟶</span> 
          <span class="main">(</span><span class="main">(</span><span class="free">client_props</span> <span class="bound">s</span> <span class="main">(</span>the <span class="main">(</span><span class="free">ta_client</span> <span class="bound">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ta_props</span> <span class="bound">s</span> <span class="bound">ta'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>





<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_KEYS_USAGE"</span></span></span>

<span class="comment1">(*
FROM PP
======================
O.KEYS_USAGE

The TEE shall enforce the cryptographic keys usage restrictions set by their creators.
======================
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_KEYS_USAGE
  <span class="main">=</span>
  <span class="comment1">(*enforce the cryptographic keys usage restrictions*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">checksum</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'k</span><span class="main">⇒</span><span class="tfree">'restriction</span><span class="main">⇒</span>bool"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_TEE_ID"</span></span></span>

<span class="comment1">(*
O.TEE_ID
The TEE shall ensure statistical uniqueness of the TEE identifier when generated by the TEE. It shall also 
ensure that it is non-modifiable and provide means to retrieve this identifier.

Application Note:
TEE identifier can be generated by the TEE or outside the TEE. When the TEE identifier is generated 
outside the TEE, before TOE delivery (in phase 3 or 5), and although it is not covered by this objective, 
there shall be an organisational process to ensure the uniqueness of the identifier.
*)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> tee_id <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">locale</span></span> O_TEE_ID <span class="main">=</span> 
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">IdGen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>tee_id"</span></span>
      <span class="comment1">(*The TEE shall provide means to retrieve this identifier*)</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">getTEEId</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span>tee_id"</span></span>
      <span class="comment1">(*The TEE shall ensure statistical uniqueness of the TEE identifier*)</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> idUnique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">x'</span><span class="main">⟶</span><span class="free">IdGen</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">IdGen</span> <span class="bound">x'</span>"</span></span>
      <span class="comment1">(*It shall also ensure that it is non-modifiable*)</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> idNonModify<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span>  <span class="free">getTEEId</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">getTEEId</span> <span class="bound">s'</span>"</span></span>
      

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O.INITIALISATION"</span></span></span>
<span class="comment1">(*
O.INITIALISATION
The TEE shall be started through a secure initialisation process that ensures:
o The integrity of the TEE initialisation code and data used to load the TEE firmware;
o The authenticity of the TEE firmware;
o The binding of the TEE firmware to the SoC of the device;
o The protection against TEE firmware downgrade attacks.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_INITIALISATION <span class="main">=</span> OState <span class="main">+</span>
    <span class="comment1">(*  fixes s0 :: "'s" *)</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">getfirmware</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'firmware</span>"</span></span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">getinitcode</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'initcode</span>"</span></span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">initialisation</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'sysconf</span><span class="main">⇒</span><span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> bool<span class="main">)</span>"</span></span><span class="comment1">(*secure initialisation process*)</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">checkinitcode</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'SoC</span><span class="main">⇒</span><span class="tfree">'initcode</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*check integrity of the TEE initialisation code and data*)</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">checkfirmware</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'SoC</span><span class="main">⇒</span><span class="tfree">'firmware</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*check authenticity and binding of the TEE firmware*)</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s0</span> <span class="main">=</span> fst<span class="main">(</span><span class="free">initialisation</span> <span class="free">sc</span><span class="main">)</span><span class="main">∧</span>snd<span class="main">(</span><span class="free">initialisation</span> <span class="free">sc</span><span class="main">)</span>
            <span class="main">⟶</span><span class="free">checkinitcode</span> <span class="main">(</span><span class="free">getSoc</span> <span class="free">s0</span><span class="main">)</span> <span class="main">(</span><span class="free">getinitcode</span> <span class="free">s0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">checkfirmware</span> <span class="main">(</span><span class="free">getSoc</span> <span class="free">s0</span><span class="main">)</span> <span class="main">(</span><span class="free">getfirmware</span> <span class="free">s0</span><span class="main">)</span> "</span></span><span class="comment1">(*secure initialisation*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_INSTANCE_TIME"</span></span></span>

<span class="comment1">(*
O.INSTANCE_TIME
The TEE shall provide TA instance time and shall ensure that this time is monotonic during TA instance 
lifetime – from the TA instance creation until the TA instance is destroyed – and not impacted by
transitions through low power states.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_INSTANCE_TIME
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">query_time</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇀</span><span class="tfree">'instime</span><span class="main">::</span>linorder"</span></span><span class="comment1">(*get TA instance time, system time + offset*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Trans</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'s</span>"</span></span>
  <span class="comment1">(*The TEE shall ensure that this time is monotonic during TA instance lifetime,
    from the TA instance creation until the TA instance is destroyed *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monotonic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">t</span> <span class="bound">ta</span><span class="main">.</span> <span class="free">Trans</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">query_time</span> <span class="bound">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">≠</span>None <span class="main">∧</span> <span class="main">(</span><span class="free">query_time</span> <span class="bound">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">≠</span>None 
                                          <span class="main">⟶</span> the <span class="main">(</span><span class="free">query_time</span> <span class="bound">s</span> <span class="bound">ta</span><span class="main">)</span> <span class="main">≤</span>the <span class="main">(</span><span class="free">query_time</span> <span class="bound">t</span> <span class="bound">ta</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_OPERATION"</span></span></span>

<span class="comment1">(*
O.OPERATION

The TEE shall ensure the correct operation of its security functions. In particular, the TEE shall:
o Protect itself against abnormal situations caused by programmer errors or violation of good 
practices by the REE (and the CAs indirectly) or by the TAs;
//maybe when TA get dead lock or call API without a proper order,

o Control access to its services by the REE and TAs: The TEE shall check the validity of any 
operation requested from either the REE or a TA, at any entry point into the TEE;

o Enter a secure state upon failure detection, without exposure of any sensitive data.

Application Note:
o Programmer errors or violation of good practices (e.g. that exploit multi-threading or 
context/session management) might become attack-enablers. However, the TEE must guarantee 
the stability and security of its resources and services independent of the REE, which may have 
been corrupted. In any case, a Trusted Application must not be able to use a programmer error 
on purpose to circumvent the TEE security functionality.

o Software in the REE must not be able to call directly to TEE resources or functions. The REE 
software must go through protocols such that the Trusted OS or Trusted Application performs the 
verification of the acceptability of the operation that the REE software has requested.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_OPERATION
   <span class="main">=</span>
  <span class="comment1">(*Control access to its services by the REE and TAs*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ca_access</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*1. whether CA can call some API. 
                  2. whether obey the policy for controlling access to TA and TEE execution spaces*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ta_access</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span>bool"</span></span>

  <span class="comment1">(*the allowed API for TA and CA are different
  assumes access_diff:"∀s a ca ta. valid_ca_access s a ca ≠ valid_ta_access s a ta"*)</span>

  <span class="comment1">(*Programmer errors or violation of good practices*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ca_action</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span>bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">valid_ta_action</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span>bool"</span></span>
  <span class="comment1">(*
  with three dimension: 1. the action is a defined API?(unexpected commands) 
                        2. bad parameter?(programmer error)
                        3. other programmer error
  *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">move_to_secure_state</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'s</span>"</span></span><span class="comment1">(*Enter a secure state,like trans1, but different actions*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">secure_state</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*judge whether the state is secure*)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">trans1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'s</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">failure_detect</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span>bool"</span></span>
  <span class="comment1">(*Protect itself against abnormal situations caused by programmer errors or violation of good practices*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> action_cor_use<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ca_action</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ta_action</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ta</span><span class="main">)</span> 
                          <span class="main">⟶</span> <span class="free">failure_detect</span> <span class="bound">s</span>"</span></span>
  <span class="comment1">(*Control access to its services by the REE and TAs*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> access_cor_use<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ca_access</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ca</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ta_access</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ta</span><span class="main">)</span> 
                          <span class="main">⟶</span> <span class="free">failure_detect</span> <span class="bound">s</span>"</span></span>
  <span class="comment1">(*the TEE shall Enter a secure state upon failure detection*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">=</span> <span class="free">move_to_secure_state</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">failure_detect</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">secure_state</span> <span class="bound">s'</span>"</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_RNG"</span></span></span>
<span class="comment1">(*
O.RNG
The TEE shall ensure the cryptographic quality of random number generation. Random numbers shall not 
be predictable and shall have sufficient entropy.
Application Note:
Random number generation may combine hardware and/or software mechanisms.
The RNG functionality is also used for generation of the TEE identifier if this identifier is generated within 
the TEE.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_RNG <span class="main">=</span> 
        <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">rng</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>nat"</span></span>
        <span class="keyword2"><span class="keyword">assumes</span></span> rngdiff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">x'</span><span class="main">⟶</span><span class="free">rng</span> <span class="free">x</span><span class="main">≠</span><span class="free">rng</span> <span class="free">x'</span>"</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_TA_AUTEHNTICITY"</span></span></span>
<span class="comment1">(*
O.TA_AUTHENTICITY
The TEE shall verify the authenticity of the Trusted Applications’ binary code.
Application Note:
Verification of authenticity of TA code can be performed together with verification of the TEE firmware if 
both are bundled together or during the loading of the TA code in volatile memory.
*)</span>


<span class="keyword1"><span class="command">locale</span></span> O_TA_AUTHENTICITY
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">verify</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'bc</span> <span class="main">⇒</span> <span class="tfree">'k</span> <span class="main">⇒</span> bool"</span></span> 
    <span class="comment1">(* use a key 'k to authenticate whether a TA code 'bc is the CODE the TEE thinks *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_TRUSTED_STORAGE"</span></span></span>

<span class="comment1">(*O.TRUSTED_STORAGE
The TEE shall provide Trusted Storage services for persistent TA data and keys such that the following 
properties are enforced: confidentiality, authenticity, and consistency.
Moreover, the TEE shall either enforce the atomicity of the operations that modify the storage or detect that 
modifications of the storage have not been completed as expected.
The Trusted Storage shall be bound to the host device, which means that the stored data cannot be read 
in another device.*)</span>


<span class="keyword1"><span class="command">locale</span></span> O_TRUSTED_STORAGE <span class="main">=</span> OState <span class="main">+</span>
    <span class="comment1">(*fixes trans::"'s⇒'a⇒'s"*)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Store_op</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Read_op</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
<span class="comment1">(*
protected by trans

    fixes storage_error_detect::"'s⇒bool"
    (*the TEE shall either enforce the atomicity of the operations that modify the storage*)
    assumes atomicity:"∀s t . t= trans s Store_op ∧ storage_error_detect t ⟶ t = s"*)</span>  
   
     <span class="comment1">(*device are represented as SoC here*)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">storage_bind</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'ts</span><span class="main">⇒</span><span class="tfree">'SoC</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*tee's id and SSK is in device*)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">read_ctrl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ts</span><span class="main">⇒</span><span class="tfree">'SoC</span><span class="main">⇒</span><span class="tfree">'apicaller</span><span class="main">⇒</span>bool"</span></span>
    <span class="comment1">(*the stored data cannot be read in another device*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> bindlemma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ts</span> <span class="bound">call</span><span class="main">.</span> <span class="free">read_ctrl</span> <span class="bound">s</span> <span class="free">Read_op</span> <span class="bound">ts</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">call</span> <span class="main">⟶</span> <span class="free">storage_bind</span> <span class="bound">ts</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> bindlemma2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ts</span> <span class="bound">call</span><span class="main">.</span> <span class="free">read_ctrl</span> <span class="bound">s</span> <span class="free">Store_op</span> <span class="bound">ts</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">call</span> <span class="main">⟶</span> <span class="free">storage_bind</span> <span class="bound">ts</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="comment1">(*The TEE shall provide Trusted Storage services for persistent TA data and keys such that the following 
    properties are enforced: confidentiality, authenticity, and consistency.*)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tsSecurity</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ts</span><span class="main">⇒</span><span class="tfree">'apicaller</span><span class="main">⇒</span>bool"</span></span><span class="comment1">(*caller can operate on ts when approved by config in s,
                                                security include confidence and integrity*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> tsSeclemma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ts</span> <span class="bound">call</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">read_ctrl</span> <span class="bound">s</span> <span class="free">Read_op</span> <span class="bound">ts</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">call</span><span class="main">)</span> <span class="main">⟶</span><span class="main">¬</span><span class="main">(</span><span class="free">tsSecurity</span> <span class="free">Read_op</span> <span class="bound">ts</span> <span class="bound">call</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> tsSeclemma2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ts</span> <span class="bound">call</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">read_ctrl</span> <span class="bound">s</span> <span class="free">Store_op</span> <span class="bound">ts</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">call</span><span class="main">)</span> <span class="main">⟶</span><span class="main">¬</span><span class="main">(</span><span class="free">tsSecurity</span> <span class="free">Store_op</span> <span class="bound">ts</span> <span class="bound">call</span><span class="main">)</span>"</span></span>
    
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_RUNTIME_CONFIDENTIALITY"</span></span></span>

<span class="comment1">(*
O.RUNTIME_CONFIDENTIALITY

The TEE shall ensure that confidential TEE runtime data and TA data and keys are protected against 
unauthorized disclosure. In particular:
o The TEE shall not export any sensitive data, random numbers or secret keys to the REE;
o The TEE shall grant access to sensitive data, random numbers or secret keys only to authorized 
TAs;
o The TEE shall clean up sensitive resources as soon as it can determine that their values are no 
longer needed.*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_RUNTIME_CONFIDENTIALITY <span class="main">=</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">memory_model</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Raccess</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span>bool"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">getMem</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span><span class="tfree">'mm</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">readMem</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span><span class="tfree">'mc</span> option"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">unavailable</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'mm</span><span class="main">⇒</span>bool"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TEE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the TEE domain *)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">REE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the REE domain *)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TA_domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span> <span class="tfree">'ta</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>  <span class="comment1">(* domain id of TAs *)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">TEE</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ta</span> <span class="bound">s</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">TEE</span> <span class="main">∧</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> inj <span class="main">(</span><span class="free">TA_domain</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span> <span class="main">∨</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">REE</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">=</span> <span class="bound">d</span><span class="main">)</span>"</span></span> 
    <span class="comment1">(*The TEE shall not export any sensitive data, random numbers or secret keys to the REE*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">Raccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">TEE</span><span class="main">)</span> <span class="free">REE</span> <span class="main">∧</span><span class="main">¬</span><span class="free">Raccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta</span><span class="main">)</span><span class="main">)</span> <span class="free">REE</span> "</span></span>
    <span class="comment1">(*The TEE shall grant access to sensitive data, random numbers or secret keys only to authorized TAs*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ta</span><span class="main">≠</span><span class="free">ta'</span> <span class="main">⟶</span> <span class="main">¬</span><span class="free">Raccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta'</span><span class="main">)</span>"</span></span>
    <span class="comment1">(*The TEE shall clean up sensitive resources as soon as it can determine that their values are no longer needed.*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">unavailable</span> <span class="free">s</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">d</span><span class="main">)</span> <span class="free">d2</span> <span class="main">=</span> None"</span></span>
    



<span class="comment1">(*
O.RUNTIME_INTEGRITY

The TEE shall ensure that the TEE firmware, TEE runtime data, TA code, and TA data and keys are 
protected against unauthorized modification at runtime when stored in volatile memory

*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_RUNTIME_INTEGRITY"</span></span></span>

<span class="keyword1"><span class="command">locale</span></span> O_RUNTIME_INTEGRITY <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">memory_model</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Waccess</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span>bool"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">getMem</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span><span class="tfree">'mm</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">unavailable</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'mm</span><span class="main">⇒</span>bool"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TEE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the TEE domain *)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">REE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the REE domain *)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TA_domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span> <span class="tfree">'ta</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>  <span class="comment1">(* domain id of TAs *)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">TEE</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ta</span> <span class="bound">s</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">TEE</span> <span class="main">∧</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> inj <span class="main">(</span><span class="free">TA_domain</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span> <span class="main">∨</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">REE</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">=</span> <span class="bound">d</span><span class="main">)</span>"</span></span> 
    <span class="comment1">(*The TEE shall not export any sensitive data, random numbers or secret keys to the REE*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">Waccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">TEE</span><span class="main">)</span> <span class="free">REE</span> <span class="main">∧</span><span class="main">¬</span><span class="free">Waccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta</span><span class="main">)</span><span class="main">)</span> <span class="free">REE</span> "</span></span>
    <span class="comment1">(*The TEE shall grant access to sensitive data, random numbers or secret keys only to authorized TAs*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ta</span><span class="main">≠</span><span class="free">ta'</span> <span class="main">⟶</span> <span class="main">¬</span><span class="free">Waccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta'</span><span class="main">)</span>"</span></span>
   




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_TEE_DATA_PROTECTION"</span></span></span>

<span class="comment1">(*
O.TEE_DATA_PROTECTION The TEE shall ensure the authenticity, 
      consistency, and confidentiality of TEE persistent data.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_TEE_DATA_PROTECTION <span class="main">=</span> OState <span class="main">+</span> 
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">on_detect_TEE_auth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">verify2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'tee_data</span><span class="main">⇒</span><span class="tfree">'SoC</span><span class="main">⇒</span>bool"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">verify2</span> <span class="main">(</span><span class="free">TEE_persist</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span>"</span></span><span class="comment1">(*ensure the consistency, and confidentiality of TEE persistent data.*)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="free">verify2</span> <span class="main">(</span><span class="free">TEE_persist</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span> 
                  <span class="main">∧</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">on_detect_TEE_auth</span> <span class="bound">s</span> 
                  <span class="main">∧</span> <span class="main">¬</span> <span class="free">verify2</span> <span class="main">(</span><span class="free">TEE_persist</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">TEE_state</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">TEE_state_abort</span>"</span></span>
        <span class="comment1">(*ensure the authenticity, consistency of TEE persistent data.*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_TA_ISOLATION"</span></span></span>

<span class="comment1">(*
O.TA_ISOLATION

The TEE shall isolate the TAs from each other: Each TA shall access its own execution and storage space, 
which is shared among all the instances of the TA but separated from the spaces of any other TA.
Application Note:
This objective contributes to the enforcement of the confidentiality and integrity of TA data.
*)</span>


<span class="keyword1"><span class="command">locale</span></span> O_TA_ISOLATION
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span> option"</span></span> <span class="comment1">(* domain of actions *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">vpeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∼</span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∼</span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span>"</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">interference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">↝</span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span>"</span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TEE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the TEE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">REE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the REE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TA_domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span> <span class="tfree">'ta</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>  <span class="comment1">(* domain id of TAs *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">TEE</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ta</span> <span class="bound">s</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">TEE</span> <span class="main">∧</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> inj <span class="main">(</span><span class="free">TA_domain</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span> <span class="main">∨</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">REE</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">=</span> <span class="bound">d</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    tee_intf_all <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">TEE</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    interf_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="comment1">(*Each TA shall access its own execution and storage space*)</span>
    ta_intf <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ta</span> <span class="bound">ta'</span><span class="main">.</span> <span class="bound">ta</span><span class="main">≠</span><span class="bound">ta'</span><span class="main">⟶</span><span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_TEE_ISOLATION"</span></span></span>

<span class="comment1">(*
O.TEE_ISOLATION

The TEE shall prevent the REE and the TAs from accessing the TEE’s own execution and storage space 
and resources.
Application Note:
This objective contributes to the enforcement of the correct execution of the TEE. Note that resource 
allocation can change during runtime as long as it does not break isolation between resources used by the 
TEE and the REE/TAs.
// maybe tee's accessing ta's data is allowed
*)</span>

<span class="keyword1"><span class="command">locale</span></span> O_TEE_ISOLATION
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span> option"</span></span> <span class="comment1">(* domain of actions *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">vpeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3">(</span></span>_ <span class="keyword1"><span class="keyword1">∼</span></span> _ <span class="keyword1"><span class="keyword1">∼</span></span> _<span class="keyword3"><span class="keyword3">)</span></span>"</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">interference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3">(</span></span>_ <span class="keyword1"><span class="keyword1">↝</span></span> _<span class="keyword3"><span class="keyword3">)</span></span>"</span><span class="main">)</span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TEE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the TEE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">REE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the REE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TA_domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span> <span class="tfree">'ta</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>  <span class="comment1">(* domain id of TAs *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">TEE</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ta</span> <span class="bound">s</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">TEE</span> <span class="main">∧</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">≠</span> <span class="free">REE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> inj <span class="main">(</span><span class="free">TA_domain</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span> <span class="main">∨</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">REE</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="bound">s</span> <span class="bound">ta</span> <span class="main">=</span> <span class="bound">d</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    tee_intf_all <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">TEE</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="comment1">(*The TEE shall prevent the REE and the TAs from accessing 
          the TEE’s own execution and storage space and resources.*)</span>
    no_intf_tee <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="free">TEE</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    interf_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span>
  
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"O_ISOLATION and proofs"</span></span></span>
  
<span class="comment1">(*
Isolation includes the 5 objectives below:
O.RUNTIME_CONFIDENTIALITY
O.RUNTIME_INTEGRITY
O.TA_ISOLATION
O.TEE_ISOLATION
O.TEE_DATA_PROTECTION
*)</span>



<span class="keyword1"><span class="command">locale</span></span> O_ISOLATION
   <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s0</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'s</span></span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Trans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="comment1">(* state machine of the whole system *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'d</span> option"</span></span> <span class="comment1">(* domain of actions *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">vpeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">∼</span> _ <span class="keyword1">∼</span> _<span class="keyword3">)</span>"</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">interference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">↝</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="comment1">(*
  fixes write_interference :: "'d ⇒ 'd ⇒ bool" ("(_ ↝ _)")(*including sensitive data and params*)
  fixes ta_data::"'s⇒'d⇒'data"(*ta runtime data, parameter not included*)
  fixes tee_data::"'s⇒'d⇒'data"(*tee runtime data, parameter not included*)
  (*because REE data can be accessed by all, so we don't model it*)
  fixes access::"'s⇒'d⇒'data⇒bool"(*ta/tee runtime data access management*)
  fixes clean_up::"'s⇒'data⇒bool"(*The TEE shall clean up sensitive resources*)
  fixes read_interference :: "'d ⇒ 'd ⇒ bool" ("(_↪_)")
*)</span>

<span class="comment1">(*
   // in this project TA is TA instance so we may not distinguish them
*)</span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TEE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the TEE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">REE</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'d</span></span></span> <span class="comment1">(* the REE domain *)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">TA_domain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span> <span class="tfree">'ta</span> <span class="main">⇒</span> <span class="tfree">'d</span>"</span></span>  <span class="comment1">(* domain id of TAs *)</span>
<span class="comment1">(* fixes CA_domain :: "'ca ⇒ 'd"*)</span>  <span class="comment1">(* domain id of CAs *)</span> 
    <span class="comment1">(* CAs as clients have to be identified, as well as their actions, 
    so we consider each CA as an identity. When define security, we consider them as the whole REE domain  *)</span>
  <span class="comment1">(*
  assumes "TEE ≠ REE"
    and   "∀ta s. TA_domain s ta ≠ TEE ∧ TA_domain s ta ≠ REE"
    and   "∀s. inj (TA_domain s)"
    and   "∀d s. d = TEE ∨ d = REE ∨ (∃ta. TA_domain s ta = d)" 
  *)</span>
  <span class="comment1">(*we can write this in specification because we proof security in requirement layer,not secure layer*)</span> 



   <span class="comment1">(* CAs as clients have to be identified, as well as their actions, 
      so we consider each CA as a domain. When define security, we consider them as the whole REE domain  *)</span>



  <span class="keyword2"><span class="keyword">assumes</span></span> 
    vpeq_transitive_lemma <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">r</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    vpeq_symmetric_lemma <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">t</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    vpeq_reflexive_lemma <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="comment1">(* tee_vpeq : "∀s t a. (s ∼ TEE ∼ t) ⟶ (domain s a) = (domain t a)" and*)</span>
    tee_intf_all <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">TEE</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    no_intf_tee <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="free">TEE</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    interf_reflexive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> 
<span class="comment1">(*
    tee_vpeq : "∀s t. (s ∼ TEE ∼ t) ⟶ (tee_data s TEE) = (tee_data t TEE)" and
    ta_vpeq : "∀s t ta. (s ∼ TA_domain ta ∼ t) ⟶ ta_data s (TA_domain ta) = ta_data t (TA_domain ta)" and
*)</span> 


<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">non_interference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">∖↝</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main"><span class="free">∖↝</span></span>  <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main"><span class="free">↝</span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(*definition non_read_interference :: "'d ⇒ 'd ⇒ bool" ("(_ ∖↪ _)")
  where "(u ∖↪  v) ≡ ¬ (u ↪ v)"
*)</span>


<span class="comment1">(*state transition after the execution of an event list in which each event is executed by function "trans"*)</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">run</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list<span class="main">⇒</span><span class="main">(</span><span class="tfree">'s</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  run_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="main">[]</span> <span class="main">=</span> Id"</span></span> <span class="main">|</span>
  run_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">run</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">O</span> <span class="free">run</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span>"</span></span>

<span class="comment1">(*judge whether s' is reachable after the execution of an event list with an initial state s*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reachable</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'s</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">∈</span> run <span class="bound">as</span><span class="main">)</span>"</span></span>
  
<span class="comment1">(*judge whether s is reachable from initial state s0*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reachable0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable0</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> reachable <span class="free">s0</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> non_interference_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> reachable_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> reachable0_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> run.simps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
            run.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">cong</span><span class="main">]</span>

    <span class="keyword1"><span class="command">lemma</span></span> reachable_s0 <span class="main">:</span> <span class="quoted"><span class="quoted">"reachable0 <span class="free">s0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reachable0_def reachable_def run_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
    
    <span class="keyword1"><span class="command">lemma</span></span> reachable_self <span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">s</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reachable_def run.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">lemma</span></span> reachable_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="free">a</span> <span class="main">⟹</span> reachable <span class="free">s</span> <span class="free">s'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span>run <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> run_trans <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="bound">T</span> <span class="bound">V</span> <span class="bound">as</span> <span class="bound">bs</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="bound">T</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">T</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="bound">V</span><span class="main">)</span><span class="main">∈</span>run <span class="main">(</span><span class="bound">as</span><span class="main">@</span><span class="bound">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span> <span class="skolem">V</span> <span class="skolem">as</span> <span class="skolem">bs</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="skolem">T</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">as</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span><span class="main">∈</span>run <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">cs</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">cs</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">C</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="skolem">cs</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">bs</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span> "</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">T</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">T</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="skolem">bs</span>"</span></span>
                    <span class="keyword1"><span class="command">from</span></span> b0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span><span class="skolem">C'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">C'</span><span class="main">,</span><span class="skolem">T</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">cs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">with</span></span> a0 b0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C'</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span><span class="main">∈</span>run <span class="main">(</span><span class="skolem">cs</span><span class="main">@</span><span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">with</span></span> b2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> run <span class="main">(</span><span class="main">(</span><span class="skolem">c</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> append_Cons relcomp.relcompI run_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">(* 
    (*The TEE shall not export any sensitive data, random numbers or secret keys to the REE*)
    assumes ree_no_access: "∀s data d. (data = ta_data s d) ∨ (data = tee_data s d) ⟶ ¬ access s REE data"
    assumes 
      ta_data_diff:"∀s ta ta'. ta_data s (TA_domain ta) ≠ ta_data s (TA_domain ta')"
      and ta_tee_diff:"∀s ta. ta_data s (TA_domain ta) ≠ tee_data s TEE"
      (*The TEE shall grant access to sensitive data, random numbers or secret keys only to authorized TAs*)
      (*Each TA shall access its own execution and storage space*)
      and ta_data_iso:"∀s ta data. access s (TA_domain ta) data ⟶ data = (ta_data s (TA_domain ta)) "
      (*The TEE shall prevent the REE and the TAs from accessing the TEE’s own execution and storage space and resources.*)
      and ta_tee_iso:"∀s ta. TA_domain ta ≠ TEE ⟶ ¬ access s (TA_domain ta) (tee_data s TEE)"
  *)</span>
    <span class="keyword1"><span class="command">lemma</span></span> reachable_transitive <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>reachable <span class="free">C</span> <span class="free">T</span><span class="main">;</span> reachable <span class="free">T</span> <span class="free">V</span><span class="main">⟧</span> <span class="main">⟹</span> reachable <span class="free">C</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">C</span> <span class="free">T</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">T</span> <span class="free">V</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> a0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">T</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">T</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">V</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span><span class="free">V</span>"</span></span>
                    <span class="keyword1"><span class="command">with</span></span> a0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 b0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">T</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="free">V</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">=</span><span class="free">V</span>"</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">assume</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">as</span><span class="main">.</span> <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="bound">as</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">from</span></span> b0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">T</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">as</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">from</span></span> c0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">V</span><span class="main">)</span><span class="main">∈</span>run <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d0  run_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> reachableStep <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>reachable0 <span class="free">C</span><span class="main">;</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">C'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="free">a</span><span class="main">⟧</span> <span class="main">⟹</span> reachable0 <span class="free">C'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> reachable0_def reachable_def reachable_trans run_trans<span class="main">)</span>
     
     
    <span class="keyword1"><span class="command">lemma</span></span> reachable0_reach <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>reachable0 <span class="free">C</span><span class="main">;</span> reachable <span class="free">C</span> <span class="free">C'</span><span class="main">⟧</span> <span class="main">⟹</span> reachable0 <span class="free">C'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_transitive<span class="main">)</span>
      
    <span class="keyword1"><span class="command">declare</span></span> reachable_def<span class="main">[</span><span class="operator">cong</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> reachable0_def<span class="main">[</span><span class="operator">cong</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"security properties"</span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">integrity</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">integrity</span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="bound">a</span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
      
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">integrity_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">integrity_e</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∖↝</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
   


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">confidentiality</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">confidentiality</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">a</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="bound">a</span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="bound">a</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">confidentiality_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">confidentiality_e</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_confidentiality</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">weak_confidentiality</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">a</span> <span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="bound">a</span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="bound">a</span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="bound">a</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">weak_confidentiality_e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">weak_confidentiality_e</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">d</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> reachable0 <span class="bound">s</span> <span class="main">∧</span> reachable0 <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free">domain</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>
                                <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Trans</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s'</span> <span class="main"><span class="free">∼</span></span> <span class="bound">d</span> <span class="main"><span class="free">∼</span></span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">declare</span></span> confidentiality_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> confidentiality_e_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          weak_confidentiality_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> weak_confidentiality_e_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
          integrity_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> integrity_e_def<span class="main">[</span><span class="operator">cong</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> confidentiality_all_event<span class="main">:</span> <span class="quoted"><span class="quoted">"confidentiality <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> confidentiality_e <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> weak_confidentiality_all_event<span class="main">:</span> <span class="quoted"><span class="quoted">"weak_confidentiality <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> weak_confidentiality_e <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> integrity_all_event<span class="main">:</span> <span class="quoted"><span class="quoted">"integrity <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> integrity_e <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> weak_with_step_cons<span class="main">:</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> p1<span class="main">:</span><span class="quoted">weak_confidentiality</span>
        <span class="keyword2"><span class="keyword">and</span></span>   p2<span class="main">:</span><span class="quoted">integrity</span>
      <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted">confidentiality</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">a</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span> <span class="skolem">t'</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span> <span class="main">∧</span> reachable0 <span class="skolem">t</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="skolem">a</span>
              <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
           <span class="keyword1"><span class="command">{</span></span>
             <span class="keyword3"><span class="command">assume</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"reachable0 <span class="skolem">s</span> <span class="main">∧</span> reachable0 <span class="skolem">t</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">∼</span></span> <span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
             <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span><span class="main">∈</span><span class="free">Trans</span> <span class="skolem">a</span>"</span></span>
             <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">d</span> <span class="main"><span class="free">∼</span></span> <span class="skolem">t'</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> b0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span>"</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aa a0 a1 a2 b0 p1 weak_confidentiality_def a3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
                <span class="keyword1"><span class="command">next</span></span>
                <span class="keyword3"><span class="command">assume</span></span> b1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> b2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">domain</span> <span class="skolem">s</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1 <span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> b1 <span class="keyword1"><span class="command">have</span></span> b3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">(</span>the <span class="main">(</span><span class="free">domain</span> <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main"><span class="free">∼</span></span><span class="skolem">d</span><span class="main"><span class="free">∼</span></span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aa b1  p2 a3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main"><span class="free">∼</span></span><span class="skolem">d</span><span class="main"><span class="free">∼</span></span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aa b3 p2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a0 b4 vpeq_symmetric_lemma vpeq_transitive_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">qed</span></span>
           <span class="keyword1"><span class="command">}</span></span>
           <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
           <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> confidentiality_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"Security Objectives Rationale"</span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.IMPERSONATION"</span></span></span>
<span class="comment1">(*
T.IMPERSONATION The combination of the following objectives ensures protection against application 
impersonation attacks:
o O.CA_TA_IDENTIFICATION ensures the protection of Client identities and the possibility to 
distinguish Client Applications and Trusted Applications
o O.OPERATION ensures the verification of Client identities before any operation on their behalf
o O.RUNTIME_INTEGRITY prevents against unauthorized modification of security functionality at 
runtime.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> Impersonation <span class="main">=</span> O_CA_TA_IDENTIFICATION <span class="quoted"><span class="free">ta_client</span></span> <span class="quoted"><span class="free">ta_id_as_client</span></span> <span class="quoted"><span class="free">ca_id_as_client</span></span>
          <span class="main">+</span> O_OPERATION <span class="quoted"><span class="free">valid_ca_access</span></span> <span class="quoted"><span class="free">valid_ta_access</span></span> <span class="main">+</span> O_RUNTIME_INTEGRITY
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">ta_client</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'ta</span> <span class="main">⇀</span> <span class="tfree">'cid</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ta_id_as_client</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span><span class="tfree">'cid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ca_id_as_client</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span><span class="tfree">'cid</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">valid_ca_access</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ca</span><span class="main">⇒</span>bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">valid_ta_access</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'ta</span><span class="main">⇒</span>bool"</span></span>
    
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">valid_ta_access</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">ta</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">failure_detect</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> access_cor_use <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">interpretation</span></span> T_IMPERSONATION <span class="quoted"><span class="free">valid_ta_access</span></span> <span class="quoted"><span class="free">failure_detect</span></span> 
    <span class="keyword1"><span class="command">using</span></span> aux1
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_IMPERSONATION_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.ABUSE_FUNCT"</span></span></span>
<span class="comment1">(*
T.ABUSE_FUNCT The combination of the following objectives ensures protection against abuse of 
functionality:
o O.INITIALISATION ensures that the TEE security functionality is correctly initialized
o O.OPERATION ensures correct operation of the security functionality and a proper management 
of failures
o O.RUNTIME_CONFIDENTIALITY prevents exposure of confidential data
o O.RUNTIME_INTEGRITY ensures protection against unauthorized modification of security 
functionality at runtime
o O.TA_AUTHENTICITY ensures that the authenticity of TA code is verified
o O.TEE_DATA_PROTECTION ensures that the data used by the TEE are authentic and consistent
o O.TEE_ISOLATION enforces the separation between the TEE and the outside (REE and TAs)
o O.KEYS_USAGE controls the usage of cryptographic keys
o OE.TA_DEVELOPMENT enforces TA development principles, which are meant in particular to 
prevent disclosing information or performing modifications upon request of unauthorized entities.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> OE_TA_DEVELOPMENT

<span class="keyword1"><span class="command">locale</span></span> ABUSE_FUNCT <span class="main">=</span> O_INITIALISATION <span class="main">+</span> O_OPERATION <span class="main">+</span> O_RUNTIME_CONFIDENTIALITY
                    <span class="main">+</span> O_RUNTIME_INTEGRITY <span class="main">+</span> O_TA_AUTHENTICITY <span class="main">+</span> O_TEE_DATA_PROTECTION
                    <span class="main">+</span> O_TEE_ISOLATION <span class="main">+</span> O_KEYS_USAGE <span class="main">+</span> OE_TA_DEVELOPMENT

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> T_ABUSE_FUNCT
      <span class="keyword1"><span class="command">using</span></span> O_INITIALISATION_axioms O_INITIALISATION_def
        <span class="keyword1"><span class="command">using</span></span> O_OPERATION_axioms O_OPERATION_def
        <span class="keyword1"><span class="command">using</span></span> O_RUNTIME_CONFIDENTIALITY_axioms O_RUNTIME_CONFIDENTIALITY_def
        <span class="keyword1"><span class="command">using</span></span> O_RUNTIME_INTEGRITY_axioms O_RUNTIME_INTEGRITY_def
        <span class="keyword1"><span class="command">using</span></span> O_TEE_DATA_PROTECTION_axioms O_TEE_DATA_PROTECTION_def
        <span class="keyword1"><span class="command">using</span></span> O_TEE_ISOLATION_axioms O_TEE_ISOLATION_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ABUSE_FUNCT.intro <span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">sorry</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.CLONE"</span></span></span>
<span class="comment1">(*
T.CLONE The combination of the following objectives ensures protection against cloning:
o O.TEE_ID provides the unique TEE identification means
o O.INITIALISATION ensures that the TEE is bound to the SoC of the device
o O.RUNTIME_CONFIDENTIALITY prevents exposure of confidential data, particularly TSF data 
used to bind the TEE to the device
o O.RUNTIME_INTEGRITY prevents unauthorized modification at runtime of security functionalities 
or data used to detect or prevent cloning
o O.TEE_DATA_PROTECTION prevents the TEE from using TEE data that is inconsistent or not 
authentic
o O.TRUSTED_STORAGE ensures that the trusted storage is bound to the device and prevents the 
TEE from using data that is inconsistent or not authentic
o O.RNG ensures that the TEE identifier is in fact unique when generated inside the TOE
*)</span>


<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'ts</span><span class="main">,</span><span class="tfree">'tee_data</span><span class="main">,</span><span class="tfree">'firmware</span><span class="main">,</span><span class="tfree">'mm</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> related_data <span class="main">=</span>
      t_id<span class="main">::</span><span class="quoted"><span class="quoted">"tee_id"</span></span>
      t_storage <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'ts</span>"</span></span>
      tee_persist <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'tee_data</span>"</span></span>
      tee_firm <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'firmware</span>"</span></span>
      tee_runtime <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span>"</span></span>
      tee_dom <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span>"</span></span>

<span class="comment1">(*typedecl SoC*)</span>

<span class="keyword1"><span class="command">consts</span></span> get_related_data<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="main">(</span><span class="tfree">'ts</span><span class="main">,</span><span class="tfree">'tee_data</span><span class="main">,</span><span class="tfree">'firmware</span><span class="main">,</span><span class="tfree">'mm</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> related_data"</span></span>



<span class="keyword1"><span class="command">locale</span></span> Clone <span class="main">=</span> O_TEE_ID  <span class="main">+</span> O_INITIALISATION <span class="main">+</span> O_RUNTIME_CONFIDENTIALITY <span class="quoted"><span class="free">memory_model</span></span> <span class="quoted"><span class="free">Raccess</span></span>  
                <span class="main">+</span> O_RUNTIME_INTEGRITY <span class="quoted"><span class="free">memory_model</span></span> <span class="quoted"><span class="free">Waccess</span></span>
                <span class="main">+</span> O_TEE_DATA_PROTECTION <span class="main">+</span> O_TRUSTED_STORAGE <span class="main">+</span> O_RNG  
      
      <span class="keyword2"><span class="keyword">for</span></span> <span class="free">memory_model</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'mm</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Raccess</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span>bool"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Waccess</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'mm</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span>bool"</span></span>  
      <span class="main">+</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">id_bind</span><span class="main">::</span><span class="quoted"><span class="quoted">"tee_id<span class="main">⇒</span><span class="tfree">'n</span><span class="main">⇒</span>bool"</span></span>
      <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">id_bind</span> <span class="main">(</span><span class="free">getTEEId</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="free">getSoc</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Raccess</span> <span class="main">(</span>tee_runtime <span class="free">data</span><span class="main">)</span> <span class="main">(</span>tee_dom <span class="free">data</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Waccess</span> <span class="main">(</span>tee_runtime <span class="free">data</span><span class="main">)</span> <span class="main">(</span>tee_dom <span class="free">data</span><span class="main">)</span><span class="main">)</span>"</span></span>

      

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bind_check</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'p</span><span class="main">,</span><span class="tfree">'f</span><span class="main">,</span><span class="tfree">'h</span><span class="main">,</span><span class="tfree">'mm</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> related_data<span class="main">⇒</span><span class="tfree">'n</span><span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">bind_check</span> <span class="free"><span class="bound"><span class="entity">data</span></span></span> <span class="free"><span class="bound"><span class="entity">soc</span></span></span><span class="main">≡</span> <span class="main">(</span><span class="free">id_bind</span> <span class="main">(</span>t_id <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">soc</span></span></span><span class="main">)</span> <span class="main">∧</span>
                           <span class="main">(</span><span class="free">verify2</span> <span class="main">(</span>tee_persist <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">soc</span></span></span><span class="main">)</span><span class="main">∧</span>
                           <span class="main">(</span><span class="free">checkfirmware</span> <span class="free"><span class="bound"><span class="entity">soc</span></span></span> <span class="main">(</span>tee_firm <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
                           <span class="main">(</span><span class="free">storage_bind</span> <span class="main">(</span>t_storage <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">soc</span></span></span><span class="main">)</span><span class="main">∧</span>
                           <span class="main">(</span><span class="free">Raccess</span> <span class="main">(</span>tee_runtime <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span> <span class="main">(</span>tee_dom <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
                           <span class="main">(</span><span class="free">Waccess</span> <span class="main">(</span>tee_runtime <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span> <span class="main">(</span>tee_dom <span class="free"><span class="bound"><span class="entity">data</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> clone_aux<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> bind_check <span class="main">(</span>get_related_data <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Clone_axioms O_TEE_DATA_PROTECTION_def O_TEE_DATA_PROTECTION_axioms
        O_TRUSTED_STORAGE_def O_TRUSTED_STORAGE_axioms 
      O_INITIALISATION_def O_INITIALISATION_axioms 



<span class="keyword1"><span class="command">interpretation</span></span> T_CLONE <span class="quoted">get_related_data</span> <span class="quoted">bind_check</span>
 <span class="keyword1"><span class="command">using</span></span> clone_aux
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_CLONE.intro<span class="main">)</span> 

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.FLASH_DUMP"</span></span></span>
<span class="comment1">(*
T.FLASH_DUMP The objective O.TRUSTED_STORAGE 
ensures the confidentiality of the data stored in external memory.
*)</span>



<span class="keyword1"><span class="command">locale</span></span> Flash <span class="main">=</span> O_TRUSTED_STORAGE <span class="main">+</span>
       <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">encrypted</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'ts</span><span class="main">⇒</span><span class="tfree">'SoC</span><span class="main">⇒</span>bool"</span></span>
       <span class="keyword2"><span class="keyword">assumes</span></span> en_check<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">encrypted</span> <span class="main">(</span><span class="free">getTS</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> T_FLUSH_DUMP <span class="quoted"><span class="free">s0</span></span> <span class="quoted"><span class="free">Trans</span></span> <span class="quoted"><span class="free">getSoc</span></span> <span class="quoted"><span class="free">getTS</span></span>  <span class="quoted"><span class="free">encrypted</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="main">(</span>simp add<span class="main">:</span> T_FLUSH_DUMP_def en_check<span class="main">)</span> 
        <span class="keyword1"><span class="command">sorry</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.RAM"</span></span></span>
<span class="comment1">(*
T.RAM The combination of the following objectives ensures protection against RAM attacks:
o O.INITIALISATION ensures that the TEE security functionality is correctly initialized and that the 
initialisation process is protected from the REE
o O.RUNTIME_CONFIDENTIALITY prevents exposure of confidential data at runtime
o O.RUNTIME_INTEGRITY protects against unauthorized modification of code and data at runtime
o O.TA_ISOLATION provides a memory barrier between TAs
o O.TEE_ISOLATION provides a memory barrier between the TEE and the REE.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> RAM <span class="main">=</span> O_INITIALISATION <span class="main">+</span> O_RUNTIME_CONFIDENTIALITY <span class="main">+</span> O_RUNTIME_INTEGRITY
              <span class="main">+</span> O_TA_ISOLATION <span class="main">+</span> O_TEE_ISOLATION

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> T_RAM <span class="quoted"><span class="free">Raccess</span></span> <span class="quoted"><span class="free">Waccess</span></span> <span class="quoted"><span class="free">getMem</span></span> <span class="quoted"><span class="free">TEE</span></span> <span class="quoted"><span class="free">REE</span></span> <span class="quoted"><span class="free">TA_domain</span></span>
<span class="keyword1"><span class="command">using</span></span> O_RUNTIME_CONFIDENTIALITY_axioms O_RUNTIME_CONFIDENTIALITY_def 
      O_RUNTIME_INTEGRITY_axioms O_RUNTIME_INTEGRITY_def T_RAM_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span>best<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.RNG"</span></span></span>
<span class="comment1">(*
T.RNG The combination of the following objectives ensures protection of the random number generation:
o O.INITIALISATION ensures the correct initialisation of the TEE security functions, particularly the 
RNG
o O.RNG ensures that random numbers are unpredictable, have sufficient entropy, and are not 
disclosed
o O.RUNTIME_CONFIDENTIALITY ensures that confidential data is not disclosed
o O.RUNTIME_INTEGRITY protects against unauthorized modification, for instance to force the 
output of the RNG.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> RNG <span class="main">=</span> O_INITIALISATION <span class="main">+</span> O_RUNTIME_CONFIDENTIALITY <span class="main">+</span> O_RUNTIME_INTEGRITY <span class="main">+</span> O_RNG
            <span class="main">+</span>
          <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">unpredict</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>bool"</span></span>
          <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">≠</span><span class="free">x'</span><span class="main">⟶</span><span class="free">rng</span> <span class="free">x</span><span class="main">≠</span><span class="free">rng</span> <span class="free">x'</span><span class="main">)</span> <span class="main">⟶</span><span class="free">unpredict</span> <span class="main">(</span><span class="free">rng</span> <span class="free">x</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> T_RNG <span class="quoted"><span class="free">unpredict</span></span> <span class="quoted"><span class="free">rng</span></span> 
    <span class="keyword1"><span class="command">using</span></span> T_RNG_def O_RNG_def O_RNG_axioms
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"RNG_axioms <span class="free">rng</span> <span class="free">unpredict</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> RNG_axioms RNG_def<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span>
      f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">unpredict</span> <span class="main">(</span><span class="free">rng</span> <span class="skolem">nn</span><span class="main">)</span> <span class="main">⟶</span> T_RNG <span class="free">unpredict</span> <span class="free">rng</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> T_RNG.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">unpredict</span> <span class="main">(</span><span class="free">rng</span> <span class="skolem">nn</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 RNG_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"T_RNG <span class="free">unpredict</span> <span class="free">rng</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.PERTURBATION"</span></span></span>

<span class="comment1">(*
T.PERTURBATION The combination of the following objectives ensures protection against perturbation attacks:
o O.INITIALISATION ensures that the TEE security functionality is correctly initialized
o O.INSTANCE_TIME ensures the reliability of instance time stamps
o O.OPERATION ensures correct operation of the security functionality and proper management of failures
o O.RUNTIME_CONFIDENTIALITY covers runtime TEE data which might influence the behaviour of the TEE
o O.TA_AUTHENTICITY ensures that the authenticity of TA code is verified
o O.RUNTIME_INTEGRITY ensures protection against unauthorized modification of security functionality at runtime
o O.TA_ISOLATION ensures the separation of the TA
o O.TEE_DATA_PROTECTION covers persistent TEE data which might influence the behaviour of the TEE
o O.TEE_ISOLATION enforces the separation between the TEE and the outside (REE and TAs).
*)</span>

<span class="keyword1"><span class="command">locale</span></span> PERTURBATION <span class="main">=</span> O_INITIALISATION <span class="main">+</span> O_INSTANCE_TIME <span class="main">+</span> O_OPERATION <span class="main">+</span> O_RUNTIME_CONFIDENTIALITY <span class="main">+</span>
            O_TA_AUTHENTICITY <span class="main">+</span> O_RUNTIME_INTEGRITY <span class="main">+</span> O_TA_ISOLATION <span class="main">+</span> O_TEE_DATA_PROTECTION <span class="main">+</span>
          O_TEE_ISOLATION

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> PERTURBATION
  <span class="keyword1"><span class="command">using</span></span> O_INITIALISATION_axioms O_INSTANCE_TIME_axioms O_OPERATION_axioms
          O_RUNTIME_CONFIDENTIALITY_axioms O_TA_AUTHENTICITY_axioms
          O_RUNTIME_INTEGRITY_axioms O_TA_ISOLATION_axioms
          O_TEE_DATA_PROTECTION_axioms O_TEE_ISOLATION_axioms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> -
    <span class="keyword1"><span class="command">proof</span></span> -
     <span class="keyword1"><span class="command">have</span></span>  <span class="quoted">"s0 = initialize sc∧secure_state s0"</span>
    <span class="comment1">(*accesses TEE functionality outside of their expected availability range*)</span>
    ∧ <span class="quoted">"(¬ valid_action s a cid ∨ ¬ valid_access s a cid )∧s'=Trans s a⟶ secure_state s'"</span>
      <span class="keyword1"><span class="command">using</span></span> T_ABUSE_FUNCT.intro <span class="keyword1"><span class="command">by</span></span> simp

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">"interpretation T_PERTURBATION"</span> <span class="keyword1"><span class="command">by</span></span> blast

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.SPY"</span></span></span>
<span class="comment1">(*
T.SPY The combination of the following objectives ensures protection against disclosure:
o O.RUNTIME_CONFIDENTIALITY ensures protection of confidential data at runtime
o O.TA_ISOLATION ensures the separation between TAs
o O.TEE_ISOLATION ensures that neither REE nor TAs can access TEE data
o O.TRUSTED_STORAGE ensures that data stored in the trusted storage locations is accessible 
by the TA owner only.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> SPY <span class="main">=</span> O_RUNTIME_CONFIDENTIALITY <span class="main">+</span> O_TA_ISOLATION <span class="main">+</span> O_TEE_ISOLATION
            <span class="main">+</span> O_TRUSTED_STORAGE
    <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">gettsOwner</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'ts</span><span class="main">⇒</span><span class="tfree">'apicaller</span>"</span></span>
     <span class="keyword2"><span class="keyword">assumes</span></span> l0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">ts</span> <span class="bound">call</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">read_ctrl</span> <span class="bound">s</span> <span class="free">Read_op</span> <span class="bound">ts</span> <span class="main">(</span><span class="free">getSoc</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">call</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">call</span><span class="main">≠</span><span class="free">gettsOwner</span> <span class="bound">ts</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">assumes</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">↝</span></span> <span class="free">TEE</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">d</span> <span class="main">=</span> <span class="free">TEE</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="free">d1</span><span class="main">≠</span><span class="free">TEE</span><span class="main">⟶</span><span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">TEE</span><span class="main">)</span> <span class="free">d1</span> <span class="main">=</span>None<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">assumes</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ta</span> <span class="bound">ta'</span><span class="main">.</span> <span class="bound">ta</span><span class="main">≠</span><span class="bound">ta'</span><span class="main">⟶</span><span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta</span><span class="main">)</span> <span class="main"><span class="free">↝</span></span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
       <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">ta</span> <span class="bound">ta'</span><span class="main">.</span> <span class="bound">ta</span><span class="main">≠</span><span class="bound">ta'</span> <span class="main">⟶</span><span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta'</span><span class="main">)</span> <span class="main">=</span>None<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> l3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="free">Raccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">TEE</span><span class="main">)</span> <span class="free">REE</span> <span class="main">∧</span><span class="main">¬</span><span class="free">Raccess</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta</span><span class="main">)</span><span class="main">)</span> <span class="free">REE</span> <span class="main">)</span>
            <span class="main">⟶</span> <span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="free">ta</span><span class="main">)</span><span class="main">)</span> <span class="free">REE</span> <span class="main">=</span>None <span class="main">∧</span><span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">TEE</span><span class="main">)</span> <span class="free">REE</span> <span class="main">=</span>None"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">lemma</span></span> trust_storage_protection<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">call</span><span class="main">≠</span><span class="main">(</span><span class="free">gettsOwner</span> <span class="free">ts</span><span class="main">)</span><span class="main">⟶</span><span class="main">¬</span><span class="main">(</span><span class="free">tsSecurity</span> <span class="free">Read_op</span> <span class="free">ts</span> <span class="free">call</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
<span class="keyword1"><span class="command">{</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">call</span><span class="main">≠</span><span class="main">(</span><span class="free">gettsOwner</span> <span class="free">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">tsSecurity</span> <span class="free">Read_op</span> <span class="free">ts</span> <span class="free">call</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> l0 O_TRUSTED_STORAGE_def O_TRUSTED_STORAGE_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> runtime_data_protection<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d2</span><span class="main">≠</span><span class="free">TEE</span><span class="main">∧</span><span class="free">d1</span><span class="main">≠</span><span class="free">REE</span><span class="main">∧</span><span class="free">d2</span><span class="main">≠</span><span class="free">d1</span><span class="main">⟶</span><span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">d1</span><span class="main">)</span> <span class="free">d2</span> <span class="main">=</span> None"</span></span>
 <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> p0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d2</span><span class="main">≠</span><span class="free">TEE</span><span class="main">∧</span><span class="free">d1</span><span class="main">≠</span><span class="free">REE</span><span class="main">∧</span><span class="free">d2</span><span class="main">≠</span><span class="free">d1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="free">d1</span><span class="main">)</span> <span class="free">d2</span> <span class="main">=</span> None"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d2</span><span class="main">=</span><span class="free">REE</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l3 O_RUNTIME_CONFIDENTIALITY_axioms 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> O_RUNTIME_CONFIDENTIALITY_def p0<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta</span> <span class="main">=</span> <span class="free">d2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p0 False O_RUNTIME_CONFIDENTIALITY_axioms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> O_TEE_ISOLATION_axioms O_TEE_ISOLATION_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ta</span></span> <span class="keyword2"><span class="keyword">where</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">TA_domain</span> <span class="free">s</span> <span class="skolem">ta</span> <span class="main">=</span> <span class="free">d2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d1</span><span class="main">=</span><span class="free">TEE</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l1  p0 a2 O_TEE_ISOLATION_def O_TEE_ISOLATION_axioms 
               O_TA_ISOLATION_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> <span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta</span> <span class="main">=</span> <span class="free">d1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> p0 O_TEE_ISOLATION_axioms O_TEE_ISOLATION_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ta'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">TA_domain</span> <span class="free">s</span> <span class="skolem">ta'</span> <span class="main">=</span> <span class="free">d1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ta</span> <span class="bound">ta'</span><span class="main">.</span> <span class="bound">ta</span><span class="main">≠</span><span class="bound">ta'</span> <span class="main">⟶</span>
            <span class="free">readMem</span> <span class="main">(</span><span class="free">getMem</span> <span class="free">s</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">TA_domain</span> <span class="free">s</span> <span class="bound">ta'</span><span class="main">)</span> <span class="main">=</span>None<span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> l2 O_TA_ISOLATION_def O_TA_ISOLATION_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 a4 a5 p0 O_TA_ISOLATION_axioms 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">interpretation</span></span> T_SPY <span class="quoted"><span class="free">tsSecurity</span></span> <span class="quoted"><span class="free">Store_op</span></span> <span class="quoted"><span class="free">Read_op</span></span>  <span class="quoted"><span class="free">gettsOwner</span></span> <span class="quoted"><span class="free">getMem</span></span> <span class="quoted"><span class="free">readMem</span></span> <span class="quoted"><span class="free">TEE</span></span> <span class="quoted"><span class="free">REE</span></span> <span class="quoted"><span class="free">TA_domain</span></span>
  <span class="keyword1"><span class="command">using</span></span> O_TRUSTED_STORAGE_def O_TRUSTED_STORAGE_axioms T_SPY_def  O_RUNTIME_CONFIDENTIALITY_def
        O_RUNTIME_CONFIDENTIALITY_axioms 
        O_TEE_ISOLATION_def O_TEE_ISOLATION_axioms 
        runtime_data_protection trust_storage_protection
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span>best<span class="main"><span class="main">)</span></span><span class="main">)</span>
      

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.ROGUE_CODE_EXECUTION"</span></span></span>

<span class="comment1">(*
T.ROGUE_CODE_EXECUTION 
The combination of the following objectives ensures protection against import of malicious code:
o O.INITIALISATION ensures that the TEE security functionality is correctly initialized 
  and the integrity of TEE firmware
o O.OPERATION ensures correct operation of the security functionality
o O.RUNTIME_CONFIDENTIALITY covers runtime TEE data which might influence the behaviour of the TEE
o O.TA_AUTHENTICITY ensures that the authenticity of TA code is verified
o O.RUNTIME_INTEGRITY ensures protection against unauthorized modification of security functionality at runtime
o O.TEE_DATA_PROTECTION covers persistent TEE data which might influence the behaviour of the TEE
o O.TRUSTED_STORAGE ensures protection of the storage from which code might be imported
o OE.INTEGRATION_CONFIGURATION covers the import of foreign code in a phase other than the end-user phase
o OE.PROTECTION_AFTER_DELIVERY covers the import of foreign code in a phase after delivery 
  and before the end-user phase.
*)</span>

<span class="keyword1"><span class="command">locale</span></span> OE_INTEGRATION_CONFIGURATION

<span class="keyword1"><span class="command">locale</span></span> OE_PROTECTION_AFTER_DELIVERY


<span class="keyword1"><span class="command">locale</span></span> ROGUE_CODE_EXECUTION <span class="main">=</span> O_INITIALISATION <span class="main">+</span> O_OPERATION <span class="main">+</span> O_RUNTIME_CONFIDENTIALITY
                             <span class="main">+</span> O_TA_AUTHENTICITY <span class="main">+</span> O_RUNTIME_INTEGRITY <span class="main">+</span> O_TEE_DATA_PROTECTION
                             <span class="main">+</span> O_TRUSTED_STORAGE <span class="main">+</span> OE_INTEGRATION_CONFIGURATION
                             <span class="main">+</span> OE_PROTECTION_AFTER_DELIVERY
      
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> T_ROGUE_CODE_EXECUTION
          <span class="keyword1"><span class="command">using</span></span> O_INITIALISATION_axioms O_INITIALISATION_def
          <span class="keyword1"><span class="command">using</span></span> O_OPERATION_axioms O_OPERATION_def
          <span class="keyword1"><span class="command">using</span></span> O_RUNTIME_CONFIDENTIALITY_axioms O_RUNTIME_CONFIDENTIALITY_def
          <span class="keyword1"><span class="command">using</span></span> O_RUNTIME_INTEGRITY_axioms O_RUNTIME_INTEGRITY_def
          <span class="keyword1"><span class="command">using</span></span> O_TEE_DATA_PROTECTION_axioms O_TEE_DATA_PROTECTION_def
          <span class="keyword1"><span class="command">using</span></span> O_TRUSTED_STORAGE_axioms O_TRUSTED_STORAGE_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ROGUE_CODE_EXECUTION_axioms ROGUE_CODE_EXECUTION.intro<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.TEE_FIRMWARE_DOWNGRADE"</span></span></span>
<span class="comment1">(*
T.TEE_FIRMWARE_DOWNGRADE The combination of the following objectives ensures protection against 
TEE firmware downgrade:
o O.INITIALISATION ensures that the firmware that is executed is the intended version
o OE.INTEGRATION_CONFIGURATION ensures that the firmware installed in the device is the 
intended version
o OE.PROTECTION_AFTER_DELIVERY ensures that the firmware has not been modified after 
delivery.
*)</span>



<span class="keyword1"><span class="command">locale</span></span> TEE_Firmware <span class="main">=</span> OE_INTEGRATION_CONFIGURATION <span class="main">+</span> OE_PROTECTION_AFTER_DELIVERY <span class="main">+</span>
                      O_INITIALISATION

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> T_TEE_FIRMWARE_DOWNGRADE <span class="quoted"><span class="free">s0</span></span> <span class="quoted"><span class="free">Trans</span></span> <span class="quoted"><span class="free">getSoc</span></span> <span class="quoted"><span class="free">getTS</span></span> <span class="quoted"><span class="free">checkfirmware</span></span> <span class="quoted"><span class="free">initialisation</span></span> <span class="quoted"><span class="free">getfirmware</span></span>
  <span class="keyword1"><span class="command">using</span></span> T_TEE_FIRMWARE_DOWNGRADE_def O_INITIALISATION_def O_INITIALISATION_axioms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.STORAGE_CORRUPTION"</span></span></span>
<span class="comment1">(*
T.STORAGE_CORRUPTION The combination of the following objectives ensures protection against 
corruption of non-volatile storage:
o O.OPERATION ensures the correct operation of the TEE security functionality, including storage
o O.TEE_DATA_PROTECTION ensures that stored TEE data are genuine and consistent
o O.TRUSTED_STORAGE enforces detection of corruption of the TA’s storage
o O.TA_AUTHENTICITY ensures that the authenticity of TA code is verified
o O.INITIALISATION ensures that the firmware that is executed is the intended version
o OE.ROLLBACK states the limits of the properties enforced by the TSF
*)</span>

<span class="keyword1"><span class="command">locale</span></span> OE_ROLLBACK

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'tee_data</span><span class="main">,</span><span class="tfree">'ts</span><span class="main">,</span><span class="tfree">'firmware</span><span class="main">)</span> store_data <span class="main">=</span> 
                               tee_data<span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'tee_data</span></span></span>
                               trust_store<span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'ts</span></span></span>
                               firm_ware<span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'firmware</span></span></span>
                 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_store_data</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="main">(</span><span class="tfree">'tee_data</span><span class="main">,</span><span class="tfree">'ts</span><span class="main">,</span><span class="tfree">'firmware</span><span class="main">)</span> store_data"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">get_store_data</span> <span class="free">s</span> <span class="main">≡</span> tee_data <span class="free">s</span>"</span></span>              

<span class="keyword1"><span class="command">locale</span></span> Storage_corruption <span class="main">=</span> O_OPERATION <span class="main">+</span> O_TEE_DATA_PROTECTION
        <span class="main">+</span> O_TRUSTED_STORAGE <span class="main">+</span> O_TA_AUTHENTICITY <span class="main">+</span> O_INITIALISATION
        <span class="main">+</span> OE_ROLLBACK

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> T_STORAGE_CORRUPTION
    <span class="keyword1"><span class="command">using</span></span> O_INITIALISATION_axioms O_OPERATION_axioms
          O_TEE_DATA_PROTECTION_axioms O_TEE_DATA_PROTECTION.intro
          O_TRUSTED_STORAGE_axioms O_TRUSTED_STORAGE.intro
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span>best<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>





<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="document"><span class="plain_text">"SOs for T.ABUSE_DEBUG"</span></span></span>

<span class="comment1">(*
T.ABUSE_DEBUG The objective for the environment OE.DISABLED_DEBUG ensures protection against 
abuse of debug functionality. 
*)</span>

<span class="keyword1"><span class="command">locale</span></span> OE_DISABLED_DEBUG

<span class="keyword1"><span class="command">locale</span></span> Debug <span class="main">=</span> OE_DISABLED_DEBUG <span class="main">+</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">debug</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'s</span>"</span></span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">check_drights</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'s</span><span class="main">⇒</span><span class="tfree">'d</span><span class="main">⇒</span>bool"</span></span>
      <span class="comment1">(*An attacker manages to be granted access to TEE Debug features*)</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">check_drights</span> <span class="free">s</span> <span class="free">d</span><span class="main">∧</span><span class="free">s'</span> <span class="main">=</span> <span class="free">debug</span> <span class="free">s</span><span class="main">⟶</span><span class="free">s'</span><span class="main">=</span><span class="free">s</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> T_ABUSE_DEBUG <span class="quoted"><span class="free">debug</span></span> <span class="quoted"><span class="free">check_drights</span></span> 
    <span class="keyword1"><span class="command">using</span></span> T_ABUSE_DEBUG_def Debug_axioms Debug_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="document"><span class="plain_text">"refinement theorem"</span></span></span>

<span class="keyword1"><span class="command">locale</span></span> SecurityThreats <span class="main">=</span> T_ABUSE_FUNCT <span class="main">+</span> T_CLONE <span class="main">+</span> T_FLUSH_DUMP <span class="main">+</span>
        T_IMPERSONATION <span class="main">+</span> T_ROGUE_CODE_EXECUTION <span class="main">+</span> T_PERTURBATION <span class="main">+</span>
        T_RAM <span class="main">+</span> T_RNG <span class="main">+</span> T_SPY <span class="main">+</span> T_TEE_FIRMWARE_DOWNGRADE <span class="main">+</span> T_STORAGE_CORRUPTION
        <span class="main">+</span> T_ABUSE_DEBUG

<span class="keyword1"><span class="command">locale</span></span> SecurityObjectives <span class="main">=</span> O_CA_TA_IDENTIFICATION <span class="main">+</span> O_KEYS_USAGE <span class="main">+</span> O_TEE_ID <span class="main">+</span>
        O_INITIALISATION <span class="main">+</span> O_INSTANCE_TIME <span class="main">+</span> O_OPERATION <span class="main">+</span> O_RNG <span class="main">+</span>
        O_TA_AUTHENTICITY <span class="main">+</span> O_TRUSTED_STORAGE <span class="main">+</span> O_RUNTIME_CONFIDENTIALITY <span class="main">+</span>
        O_RUNTIME_INTEGRITY <span class="main">+</span> O_TEE_DATA_PROTECTION <span class="main">+</span> O_TA_ISOLATION <span class="main">+</span>
        O_TEE_ISOLATION 

<span class="comment1">(*Theorem 1 (Threat-Objective refinement).*)</span>
<span class="keyword1"><span class="command">sublocale</span></span> SecurityObjectives <span class="main">⊆</span> SecurityThreats
          <span class="keyword1"><span class="command">oops</span></span>
<span class="comment1">(*sublocale here stand for a theorem*)</span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
<deepl-input-controller><template shadowrootmode="open"><link rel="stylesheet" href="chrome-extension://cofdbpoegempjloogbagkncekinflcnj/build/content.css"><div><div class="dl-input-translation-container svelte-ju4595"><div></div></div></div></template></deepl-input-controller></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>